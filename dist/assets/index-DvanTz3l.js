var qm=r=>{throw TypeError(r)};var Ld=(r,e,t)=>e.has(r)||qm("Cannot "+t);var H=(r,e,t)=>(Ld(r,e,"read from private field"),t?t.call(r):e.get(r)),ve=(r,e,t)=>e.has(r)?qm("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),ue=(r,e,t,n)=>(Ld(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),St=(r,e,t)=>(Ld(r,e,"access private method"),t);var xl=(r,e,t,n)=>({set _(s){ue(r,e,s,t)},get _(){return H(r,e,n)}});function kR(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in r)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(r,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function zE(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var qE={exports:{}},Ou={},YE={exports:{}},ge={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var il=Symbol.for("react.element"),PR=Symbol.for("react.portal"),DR=Symbol.for("react.fragment"),OR=Symbol.for("react.strict_mode"),NR=Symbol.for("react.profiler"),MR=Symbol.for("react.provider"),FR=Symbol.for("react.context"),$R=Symbol.for("react.forward_ref"),UR=Symbol.for("react.suspense"),BR=Symbol.for("react.memo"),jR=Symbol.for("react.lazy"),Ym=Symbol.iterator;function GR(r){return r===null||typeof r!="object"?null:(r=Ym&&r[Ym]||r["@@iterator"],typeof r=="function"?r:null)}var QE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},XE=Object.assign,JE={};function Po(r,e,t){this.props=r,this.context=e,this.refs=JE,this.updater=t||QE}Po.prototype.isReactComponent={};Po.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};Po.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function ZE(){}ZE.prototype=Po.prototype;function Vp(r,e,t){this.props=r,this.context=e,this.refs=JE,this.updater=t||QE}var Kp=Vp.prototype=new ZE;Kp.constructor=Vp;XE(Kp,Po.prototype);Kp.isPureReactComponent=!0;var Qm=Array.isArray,eS=Object.prototype.hasOwnProperty,Hp={current:null},tS={key:!0,ref:!0,__self:!0,__source:!0};function rS(r,e,t){var n,s={},i=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)eS.call(e,n)&&!tS.hasOwnProperty(n)&&(s[n]=e[n]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return{$$typeof:il,type:r,key:i,ref:o,props:s,_owner:Hp.current}}function VR(r,e){return{$$typeof:il,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function Wp(r){return typeof r=="object"&&r!==null&&r.$$typeof===il}function KR(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var Xm=/\/+/g;function Cd(r,e){return typeof r=="object"&&r!==null&&r.key!=null?KR(""+r.key):e.toString(36)}function fc(r,e,t,n,s){var i=typeof r;(i==="undefined"||i==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case il:case PR:o=!0}}if(o)return o=r,s=s(o),r=n===""?"."+Cd(o,0):n,Qm(s)?(t="",r!=null&&(t=r.replace(Xm,"$&/")+"/"),fc(s,e,t,"",function(c){return c})):s!=null&&(Wp(s)&&(s=VR(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Xm,"$&/")+"/")+r)),e.push(s)),1;if(o=0,n=n===""?".":n+":",Qm(r))for(var a=0;a<r.length;a++){i=r[a];var l=n+Cd(i,a);o+=fc(i,e,t,l,s)}else if(l=GR(r),typeof l=="function")for(r=l.call(r),a=0;!(i=r.next()).done;)i=i.value,l=n+Cd(i,a++),o+=fc(i,e,t,l,s);else if(i==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function wl(r,e,t){if(r==null)return r;var n=[],s=0;return fc(r,n,"","",function(i){return e.call(t,i,s++)}),n}function HR(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var kt={current:null},pc={transition:null},WR={ReactCurrentDispatcher:kt,ReactCurrentBatchConfig:pc,ReactCurrentOwner:Hp};function nS(){throw Error("act(...) is not supported in production builds of React.")}ge.Children={map:wl,forEach:function(r,e,t){wl(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return wl(r,function(){e++}),e},toArray:function(r){return wl(r,function(e){return e})||[]},only:function(r){if(!Wp(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};ge.Component=Po;ge.Fragment=DR;ge.Profiler=NR;ge.PureComponent=Vp;ge.StrictMode=OR;ge.Suspense=UR;ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WR;ge.act=nS;ge.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=XE({},r.props),s=r.key,i=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Hp.current),e.key!==void 0&&(s=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(l in e)eS.call(e,l)&&!tS.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:il,type:r.type,key:s,ref:i,props:n,_owner:o}};ge.createContext=function(r){return r={$$typeof:FR,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:MR,_context:r},r.Consumer=r};ge.createElement=rS;ge.createFactory=function(r){var e=rS.bind(null,r);return e.type=r,e};ge.createRef=function(){return{current:null}};ge.forwardRef=function(r){return{$$typeof:$R,render:r}};ge.isValidElement=Wp;ge.lazy=function(r){return{$$typeof:jR,_payload:{_status:-1,_result:r},_init:HR}};ge.memo=function(r,e){return{$$typeof:BR,type:r,compare:e===void 0?null:e}};ge.startTransition=function(r){var e=pc.transition;pc.transition={};try{r()}finally{pc.transition=e}};ge.unstable_act=nS;ge.useCallback=function(r,e){return kt.current.useCallback(r,e)};ge.useContext=function(r){return kt.current.useContext(r)};ge.useDebugValue=function(){};ge.useDeferredValue=function(r){return kt.current.useDeferredValue(r)};ge.useEffect=function(r,e){return kt.current.useEffect(r,e)};ge.useId=function(){return kt.current.useId()};ge.useImperativeHandle=function(r,e,t){return kt.current.useImperativeHandle(r,e,t)};ge.useInsertionEffect=function(r,e){return kt.current.useInsertionEffect(r,e)};ge.useLayoutEffect=function(r,e){return kt.current.useLayoutEffect(r,e)};ge.useMemo=function(r,e){return kt.current.useMemo(r,e)};ge.useReducer=function(r,e,t){return kt.current.useReducer(r,e,t)};ge.useRef=function(r){return kt.current.useRef(r)};ge.useState=function(r){return kt.current.useState(r)};ge.useSyncExternalStore=function(r,e,t){return kt.current.useSyncExternalStore(r,e,t)};ge.useTransition=function(){return kt.current.useTransition()};ge.version="18.3.1";YE.exports=ge;var w=YE.exports;const z=zE(w),zp=kR({__proto__:null,default:z},[w]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zR=w,qR=Symbol.for("react.element"),YR=Symbol.for("react.fragment"),QR=Object.prototype.hasOwnProperty,XR=zR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,JR={key:!0,ref:!0,__self:!0,__source:!0};function sS(r,e,t){var n,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)QR.call(e,n)&&!JR.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:qR,type:r,key:i,ref:o,props:s,_owner:XR.current}}Ou.Fragment=YR;Ou.jsx=sS;Ou.jsxs=sS;qE.exports=Ou;var _=qE.exports,iS={exports:{}},ar={},oS={exports:{}},aS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(P,k){var j=P.length;P.push(k);e:for(;0<j;){var U=j-1>>>1,$=P[U];if(0<s($,k))P[U]=k,P[j]=$,j=U;else break e}}function t(P){return P.length===0?null:P[0]}function n(P){if(P.length===0)return null;var k=P[0],j=P.pop();if(j!==k){P[0]=j;e:for(var U=0,$=P.length,q=$>>>1;U<q;){var Q=2*(U+1)-1,Z=P[Q],re=Q+1,se=P[re];if(0>s(Z,j))re<$&&0>s(se,Z)?(P[U]=se,P[re]=j,U=re):(P[U]=Z,P[Q]=j,U=Q);else if(re<$&&0>s(se,j))P[U]=se,P[re]=j,U=re;else break e}}return k}function s(P,k){var j=P.sortIndex-k.sortIndex;return j!==0?j:P.id-k.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(P){for(var k=t(c);k!==null;){if(k.callback===null)n(c);else if(k.startTime<=P)n(c),k.sortIndex=k.expirationTime,e(l,k);else break;k=t(c)}}function S(P){if(g=!1,E(P),!p)if(t(l)!==null)p=!0,M(T);else{var k=t(c);k!==null&&K(S,k.startTime-P)}}function T(P,k){p=!1,g&&(g=!1,y(R),R=-1),f=!0;var j=h;try{for(E(k),d=t(l);d!==null&&(!(d.expirationTime>k)||P&&!C());){var U=d.callback;if(typeof U=="function"){d.callback=null,h=d.priorityLevel;var $=U(d.expirationTime<=k);k=r.unstable_now(),typeof $=="function"?d.callback=$:d===t(l)&&n(l),E(k)}else n(l);d=t(l)}if(d!==null)var q=!0;else{var Q=t(c);Q!==null&&K(S,Q.startTime-k),q=!1}return q}finally{d=null,h=j,f=!1}}var A=!1,b=null,R=-1,L=5,I=-1;function C(){return!(r.unstable_now()-I<L)}function D(){if(b!==null){var P=r.unstable_now();I=P;var k=!0;try{k=b(!0,P)}finally{k?B():(A=!1,b=null)}}else A=!1}var B;if(typeof v=="function")B=function(){v(D)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,V=F.port2;F.port1.onmessage=D,B=function(){V.postMessage(null)}}else B=function(){m(D,0)};function M(P){b=P,A||(A=!0,B())}function K(P,k){R=m(function(){P(r.unstable_now())},k)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(P){P.callback=null},r.unstable_continueExecution=function(){p||f||(p=!0,M(T))},r.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<P?Math.floor(1e3/P):5},r.unstable_getCurrentPriorityLevel=function(){return h},r.unstable_getFirstCallbackNode=function(){return t(l)},r.unstable_next=function(P){switch(h){case 1:case 2:case 3:var k=3;break;default:k=h}var j=h;h=k;try{return P()}finally{h=j}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(P,k){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var j=h;h=P;try{return k()}finally{h=j}},r.unstable_scheduleCallback=function(P,k,j){var U=r.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?U+j:U):j=U,P){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=j+$,P={id:u++,callback:k,priorityLevel:P,startTime:j,expirationTime:$,sortIndex:-1},j>U?(P.sortIndex=j,e(c,P),t(l)===null&&P===t(c)&&(g?(y(R),R=-1):g=!0,K(S,j-U))):(P.sortIndex=$,e(l,P),p||f||(p=!0,M(T))),P},r.unstable_shouldYield=C,r.unstable_wrapCallback=function(P){var k=h;return function(){var j=h;h=k;try{return P.apply(this,arguments)}finally{h=j}}}})(aS);oS.exports=aS;var ZR=oS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eI=w,ir=ZR;function W(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lS=new Set,Sa={};function di(r,e){xo(r,e),xo(r+"Capture",e)}function xo(r,e){for(Sa[r]=e,r=0;r<e.length;r++)lS.add(e[r])}var In=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qh=Object.prototype.hasOwnProperty,tI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Jm={},Zm={};function rI(r){return Qh.call(Zm,r)?!0:Qh.call(Jm,r)?!1:tI.test(r)?Zm[r]=!0:(Jm[r]=!0,!1)}function nI(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function sI(r,e,t,n){if(e===null||typeof e>"u"||nI(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Pt(r,e,t,n,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var vt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){vt[r]=new Pt(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];vt[e]=new Pt(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){vt[r]=new Pt(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){vt[r]=new Pt(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){vt[r]=new Pt(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){vt[r]=new Pt(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){vt[r]=new Pt(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){vt[r]=new Pt(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){vt[r]=new Pt(r,5,!1,r.toLowerCase(),null,!1,!1)});var qp=/[\-:]([a-z])/g;function Yp(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(qp,Yp);vt[e]=new Pt(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(qp,Yp);vt[e]=new Pt(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(qp,Yp);vt[e]=new Pt(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){vt[r]=new Pt(r,1,!1,r.toLowerCase(),null,!1,!1)});vt.xlinkHref=new Pt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){vt[r]=new Pt(r,1,!1,r.toLowerCase(),null,!0,!0)});function Qp(r,e,t,n){var s=vt.hasOwnProperty(e)?vt[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(sI(e,t,s,n)&&(t=null),n||s===null?rI(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):s.mustUseProperty?r[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,n=s.attributeNamespace,t===null?r.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var Nn=eI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tl=Symbol.for("react.element"),Fi=Symbol.for("react.portal"),$i=Symbol.for("react.fragment"),Xp=Symbol.for("react.strict_mode"),Xh=Symbol.for("react.profiler"),cS=Symbol.for("react.provider"),uS=Symbol.for("react.context"),Jp=Symbol.for("react.forward_ref"),Jh=Symbol.for("react.suspense"),Zh=Symbol.for("react.suspense_list"),Zp=Symbol.for("react.memo"),Qn=Symbol.for("react.lazy"),dS=Symbol.for("react.offscreen"),e0=Symbol.iterator;function Bo(r){return r===null||typeof r!="object"?null:(r=e0&&r[e0]||r["@@iterator"],typeof r=="function"?r:null)}var Ve=Object.assign,kd;function Xo(r){if(kd===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);kd=e&&e[1]||""}return`
`+kd+r}var Pd=!1;function Dd(r,e){if(!r||Pd)return"";Pd=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var n=c}Reflect.construct(r,[],e)}else{try{e.call()}catch(c){n=c}r.call(e.prototype)}else{try{throw Error()}catch(c){n=c}r()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=n.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return r.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",r.displayName)),l}while(1<=o&&0<=a);break}}}finally{Pd=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?Xo(r):""}function iI(r){switch(r.tag){case 5:return Xo(r.type);case 16:return Xo("Lazy");case 13:return Xo("Suspense");case 19:return Xo("SuspenseList");case 0:case 2:case 15:return r=Dd(r.type,!1),r;case 11:return r=Dd(r.type.render,!1),r;case 1:return r=Dd(r.type,!0),r;default:return""}}function ef(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case $i:return"Fragment";case Fi:return"Portal";case Xh:return"Profiler";case Xp:return"StrictMode";case Jh:return"Suspense";case Zh:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case uS:return(r.displayName||"Context")+".Consumer";case cS:return(r._context.displayName||"Context")+".Provider";case Jp:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Zp:return e=r.displayName||null,e!==null?e:ef(r.type)||"Memo";case Qn:e=r._payload,r=r._init;try{return ef(r(e))}catch{}}return null}function oI(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ef(e);case 8:return e===Xp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ws(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function hS(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function aI(r){var e=hS(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function bl(r){r._valueTracker||(r._valueTracker=aI(r))}function fS(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=hS(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function $c(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function tf(r,e){var t=e.checked;return Ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function t0(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=ws(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function pS(r,e){e=e.checked,e!=null&&Qp(r,"checked",e,!1)}function rf(r,e){pS(r,e);var t=ws(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?nf(r,e.type,t):e.hasOwnProperty("defaultValue")&&nf(r,e.type,ws(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function r0(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function nf(r,e,t){(e!=="number"||$c(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var Jo=Array.isArray;function Xi(r,e,t,n){if(r=r.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<r.length;t++)s=e.hasOwnProperty("$"+r[t].value),r[t].selected!==s&&(r[t].selected=s),s&&n&&(r[t].defaultSelected=!0)}else{for(t=""+ws(t),e=null,s=0;s<r.length;s++){if(r[s].value===t){r[s].selected=!0,n&&(r[s].defaultSelected=!0);return}e!==null||r[s].disabled||(e=r[s])}e!==null&&(e.selected=!0)}}function sf(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(W(91));return Ve({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function n0(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(W(92));if(Jo(t)){if(1<t.length)throw Error(W(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:ws(t)}}function gS(r,e){var t=ws(e.value),n=ws(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function s0(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function mS(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function of(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?mS(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var _l,yS=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,s)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(_l=_l||document.createElement("div"),_l.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=_l.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function xa(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var sa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lI=["Webkit","ms","Moz","O"];Object.keys(sa).forEach(function(r){lI.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),sa[e]=sa[r]})});function vS(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||sa.hasOwnProperty(r)&&sa[r]?(""+e).trim():e+"px"}function ES(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,s=vS(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,s):r[t]=s}}var cI=Ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function af(r,e){if(e){if(cI[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(W(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(W(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(W(61))}if(e.style!=null&&typeof e.style!="object")throw Error(W(62))}}function lf(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cf=null;function eg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var uf=null,Ji=null,Zi=null;function i0(r){if(r=ll(r)){if(typeof uf!="function")throw Error(W(280));var e=r.stateNode;e&&(e=Uu(e),uf(r.stateNode,r.type,e))}}function SS(r){Ji?Zi?Zi.push(r):Zi=[r]:Ji=r}function xS(){if(Ji){var r=Ji,e=Zi;if(Zi=Ji=null,i0(r),e)for(r=0;r<e.length;r++)i0(e[r])}}function wS(r,e){return r(e)}function TS(){}var Od=!1;function bS(r,e,t){if(Od)return r(e,t);Od=!0;try{return wS(r,e,t)}finally{Od=!1,(Ji!==null||Zi!==null)&&(TS(),xS())}}function wa(r,e){var t=r.stateNode;if(t===null)return null;var n=Uu(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(W(231,e,typeof t));return t}var df=!1;if(In)try{var jo={};Object.defineProperty(jo,"passive",{get:function(){df=!0}}),window.addEventListener("test",jo,jo),window.removeEventListener("test",jo,jo)}catch{df=!1}function uI(r,e,t,n,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var ia=!1,Uc=null,Bc=!1,hf=null,dI={onError:function(r){ia=!0,Uc=r}};function hI(r,e,t,n,s,i,o,a,l){ia=!1,Uc=null,uI.apply(dI,arguments)}function fI(r,e,t,n,s,i,o,a,l){if(hI.apply(this,arguments),ia){if(ia){var c=Uc;ia=!1,Uc=null}else throw Error(W(198));Bc||(Bc=!0,hf=c)}}function hi(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function _S(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function o0(r){if(hi(r)!==r)throw Error(W(188))}function pI(r){var e=r.alternate;if(!e){if(e=hi(r),e===null)throw Error(W(188));return e!==r?null:r}for(var t=r,n=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return o0(s),r;if(i===n)return o0(s),e;i=i.sibling}throw Error(W(188))}if(t.return!==n.return)t=s,n=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o)throw Error(W(189))}}if(t.alternate!==n)throw Error(W(190))}if(t.tag!==3)throw Error(W(188));return t.stateNode.current===t?r:e}function AS(r){return r=pI(r),r!==null?RS(r):null}function RS(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=RS(r);if(e!==null)return e;r=r.sibling}return null}var IS=ir.unstable_scheduleCallback,a0=ir.unstable_cancelCallback,gI=ir.unstable_shouldYield,mI=ir.unstable_requestPaint,Ye=ir.unstable_now,yI=ir.unstable_getCurrentPriorityLevel,tg=ir.unstable_ImmediatePriority,LS=ir.unstable_UserBlockingPriority,jc=ir.unstable_NormalPriority,vI=ir.unstable_LowPriority,CS=ir.unstable_IdlePriority,Nu=null,on=null;function EI(r){if(on&&typeof on.onCommitFiberRoot=="function")try{on.onCommitFiberRoot(Nu,r,void 0,(r.current.flags&128)===128)}catch{}}var $r=Math.clz32?Math.clz32:wI,SI=Math.log,xI=Math.LN2;function wI(r){return r>>>=0,r===0?32:31-(SI(r)/xI|0)|0}var Al=64,Rl=4194304;function Zo(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Gc(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,s=r.suspendedLanes,i=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?n=Zo(a):(i&=o,i!==0&&(n=Zo(i)))}else o=t&~s,o!==0?n=Zo(o):i!==0&&(n=Zo(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-$r(e),s=1<<t,n|=r[t],e&=~s;return n}function TI(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bI(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,s=r.expirationTimes,i=r.pendingLanes;0<i;){var o=31-$r(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&n)&&(s[o]=TI(a,e)):l<=e&&(r.expiredLanes|=a),i&=~a}}function ff(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function kS(){var r=Al;return Al<<=1,!(Al&4194240)&&(Al=64),r}function Nd(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function ol(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-$r(e),r[e]=t}function _I(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var s=31-$r(t),i=1<<s;e[s]=0,n[s]=-1,r[s]=-1,t&=~i}}function rg(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-$r(t),s=1<<n;s&e|r[n]&e&&(r[n]|=e),t&=~s}}var Te=0;function PS(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var DS,ng,OS,NS,MS,pf=!1,Il=[],fs=null,ps=null,gs=null,Ta=new Map,ba=new Map,ts=[],AI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function l0(r,e){switch(r){case"focusin":case"focusout":fs=null;break;case"dragenter":case"dragleave":ps=null;break;case"mouseover":case"mouseout":gs=null;break;case"pointerover":case"pointerout":Ta.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ba.delete(e.pointerId)}}function Go(r,e,t,n,s,i){return r===null||r.nativeEvent!==i?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ll(e),e!==null&&ng(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),r)}function RI(r,e,t,n,s){switch(e){case"focusin":return fs=Go(fs,r,e,t,n,s),!0;case"dragenter":return ps=Go(ps,r,e,t,n,s),!0;case"mouseover":return gs=Go(gs,r,e,t,n,s),!0;case"pointerover":var i=s.pointerId;return Ta.set(i,Go(Ta.get(i)||null,r,e,t,n,s)),!0;case"gotpointercapture":return i=s.pointerId,ba.set(i,Go(ba.get(i)||null,r,e,t,n,s)),!0}return!1}function FS(r){var e=Hs(r.target);if(e!==null){var t=hi(e);if(t!==null){if(e=t.tag,e===13){if(e=_S(t),e!==null){r.blockedOn=e,MS(r.priority,function(){OS(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function gc(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=gf(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);cf=n,t.target.dispatchEvent(n),cf=null}else return e=ll(t),e!==null&&ng(e),r.blockedOn=t,!1;e.shift()}return!0}function c0(r,e,t){gc(r)&&t.delete(e)}function II(){pf=!1,fs!==null&&gc(fs)&&(fs=null),ps!==null&&gc(ps)&&(ps=null),gs!==null&&gc(gs)&&(gs=null),Ta.forEach(c0),ba.forEach(c0)}function Vo(r,e){r.blockedOn===e&&(r.blockedOn=null,pf||(pf=!0,ir.unstable_scheduleCallback(ir.unstable_NormalPriority,II)))}function _a(r){function e(s){return Vo(s,r)}if(0<Il.length){Vo(Il[0],r);for(var t=1;t<Il.length;t++){var n=Il[t];n.blockedOn===r&&(n.blockedOn=null)}}for(fs!==null&&Vo(fs,r),ps!==null&&Vo(ps,r),gs!==null&&Vo(gs,r),Ta.forEach(e),ba.forEach(e),t=0;t<ts.length;t++)n=ts[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<ts.length&&(t=ts[0],t.blockedOn===null);)FS(t),t.blockedOn===null&&ts.shift()}var eo=Nn.ReactCurrentBatchConfig,Vc=!0;function LI(r,e,t,n){var s=Te,i=eo.transition;eo.transition=null;try{Te=1,sg(r,e,t,n)}finally{Te=s,eo.transition=i}}function CI(r,e,t,n){var s=Te,i=eo.transition;eo.transition=null;try{Te=4,sg(r,e,t,n)}finally{Te=s,eo.transition=i}}function sg(r,e,t,n){if(Vc){var s=gf(r,e,t,n);if(s===null)Hd(r,e,n,Kc,t),l0(r,n);else if(RI(s,r,e,t,n))n.stopPropagation();else if(l0(r,n),e&4&&-1<AI.indexOf(r)){for(;s!==null;){var i=ll(s);if(i!==null&&DS(i),i=gf(r,e,t,n),i===null&&Hd(r,e,n,Kc,t),i===s)break;s=i}s!==null&&n.stopPropagation()}else Hd(r,e,n,null,t)}}var Kc=null;function gf(r,e,t,n){if(Kc=null,r=eg(n),r=Hs(r),r!==null)if(e=hi(r),e===null)r=null;else if(t=e.tag,t===13){if(r=_S(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return Kc=r,null}function $S(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yI()){case tg:return 1;case LS:return 4;case jc:case vI:return 16;case CS:return 536870912;default:return 16}default:return 16}}var cs=null,ig=null,mc=null;function US(){if(mc)return mc;var r,e=ig,t=e.length,n,s="value"in cs?cs.value:cs.textContent,i=s.length;for(r=0;r<t&&e[r]===s[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===s[i-n];n++);return mc=s.slice(r,1<n?1-n:void 0)}function yc(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function Ll(){return!0}function u0(){return!1}function lr(r){function e(t,n,s,i,o){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ll:u0,this.isPropagationStopped=u0,this}return Ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ll)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ll)},persist:function(){},isPersistent:Ll}),e}var Do={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},og=lr(Do),al=Ve({},Do,{view:0,detail:0}),kI=lr(al),Md,Fd,Ko,Mu=Ve({},al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ag,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ko&&(Ko&&r.type==="mousemove"?(Md=r.screenX-Ko.screenX,Fd=r.screenY-Ko.screenY):Fd=Md=0,Ko=r),Md)},movementY:function(r){return"movementY"in r?r.movementY:Fd}}),d0=lr(Mu),PI=Ve({},Mu,{dataTransfer:0}),DI=lr(PI),OI=Ve({},al,{relatedTarget:0}),$d=lr(OI),NI=Ve({},Do,{animationName:0,elapsedTime:0,pseudoElement:0}),MI=lr(NI),FI=Ve({},Do,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),$I=lr(FI),UI=Ve({},Do,{data:0}),h0=lr(UI),BI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},GI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VI(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=GI[r])?!!e[r]:!1}function ag(){return VI}var KI=Ve({},al,{key:function(r){if(r.key){var e=BI[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=yc(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?jI[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ag,charCode:function(r){return r.type==="keypress"?yc(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?yc(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),HI=lr(KI),WI=Ve({},Mu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),f0=lr(WI),zI=Ve({},al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ag}),qI=lr(zI),YI=Ve({},Do,{propertyName:0,elapsedTime:0,pseudoElement:0}),QI=lr(YI),XI=Ve({},Mu,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),JI=lr(XI),ZI=[9,13,27,32],lg=In&&"CompositionEvent"in window,oa=null;In&&"documentMode"in document&&(oa=document.documentMode);var e1=In&&"TextEvent"in window&&!oa,BS=In&&(!lg||oa&&8<oa&&11>=oa),p0=" ",g0=!1;function jS(r,e){switch(r){case"keyup":return ZI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function GS(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ui=!1;function t1(r,e){switch(r){case"compositionend":return GS(e);case"keypress":return e.which!==32?null:(g0=!0,p0);case"textInput":return r=e.data,r===p0&&g0?null:r;default:return null}}function r1(r,e){if(Ui)return r==="compositionend"||!lg&&jS(r,e)?(r=US(),mc=ig=cs=null,Ui=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return BS&&e.locale!=="ko"?null:e.data;default:return null}}var n1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function m0(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!n1[r.type]:e==="textarea"}function VS(r,e,t,n){SS(n),e=Hc(e,"onChange"),0<e.length&&(t=new og("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var aa=null,Aa=null;function s1(r){ex(r,0)}function Fu(r){var e=Gi(r);if(fS(e))return r}function i1(r,e){if(r==="change")return e}var KS=!1;if(In){var Ud;if(In){var Bd="oninput"in document;if(!Bd){var y0=document.createElement("div");y0.setAttribute("oninput","return;"),Bd=typeof y0.oninput=="function"}Ud=Bd}else Ud=!1;KS=Ud&&(!document.documentMode||9<document.documentMode)}function v0(){aa&&(aa.detachEvent("onpropertychange",HS),Aa=aa=null)}function HS(r){if(r.propertyName==="value"&&Fu(Aa)){var e=[];VS(e,Aa,r,eg(r)),bS(s1,e)}}function o1(r,e,t){r==="focusin"?(v0(),aa=e,Aa=t,aa.attachEvent("onpropertychange",HS)):r==="focusout"&&v0()}function a1(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Fu(Aa)}function l1(r,e){if(r==="click")return Fu(e)}function c1(r,e){if(r==="input"||r==="change")return Fu(e)}function u1(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var Br=typeof Object.is=="function"?Object.is:u1;function Ra(r,e){if(Br(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!Qh.call(e,s)||!Br(r[s],e[s]))return!1}return!0}function E0(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function S0(r,e){var t=E0(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=E0(t)}}function WS(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?WS(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function zS(){for(var r=window,e=$c();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=$c(r.document)}return e}function cg(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function d1(r){var e=zS(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&WS(t.ownerDocument.documentElement,t)){if(n!==null&&cg(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var s=t.textContent.length,i=Math.min(n.start,s);n=n.end===void 0?i:Math.min(n.end,s),!r.extend&&i>n&&(s=n,n=i,i=s),s=S0(t,i);var o=S0(t,n);s&&o&&(r.rangeCount!==1||r.anchorNode!==s.node||r.anchorOffset!==s.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),r.removeAllRanges(),i>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var h1=In&&"documentMode"in document&&11>=document.documentMode,Bi=null,mf=null,la=null,yf=!1;function x0(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;yf||Bi==null||Bi!==$c(n)||(n=Bi,"selectionStart"in n&&cg(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),la&&Ra(la,n)||(la=n,n=Hc(mf,"onSelect"),0<n.length&&(e=new og("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=Bi)))}function Cl(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var ji={animationend:Cl("Animation","AnimationEnd"),animationiteration:Cl("Animation","AnimationIteration"),animationstart:Cl("Animation","AnimationStart"),transitionend:Cl("Transition","TransitionEnd")},jd={},qS={};In&&(qS=document.createElement("div").style,"AnimationEvent"in window||(delete ji.animationend.animation,delete ji.animationiteration.animation,delete ji.animationstart.animation),"TransitionEvent"in window||delete ji.transitionend.transition);function $u(r){if(jd[r])return jd[r];if(!ji[r])return r;var e=ji[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in qS)return jd[r]=e[t];return r}var YS=$u("animationend"),QS=$u("animationiteration"),XS=$u("animationstart"),JS=$u("transitionend"),ZS=new Map,w0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Is(r,e){ZS.set(r,e),di(e,[r])}for(var Gd=0;Gd<w0.length;Gd++){var Vd=w0[Gd],f1=Vd.toLowerCase(),p1=Vd[0].toUpperCase()+Vd.slice(1);Is(f1,"on"+p1)}Is(YS,"onAnimationEnd");Is(QS,"onAnimationIteration");Is(XS,"onAnimationStart");Is("dblclick","onDoubleClick");Is("focusin","onFocus");Is("focusout","onBlur");Is(JS,"onTransitionEnd");xo("onMouseEnter",["mouseout","mouseover"]);xo("onMouseLeave",["mouseout","mouseover"]);xo("onPointerEnter",["pointerout","pointerover"]);xo("onPointerLeave",["pointerout","pointerover"]);di("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));di("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));di("onBeforeInput",["compositionend","keypress","textInput","paste"]);di("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));di("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));di("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ea="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),g1=new Set("cancel close invalid load scroll toggle".split(" ").concat(ea));function T0(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,fI(n,e,void 0,r),r.currentTarget=null}function ex(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],s=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;T0(s,a,c),i=l}else for(o=0;o<n.length;o++){if(a=n[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;T0(s,a,c),i=l}}}if(Bc)throw r=hf,Bc=!1,hf=null,r}function Pe(r,e){var t=e[wf];t===void 0&&(t=e[wf]=new Set);var n=r+"__bubble";t.has(n)||(tx(e,r,2,!1),t.add(n))}function Kd(r,e,t){var n=0;e&&(n|=4),tx(t,r,n,e)}var kl="_reactListening"+Math.random().toString(36).slice(2);function Ia(r){if(!r[kl]){r[kl]=!0,lS.forEach(function(t){t!=="selectionchange"&&(g1.has(t)||Kd(t,!1,r),Kd(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[kl]||(e[kl]=!0,Kd("selectionchange",!1,e))}}function tx(r,e,t,n){switch($S(e)){case 1:var s=LI;break;case 4:s=CI;break;default:s=sg}t=s.bind(null,e,t,r),s=void 0,!df||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?r.addEventListener(e,t,{capture:!0,passive:s}):r.addEventListener(e,t,!0):s!==void 0?r.addEventListener(e,t,{passive:s}):r.addEventListener(e,t,!1)}function Hd(r,e,t,n,s){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Hs(a),o===null)return;if(l=o.tag,l===5||l===6){n=i=o;continue e}a=a.parentNode}}n=n.return}bS(function(){var c=i,u=eg(t),d=[];e:{var h=ZS.get(r);if(h!==void 0){var f=og,p=r;switch(r){case"keypress":if(yc(t)===0)break e;case"keydown":case"keyup":f=HI;break;case"focusin":p="focus",f=$d;break;case"focusout":p="blur",f=$d;break;case"beforeblur":case"afterblur":f=$d;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=d0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=DI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=qI;break;case YS:case QS:case XS:f=MI;break;case JS:f=QI;break;case"scroll":f=kI;break;case"wheel":f=JI;break;case"copy":case"cut":case"paste":f=$I;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=f0}var g=(e&4)!==0,m=!g&&r==="scroll",y=g?h!==null?h+"Capture":null:h;g=[];for(var v=c,E;v!==null;){E=v;var S=E.stateNode;if(E.tag===5&&S!==null&&(E=S,y!==null&&(S=wa(v,y),S!=null&&g.push(La(v,S,E)))),m)break;v=v.return}0<g.length&&(h=new f(h,p,null,t,u),d.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=r==="mouseover"||r==="pointerover",f=r==="mouseout"||r==="pointerout",h&&t!==cf&&(p=t.relatedTarget||t.fromElement)&&(Hs(p)||p[Ln]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=c,p=p?Hs(p):null,p!==null&&(m=hi(p),p!==m||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(g=d0,S="onMouseLeave",y="onMouseEnter",v="mouse",(r==="pointerout"||r==="pointerover")&&(g=f0,S="onPointerLeave",y="onPointerEnter",v="pointer"),m=f==null?h:Gi(f),E=p==null?h:Gi(p),h=new g(S,v+"leave",f,t,u),h.target=m,h.relatedTarget=E,S=null,Hs(u)===c&&(g=new g(y,v+"enter",p,t,u),g.target=E,g.relatedTarget=m,S=g),m=S,f&&p)t:{for(g=f,y=p,v=0,E=g;E;E=vi(E))v++;for(E=0,S=y;S;S=vi(S))E++;for(;0<v-E;)g=vi(g),v--;for(;0<E-v;)y=vi(y),E--;for(;v--;){if(g===y||y!==null&&g===y.alternate)break t;g=vi(g),y=vi(y)}g=null}else g=null;f!==null&&b0(d,h,f,g,!1),p!==null&&m!==null&&b0(d,m,p,g,!0)}}e:{if(h=c?Gi(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var T=i1;else if(m0(h))if(KS)T=c1;else{T=a1;var A=o1}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(T=l1);if(T&&(T=T(r,c))){VS(d,T,t,u);break e}A&&A(r,h,c),r==="focusout"&&(A=h._wrapperState)&&A.controlled&&h.type==="number"&&nf(h,"number",h.value)}switch(A=c?Gi(c):window,r){case"focusin":(m0(A)||A.contentEditable==="true")&&(Bi=A,mf=c,la=null);break;case"focusout":la=mf=Bi=null;break;case"mousedown":yf=!0;break;case"contextmenu":case"mouseup":case"dragend":yf=!1,x0(d,t,u);break;case"selectionchange":if(h1)break;case"keydown":case"keyup":x0(d,t,u)}var b;if(lg)e:{switch(r){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Ui?jS(r,t)&&(R="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(BS&&t.locale!=="ko"&&(Ui||R!=="onCompositionStart"?R==="onCompositionEnd"&&Ui&&(b=US()):(cs=u,ig="value"in cs?cs.value:cs.textContent,Ui=!0)),A=Hc(c,R),0<A.length&&(R=new h0(R,r,null,t,u),d.push({event:R,listeners:A}),b?R.data=b:(b=GS(t),b!==null&&(R.data=b)))),(b=e1?t1(r,t):r1(r,t))&&(c=Hc(c,"onBeforeInput"),0<c.length&&(u=new h0("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=b))}ex(d,e)})}function La(r,e,t){return{instance:r,listener:e,currentTarget:t}}function Hc(r,e){for(var t=e+"Capture",n=[];r!==null;){var s=r,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=wa(r,t),i!=null&&n.unshift(La(r,i,s)),i=wa(r,e),i!=null&&n.push(La(r,i,s))),r=r.return}return n}function vi(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function b0(r,e,t,n,s){for(var i=e._reactName,o=[];t!==null&&t!==n;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,s?(l=wa(t,i),l!=null&&o.unshift(La(t,l,a))):s||(l=wa(t,i),l!=null&&o.push(La(t,l,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var m1=/\r\n?/g,y1=/\u0000|\uFFFD/g;function _0(r){return(typeof r=="string"?r:""+r).replace(m1,`
`).replace(y1,"")}function Pl(r,e,t){if(e=_0(e),_0(r)!==e&&t)throw Error(W(425))}function Wc(){}var vf=null,Ef=null;function Sf(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xf=typeof setTimeout=="function"?setTimeout:void 0,v1=typeof clearTimeout=="function"?clearTimeout:void 0,A0=typeof Promise=="function"?Promise:void 0,E1=typeof queueMicrotask=="function"?queueMicrotask:typeof A0<"u"?function(r){return A0.resolve(null).then(r).catch(S1)}:xf;function S1(r){setTimeout(function(){throw r})}function Wd(r,e){var t=e,n=0;do{var s=t.nextSibling;if(r.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(n===0){r.removeChild(s),_a(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=s}while(t);_a(e)}function ms(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function R0(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Oo=Math.random().toString(36).slice(2),en="__reactFiber$"+Oo,Ca="__reactProps$"+Oo,Ln="__reactContainer$"+Oo,wf="__reactEvents$"+Oo,x1="__reactListeners$"+Oo,w1="__reactHandles$"+Oo;function Hs(r){var e=r[en];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Ln]||t[en]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=R0(r);r!==null;){if(t=r[en])return t;r=R0(r)}return e}r=t,t=r.parentNode}return null}function ll(r){return r=r[en]||r[Ln],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Gi(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(W(33))}function Uu(r){return r[Ca]||null}var Tf=[],Vi=-1;function Ls(r){return{current:r}}function De(r){0>Vi||(r.current=Tf[Vi],Tf[Vi]=null,Vi--)}function Ce(r,e){Vi++,Tf[Vi]=r.current,r.current=e}var Ts={},_t=Ls(Ts),jt=Ls(!1),si=Ts;function wo(r,e){var t=r.type.contextTypes;if(!t)return Ts;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=s),s}function Gt(r){return r=r.childContextTypes,r!=null}function zc(){De(jt),De(_t)}function I0(r,e,t){if(_t.current!==Ts)throw Error(W(168));Ce(_t,e),Ce(jt,t)}function rx(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(W(108,oI(r)||"Unknown",s));return Ve({},t,n)}function qc(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Ts,si=_t.current,Ce(_t,r),Ce(jt,jt.current),!0}function L0(r,e,t){var n=r.stateNode;if(!n)throw Error(W(169));t?(r=rx(r,e,si),n.__reactInternalMemoizedMergedChildContext=r,De(jt),De(_t),Ce(_t,r)):De(jt),Ce(jt,t)}var Tn=null,Bu=!1,zd=!1;function nx(r){Tn===null?Tn=[r]:Tn.push(r)}function T1(r){Bu=!0,nx(r)}function Cs(){if(!zd&&Tn!==null){zd=!0;var r=0,e=Te;try{var t=Tn;for(Te=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}Tn=null,Bu=!1}catch(s){throw Tn!==null&&(Tn=Tn.slice(r+1)),IS(tg,Cs),s}finally{Te=e,zd=!1}}return null}var Ki=[],Hi=0,Yc=null,Qc=0,fr=[],pr=0,ii=null,_n=1,An="";function Us(r,e){Ki[Hi++]=Qc,Ki[Hi++]=Yc,Yc=r,Qc=e}function sx(r,e,t){fr[pr++]=_n,fr[pr++]=An,fr[pr++]=ii,ii=r;var n=_n;r=An;var s=32-$r(n)-1;n&=~(1<<s),t+=1;var i=32-$r(e)+s;if(30<i){var o=s-s%5;i=(n&(1<<o)-1).toString(32),n>>=o,s-=o,_n=1<<32-$r(e)+s|t<<s|n,An=i+r}else _n=1<<i|t<<s|n,An=r}function ug(r){r.return!==null&&(Us(r,1),sx(r,1,0))}function dg(r){for(;r===Yc;)Yc=Ki[--Hi],Ki[Hi]=null,Qc=Ki[--Hi],Ki[Hi]=null;for(;r===ii;)ii=fr[--pr],fr[pr]=null,An=fr[--pr],fr[pr]=null,_n=fr[--pr],fr[pr]=null}var rr=null,tr=null,Me=!1,Fr=null;function ix(r,e){var t=gr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function C0(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,rr=r,tr=ms(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,rr=r,tr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ii!==null?{id:_n,overflow:An}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=gr(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,rr=r,tr=null,!0):!1;default:return!1}}function bf(r){return(r.mode&1)!==0&&(r.flags&128)===0}function _f(r){if(Me){var e=tr;if(e){var t=e;if(!C0(r,e)){if(bf(r))throw Error(W(418));e=ms(t.nextSibling);var n=rr;e&&C0(r,e)?ix(n,t):(r.flags=r.flags&-4097|2,Me=!1,rr=r)}}else{if(bf(r))throw Error(W(418));r.flags=r.flags&-4097|2,Me=!1,rr=r}}}function k0(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;rr=r}function Dl(r){if(r!==rr)return!1;if(!Me)return k0(r),Me=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!Sf(r.type,r.memoizedProps)),e&&(e=tr)){if(bf(r))throw ox(),Error(W(418));for(;e;)ix(r,e),e=ms(e.nextSibling)}if(k0(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(W(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){tr=ms(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}tr=null}}else tr=rr?ms(r.stateNode.nextSibling):null;return!0}function ox(){for(var r=tr;r;)r=ms(r.nextSibling)}function To(){tr=rr=null,Me=!1}function hg(r){Fr===null?Fr=[r]:Fr.push(r)}var b1=Nn.ReactCurrentBatchConfig;function Ho(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(W(309));var n=t.stateNode}if(!n)throw Error(W(147,r));var s=n,i=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof r!="string")throw Error(W(284));if(!t._owner)throw Error(W(290,r))}return r}function Ol(r,e){throw r=Object.prototype.toString.call(e),Error(W(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function P0(r){var e=r._init;return e(r._payload)}function ax(r){function e(y,v){if(r){var E=y.deletions;E===null?(y.deletions=[v],y.flags|=16):E.push(v)}}function t(y,v){if(!r)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function n(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function s(y,v){return y=Ss(y,v),y.index=0,y.sibling=null,y}function i(y,v,E){return y.index=E,r?(E=y.alternate,E!==null?(E=E.index,E<v?(y.flags|=2,v):E):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,v,E,S){return v===null||v.tag!==6?(v=eh(E,y.mode,S),v.return=y,v):(v=s(v,E),v.return=y,v)}function l(y,v,E,S){var T=E.type;return T===$i?u(y,v,E.props.children,S,E.key):v!==null&&(v.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Qn&&P0(T)===v.type)?(S=s(v,E.props),S.ref=Ho(y,v,E),S.return=y,S):(S=bc(E.type,E.key,E.props,null,y.mode,S),S.ref=Ho(y,v,E),S.return=y,S)}function c(y,v,E,S){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=th(E,y.mode,S),v.return=y,v):(v=s(v,E.children||[]),v.return=y,v)}function u(y,v,E,S,T){return v===null||v.tag!==7?(v=ri(E,y.mode,S,T),v.return=y,v):(v=s(v,E),v.return=y,v)}function d(y,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=eh(""+v,y.mode,E),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Tl:return E=bc(v.type,v.key,v.props,null,y.mode,E),E.ref=Ho(y,null,v),E.return=y,E;case Fi:return v=th(v,y.mode,E),v.return=y,v;case Qn:var S=v._init;return d(y,S(v._payload),E)}if(Jo(v)||Bo(v))return v=ri(v,y.mode,E,null),v.return=y,v;Ol(y,v)}return null}function h(y,v,E,S){var T=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return T!==null?null:a(y,v,""+E,S);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Tl:return E.key===T?l(y,v,E,S):null;case Fi:return E.key===T?c(y,v,E,S):null;case Qn:return T=E._init,h(y,v,T(E._payload),S)}if(Jo(E)||Bo(E))return T!==null?null:u(y,v,E,S,null);Ol(y,E)}return null}function f(y,v,E,S,T){if(typeof S=="string"&&S!==""||typeof S=="number")return y=y.get(E)||null,a(v,y,""+S,T);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Tl:return y=y.get(S.key===null?E:S.key)||null,l(v,y,S,T);case Fi:return y=y.get(S.key===null?E:S.key)||null,c(v,y,S,T);case Qn:var A=S._init;return f(y,v,E,A(S._payload),T)}if(Jo(S)||Bo(S))return y=y.get(E)||null,u(v,y,S,T,null);Ol(v,S)}return null}function p(y,v,E,S){for(var T=null,A=null,b=v,R=v=0,L=null;b!==null&&R<E.length;R++){b.index>R?(L=b,b=null):L=b.sibling;var I=h(y,b,E[R],S);if(I===null){b===null&&(b=L);break}r&&b&&I.alternate===null&&e(y,b),v=i(I,v,R),A===null?T=I:A.sibling=I,A=I,b=L}if(R===E.length)return t(y,b),Me&&Us(y,R),T;if(b===null){for(;R<E.length;R++)b=d(y,E[R],S),b!==null&&(v=i(b,v,R),A===null?T=b:A.sibling=b,A=b);return Me&&Us(y,R),T}for(b=n(y,b);R<E.length;R++)L=f(b,y,R,E[R],S),L!==null&&(r&&L.alternate!==null&&b.delete(L.key===null?R:L.key),v=i(L,v,R),A===null?T=L:A.sibling=L,A=L);return r&&b.forEach(function(C){return e(y,C)}),Me&&Us(y,R),T}function g(y,v,E,S){var T=Bo(E);if(typeof T!="function")throw Error(W(150));if(E=T.call(E),E==null)throw Error(W(151));for(var A=T=null,b=v,R=v=0,L=null,I=E.next();b!==null&&!I.done;R++,I=E.next()){b.index>R?(L=b,b=null):L=b.sibling;var C=h(y,b,I.value,S);if(C===null){b===null&&(b=L);break}r&&b&&C.alternate===null&&e(y,b),v=i(C,v,R),A===null?T=C:A.sibling=C,A=C,b=L}if(I.done)return t(y,b),Me&&Us(y,R),T;if(b===null){for(;!I.done;R++,I=E.next())I=d(y,I.value,S),I!==null&&(v=i(I,v,R),A===null?T=I:A.sibling=I,A=I);return Me&&Us(y,R),T}for(b=n(y,b);!I.done;R++,I=E.next())I=f(b,y,R,I.value,S),I!==null&&(r&&I.alternate!==null&&b.delete(I.key===null?R:I.key),v=i(I,v,R),A===null?T=I:A.sibling=I,A=I);return r&&b.forEach(function(D){return e(y,D)}),Me&&Us(y,R),T}function m(y,v,E,S){if(typeof E=="object"&&E!==null&&E.type===$i&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Tl:e:{for(var T=E.key,A=v;A!==null;){if(A.key===T){if(T=E.type,T===$i){if(A.tag===7){t(y,A.sibling),v=s(A,E.props.children),v.return=y,y=v;break e}}else if(A.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Qn&&P0(T)===A.type){t(y,A.sibling),v=s(A,E.props),v.ref=Ho(y,A,E),v.return=y,y=v;break e}t(y,A);break}else e(y,A);A=A.sibling}E.type===$i?(v=ri(E.props.children,y.mode,S,E.key),v.return=y,y=v):(S=bc(E.type,E.key,E.props,null,y.mode,S),S.ref=Ho(y,v,E),S.return=y,y=S)}return o(y);case Fi:e:{for(A=E.key;v!==null;){if(v.key===A)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){t(y,v.sibling),v=s(v,E.children||[]),v.return=y,y=v;break e}else{t(y,v);break}else e(y,v);v=v.sibling}v=th(E,y.mode,S),v.return=y,y=v}return o(y);case Qn:return A=E._init,m(y,v,A(E._payload),S)}if(Jo(E))return p(y,v,E,S);if(Bo(E))return g(y,v,E,S);Ol(y,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(t(y,v.sibling),v=s(v,E),v.return=y,y=v):(t(y,v),v=eh(E,y.mode,S),v.return=y,y=v),o(y)):t(y,v)}return m}var bo=ax(!0),lx=ax(!1),Xc=Ls(null),Jc=null,Wi=null,fg=null;function pg(){fg=Wi=Jc=null}function gg(r){var e=Xc.current;De(Xc),r._currentValue=e}function Af(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function to(r,e){Jc=r,fg=Wi=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(Ut=!0),r.firstContext=null)}function vr(r){var e=r._currentValue;if(fg!==r)if(r={context:r,memoizedValue:e,next:null},Wi===null){if(Jc===null)throw Error(W(308));Wi=r,Jc.dependencies={lanes:0,firstContext:r}}else Wi=Wi.next=r;return e}var Ws=null;function mg(r){Ws===null?Ws=[r]:Ws.push(r)}function cx(r,e,t,n){var s=e.interleaved;return s===null?(t.next=t,mg(e)):(t.next=s.next,s.next=t),e.interleaved=t,Cn(r,n)}function Cn(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var Xn=!1;function yg(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ux(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Rn(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function ys(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,me&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,Cn(r,t)}return s=n.interleaved,s===null?(e.next=e,mg(n)):(e.next=s.next,s.next=e),n.interleaved=e,Cn(r,t)}function vc(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,rg(r,t)}}function D0(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function Zc(r,e,t,n){var s=r.updateQueue;Xn=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=r.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;o=0,u=c=l=null,a=i;do{var h=a.lane,f=a.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=r,g=a;switch(h=e,f=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=Ve({},d,h);break e;case 2:Xn=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);if(u===null&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ai|=o,r.lanes=o,r.memoizedState=d}}function O0(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],s=n.callback;if(s!==null){if(n.callback=null,n=t,typeof s!="function")throw Error(W(191,s));s.call(n)}}}var cl={},an=Ls(cl),ka=Ls(cl),Pa=Ls(cl);function zs(r){if(r===cl)throw Error(W(174));return r}function vg(r,e){switch(Ce(Pa,e),Ce(ka,r),Ce(an,cl),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:of(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=of(e,r)}De(an),Ce(an,e)}function _o(){De(an),De(ka),De(Pa)}function dx(r){zs(Pa.current);var e=zs(an.current),t=of(e,r.type);e!==t&&(Ce(ka,r),Ce(an,t))}function Eg(r){ka.current===r&&(De(an),De(ka))}var Be=Ls(0);function eu(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var qd=[];function Sg(){for(var r=0;r<qd.length;r++)qd[r]._workInProgressVersionPrimary=null;qd.length=0}var Ec=Nn.ReactCurrentDispatcher,Yd=Nn.ReactCurrentBatchConfig,oi=0,Ge=null,rt=null,lt=null,tu=!1,ca=!1,Da=0,_1=0;function xt(){throw Error(W(321))}function xg(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!Br(r[t],e[t]))return!1;return!0}function wg(r,e,t,n,s,i){if(oi=i,Ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ec.current=r===null||r.memoizedState===null?L1:C1,r=t(n,s),ca){i=0;do{if(ca=!1,Da=0,25<=i)throw Error(W(301));i+=1,lt=rt=null,e.updateQueue=null,Ec.current=k1,r=t(n,s)}while(ca)}if(Ec.current=ru,e=rt!==null&&rt.next!==null,oi=0,lt=rt=Ge=null,tu=!1,e)throw Error(W(300));return r}function Tg(){var r=Da!==0;return Da=0,r}function qr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lt===null?Ge.memoizedState=lt=r:lt=lt.next=r,lt}function Er(){if(rt===null){var r=Ge.alternate;r=r!==null?r.memoizedState:null}else r=rt.next;var e=lt===null?Ge.memoizedState:lt.next;if(e!==null)lt=e,rt=r;else{if(r===null)throw Error(W(310));rt=r,r={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},lt===null?Ge.memoizedState=lt=r:lt=lt.next=r}return lt}function Oa(r,e){return typeof e=="function"?e(r):e}function Qd(r){var e=Er(),t=e.queue;if(t===null)throw Error(W(311));t.lastRenderedReducer=r;var n=rt,s=n.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}n.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,n=n.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((oi&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:r(n,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=n):l=l.next=d,Ge.lanes|=u,ai|=u}c=c.next}while(c!==null&&c!==i);l===null?o=n:l.next=a,Br(n,e.memoizedState)||(Ut=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=l,t.lastRenderedState=n}if(r=t.interleaved,r!==null){s=r;do i=s.lane,Ge.lanes|=i,ai|=i,s=s.next;while(s!==r)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Xd(r){var e=Er(),t=e.queue;if(t===null)throw Error(W(311));t.lastRenderedReducer=r;var n=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=r(i,o.action),o=o.next;while(o!==s);Br(i,e.memoizedState)||(Ut=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,n]}function hx(){}function fx(r,e){var t=Ge,n=Er(),s=e(),i=!Br(n.memoizedState,s);if(i&&(n.memoizedState=s,Ut=!0),n=n.queue,bg(mx.bind(null,t,n,r),[r]),n.getSnapshot!==e||i||lt!==null&&lt.memoizedState.tag&1){if(t.flags|=2048,Na(9,gx.bind(null,t,n,s,e),void 0,null),ut===null)throw Error(W(349));oi&30||px(t,e,s)}return s}function px(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function gx(r,e,t,n){e.value=t,e.getSnapshot=n,yx(e)&&vx(r)}function mx(r,e,t){return t(function(){yx(e)&&vx(r)})}function yx(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!Br(r,t)}catch{return!0}}function vx(r){var e=Cn(r,1);e!==null&&Ur(e,r,1,-1)}function N0(r){var e=qr();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:r},e.queue=r,r=r.dispatch=I1.bind(null,Ge,r),[e.memoizedState,r]}function Na(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function Ex(){return Er().memoizedState}function Sc(r,e,t,n){var s=qr();Ge.flags|=r,s.memoizedState=Na(1|e,t,void 0,n===void 0?null:n)}function ju(r,e,t,n){var s=Er();n=n===void 0?null:n;var i=void 0;if(rt!==null){var o=rt.memoizedState;if(i=o.destroy,n!==null&&xg(n,o.deps)){s.memoizedState=Na(e,t,i,n);return}}Ge.flags|=r,s.memoizedState=Na(1|e,t,i,n)}function M0(r,e){return Sc(8390656,8,r,e)}function bg(r,e){return ju(2048,8,r,e)}function Sx(r,e){return ju(4,2,r,e)}function xx(r,e){return ju(4,4,r,e)}function wx(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function Tx(r,e,t){return t=t!=null?t.concat([r]):null,ju(4,4,wx.bind(null,e,r),t)}function _g(){}function bx(r,e){var t=Er();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&xg(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function _x(r,e){var t=Er();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&xg(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function Ax(r,e,t){return oi&21?(Br(t,e)||(t=kS(),Ge.lanes|=t,ai|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,Ut=!0),r.memoizedState=t)}function A1(r,e){var t=Te;Te=t!==0&&4>t?t:4,r(!0);var n=Yd.transition;Yd.transition={};try{r(!1),e()}finally{Te=t,Yd.transition=n}}function Rx(){return Er().memoizedState}function R1(r,e,t){var n=Es(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},Ix(r))Lx(e,t);else if(t=cx(r,e,t,n),t!==null){var s=Ct();Ur(t,r,n,s),Cx(t,e,n)}}function I1(r,e,t){var n=Es(r),s={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(Ix(r))Lx(e,s);else{var i=r.alternate;if(r.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Br(a,o)){var l=e.interleaved;l===null?(s.next=s,mg(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=cx(r,e,s,n),t!==null&&(s=Ct(),Ur(t,r,n,s),Cx(t,e,n))}}function Ix(r){var e=r.alternate;return r===Ge||e!==null&&e===Ge}function Lx(r,e){ca=tu=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function Cx(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,rg(r,t)}}var ru={readContext:vr,useCallback:xt,useContext:xt,useEffect:xt,useImperativeHandle:xt,useInsertionEffect:xt,useLayoutEffect:xt,useMemo:xt,useReducer:xt,useRef:xt,useState:xt,useDebugValue:xt,useDeferredValue:xt,useTransition:xt,useMutableSource:xt,useSyncExternalStore:xt,useId:xt,unstable_isNewReconciler:!1},L1={readContext:vr,useCallback:function(r,e){return qr().memoizedState=[r,e===void 0?null:e],r},useContext:vr,useEffect:M0,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,Sc(4194308,4,wx.bind(null,e,r),t)},useLayoutEffect:function(r,e){return Sc(4194308,4,r,e)},useInsertionEffect:function(r,e){return Sc(4,2,r,e)},useMemo:function(r,e){var t=qr();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=qr();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=R1.bind(null,Ge,r),[n.memoizedState,r]},useRef:function(r){var e=qr();return r={current:r},e.memoizedState=r},useState:N0,useDebugValue:_g,useDeferredValue:function(r){return qr().memoizedState=r},useTransition:function(){var r=N0(!1),e=r[0];return r=A1.bind(null,r[1]),qr().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Ge,s=qr();if(Me){if(t===void 0)throw Error(W(407));t=t()}else{if(t=e(),ut===null)throw Error(W(349));oi&30||px(n,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,M0(mx.bind(null,n,i,r),[r]),n.flags|=2048,Na(9,gx.bind(null,n,i,t,e),void 0,null),t},useId:function(){var r=qr(),e=ut.identifierPrefix;if(Me){var t=An,n=_n;t=(n&~(1<<32-$r(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Da++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=_1++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},C1={readContext:vr,useCallback:bx,useContext:vr,useEffect:bg,useImperativeHandle:Tx,useInsertionEffect:Sx,useLayoutEffect:xx,useMemo:_x,useReducer:Qd,useRef:Ex,useState:function(){return Qd(Oa)},useDebugValue:_g,useDeferredValue:function(r){var e=Er();return Ax(e,rt.memoizedState,r)},useTransition:function(){var r=Qd(Oa)[0],e=Er().memoizedState;return[r,e]},useMutableSource:hx,useSyncExternalStore:fx,useId:Rx,unstable_isNewReconciler:!1},k1={readContext:vr,useCallback:bx,useContext:vr,useEffect:bg,useImperativeHandle:Tx,useInsertionEffect:Sx,useLayoutEffect:xx,useMemo:_x,useReducer:Xd,useRef:Ex,useState:function(){return Xd(Oa)},useDebugValue:_g,useDeferredValue:function(r){var e=Er();return rt===null?e.memoizedState=r:Ax(e,rt.memoizedState,r)},useTransition:function(){var r=Xd(Oa)[0],e=Er().memoizedState;return[r,e]},useMutableSource:hx,useSyncExternalStore:fx,useId:Rx,unstable_isNewReconciler:!1};function Cr(r,e){if(r&&r.defaultProps){e=Ve({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function Rf(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:Ve({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var Gu={isMounted:function(r){return(r=r._reactInternals)?hi(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=Ct(),s=Es(r),i=Rn(n,s);i.payload=e,t!=null&&(i.callback=t),e=ys(r,i,s),e!==null&&(Ur(e,r,s,n),vc(e,r,s))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=Ct(),s=Es(r),i=Rn(n,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=ys(r,i,s),e!==null&&(Ur(e,r,s,n),vc(e,r,s))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=Ct(),n=Es(r),s=Rn(t,n);s.tag=2,e!=null&&(s.callback=e),e=ys(r,s,n),e!==null&&(Ur(e,r,n,t),vc(e,r,n))}};function F0(r,e,t,n,s,i,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,i,o):e.prototype&&e.prototype.isPureReactComponent?!Ra(t,n)||!Ra(s,i):!0}function kx(r,e,t){var n=!1,s=Ts,i=e.contextType;return typeof i=="object"&&i!==null?i=vr(i):(s=Gt(e)?si:_t.current,n=e.contextTypes,i=(n=n!=null)?wo(r,s):Ts),e=new e(t,i),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Gu,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=i),e}function $0(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&Gu.enqueueReplaceState(e,e.state,null)}function If(r,e,t,n){var s=r.stateNode;s.props=t,s.state=r.memoizedState,s.refs={},yg(r);var i=e.contextType;typeof i=="object"&&i!==null?s.context=vr(i):(i=Gt(e)?si:_t.current,s.context=wo(r,i)),s.state=r.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Rf(r,e,i,t),s.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Gu.enqueueReplaceState(s,s.state,null),Zc(r,t,s,n),s.state=r.memoizedState),typeof s.componentDidMount=="function"&&(r.flags|=4194308)}function Ao(r,e){try{var t="",n=e;do t+=iI(n),n=n.return;while(n);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:r,source:e,stack:s,digest:null}}function Jd(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function Lf(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var P1=typeof WeakMap=="function"?WeakMap:Map;function Px(r,e,t){t=Rn(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){su||(su=!0,Uf=n),Lf(r,e)},t}function Dx(r,e,t){t=Rn(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;t.payload=function(){return n(s)},t.callback=function(){Lf(r,e)}}var i=r.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Lf(r,e),typeof n!="function"&&(vs===null?vs=new Set([this]):vs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function U0(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new P1;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(s.add(t),r=W1.bind(null,r,e,t),e.then(r,r))}function B0(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function j0(r,e,t,n,s){return r.mode&1?(r.flags|=65536,r.lanes=s,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Rn(-1,1),e.tag=2,ys(t,e,1))),t.lanes|=1),r)}var D1=Nn.ReactCurrentOwner,Ut=!1;function Rt(r,e,t,n){e.child=r===null?lx(e,null,t,n):bo(e,r.child,t,n)}function G0(r,e,t,n,s){t=t.render;var i=e.ref;return to(e,s),n=wg(r,e,t,n,i,s),t=Tg(),r!==null&&!Ut?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,kn(r,e,s)):(Me&&t&&ug(e),e.flags|=1,Rt(r,e,n,s),e.child)}function V0(r,e,t,n,s){if(r===null){var i=t.type;return typeof i=="function"&&!Dg(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Ox(r,e,i,n,s)):(r=bc(t.type,null,n,e,e.mode,s),r.ref=e.ref,r.return=e,e.child=r)}if(i=r.child,!(r.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Ra,t(o,n)&&r.ref===e.ref)return kn(r,e,s)}return e.flags|=1,r=Ss(i,n),r.ref=e.ref,r.return=e,e.child=r}function Ox(r,e,t,n,s){if(r!==null){var i=r.memoizedProps;if(Ra(i,n)&&r.ref===e.ref)if(Ut=!1,e.pendingProps=n=i,(r.lanes&s)!==0)r.flags&131072&&(Ut=!0);else return e.lanes=r.lanes,kn(r,e,s)}return Cf(r,e,t,n,s)}function Nx(r,e,t){var n=e.pendingProps,s=n.children,i=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ce(qi,Yt),Yt|=t;else{if(!(t&1073741824))return r=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,Ce(qi,Yt),Yt|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:t,Ce(qi,Yt),Yt|=n}else i!==null?(n=i.baseLanes|t,e.memoizedState=null):n=t,Ce(qi,Yt),Yt|=n;return Rt(r,e,s,t),e.child}function Mx(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Cf(r,e,t,n,s){var i=Gt(t)?si:_t.current;return i=wo(e,i),to(e,s),t=wg(r,e,t,n,i,s),n=Tg(),r!==null&&!Ut?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,kn(r,e,s)):(Me&&n&&ug(e),e.flags|=1,Rt(r,e,t,s),e.child)}function K0(r,e,t,n,s){if(Gt(t)){var i=!0;qc(e)}else i=!1;if(to(e,s),e.stateNode===null)xc(r,e),kx(e,t,n),If(e,t,n,s),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=vr(c):(c=Gt(t)?si:_t.current,c=wo(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||l!==c)&&$0(e,o,n,c),Xn=!1;var h=e.memoizedState;o.state=h,Zc(e,n,o,s),l=e.memoizedState,a!==n||h!==l||jt.current||Xn?(typeof u=="function"&&(Rf(e,t,u,n),l=e.memoizedState),(a=Xn||F0(e,t,a,n,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,ux(r,e),a=e.memoizedProps,c=e.type===e.elementType?a:Cr(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=vr(l):(l=Gt(t)?si:_t.current,l=wo(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&$0(e,o,n,l),Xn=!1,h=e.memoizedState,o.state=h,Zc(e,n,o,s);var p=e.memoizedState;a!==d||h!==p||jt.current||Xn?(typeof f=="function"&&(Rf(e,t,f,n),p=e.memoizedState),(c=Xn||F0(e,t,c,n,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),o.props=n,o.state=p,o.context=l,n=c):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=1024),n=!1)}return kf(r,e,t,n,i,s)}function kf(r,e,t,n,s,i){Mx(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return s&&L0(e,t,!1),kn(r,e,i);n=e.stateNode,D1.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=bo(e,r.child,null,i),e.child=bo(e,null,a,i)):Rt(r,e,a,i),e.memoizedState=n.state,s&&L0(e,t,!0),e.child}function Fx(r){var e=r.stateNode;e.pendingContext?I0(r,e.pendingContext,e.pendingContext!==e.context):e.context&&I0(r,e.context,!1),vg(r,e.containerInfo)}function H0(r,e,t,n,s){return To(),hg(s),e.flags|=256,Rt(r,e,t,n),e.child}var Pf={dehydrated:null,treeContext:null,retryLane:0};function Df(r){return{baseLanes:r,cachePool:null,transitions:null}}function $x(r,e,t){var n=e.pendingProps,s=Be.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(s|=1),Ce(Be,s&1),r===null)return _f(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,i?(n=e.mode,i=e.child,o={mode:"hidden",children:o},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Hu(o,n,0,null),r=ri(r,n,t,null),i.return=e,r.return=e,i.sibling=r,e.child=i,e.child.memoizedState=Df(t),e.memoizedState=Pf,r):Ag(e,o));if(s=r.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return O1(r,e,o,n,a,s,t);if(i){i=n.fallback,o=e.mode,s=r.child,a=s.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Ss(s,l),n.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Ss(a,i):(i=ri(i,o,t,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,o=r.child.memoizedState,o=o===null?Df(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=r.childLanes&~t,e.memoizedState=Pf,n}return i=r.child,r=i.sibling,n=Ss(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function Ag(r,e){return e=Hu({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function Nl(r,e,t,n){return n!==null&&hg(n),bo(e,r.child,null,t),r=Ag(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function O1(r,e,t,n,s,i,o){if(t)return e.flags&256?(e.flags&=-257,n=Jd(Error(W(422))),Nl(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(i=n.fallback,s=e.mode,n=Hu({mode:"visible",children:n.children},s,0,null),i=ri(i,s,o,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&bo(e,r.child,null,o),e.child.memoizedState=Df(o),e.memoizedState=Pf,i);if(!(e.mode&1))return Nl(r,e,o,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var a=n.dgst;return n=a,i=Error(W(419)),n=Jd(i,n,void 0),Nl(r,e,o,n)}if(a=(o&r.childLanes)!==0,Ut||a){if(n=ut,n!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Cn(r,s),Ur(n,r,s,-1))}return Pg(),n=Jd(Error(W(421))),Nl(r,e,o,n)}return s.data==="$?"?(e.flags|=128,e.child=r.child,e=z1.bind(null,r),s._reactRetry=e,null):(r=i.treeContext,tr=ms(s.nextSibling),rr=e,Me=!0,Fr=null,r!==null&&(fr[pr++]=_n,fr[pr++]=An,fr[pr++]=ii,_n=r.id,An=r.overflow,ii=e),e=Ag(e,n.children),e.flags|=4096,e)}function W0(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),Af(r.return,e,t)}function Zd(r,e,t,n,s){var i=r.memoizedState;i===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=t,i.tailMode=s)}function Ux(r,e,t){var n=e.pendingProps,s=n.revealOrder,i=n.tail;if(Rt(r,e,n.children,t),n=Be.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&W0(r,t,e);else if(r.tag===19)W0(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(Ce(Be,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)r=t.alternate,r!==null&&eu(r)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Zd(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(r=s.alternate,r!==null&&eu(r)===null){e.child=s;break}r=s.sibling,s.sibling=t,t=s,s=r}Zd(e,!0,t,null,i);break;case"together":Zd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function xc(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function kn(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),ai|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(W(153));if(e.child!==null){for(r=e.child,t=Ss(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=Ss(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function N1(r,e,t){switch(e.tag){case 3:Fx(e),To();break;case 5:dx(e);break;case 1:Gt(e.type)&&qc(e);break;case 4:vg(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;Ce(Xc,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Ce(Be,Be.current&1),e.flags|=128,null):t&e.child.childLanes?$x(r,e,t):(Ce(Be,Be.current&1),r=kn(r,e,t),r!==null?r.sibling:null);Ce(Be,Be.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return Ux(r,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ce(Be,Be.current),n)break;return null;case 22:case 23:return e.lanes=0,Nx(r,e,t)}return kn(r,e,t)}var Bx,Of,jx,Gx;Bx=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Of=function(){};jx=function(r,e,t,n){var s=r.memoizedProps;if(s!==n){r=e.stateNode,zs(an.current);var i=null;switch(t){case"input":s=tf(r,s),n=tf(r,n),i=[];break;case"select":s=Ve({},s,{value:void 0}),n=Ve({},n,{value:void 0}),i=[];break;case"textarea":s=sf(r,s),n=sf(r,n),i=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=Wc)}af(t,n);var o;t=null;for(c in s)if(!n.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Sa.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in n){var l=n[c];if(a=s!=null?s[c]:void 0,n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Sa.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Pe("scroll",r),i||a===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};Gx=function(r,e,t,n){t!==n&&(e.flags|=4)};function Wo(r,e){if(!Me)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function wt(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=r,s=s.sibling;else for(s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=r,s=s.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function M1(r,e,t){var n=e.pendingProps;switch(dg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wt(e),null;case 1:return Gt(e.type)&&zc(),wt(e),null;case 3:return n=e.stateNode,_o(),De(jt),De(_t),Sg(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(Dl(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Fr!==null&&(Gf(Fr),Fr=null))),Of(r,e),wt(e),null;case 5:Eg(e);var s=zs(Pa.current);if(t=e.type,r!==null&&e.stateNode!=null)jx(r,e,t,n,s),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(W(166));return wt(e),null}if(r=zs(an.current),Dl(e)){n=e.stateNode,t=e.type;var i=e.memoizedProps;switch(n[en]=e,n[Ca]=i,r=(e.mode&1)!==0,t){case"dialog":Pe("cancel",n),Pe("close",n);break;case"iframe":case"object":case"embed":Pe("load",n);break;case"video":case"audio":for(s=0;s<ea.length;s++)Pe(ea[s],n);break;case"source":Pe("error",n);break;case"img":case"image":case"link":Pe("error",n),Pe("load",n);break;case"details":Pe("toggle",n);break;case"input":t0(n,i),Pe("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Pe("invalid",n);break;case"textarea":n0(n,i),Pe("invalid",n)}af(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?n.textContent!==a&&(i.suppressHydrationWarning!==!0&&Pl(n.textContent,a,r),s=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Pl(n.textContent,a,r),s=["children",""+a]):Sa.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Pe("scroll",n)}switch(t){case"input":bl(n),r0(n,i,!0);break;case"textarea":bl(n),s0(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=Wc)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=mS(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[en]=e,r[Ca]=n,Bx(r,e,!1,!1),e.stateNode=r;e:{switch(o=lf(t,n),t){case"dialog":Pe("cancel",r),Pe("close",r),s=n;break;case"iframe":case"object":case"embed":Pe("load",r),s=n;break;case"video":case"audio":for(s=0;s<ea.length;s++)Pe(ea[s],r);s=n;break;case"source":Pe("error",r),s=n;break;case"img":case"image":case"link":Pe("error",r),Pe("load",r),s=n;break;case"details":Pe("toggle",r),s=n;break;case"input":t0(r,n),s=tf(r,n),Pe("invalid",r);break;case"option":s=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},s=Ve({},n,{value:void 0}),Pe("invalid",r);break;case"textarea":n0(r,n),s=sf(r,n),Pe("invalid",r);break;default:s=n}af(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?ES(r,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&yS(r,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&xa(r,l):typeof l=="number"&&xa(r,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Sa.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Pe("scroll",r):l!=null&&Qp(r,i,l,o))}switch(t){case"input":bl(r),r0(r,n,!1);break;case"textarea":bl(r),s0(r);break;case"option":n.value!=null&&r.setAttribute("value",""+ws(n.value));break;case"select":r.multiple=!!n.multiple,i=n.value,i!=null?Xi(r,!!n.multiple,i,!1):n.defaultValue!=null&&Xi(r,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(r.onclick=Wc)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return wt(e),null;case 6:if(r&&e.stateNode!=null)Gx(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(W(166));if(t=zs(Pa.current),zs(an.current),Dl(e)){if(n=e.stateNode,t=e.memoizedProps,n[en]=e,(i=n.nodeValue!==t)&&(r=rr,r!==null))switch(r.tag){case 3:Pl(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Pl(n.nodeValue,t,(r.mode&1)!==0)}i&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[en]=e,e.stateNode=n}return wt(e),null;case 13:if(De(Be),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Me&&tr!==null&&e.mode&1&&!(e.flags&128))ox(),To(),e.flags|=98560,i=!1;else if(i=Dl(e),n!==null&&n.dehydrated!==null){if(r===null){if(!i)throw Error(W(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(W(317));i[en]=e}else To(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;wt(e),i=!1}else Fr!==null&&(Gf(Fr),Fr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Be.current&1?st===0&&(st=3):Pg())),e.updateQueue!==null&&(e.flags|=4),wt(e),null);case 4:return _o(),Of(r,e),r===null&&Ia(e.stateNode.containerInfo),wt(e),null;case 10:return gg(e.type._context),wt(e),null;case 17:return Gt(e.type)&&zc(),wt(e),null;case 19:if(De(Be),i=e.memoizedState,i===null)return wt(e),null;if(n=(e.flags&128)!==0,o=i.rendering,o===null)if(n)Wo(i,!1);else{if(st!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=eu(r),o!==null){for(e.flags|=128,Wo(i,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)i=t,r=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=r,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,r=o.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return Ce(Be,Be.current&1|2),e.child}r=r.sibling}i.tail!==null&&Ye()>Ro&&(e.flags|=128,n=!0,Wo(i,!1),e.lanes=4194304)}else{if(!n)if(r=eu(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Wo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Me)return wt(e),null}else 2*Ye()-i.renderingStartTime>Ro&&t!==1073741824&&(e.flags|=128,n=!0,Wo(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ye(),e.sibling=null,t=Be.current,Ce(Be,n?t&1|2:t&1),e):(wt(e),null);case 22:case 23:return kg(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Yt&1073741824&&(wt(e),e.subtreeFlags&6&&(e.flags|=8192)):wt(e),null;case 24:return null;case 25:return null}throw Error(W(156,e.tag))}function F1(r,e){switch(dg(e),e.tag){case 1:return Gt(e.type)&&zc(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return _o(),De(jt),De(_t),Sg(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return Eg(e),null;case 13:if(De(Be),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(W(340));To()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return De(Be),null;case 4:return _o(),null;case 10:return gg(e.type._context),null;case 22:case 23:return kg(),null;case 24:return null;default:return null}}var Ml=!1,bt=!1,$1=typeof WeakSet=="function"?WeakSet:Set,J=null;function zi(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){ze(r,e,n)}else t.current=null}function Nf(r,e,t){try{t()}catch(n){ze(r,e,n)}}var z0=!1;function U1(r,e){if(vf=Vc,r=zS(),cg(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=r,h=null;t:for(;;){for(var f;d!==t||s!==0&&d.nodeType!==3||(a=o+s),d!==i||n!==0&&d.nodeType!==3||(l=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===r)break t;if(h===t&&++c===s&&(a=o),h===i&&++u===n&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Ef={focusedElem:r,selectionRange:t},Vc=!1,J=e;J!==null;)if(e=J,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,J=r;else for(;J!==null;){e=J;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,m=p.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Cr(e.type,g),m);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(W(163))}}catch(S){ze(e,e.return,S)}if(r=e.sibling,r!==null){r.return=e.return,J=r;break}J=e.return}return p=z0,z0=!1,p}function ua(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&r)===r){var i=s.destroy;s.destroy=void 0,i!==void 0&&Nf(e,t,i)}s=s.next}while(s!==n)}}function Vu(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function Mf(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function Vx(r){var e=r.alternate;e!==null&&(r.alternate=null,Vx(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[en],delete e[Ca],delete e[wf],delete e[x1],delete e[w1])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Kx(r){return r.tag===5||r.tag===3||r.tag===4}function q0(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Kx(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Ff(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Wc));else if(n!==4&&(r=r.child,r!==null))for(Ff(r,e,t),r=r.sibling;r!==null;)Ff(r,e,t),r=r.sibling}function $f(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for($f(r,e,t),r=r.sibling;r!==null;)$f(r,e,t),r=r.sibling}var ft=null,Nr=!1;function Vn(r,e,t){for(t=t.child;t!==null;)Hx(r,e,t),t=t.sibling}function Hx(r,e,t){if(on&&typeof on.onCommitFiberUnmount=="function")try{on.onCommitFiberUnmount(Nu,t)}catch{}switch(t.tag){case 5:bt||zi(t,e);case 6:var n=ft,s=Nr;ft=null,Vn(r,e,t),ft=n,Nr=s,ft!==null&&(Nr?(r=ft,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):ft.removeChild(t.stateNode));break;case 18:ft!==null&&(Nr?(r=ft,t=t.stateNode,r.nodeType===8?Wd(r.parentNode,t):r.nodeType===1&&Wd(r,t),_a(r)):Wd(ft,t.stateNode));break;case 4:n=ft,s=Nr,ft=t.stateNode.containerInfo,Nr=!0,Vn(r,e,t),ft=n,Nr=s;break;case 0:case 11:case 14:case 15:if(!bt&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Nf(t,e,o),s=s.next}while(s!==n)}Vn(r,e,t);break;case 1:if(!bt&&(zi(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){ze(t,e,a)}Vn(r,e,t);break;case 21:Vn(r,e,t);break;case 22:t.mode&1?(bt=(n=bt)||t.memoizedState!==null,Vn(r,e,t),bt=n):Vn(r,e,t);break;default:Vn(r,e,t)}}function Y0(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new $1),e.forEach(function(n){var s=q1.bind(null,r,n);t.has(n)||(t.add(n),n.then(s,s))})}}function _r(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n];try{var i=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ft=a.stateNode,Nr=!1;break e;case 3:ft=a.stateNode.containerInfo,Nr=!0;break e;case 4:ft=a.stateNode.containerInfo,Nr=!0;break e}a=a.return}if(ft===null)throw Error(W(160));Hx(i,o,s),ft=null,Nr=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){ze(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Wx(e,r),e=e.sibling}function Wx(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(_r(e,r),Hr(r),n&4){try{ua(3,r,r.return),Vu(3,r)}catch(g){ze(r,r.return,g)}try{ua(5,r,r.return)}catch(g){ze(r,r.return,g)}}break;case 1:_r(e,r),Hr(r),n&512&&t!==null&&zi(t,t.return);break;case 5:if(_r(e,r),Hr(r),n&512&&t!==null&&zi(t,t.return),r.flags&32){var s=r.stateNode;try{xa(s,"")}catch(g){ze(r,r.return,g)}}if(n&4&&(s=r.stateNode,s!=null)){var i=r.memoizedProps,o=t!==null?t.memoizedProps:i,a=r.type,l=r.updateQueue;if(r.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&pS(s,i),lf(a,o);var c=lf(a,i);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?ES(s,d):u==="dangerouslySetInnerHTML"?yS(s,d):u==="children"?xa(s,d):Qp(s,u,d,c)}switch(a){case"input":rf(s,i);break;case"textarea":gS(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Xi(s,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?Xi(s,!!i.multiple,i.defaultValue,!0):Xi(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ca]=i}catch(g){ze(r,r.return,g)}}break;case 6:if(_r(e,r),Hr(r),n&4){if(r.stateNode===null)throw Error(W(162));s=r.stateNode,i=r.memoizedProps;try{s.nodeValue=i}catch(g){ze(r,r.return,g)}}break;case 3:if(_r(e,r),Hr(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{_a(e.containerInfo)}catch(g){ze(r,r.return,g)}break;case 4:_r(e,r),Hr(r);break;case 13:_r(e,r),Hr(r),s=r.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Lg=Ye())),n&4&&Y0(r);break;case 22:if(u=t!==null&&t.memoizedState!==null,r.mode&1?(bt=(c=bt)||u,_r(e,r),bt=c):_r(e,r),Hr(r),n&8192){if(c=r.memoizedState!==null,(r.stateNode.isHidden=c)&&!u&&r.mode&1)for(J=r,u=r.child;u!==null;){for(d=J=u;J!==null;){switch(h=J,f=h.child,h.tag){case 0:case 11:case 14:case 15:ua(4,h,h.return);break;case 1:zi(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){n=h,t=h.return;try{e=n,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){ze(n,t,g)}}break;case 5:zi(h,h.return);break;case 22:if(h.memoizedState!==null){X0(d);continue}}f!==null?(f.return=h,J=f):X0(d)}u=u.sibling}e:for(u=null,d=r;;){if(d.tag===5){if(u===null){u=d;try{s=d.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=vS("display",o))}catch(g){ze(r,r.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){ze(r,r.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:_r(e,r),Hr(r),n&4&&Y0(r);break;case 21:break;default:_r(e,r),Hr(r)}}function Hr(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(Kx(t)){var n=t;break e}t=t.return}throw Error(W(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(xa(s,""),n.flags&=-33);var i=q0(r);$f(r,i,s);break;case 3:case 4:var o=n.stateNode.containerInfo,a=q0(r);Ff(r,a,o);break;default:throw Error(W(161))}}catch(l){ze(r,r.return,l)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function B1(r,e,t){J=r,zx(r)}function zx(r,e,t){for(var n=(r.mode&1)!==0;J!==null;){var s=J,i=s.child;if(s.tag===22&&n){var o=s.memoizedState!==null||Ml;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||bt;a=Ml;var c=bt;if(Ml=o,(bt=l)&&!c)for(J=s;J!==null;)o=J,l=o.child,o.tag===22&&o.memoizedState!==null?J0(s):l!==null?(l.return=o,J=l):J0(s);for(;i!==null;)J=i,zx(i),i=i.sibling;J=s,Ml=a,bt=c}Q0(r)}else s.subtreeFlags&8772&&i!==null?(i.return=s,J=i):Q0(r)}}function Q0(r){for(;J!==null;){var e=J;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bt||Vu(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!bt)if(t===null)n.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Cr(e.type,t.memoizedProps);n.componentDidUpdate(s,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&O0(e,i,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}O0(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&_a(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(W(163))}bt||e.flags&512&&Mf(e)}catch(h){ze(e,e.return,h)}}if(e===r){J=null;break}if(t=e.sibling,t!==null){t.return=e.return,J=t;break}J=e.return}}function X0(r){for(;J!==null;){var e=J;if(e===r){J=null;break}var t=e.sibling;if(t!==null){t.return=e.return,J=t;break}J=e.return}}function J0(r){for(;J!==null;){var e=J;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Vu(4,e)}catch(l){ze(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(l){ze(e,s,l)}}var i=e.return;try{Mf(e)}catch(l){ze(e,i,l)}break;case 5:var o=e.return;try{Mf(e)}catch(l){ze(e,o,l)}}}catch(l){ze(e,e.return,l)}if(e===r){J=null;break}var a=e.sibling;if(a!==null){a.return=e.return,J=a;break}J=e.return}}var j1=Math.ceil,nu=Nn.ReactCurrentDispatcher,Rg=Nn.ReactCurrentOwner,mr=Nn.ReactCurrentBatchConfig,me=0,ut=null,Ze=null,yt=0,Yt=0,qi=Ls(0),st=0,Ma=null,ai=0,Ku=0,Ig=0,da=null,$t=null,Lg=0,Ro=1/0,En=null,su=!1,Uf=null,vs=null,Fl=!1,us=null,iu=0,ha=0,Bf=null,wc=-1,Tc=0;function Ct(){return me&6?Ye():wc!==-1?wc:wc=Ye()}function Es(r){return r.mode&1?me&2&&yt!==0?yt&-yt:b1.transition!==null?(Tc===0&&(Tc=kS()),Tc):(r=Te,r!==0||(r=window.event,r=r===void 0?16:$S(r.type)),r):1}function Ur(r,e,t,n){if(50<ha)throw ha=0,Bf=null,Error(W(185));ol(r,t,n),(!(me&2)||r!==ut)&&(r===ut&&(!(me&2)&&(Ku|=t),st===4&&rs(r,yt)),Vt(r,n),t===1&&me===0&&!(e.mode&1)&&(Ro=Ye()+500,Bu&&Cs()))}function Vt(r,e){var t=r.callbackNode;bI(r,e);var n=Gc(r,r===ut?yt:0);if(n===0)t!==null&&a0(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&a0(t),e===1)r.tag===0?T1(Z0.bind(null,r)):nx(Z0.bind(null,r)),E1(function(){!(me&6)&&Cs()}),t=null;else{switch(PS(n)){case 1:t=tg;break;case 4:t=LS;break;case 16:t=jc;break;case 536870912:t=CS;break;default:t=jc}t=tw(t,qx.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function qx(r,e){if(wc=-1,Tc=0,me&6)throw Error(W(327));var t=r.callbackNode;if(ro()&&r.callbackNode!==t)return null;var n=Gc(r,r===ut?yt:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=ou(r,n);else{e=n;var s=me;me|=2;var i=Qx();(ut!==r||yt!==e)&&(En=null,Ro=Ye()+500,ti(r,e));do try{K1();break}catch(a){Yx(r,a)}while(!0);pg(),nu.current=i,me=s,Ze!==null?e=0:(ut=null,yt=0,e=st)}if(e!==0){if(e===2&&(s=ff(r),s!==0&&(n=s,e=jf(r,s))),e===1)throw t=Ma,ti(r,0),rs(r,n),Vt(r,Ye()),t;if(e===6)rs(r,n);else{if(s=r.current.alternate,!(n&30)&&!G1(s)&&(e=ou(r,n),e===2&&(i=ff(r),i!==0&&(n=i,e=jf(r,i))),e===1))throw t=Ma,ti(r,0),rs(r,n),Vt(r,Ye()),t;switch(r.finishedWork=s,r.finishedLanes=n,e){case 0:case 1:throw Error(W(345));case 2:Bs(r,$t,En);break;case 3:if(rs(r,n),(n&130023424)===n&&(e=Lg+500-Ye(),10<e)){if(Gc(r,0)!==0)break;if(s=r.suspendedLanes,(s&n)!==n){Ct(),r.pingedLanes|=r.suspendedLanes&s;break}r.timeoutHandle=xf(Bs.bind(null,r,$t,En),e);break}Bs(r,$t,En);break;case 4:if(rs(r,n),(n&4194240)===n)break;for(e=r.eventTimes,s=-1;0<n;){var o=31-$r(n);i=1<<o,o=e[o],o>s&&(s=o),n&=~i}if(n=s,n=Ye()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*j1(n/1960))-n,10<n){r.timeoutHandle=xf(Bs.bind(null,r,$t,En),n);break}Bs(r,$t,En);break;case 5:Bs(r,$t,En);break;default:throw Error(W(329))}}}return Vt(r,Ye()),r.callbackNode===t?qx.bind(null,r):null}function jf(r,e){var t=da;return r.current.memoizedState.isDehydrated&&(ti(r,e).flags|=256),r=ou(r,e),r!==2&&(e=$t,$t=t,e!==null&&Gf(e)),r}function Gf(r){$t===null?$t=r:$t.push.apply($t,r)}function G1(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var s=t[n],i=s.getSnapshot;s=s.value;try{if(!Br(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function rs(r,e){for(e&=~Ig,e&=~Ku,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-$r(e),n=1<<t;r[t]=-1,e&=~n}}function Z0(r){if(me&6)throw Error(W(327));ro();var e=Gc(r,0);if(!(e&1))return Vt(r,Ye()),null;var t=ou(r,e);if(r.tag!==0&&t===2){var n=ff(r);n!==0&&(e=n,t=jf(r,n))}if(t===1)throw t=Ma,ti(r,0),rs(r,e),Vt(r,Ye()),t;if(t===6)throw Error(W(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,Bs(r,$t,En),Vt(r,Ye()),null}function Cg(r,e){var t=me;me|=1;try{return r(e)}finally{me=t,me===0&&(Ro=Ye()+500,Bu&&Cs())}}function li(r){us!==null&&us.tag===0&&!(me&6)&&ro();var e=me;me|=1;var t=mr.transition,n=Te;try{if(mr.transition=null,Te=1,r)return r()}finally{Te=n,mr.transition=t,me=e,!(me&6)&&Cs()}}function kg(){Yt=qi.current,De(qi)}function ti(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,v1(t)),Ze!==null)for(t=Ze.return;t!==null;){var n=t;switch(dg(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&zc();break;case 3:_o(),De(jt),De(_t),Sg();break;case 5:Eg(n);break;case 4:_o();break;case 13:De(Be);break;case 19:De(Be);break;case 10:gg(n.type._context);break;case 22:case 23:kg()}t=t.return}if(ut=r,Ze=r=Ss(r.current,null),yt=Yt=e,st=0,Ma=null,Ig=Ku=ai=0,$t=da=null,Ws!==null){for(e=0;e<Ws.length;e++)if(t=Ws[e],n=t.interleaved,n!==null){t.interleaved=null;var s=n.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,n.next=o}t.pending=n}Ws=null}return r}function Yx(r,e){do{var t=Ze;try{if(pg(),Ec.current=ru,tu){for(var n=Ge.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}tu=!1}if(oi=0,lt=rt=Ge=null,ca=!1,Da=0,Rg.current=null,t===null||t.return===null){st=1,Ma=e,Ze=null;break}e:{var i=r,o=t.return,a=t,l=e;if(e=yt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=B0(o);if(f!==null){f.flags&=-257,j0(f,o,a,i,e),f.mode&1&&U0(i,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var g=new Set;g.add(l),e.updateQueue=g}else p.add(l);break e}else{if(!(e&1)){U0(i,c,e),Pg();break e}l=Error(W(426))}}else if(Me&&a.mode&1){var m=B0(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),j0(m,o,a,i,e),hg(Ao(l,a));break e}}i=l=Ao(l,a),st!==4&&(st=2),da===null?da=[i]:da.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=Px(i,l,e);D0(i,y);break e;case 1:a=l;var v=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(vs===null||!vs.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var S=Dx(i,a,e);D0(i,S);break e}}i=i.return}while(i!==null)}Jx(t)}catch(T){e=T,Ze===t&&t!==null&&(Ze=t=t.return);continue}break}while(!0)}function Qx(){var r=nu.current;return nu.current=ru,r===null?ru:r}function Pg(){(st===0||st===3||st===2)&&(st=4),ut===null||!(ai&268435455)&&!(Ku&268435455)||rs(ut,yt)}function ou(r,e){var t=me;me|=2;var n=Qx();(ut!==r||yt!==e)&&(En=null,ti(r,e));do try{V1();break}catch(s){Yx(r,s)}while(!0);if(pg(),me=t,nu.current=n,Ze!==null)throw Error(W(261));return ut=null,yt=0,st}function V1(){for(;Ze!==null;)Xx(Ze)}function K1(){for(;Ze!==null&&!gI();)Xx(Ze)}function Xx(r){var e=ew(r.alternate,r,Yt);r.memoizedProps=r.pendingProps,e===null?Jx(r):Ze=e,Rg.current=null}function Jx(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=F1(t,e),t!==null){t.flags&=32767,Ze=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{st=6,Ze=null;return}}else if(t=M1(t,e,Yt),t!==null){Ze=t;return}if(e=e.sibling,e!==null){Ze=e;return}Ze=e=r}while(e!==null);st===0&&(st=5)}function Bs(r,e,t){var n=Te,s=mr.transition;try{mr.transition=null,Te=1,H1(r,e,t,n)}finally{mr.transition=s,Te=n}return null}function H1(r,e,t,n){do ro();while(us!==null);if(me&6)throw Error(W(327));t=r.finishedWork;var s=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(W(177));r.callbackNode=null,r.callbackPriority=0;var i=t.lanes|t.childLanes;if(_I(r,i),r===ut&&(Ze=ut=null,yt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Fl||(Fl=!0,tw(jc,function(){return ro(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=mr.transition,mr.transition=null;var o=Te;Te=1;var a=me;me|=4,Rg.current=null,U1(r,t),Wx(t,r),d1(Ef),Vc=!!vf,Ef=vf=null,r.current=t,B1(t),mI(),me=a,Te=o,mr.transition=i}else r.current=t;if(Fl&&(Fl=!1,us=r,iu=s),i=r.pendingLanes,i===0&&(vs=null),EI(t.stateNode),Vt(r,Ye()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)s=e[t],n(s.value,{componentStack:s.stack,digest:s.digest});if(su)throw su=!1,r=Uf,Uf=null,r;return iu&1&&r.tag!==0&&ro(),i=r.pendingLanes,i&1?r===Bf?ha++:(ha=0,Bf=r):ha=0,Cs(),null}function ro(){if(us!==null){var r=PS(iu),e=mr.transition,t=Te;try{if(mr.transition=null,Te=16>r?16:r,us===null)var n=!1;else{if(r=us,us=null,iu=0,me&6)throw Error(W(331));var s=me;for(me|=4,J=r.current;J!==null;){var i=J,o=i.child;if(J.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(J=c;J!==null;){var u=J;switch(u.tag){case 0:case 11:case 15:ua(8,u,i)}var d=u.child;if(d!==null)d.return=u,J=d;else for(;J!==null;){u=J;var h=u.sibling,f=u.return;if(Vx(u),u===c){J=null;break}if(h!==null){h.return=f,J=h;break}J=f}}}var p=i.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(g!==null)}}J=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,J=o;else e:for(;J!==null;){if(i=J,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ua(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,J=y;break e}J=i.return}}var v=r.current;for(J=v;J!==null;){o=J;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,J=E;else e:for(o=v;J!==null;){if(a=J,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Vu(9,a)}}catch(T){ze(a,a.return,T)}if(a===o){J=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,J=S;break e}J=a.return}}if(me=s,Cs(),on&&typeof on.onPostCommitFiberRoot=="function")try{on.onPostCommitFiberRoot(Nu,r)}catch{}n=!0}return n}finally{Te=t,mr.transition=e}}return!1}function ey(r,e,t){e=Ao(t,e),e=Px(r,e,1),r=ys(r,e,1),e=Ct(),r!==null&&(ol(r,1,e),Vt(r,e))}function ze(r,e,t){if(r.tag===3)ey(r,r,t);else for(;e!==null;){if(e.tag===3){ey(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(vs===null||!vs.has(n))){r=Ao(t,r),r=Dx(e,r,1),e=ys(e,r,1),r=Ct(),e!==null&&(ol(e,1,r),Vt(e,r));break}}e=e.return}}function W1(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=Ct(),r.pingedLanes|=r.suspendedLanes&t,ut===r&&(yt&t)===t&&(st===4||st===3&&(yt&130023424)===yt&&500>Ye()-Lg?ti(r,0):Ig|=t),Vt(r,e)}function Zx(r,e){e===0&&(r.mode&1?(e=Rl,Rl<<=1,!(Rl&130023424)&&(Rl=4194304)):e=1);var t=Ct();r=Cn(r,e),r!==null&&(ol(r,e,t),Vt(r,t))}function z1(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),Zx(r,t)}function q1(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,s=r.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(W(314))}n!==null&&n.delete(e),Zx(r,t)}var ew;ew=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||jt.current)Ut=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return Ut=!1,N1(r,e,t);Ut=!!(r.flags&131072)}else Ut=!1,Me&&e.flags&1048576&&sx(e,Qc,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;xc(r,e),r=e.pendingProps;var s=wo(e,_t.current);to(e,t),s=wg(null,e,n,r,s,t);var i=Tg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Gt(n)?(i=!0,qc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,yg(e),s.updater=Gu,e.stateNode=s,s._reactInternals=e,If(e,n,r,t),e=kf(null,e,n,!0,i,t)):(e.tag=0,Me&&i&&ug(e),Rt(null,e,s,t),e=e.child),e;case 16:n=e.elementType;e:{switch(xc(r,e),r=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=Q1(n),r=Cr(n,r),s){case 0:e=Cf(null,e,n,r,t);break e;case 1:e=K0(null,e,n,r,t);break e;case 11:e=G0(null,e,n,r,t);break e;case 14:e=V0(null,e,n,Cr(n.type,r),t);break e}throw Error(W(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Cr(n,s),Cf(r,e,n,s,t);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Cr(n,s),K0(r,e,n,s,t);case 3:e:{if(Fx(e),r===null)throw Error(W(387));n=e.pendingProps,i=e.memoizedState,s=i.element,ux(r,e),Zc(e,n,null,t);var o=e.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ao(Error(W(423)),e),e=H0(r,e,n,t,s);break e}else if(n!==s){s=Ao(Error(W(424)),e),e=H0(r,e,n,t,s);break e}else for(tr=ms(e.stateNode.containerInfo.firstChild),rr=e,Me=!0,Fr=null,t=lx(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(To(),n===s){e=kn(r,e,t);break e}Rt(r,e,n,t)}e=e.child}return e;case 5:return dx(e),r===null&&_f(e),n=e.type,s=e.pendingProps,i=r!==null?r.memoizedProps:null,o=s.children,Sf(n,s)?o=null:i!==null&&Sf(n,i)&&(e.flags|=32),Mx(r,e),Rt(r,e,o,t),e.child;case 6:return r===null&&_f(e),null;case 13:return $x(r,e,t);case 4:return vg(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=bo(e,null,n,t):Rt(r,e,n,t),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Cr(n,s),G0(r,e,n,s,t);case 7:return Rt(r,e,e.pendingProps,t),e.child;case 8:return Rt(r,e,e.pendingProps.children,t),e.child;case 12:return Rt(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ce(Xc,n._currentValue),n._currentValue=o,i!==null)if(Br(i.value,o)){if(i.children===s.children&&!jt.current){e=kn(r,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Rn(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),Af(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(W(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Af(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Rt(r,e,s.children,t),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,to(e,t),s=vr(s),n=n(s),e.flags|=1,Rt(r,e,n,t),e.child;case 14:return n=e.type,s=Cr(n,e.pendingProps),s=Cr(n.type,s),V0(r,e,n,s,t);case 15:return Ox(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Cr(n,s),xc(r,e),e.tag=1,Gt(n)?(r=!0,qc(e)):r=!1,to(e,t),kx(e,n,s),If(e,n,s,t),kf(null,e,n,!0,r,t);case 19:return Ux(r,e,t);case 22:return Nx(r,e,t)}throw Error(W(156,e.tag))};function tw(r,e){return IS(r,e)}function Y1(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gr(r,e,t,n){return new Y1(r,e,t,n)}function Dg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Q1(r){if(typeof r=="function")return Dg(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Jp)return 11;if(r===Zp)return 14}return 2}function Ss(r,e){var t=r.alternate;return t===null?(t=gr(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function bc(r,e,t,n,s,i){var o=2;if(n=r,typeof r=="function")Dg(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case $i:return ri(t.children,s,i,e);case Xp:o=8,s|=8;break;case Xh:return r=gr(12,t,e,s|2),r.elementType=Xh,r.lanes=i,r;case Jh:return r=gr(13,t,e,s),r.elementType=Jh,r.lanes=i,r;case Zh:return r=gr(19,t,e,s),r.elementType=Zh,r.lanes=i,r;case dS:return Hu(t,s,i,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case cS:o=10;break e;case uS:o=9;break e;case Jp:o=11;break e;case Zp:o=14;break e;case Qn:o=16,n=null;break e}throw Error(W(130,r==null?r:typeof r,""))}return e=gr(o,t,e,s),e.elementType=r,e.type=n,e.lanes=i,e}function ri(r,e,t,n){return r=gr(7,r,n,e),r.lanes=t,r}function Hu(r,e,t,n){return r=gr(22,r,n,e),r.elementType=dS,r.lanes=t,r.stateNode={isHidden:!1},r}function eh(r,e,t){return r=gr(6,r,null,e),r.lanes=t,r}function th(r,e,t){return e=gr(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function X1(r,e,t,n,s){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Nd(0),this.expirationTimes=Nd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nd(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Og(r,e,t,n,s,i,o,a,l){return r=new X1(r,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=gr(3,null,null,e),r.current=i,i.stateNode=r,i.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},yg(i),r}function J1(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fi,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function rw(r){if(!r)return Ts;r=r._reactInternals;e:{if(hi(r)!==r||r.tag!==1)throw Error(W(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Gt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(W(171))}if(r.tag===1){var t=r.type;if(Gt(t))return rx(r,t,e)}return e}function nw(r,e,t,n,s,i,o,a,l){return r=Og(t,n,!0,r,s,i,o,a,l),r.context=rw(null),t=r.current,n=Ct(),s=Es(t),i=Rn(n,s),i.callback=e??null,ys(t,i,s),r.current.lanes=s,ol(r,s,n),Vt(r,n),r}function Wu(r,e,t,n){var s=e.current,i=Ct(),o=Es(s);return t=rw(t),e.context===null?e.context=t:e.pendingContext=t,e=Rn(i,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=ys(s,e,o),r!==null&&(Ur(r,s,o,i),vc(r,s,o)),o}function au(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function ty(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function Ng(r,e){ty(r,e),(r=r.alternate)&&ty(r,e)}function Z1(){return null}var sw=typeof reportError=="function"?reportError:function(r){console.error(r)};function Mg(r){this._internalRoot=r}zu.prototype.render=Mg.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(W(409));Wu(r,e,null,null)};zu.prototype.unmount=Mg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;li(function(){Wu(null,r,null,null)}),e[Ln]=null}};function zu(r){this._internalRoot=r}zu.prototype.unstable_scheduleHydration=function(r){if(r){var e=NS();r={blockedOn:null,target:r,priority:e};for(var t=0;t<ts.length&&e!==0&&e<ts[t].priority;t++);ts.splice(t,0,r),t===0&&FS(r)}};function Fg(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function qu(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function ry(){}function eL(r,e,t,n,s){if(s){if(typeof n=="function"){var i=n;n=function(){var c=au(o);i.call(c)}}var o=nw(e,n,r,0,null,!1,!1,"",ry);return r._reactRootContainer=o,r[Ln]=o.current,Ia(r.nodeType===8?r.parentNode:r),li(),o}for(;s=r.lastChild;)r.removeChild(s);if(typeof n=="function"){var a=n;n=function(){var c=au(l);a.call(c)}}var l=Og(r,0,!1,null,null,!1,!1,"",ry);return r._reactRootContainer=l,r[Ln]=l.current,Ia(r.nodeType===8?r.parentNode:r),li(function(){Wu(e,l,t,n)}),l}function Yu(r,e,t,n,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=au(o);a.call(l)}}Wu(e,o,r,s)}else o=eL(t,e,r,s,n);return au(o)}DS=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=Zo(e.pendingLanes);t!==0&&(rg(e,t|1),Vt(e,Ye()),!(me&6)&&(Ro=Ye()+500,Cs()))}break;case 13:li(function(){var n=Cn(r,1);if(n!==null){var s=Ct();Ur(n,r,1,s)}}),Ng(r,1)}};ng=function(r){if(r.tag===13){var e=Cn(r,134217728);if(e!==null){var t=Ct();Ur(e,r,134217728,t)}Ng(r,134217728)}};OS=function(r){if(r.tag===13){var e=Es(r),t=Cn(r,e);if(t!==null){var n=Ct();Ur(t,r,e,n)}Ng(r,e)}};NS=function(){return Te};MS=function(r,e){var t=Te;try{return Te=r,e()}finally{Te=t}};uf=function(r,e,t){switch(e){case"input":if(rf(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var s=Uu(n);if(!s)throw Error(W(90));fS(n),rf(n,s)}}}break;case"textarea":gS(r,t);break;case"select":e=t.value,e!=null&&Xi(r,!!t.multiple,e,!1)}};wS=Cg;TS=li;var tL={usingClientEntryPoint:!1,Events:[ll,Gi,Uu,SS,xS,Cg]},zo={findFiberByHostInstance:Hs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rL={bundleType:zo.bundleType,version:zo.version,rendererPackageName:zo.rendererPackageName,rendererConfig:zo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Nn.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=AS(r),r===null?null:r.stateNode},findFiberByHostInstance:zo.findFiberByHostInstance||Z1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $l=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$l.isDisabled&&$l.supportsFiber)try{Nu=$l.inject(rL),on=$l}catch{}}ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tL;ar.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fg(e))throw Error(W(200));return J1(r,e,null,t)};ar.createRoot=function(r,e){if(!Fg(r))throw Error(W(299));var t=!1,n="",s=sw;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Og(r,1,!1,null,null,t,!1,n,s),r[Ln]=e.current,Ia(r.nodeType===8?r.parentNode:r),new Mg(e)};ar.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(W(188)):(r=Object.keys(r).join(","),Error(W(268,r)));return r=AS(e),r=r===null?null:r.stateNode,r};ar.flushSync=function(r){return li(r)};ar.hydrate=function(r,e,t){if(!qu(e))throw Error(W(200));return Yu(null,r,e,!0,t)};ar.hydrateRoot=function(r,e,t){if(!Fg(r))throw Error(W(405));var n=t!=null&&t.hydratedSources||null,s=!1,i="",o=sw;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=nw(e,null,r,1,t??null,s,!1,i,o),r[Ln]=e.current,Ia(r),n)for(r=0;r<n.length;r++)t=n[r],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new zu(e)};ar.render=function(r,e,t){if(!qu(e))throw Error(W(200));return Yu(null,r,e,!1,t)};ar.unmountComponentAtNode=function(r){if(!qu(r))throw Error(W(40));return r._reactRootContainer?(li(function(){Yu(null,null,r,!1,function(){r._reactRootContainer=null,r[Ln]=null})}),!0):!1};ar.unstable_batchedUpdates=Cg;ar.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!qu(t))throw Error(W(200));if(r==null||r._reactInternals===void 0)throw Error(W(38));return Yu(r,e,t,!1,n)};ar.version="18.3.1-next-f1338f8080-20240426";function iw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(iw)}catch(r){console.error(r)}}iw(),iS.exports=ar;var ul=iS.exports;const ow=zE(ul);var aw,ny=ul;aw=ny.createRoot,ny.hydrateRoot;const nL=1,sL=1e6;let rh=0;function iL(){return rh=(rh+1)%Number.MAX_SAFE_INTEGER,rh.toString()}const nh=new Map,sy=r=>{if(nh.has(r))return;const e=setTimeout(()=>{nh.delete(r),fa({type:"REMOVE_TOAST",toastId:r})},sL);nh.set(r,e)},oL=(r,e)=>{switch(e.type){case"ADD_TOAST":return{...r,toasts:[e.toast,...r.toasts].slice(0,nL)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?sy(t):r.toasts.forEach(n=>{sy(n.id)}),{...r,toasts:r.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return e.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(t=>t.id!==e.toastId)}}},_c=[];let Ac={toasts:[]};function fa(r){Ac=oL(Ac,r),_c.forEach(e=>{e(Ac)})}function dr({...r}){const e=iL(),t=s=>fa({type:"UPDATE_TOAST",toast:{...s,id:e}}),n=()=>fa({type:"DISMISS_TOAST",toastId:e});return fa({type:"ADD_TOAST",toast:{...r,id:e,open:!0,onOpenChange:s=>{s||n()}}}),{id:e,dismiss:n,update:t}}function aL(){const[r,e]=w.useState(Ac);return w.useEffect(()=>(_c.push(e),()=>{const t=_c.indexOf(e);t>-1&&_c.splice(t,1)}),[r]),{...r,toast:dr,dismiss:t=>fa({type:"DISMISS_TOAST",toastId:t})}}function te(r,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(r==null||r(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function iy(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function Qu(...r){return e=>{let t=!1;const n=r.map(s=>{const i=iy(s,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let s=0;s<n.length;s++){const i=n[s];typeof i=="function"?i():iy(r[s],null)}}}}function Fe(...r){return w.useCallback(Qu(...r),r)}function Mn(r,e=[]){let t=[];function n(i,o){const a=w.createContext(o),l=t.length;t=[...t,o];const c=d=>{var y;const{scope:h,children:f,...p}=d,g=((y=h==null?void 0:h[r])==null?void 0:y[l])||a,m=w.useMemo(()=>p,Object.values(p));return _.jsx(g.Provider,{value:m,children:f})};c.displayName=i+"Provider";function u(d,h){var g;const f=((g=h==null?void 0:h[r])==null?void 0:g[l])||a,p=w.useContext(f);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${i}\``)}return[c,u]}const s=()=>{const i=t.map(o=>w.createContext(o));return function(a){const l=(a==null?void 0:a[r])||i;return w.useMemo(()=>({[`__scope${r}`]:{...a,[r]:l}}),[a,l])}};return s.scopeName=r,[n,lL(s,...e)]}function lL(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(i)[`__scope${c}`];return{...a,...d}},{});return w.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Fa(r){const e=uL(r),t=w.forwardRef((n,s)=>{const{children:i,...o}=n,a=w.Children.toArray(i),l=a.find(hL);if(l){const c=l.props.children,u=a.map(d=>d===l?w.Children.count(c)>1?w.Children.only(null):w.isValidElement(c)?c.props.children:null:d);return _.jsx(e,{...o,ref:s,children:w.isValidElement(c)?w.cloneElement(c,void 0,u):null})}return _.jsx(e,{...o,ref:s,children:i})});return t.displayName=`${r}.Slot`,t}var cL=Fa("Slot");function uL(r){const e=w.forwardRef((t,n)=>{const{children:s,...i}=t;if(w.isValidElement(s)){const o=pL(s),a=fL(i,s.props);return s.type!==w.Fragment&&(a.ref=n?Qu(n,o):o),w.cloneElement(s,a)}return w.Children.count(s)>1?w.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var lw=Symbol("radix.slottable");function dL(r){const e=({children:t})=>_.jsx(_.Fragment,{children:t});return e.displayName=`${r}.Slottable`,e.__radixId=lw,e}function hL(r){return w.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===lw}function fL(r,e){const t={...e};for(const n in e){const s=r[n],i=e[n];/^on[A-Z]/.test(n)?s&&i?t[n]=(...a)=>{const l=i(...a);return s(...a),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...i}:n==="className"&&(t[n]=[s,i].filter(Boolean).join(" "))}return{...r,...t}}function pL(r){var n,s;let e=(n=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function Xu(r){const e=r+"CollectionProvider",[t,n]=Mn(e),[s,i]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=g=>{const{scope:m,children:y}=g,v=z.useRef(null),E=z.useRef(new Map).current;return _.jsx(s,{scope:m,itemMap:E,collectionRef:v,children:y})};o.displayName=e;const a=r+"CollectionSlot",l=Fa(a),c=z.forwardRef((g,m)=>{const{scope:y,children:v}=g,E=i(a,y),S=Fe(m,E.collectionRef);return _.jsx(l,{ref:S,children:v})});c.displayName=a;const u=r+"CollectionItemSlot",d="data-radix-collection-item",h=Fa(u),f=z.forwardRef((g,m)=>{const{scope:y,children:v,...E}=g,S=z.useRef(null),T=Fe(m,S),A=i(u,y);return z.useEffect(()=>(A.itemMap.set(S,{ref:S,...E}),()=>void A.itemMap.delete(S))),_.jsx(h,{[d]:"",ref:T,children:v})});f.displayName=u;function p(g){const m=i(r+"CollectionConsumer",g);return z.useCallback(()=>{const v=m.collectionRef.current;if(!v)return[];const E=Array.from(v.querySelectorAll(`[${d}]`));return Array.from(m.itemMap.values()).sort((A,b)=>E.indexOf(A.ref.current)-E.indexOf(b.ref.current))},[m.collectionRef,m.itemMap])}return[{Provider:o,Slot:c,ItemSlot:f},p,n]}var gL=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ee=gL.reduce((r,e)=>{const t=Fa(`Primitive.${e}`),n=w.forwardRef((s,i)=>{const{asChild:o,...a}=s,l=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),_.jsx(l,{...a,ref:i})});return n.displayName=`Primitive.${e}`,{...r,[e]:n}},{});function $g(r,e){r&&ul.flushSync(()=>r.dispatchEvent(e))}function or(r){const e=w.useRef(r);return w.useEffect(()=>{e.current=r}),w.useMemo(()=>(...t)=>{var n;return(n=e.current)==null?void 0:n.call(e,...t)},[])}function mL(r,e=globalThis==null?void 0:globalThis.document){const t=or(r);w.useEffect(()=>{const n=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var yL="DismissableLayer",Vf="dismissableLayer.update",vL="dismissableLayer.pointerDownOutside",EL="dismissableLayer.focusOutside",oy,cw=w.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ju=w.forwardRef((r,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=r,c=w.useContext(cw),[u,d]=w.useState(null),h=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=w.useState({}),p=Fe(e,b=>d(b)),g=Array.from(c.layers),[m]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),y=g.indexOf(m),v=u?g.indexOf(u):-1,E=c.layersWithOutsidePointerEventsDisabled.size>0,S=v>=y,T=xL(b=>{const R=b.target,L=[...c.branches].some(I=>I.contains(R));!S||L||(s==null||s(b),o==null||o(b),b.defaultPrevented||a==null||a())},h),A=wL(b=>{const R=b.target;[...c.branches].some(I=>I.contains(R))||(i==null||i(b),o==null||o(b),b.defaultPrevented||a==null||a())},h);return mL(b=>{v===c.layers.size-1&&(n==null||n(b),!b.defaultPrevented&&a&&(b.preventDefault(),a()))},h),w.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(oy=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),ay(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=oy)}},[u,h,t,c]),w.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),ay())},[u,c]),w.useEffect(()=>{const b=()=>f({});return document.addEventListener(Vf,b),()=>document.removeEventListener(Vf,b)},[]),_.jsx(Ee.div,{...l,ref:p,style:{pointerEvents:E?S?"auto":"none":void 0,...r.style},onFocusCapture:te(r.onFocusCapture,A.onFocusCapture),onBlurCapture:te(r.onBlurCapture,A.onBlurCapture),onPointerDownCapture:te(r.onPointerDownCapture,T.onPointerDownCapture)})});Ju.displayName=yL;var SL="DismissableLayerBranch",uw=w.forwardRef((r,e)=>{const t=w.useContext(cw),n=w.useRef(null),s=Fe(e,n);return w.useEffect(()=>{const i=n.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),_.jsx(Ee.div,{...r,ref:s})});uw.displayName=SL;function xL(r,e=globalThis==null?void 0:globalThis.document){const t=or(r),n=w.useRef(!1),s=w.useRef(()=>{});return w.useEffect(()=>{const i=a=>{if(a.target&&!n.current){let l=function(){dw(vL,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);n.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function wL(r,e=globalThis==null?void 0:globalThis.document){const t=or(r),n=w.useRef(!1);return w.useEffect(()=>{const s=i=>{i.target&&!n.current&&dw(EL,t,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function ay(){const r=new CustomEvent(Vf);document.dispatchEvent(r)}function dw(r,e,t,{discrete:n}){const s=t.originalEvent.target,i=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?$g(s,i):s.dispatchEvent(i)}var TL=Ju,bL=uw,Pn=globalThis!=null&&globalThis.document?w.useLayoutEffect:()=>{},_L="Portal",Ug=w.forwardRef((r,e)=>{var a;const{container:t,...n}=r,[s,i]=w.useState(!1);Pn(()=>i(!0),[]);const o=t||s&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?ow.createPortal(_.jsx(Ee.div,{...n,ref:e}),o):null});Ug.displayName=_L;function AL(r,e){return w.useReducer((t,n)=>e[t][n]??t,r)}var ks=r=>{const{present:e,children:t}=r,n=RL(e),s=typeof t=="function"?t({present:n.isPresent}):w.Children.only(t),i=Fe(n.ref,IL(s));return typeof t=="function"||n.isPresent?w.cloneElement(s,{ref:i}):null};ks.displayName="Presence";function RL(r){const[e,t]=w.useState(),n=w.useRef(null),s=w.useRef(r),i=w.useRef("none"),o=r?"mounted":"unmounted",[a,l]=AL(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return w.useEffect(()=>{const c=Ul(n.current);i.current=a==="mounted"?c:"none"},[a]),Pn(()=>{const c=n.current,u=s.current;if(u!==r){const h=i.current,f=Ul(c);r?l("MOUNT"):f==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&h!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=r}},[r,l]),Pn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=f=>{const g=Ul(n.current).includes(f.animationName);if(f.target===e&&g&&(l("ANIMATION_END"),!s.current)){const m=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=m)})}},h=f=>{f.target===e&&(i.current=Ul(n.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:w.useCallback(c=>{n.current=c?getComputedStyle(c):null,t(c)},[])}}function Ul(r){return(r==null?void 0:r.animationName)||"none"}function IL(r){var n,s;let e=(n=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var LL=zp[" useInsertionEffect ".trim().toString()]||Pn;function dl({prop:r,defaultProp:e,onChange:t=()=>{},caller:n}){const[s,i,o]=CL({defaultProp:e,onChange:t}),a=r!==void 0,l=a?r:s;{const u=w.useRef(r!==void 0);w.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${n} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,n])}const c=w.useCallback(u=>{var d;if(a){const h=kL(u)?u(r):u;h!==r&&((d=o.current)==null||d.call(o,h))}else i(u)},[a,r,i,o]);return[l,c]}function CL({defaultProp:r,onChange:e}){const[t,n]=w.useState(r),s=w.useRef(t),i=w.useRef(e);return LL(()=>{i.current=e},[e]),w.useEffect(()=>{var o;s.current!==t&&((o=i.current)==null||o.call(i,t),s.current=t)},[t,s]),[t,n,i]}function kL(r){return typeof r=="function"}var PL=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),DL="VisuallyHidden",Zu=w.forwardRef((r,e)=>_.jsx(Ee.span,{...r,ref:e,style:{...PL,...r.style}}));Zu.displayName=DL;var OL=Zu,Bg="ToastProvider",[jg,NL,ML]=Xu("Toast"),[hw,L8]=Mn("Toast",[ML]),[FL,ed]=hw(Bg),fw=r=>{const{__scopeToast:e,label:t="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:i=50,children:o}=r,[a,l]=w.useState(null),[c,u]=w.useState(0),d=w.useRef(!1),h=w.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${Bg}\`. Expected non-empty \`string\`.`),_.jsx(jg.Provider,{scope:e,children:_.jsx(FL,{scope:e,label:t,duration:n,swipeDirection:s,swipeThreshold:i,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:w.useCallback(()=>u(f=>f+1),[]),onToastRemove:w.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:o})})};fw.displayName=Bg;var pw="ToastViewport",$L=["F8"],Kf="toast.viewportPause",Hf="toast.viewportResume",gw=w.forwardRef((r,e)=>{const{__scopeToast:t,hotkey:n=$L,label:s="Notifications ({hotkey})",...i}=r,o=ed(pw,t),a=NL(t),l=w.useRef(null),c=w.useRef(null),u=w.useRef(null),d=w.useRef(null),h=Fe(e,d,o.onViewportChange),f=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=o.toastCount>0;w.useEffect(()=>{const m=y=>{var E;n.length!==0&&n.every(S=>y[S]||y.code===S)&&((E=d.current)==null||E.focus())};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[n]),w.useEffect(()=>{const m=l.current,y=d.current;if(p&&m&&y){const v=()=>{if(!o.isClosePausedRef.current){const A=new CustomEvent(Kf);y.dispatchEvent(A),o.isClosePausedRef.current=!0}},E=()=>{if(o.isClosePausedRef.current){const A=new CustomEvent(Hf);y.dispatchEvent(A),o.isClosePausedRef.current=!1}},S=A=>{!m.contains(A.relatedTarget)&&E()},T=()=>{m.contains(document.activeElement)||E()};return m.addEventListener("focusin",v),m.addEventListener("focusout",S),m.addEventListener("pointermove",v),m.addEventListener("pointerleave",T),window.addEventListener("blur",v),window.addEventListener("focus",E),()=>{m.removeEventListener("focusin",v),m.removeEventListener("focusout",S),m.removeEventListener("pointermove",v),m.removeEventListener("pointerleave",T),window.removeEventListener("blur",v),window.removeEventListener("focus",E)}}},[p,o.isClosePausedRef]);const g=w.useCallback(({tabbingDirection:m})=>{const v=a().map(E=>{const S=E.ref.current,T=[S,...XL(S)];return m==="forwards"?T:T.reverse()});return(m==="forwards"?v.reverse():v).flat()},[a]);return w.useEffect(()=>{const m=d.current;if(m){const y=v=>{var T,A,b;const E=v.altKey||v.ctrlKey||v.metaKey;if(v.key==="Tab"&&!E){const R=document.activeElement,L=v.shiftKey;if(v.target===m&&L){(T=c.current)==null||T.focus();return}const D=g({tabbingDirection:L?"backwards":"forwards"}),B=D.findIndex(F=>F===R);sh(D.slice(B+1))?v.preventDefault():L?(A=c.current)==null||A.focus():(b=u.current)==null||b.focus()}};return m.addEventListener("keydown",y),()=>m.removeEventListener("keydown",y)}},[a,g]),_.jsxs(bL,{ref:l,role:"region","aria-label":s.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&_.jsx(Wf,{ref:c,onFocusFromOutsideViewport:()=>{const m=g({tabbingDirection:"forwards"});sh(m)}}),_.jsx(jg.Slot,{scope:t,children:_.jsx(Ee.ol,{tabIndex:-1,...i,ref:h})}),p&&_.jsx(Wf,{ref:u,onFocusFromOutsideViewport:()=>{const m=g({tabbingDirection:"backwards"});sh(m)}})]})});gw.displayName=pw;var mw="ToastFocusProxy",Wf=w.forwardRef((r,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:n,...s}=r,i=ed(mw,t);return _.jsx(Zu,{"aria-hidden":!0,tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=i.viewport)!=null&&c.contains(a))&&n()}})});Wf.displayName=mw;var hl="Toast",UL="toast.swipeStart",BL="toast.swipeMove",jL="toast.swipeCancel",GL="toast.swipeEnd",yw=w.forwardRef((r,e)=>{const{forceMount:t,open:n,defaultOpen:s,onOpenChange:i,...o}=r,[a,l]=dl({prop:n,defaultProp:s??!0,onChange:i,caller:hl});return _.jsx(ks,{present:t||a,children:_.jsx(HL,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:or(r.onPause),onResume:or(r.onResume),onSwipeStart:te(r.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:te(r.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:te(r.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:te(r.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});yw.displayName=hl;var[VL,KL]=hw(hl,{onClose(){}}),HL=w.forwardRef((r,e)=>{const{__scopeToast:t,type:n="foreground",duration:s,open:i,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:f,...p}=r,g=ed(hl,t),[m,y]=w.useState(null),v=Fe(e,F=>y(F)),E=w.useRef(null),S=w.useRef(null),T=s||g.duration,A=w.useRef(0),b=w.useRef(T),R=w.useRef(0),{onToastAdd:L,onToastRemove:I}=g,C=or(()=>{var V;(m==null?void 0:m.contains(document.activeElement))&&((V=g.viewport)==null||V.focus()),o()}),D=w.useCallback(F=>{!F||F===1/0||(window.clearTimeout(R.current),A.current=new Date().getTime(),R.current=window.setTimeout(C,F))},[C]);w.useEffect(()=>{const F=g.viewport;if(F){const V=()=>{D(b.current),c==null||c()},M=()=>{const K=new Date().getTime()-A.current;b.current=b.current-K,window.clearTimeout(R.current),l==null||l()};return F.addEventListener(Kf,M),F.addEventListener(Hf,V),()=>{F.removeEventListener(Kf,M),F.removeEventListener(Hf,V)}}},[g.viewport,T,l,c,D]),w.useEffect(()=>{i&&!g.isClosePausedRef.current&&D(T)},[i,T,g.isClosePausedRef,D]),w.useEffect(()=>(L(),()=>I()),[L,I]);const B=w.useMemo(()=>m?bw(m):null,[m]);return g.viewport?_.jsxs(_.Fragment,{children:[B&&_.jsx(WL,{__scopeToast:t,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:B}),_.jsx(VL,{scope:t,onClose:C,children:ul.createPortal(_.jsx(jg.ItemSlot,{scope:t,children:_.jsx(TL,{asChild:!0,onEscapeKeyDown:te(a,()=>{g.isFocusedToastEscapeKeyDownRef.current||C(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:_.jsx(Ee.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":g.swipeDirection,...p,ref:v,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:te(r.onKeyDown,F=>{F.key==="Escape"&&(a==null||a(F.nativeEvent),F.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,C()))}),onPointerDown:te(r.onPointerDown,F=>{F.button===0&&(E.current={x:F.clientX,y:F.clientY})}),onPointerMove:te(r.onPointerMove,F=>{if(!E.current)return;const V=F.clientX-E.current.x,M=F.clientY-E.current.y,K=!!S.current,P=["left","right"].includes(g.swipeDirection),k=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,j=P?k(0,V):0,U=P?0:k(0,M),$=F.pointerType==="touch"?10:2,q={x:j,y:U},Q={originalEvent:F,delta:q};K?(S.current=q,Bl(BL,d,Q,{discrete:!1})):ly(q,g.swipeDirection,$)?(S.current=q,Bl(UL,u,Q,{discrete:!1}),F.target.setPointerCapture(F.pointerId)):(Math.abs(V)>$||Math.abs(M)>$)&&(E.current=null)}),onPointerUp:te(r.onPointerUp,F=>{const V=S.current,M=F.target;if(M.hasPointerCapture(F.pointerId)&&M.releasePointerCapture(F.pointerId),S.current=null,E.current=null,V){const K=F.currentTarget,P={originalEvent:F,delta:V};ly(V,g.swipeDirection,g.swipeThreshold)?Bl(GL,f,P,{discrete:!0}):Bl(jL,h,P,{discrete:!0}),K.addEventListener("click",k=>k.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),WL=r=>{const{__scopeToast:e,children:t,...n}=r,s=ed(hl,e),[i,o]=w.useState(!1),[a,l]=w.useState(!1);return YL(()=>o(!0)),w.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:_.jsx(Ug,{asChild:!0,children:_.jsx(Zu,{...n,children:i&&_.jsxs(_.Fragment,{children:[s.label," ",t]})})})},zL="ToastTitle",vw=w.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return _.jsx(Ee.div,{...n,ref:e})});vw.displayName=zL;var qL="ToastDescription",Ew=w.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return _.jsx(Ee.div,{...n,ref:e})});Ew.displayName=qL;var Sw="ToastAction",xw=w.forwardRef((r,e)=>{const{altText:t,...n}=r;return t.trim()?_.jsx(Tw,{altText:t,asChild:!0,children:_.jsx(Gg,{...n,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${Sw}\`. Expected non-empty \`string\`.`),null)});xw.displayName=Sw;var ww="ToastClose",Gg=w.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r,s=KL(ww,t);return _.jsx(Tw,{asChild:!0,children:_.jsx(Ee.button,{type:"button",...n,ref:e,onClick:te(r.onClick,s.onClose)})})});Gg.displayName=ww;var Tw=w.forwardRef((r,e)=>{const{__scopeToast:t,altText:n,...s}=r;return _.jsx(Ee.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:e})});function bw(r){const e=[];return Array.from(r.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&e.push(n.textContent),QL(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",i=n.dataset.radixToastAnnounceExclude==="";if(!s)if(i){const o=n.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...bw(n))}}),e}function Bl(r,e,t,{discrete:n}){const s=t.originalEvent.currentTarget,i=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?$g(s,i):s.dispatchEvent(i)}var ly=(r,e,t=0)=>{const n=Math.abs(r.x),s=Math.abs(r.y),i=n>s;return e==="left"||e==="right"?i&&n>t:!i&&s>t};function YL(r=()=>{}){const e=or(r);Pn(()=>{let t=0,n=0;return t=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(n)}},[e])}function QL(r){return r.nodeType===r.ELEMENT_NODE}function XL(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function sh(r){const e=document.activeElement;return r.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var JL=fw,_w=gw,Aw=yw,Rw=vw,Iw=Ew,Lw=xw,Cw=Gg;function kw(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=kw(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function Pw(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=kw(r))&&(n&&(n+=" "),n+=e);return n}const cy=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,uy=Pw,Dw=(r,e)=>t=>{var n;if((e==null?void 0:e.variants)==null)return uy(r,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:i}=e,o=Object.keys(s).map(c=>{const u=t==null?void 0:t[c],d=i==null?void 0:i[c];if(u===null)return null;const h=cy(u)||cy(d);return s[c][h]}),a=t&&Object.entries(t).reduce((c,u)=>{let[d,h]=u;return h===void 0||(c[d]=h),c},{}),l=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((c,u)=>{let{class:d,className:h,...f}=u;return Object.entries(f).every(p=>{let[g,m]=p;return Array.isArray(m)?m.includes({...i,...a}[g]):{...i,...a}[g]===m})?[...c,d,h]:c},[]);return uy(r,o,l,t==null?void 0:t.class,t==null?void 0:t.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZL=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ow=(...r)=>r.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var eC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tC=w.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:o,...a},l)=>w.createElement("svg",{ref:l,...eC,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:Ow("lucide",s),...a},[...o.map(([c,u])=>w.createElement(c,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=(r,e)=>{const t=w.forwardRef(({className:n,...s},i)=>w.createElement(tC,{ref:i,iconNode:e,className:Ow(`lucide-${ZL(r)}`,n),...s}));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rC=Oe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nC=Oe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sC=Oe("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iC=Oe("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vg=Oe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=Oe("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aC=Oe("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lC=Oe("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cC=Oe("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uC=Oe("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dC=Oe("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dy=Oe("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hC=Oe("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fC=Oe("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pC=Oe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gC=Oe("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Oe("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mC=Oe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yC=Oe("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vC=Oe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EC=Oe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SC=Oe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xC=Oe("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wC=Oe("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nw=Oe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Kg="-",TC=r=>{const e=_C(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:o=>{const a=o.split(Kg);return a[0]===""&&a.length!==1&&a.shift(),Mw(a,e)||bC(o)},getConflictingClassGroupIds:(o,a)=>{const l=t[o]||[];return a&&n[o]?[...l,...n[o]]:l}}},Mw=(r,e)=>{var o;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?Mw(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(Kg);return(o=e.validators.find(({validator:a})=>a(i)))==null?void 0:o.classGroupId},hy=/^\[(.+)\]$/,bC=r=>{if(hy.test(r)){const e=hy.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},_C=r=>{const{theme:e,prefix:t}=r,n={nextPart:new Map,validators:[]};return RC(Object.entries(r.classGroups),t).forEach(([i,o])=>{zf(o,n,i,e)}),n},zf=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:fy(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(AC(s)){zf(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,o])=>{zf(o,fy(e,i),t,n)})})},fy=(r,e)=>{let t=r;return e.split(Kg).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},AC=r=>r.isThemeGetter,RC=(r,e)=>e?r.map(([t,n])=>{const s=n.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,a])=>[e+o,a])):i);return[t,s]}):r,IC=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,o)=>{t.set(i,o),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let o=t.get(i);if(o!==void 0)return o;if((o=n.get(i))!==void 0)return s(i,o),o},set(i,o){t.has(i)?t.set(i,o):s(i,o)}}},Fw="!",LC=r=>{const{separator:e,experimentalParseClassName:t}=r,n=e.length===1,s=e[0],i=e.length,o=a=>{const l=[];let c=0,u=0,d;for(let m=0;m<a.length;m++){let y=a[m];if(c===0){if(y===s&&(n||a.slice(m,m+i)===e)){l.push(a.slice(u,m)),u=m+i;continue}if(y==="/"){d=m;continue}}y==="["?c++:y==="]"&&c--}const h=l.length===0?a:a.substring(u),f=h.startsWith(Fw),p=f?h.substring(1):h,g=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:g}};return t?a=>t({className:a,parseClassName:o}):o},CC=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},kC=r=>({cache:IC(r.cacheSize),parseClassName:LC(r),...TC(r)}),PC=/\s+/,DC=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s}=e,i=[],o=r.trim().split(PC);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:f}=t(c);let p=!!f,g=n(p?h.substring(0,f):h);if(!g){if(!p){a=c+(a.length>0?" "+a:a);continue}if(g=n(h),!g){a=c+(a.length>0?" "+a:a);continue}p=!1}const m=CC(u).join(":"),y=d?m+Fw:m,v=y+g;if(i.includes(v))continue;i.push(v);const E=s(g,p);for(let S=0;S<E.length;++S){const T=E[S];i.push(y+T)}a=c+(a.length>0?" "+a:a)}return a};function OC(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=$w(e))&&(n&&(n+=" "),n+=t);return n}const $w=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=$w(r[n]))&&(t&&(t+=" "),t+=e);return t};function NC(r,...e){let t,n,s,i=o;function o(l){const c=e.reduce((u,d)=>d(u),r());return t=kC(c),n=t.cache.get,s=t.cache.set,i=a,a(l)}function a(l){const c=n(l);if(c)return c;const u=DC(l,t);return s(l,u),u}return function(){return i(OC.apply(null,arguments))}}const ke=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},Uw=/^\[(?:([a-z-]+):)?(.+)\]$/i,MC=/^\d+\/\d+$/,FC=new Set(["px","full","screen"]),$C=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,UC=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,BC=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,jC=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,GC=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,gn=r=>no(r)||FC.has(r)||MC.test(r),Kn=r=>No(r,"length",QC),no=r=>!!r&&!Number.isNaN(Number(r)),ih=r=>No(r,"number",no),qo=r=>!!r&&Number.isInteger(Number(r)),VC=r=>r.endsWith("%")&&no(r.slice(0,-1)),de=r=>Uw.test(r),Hn=r=>$C.test(r),KC=new Set(["length","size","percentage"]),HC=r=>No(r,KC,Bw),WC=r=>No(r,"position",Bw),zC=new Set(["image","url"]),qC=r=>No(r,zC,JC),YC=r=>No(r,"",XC),Yo=()=>!0,No=(r,e,t)=>{const n=Uw.exec(r);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},QC=r=>UC.test(r)&&!BC.test(r),Bw=()=>!1,XC=r=>jC.test(r),JC=r=>GC.test(r),ZC=()=>{const r=ke("colors"),e=ke("spacing"),t=ke("blur"),n=ke("brightness"),s=ke("borderColor"),i=ke("borderRadius"),o=ke("borderSpacing"),a=ke("borderWidth"),l=ke("contrast"),c=ke("grayscale"),u=ke("hueRotate"),d=ke("invert"),h=ke("gap"),f=ke("gradientColorStops"),p=ke("gradientColorStopPositions"),g=ke("inset"),m=ke("margin"),y=ke("opacity"),v=ke("padding"),E=ke("saturate"),S=ke("scale"),T=ke("sepia"),A=ke("skew"),b=ke("space"),R=ke("translate"),L=()=>["auto","contain","none"],I=()=>["auto","hidden","clip","visible","scroll"],C=()=>["auto",de,e],D=()=>[de,e],B=()=>["",gn,Kn],F=()=>["auto",no,de],V=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],M=()=>["solid","dashed","dotted","double","none"],K=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],P=()=>["start","end","center","between","around","evenly","stretch"],k=()=>["","0",de],j=()=>["auto","avoid","all","avoid-page","page","left","right","column"],U=()=>[no,de];return{cacheSize:500,separator:":",theme:{colors:[Yo],spacing:[gn,Kn],blur:["none","",Hn,de],brightness:U(),borderColor:[r],borderRadius:["none","","full",Hn,de],borderSpacing:D(),borderWidth:B(),contrast:U(),grayscale:k(),hueRotate:U(),invert:k(),gap:D(),gradientColorStops:[r],gradientColorStopPositions:[VC,Kn],inset:C(),margin:C(),opacity:U(),padding:D(),saturate:U(),scale:U(),sepia:k(),skew:U(),space:D(),translate:D()},classGroups:{aspect:[{aspect:["auto","square","video",de]}],container:["container"],columns:[{columns:[Hn]}],"break-after":[{"break-after":j()}],"break-before":[{"break-before":j()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...V(),de]}],overflow:[{overflow:I()}],"overflow-x":[{"overflow-x":I()}],"overflow-y":[{"overflow-y":I()}],overscroll:[{overscroll:L()}],"overscroll-x":[{"overscroll-x":L()}],"overscroll-y":[{"overscroll-y":L()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",qo,de]}],basis:[{basis:C()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",de]}],grow:[{grow:k()}],shrink:[{shrink:k()}],order:[{order:["first","last","none",qo,de]}],"grid-cols":[{"grid-cols":[Yo]}],"col-start-end":[{col:["auto",{span:["full",qo,de]},de]}],"col-start":[{"col-start":F()}],"col-end":[{"col-end":F()}],"grid-rows":[{"grid-rows":[Yo]}],"row-start-end":[{row:["auto",{span:[qo,de]},de]}],"row-start":[{"row-start":F()}],"row-end":[{"row-end":F()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",de]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",de]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...P()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...P(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...P(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[m]}],mx:[{mx:[m]}],my:[{my:[m]}],ms:[{ms:[m]}],me:[{me:[m]}],mt:[{mt:[m]}],mr:[{mr:[m]}],mb:[{mb:[m]}],ml:[{ml:[m]}],"space-x":[{"space-x":[b]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[b]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",de,e]}],"min-w":[{"min-w":[de,e,"min","max","fit"]}],"max-w":[{"max-w":[de,e,"none","full","min","max","fit","prose",{screen:[Hn]},Hn]}],h:[{h:[de,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[de,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[de,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[de,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Hn,Kn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ih]}],"font-family":[{font:[Yo]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",de]}],"line-clamp":[{"line-clamp":["none",no,ih]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",gn,de]}],"list-image":[{"list-image":["none",de]}],"list-style-type":[{list:["none","disc","decimal",de]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...M(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",gn,Kn]}],"underline-offset":[{"underline-offset":["auto",gn,de]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:D()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",de]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",de]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...V(),WC]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",HC]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},qC]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...M(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:M()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...M()]}],"outline-offset":[{"outline-offset":[gn,de]}],"outline-w":[{outline:[gn,Kn]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[gn,Kn]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Hn,YC]}],"shadow-color":[{shadow:[Yo]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...K(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":K()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Hn,de]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[E]}],sepia:[{sepia:[T]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[E]}],"backdrop-sepia":[{"backdrop-sepia":[T]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",de]}],duration:[{duration:U()}],ease:[{ease:["linear","in","out","in-out",de]}],delay:[{delay:U()}],animate:[{animate:["none","spin","ping","pulse","bounce",de]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[S]}],"scale-x":[{"scale-x":[S]}],"scale-y":[{"scale-y":[S]}],rotate:[{rotate:[qo,de]}],"translate-x":[{"translate-x":[R]}],"translate-y":[{"translate-y":[R]}],"skew-x":[{"skew-x":[A]}],"skew-y":[{"skew-y":[A]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",de]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",de]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":D()}],"scroll-mx":[{"scroll-mx":D()}],"scroll-my":[{"scroll-my":D()}],"scroll-ms":[{"scroll-ms":D()}],"scroll-me":[{"scroll-me":D()}],"scroll-mt":[{"scroll-mt":D()}],"scroll-mr":[{"scroll-mr":D()}],"scroll-mb":[{"scroll-mb":D()}],"scroll-ml":[{"scroll-ml":D()}],"scroll-p":[{"scroll-p":D()}],"scroll-px":[{"scroll-px":D()}],"scroll-py":[{"scroll-py":D()}],"scroll-ps":[{"scroll-ps":D()}],"scroll-pe":[{"scroll-pe":D()}],"scroll-pt":[{"scroll-pt":D()}],"scroll-pr":[{"scroll-pr":D()}],"scroll-pb":[{"scroll-pb":D()}],"scroll-pl":[{"scroll-pl":D()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",de]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[gn,Kn,ih]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},ek=NC(ZC);function ye(...r){return ek(Pw(r))}const tk=JL,jw=w.forwardRef(({className:r,...e},t)=>_.jsx(_w,{ref:t,className:ye("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...e}));jw.displayName=_w.displayName;const rk=Dw("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Gw=w.forwardRef(({className:r,variant:e,...t},n)=>_.jsx(Aw,{ref:n,className:ye(rk({variant:e}),r),...t}));Gw.displayName=Aw.displayName;const nk=w.forwardRef(({className:r,...e},t)=>_.jsx(Lw,{ref:t,className:ye("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...e}));nk.displayName=Lw.displayName;const Vw=w.forwardRef(({className:r,...e},t)=>_.jsx(Cw,{ref:t,className:ye("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...e,children:_.jsx(Nw,{className:"h-4 w-4"})}));Vw.displayName=Cw.displayName;const Kw=w.forwardRef(({className:r,...e},t)=>_.jsx(Rw,{ref:t,className:ye("text-sm font-semibold",r),...e}));Kw.displayName=Rw.displayName;const Hw=w.forwardRef(({className:r,...e},t)=>_.jsx(Iw,{ref:t,className:ye("text-sm opacity-90",r),...e}));Hw.displayName=Iw.displayName;function sk(){const{toasts:r}=aL();return _.jsxs(tk,{children:[r.map(function({id:e,title:t,description:n,action:s,...i}){return _.jsxs(Gw,{...i,children:[_.jsxs("div",{className:"grid gap-1",children:[t&&_.jsx(Kw,{children:t}),n&&_.jsx(Hw,{children:n})]}),s,_.jsx(Vw,{})]},e)}),_.jsx(jw,{})]})}var py=["light","dark"],ik="(prefers-color-scheme: dark)",ok=w.createContext(void 0),ak={setTheme:r=>{},themes:[]},lk=()=>{var r;return(r=w.useContext(ok))!=null?r:ak};w.memo(({forcedTheme:r,storageKey:e,attribute:t,enableSystem:n,enableColorScheme:s,defaultTheme:i,value:o,attrs:a,nonce:l})=>{let c=i==="system",u=t==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(p=>`'${p}'`).join(",")})`};`:`var d=document.documentElement,n='${t}',s='setAttribute';`,d=s?py.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(p,g=!1,m=!0)=>{let y=o?o[p]:p,v=g?p+"|| ''":`'${y}'`,E="";return s&&m&&!g&&py.includes(p)&&(E+=`d.style.colorScheme = '${p}';`),t==="class"?g||y?E+=`c.add(${v})`:E+="null":y&&(E+=`d[s](n,${v})`),E},f=r?`!function(){${u}${h(r)}}()`:n?`!function(){try{${u}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${ik}',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}${c?"":"else{"+h(i,!1,!1)+"}"}${d}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${e}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}else{${h(i,!1,!1)};}${d}}catch(t){}}();`;return w.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})});var ck=r=>{switch(r){case"success":return hk;case"info":return pk;case"warning":return fk;case"error":return gk;default:return null}},uk=Array(12).fill(0),dk=({visible:r,className:e})=>z.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":r},z.createElement("div",{className:"sonner-spinner"},uk.map((t,n)=>z.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),hk=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),fk=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),pk=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),gk=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},z.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),mk=z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},z.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),z.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),yk=()=>{let[r,e]=z.useState(document.hidden);return z.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),r},qf=1,vk=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let e=this.subscribers.indexOf(r);this.subscribers.splice(e,1)}),this.publish=r=>{this.subscribers.forEach(e=>e(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var e;let{message:t,...n}=r,s=typeof(r==null?void 0:r.id)=="number"||((e=r.id)==null?void 0:e.length)>0?r.id:qf++,i=this.toasts.find(a=>a.id===s),o=r.dismissible===void 0?!0:r.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),i?this.toasts=this.toasts.map(a=>a.id===s?(this.publish({...a,...r,id:s,title:t}),{...a,...r,id:s,dismissible:o,title:t}):a):this.addToast({title:t,...n,dismissible:o,id:s}),s},this.dismiss=r=>(this.dismissedToasts.add(r),r||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:r,dismiss:!0})),r),this.message=(r,e)=>this.create({...e,message:r}),this.error=(r,e)=>this.create({...e,message:r,type:"error"}),this.success=(r,e)=>this.create({...e,type:"success",message:r}),this.info=(r,e)=>this.create({...e,type:"info",message:r}),this.warning=(r,e)=>this.create({...e,type:"warning",message:r}),this.loading=(r,e)=>this.create({...e,type:"loading",message:r}),this.promise=(r,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:r,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let n=r instanceof Promise?r:r(),s=t!==void 0,i,o=n.then(async l=>{if(i=["resolve",l],z.isValidElement(l))s=!1,this.create({id:t,type:"default",message:l});else if(Sk(l)&&!l.ok){s=!1;let c=typeof e.error=="function"?await e.error(`HTTP error! status: ${l.status}`):e.error,u=typeof e.description=="function"?await e.description(`HTTP error! status: ${l.status}`):e.description;this.create({id:t,type:"error",message:c,description:u})}else if(e.success!==void 0){s=!1;let c=typeof e.success=="function"?await e.success(l):e.success,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"success",message:c,description:u})}}).catch(async l=>{if(i=["reject",l],e.error!==void 0){s=!1;let c=typeof e.error=="function"?await e.error(l):e.error,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"error",message:c,description:u})}}).finally(()=>{var l;s&&(this.dismiss(t),t=void 0),(l=e.finally)==null||l.call(e)}),a=()=>new Promise((l,c)=>o.then(()=>i[0]==="reject"?c(i[1]):l(i[1])).catch(c));return typeof t!="string"&&typeof t!="number"?{unwrap:a}:Object.assign(t,{unwrap:a})},this.custom=(r,e)=>{let t=(e==null?void 0:e.id)||qf++;return this.create({jsx:r(t),id:t,...e}),t},this.getActiveToasts=()=>this.toasts.filter(r=>!this.dismissedToasts.has(r.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Ft=new vk,Ek=(r,e)=>{let t=(e==null?void 0:e.id)||qf++;return Ft.addToast({title:r,...e,id:t}),t},Sk=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",xk=Ek,wk=()=>Ft.toasts,Tk=()=>Ft.getActiveToasts();Object.assign(xk,{success:Ft.success,info:Ft.info,warning:Ft.warning,error:Ft.error,custom:Ft.custom,message:Ft.message,promise:Ft.promise,dismiss:Ft.dismiss,loading:Ft.loading},{getHistory:wk,getToasts:Tk});function bk(r,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e==="top"&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=r:n.appendChild(document.createTextNode(r))}bk(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function jl(r){return r.label!==void 0}var _k=3,Ak="32px",Rk="16px",gy=4e3,Ik=356,Lk=14,Ck=20,kk=200;function Ar(...r){return r.filter(Boolean).join(" ")}function Pk(r){let[e,t]=r.split("-"),n=[];return e&&n.push(e),t&&n.push(t),n}var Dk=r=>{var e,t,n,s,i,o,a,l,c,u,d;let{invert:h,toast:f,unstyled:p,interacting:g,setHeights:m,visibleToasts:y,heights:v,index:E,toasts:S,expanded:T,removeToast:A,defaultRichColors:b,closeButton:R,style:L,cancelButtonStyle:I,actionButtonStyle:C,className:D="",descriptionClassName:B="",duration:F,position:V,gap:M,loadingIcon:K,expandByDefault:P,classNames:k,icons:j,closeButtonAriaLabel:U="Close toast",pauseWhenPageIsHidden:$}=r,[q,Q]=z.useState(null),[Z,re]=z.useState(null),[se,Ae]=z.useState(!1),[Se,qe]=z.useState(!1),[Et,$n]=z.useState(!1),[cr,Un]=z.useState(!1),[vl,pe]=z.useState(!1),[Xe,it]=z.useState(0),[Ot,Nt]=z.useState(0),ur=z.useRef(f.duration||F||gy),Vr=z.useRef(null),Kr=z.useRef(null),gi=E===0,El=E+1<=y,ot=f.type,pn=f.dismissible!==!1,Ad=f.className||"",Sl=f.descriptionClassName||"",Ps=z.useMemo(()=>v.findIndex(ce=>ce.toastId===f.id)||0,[v,f.id]),Ds=z.useMemo(()=>{var ce;return(ce=f.closeButton)!=null?ce:R},[f.closeButton,R]),Km=z.useMemo(()=>f.duration||F||gy,[f.duration,F]),Rd=z.useRef(0),mi=z.useRef(0),Hm=z.useRef(0),yi=z.useRef(null),[RR,IR]=V.split("-"),Wm=z.useMemo(()=>v.reduce((ce,be,Ne)=>Ne>=Ps?ce:ce+be.height,0),[v,Ps]),zm=yk(),LR=f.invert||h,Id=ot==="loading";mi.current=z.useMemo(()=>Ps*M+Wm,[Ps,Wm]),z.useEffect(()=>{ur.current=Km},[Km]),z.useEffect(()=>{Ae(!0)},[]),z.useEffect(()=>{let ce=Kr.current;if(ce){let be=ce.getBoundingClientRect().height;return Nt(be),m(Ne=>[{toastId:f.id,height:be,position:f.position},...Ne]),()=>m(Ne=>Ne.filter(wr=>wr.toastId!==f.id))}},[m,f.id]),z.useLayoutEffect(()=>{if(!se)return;let ce=Kr.current,be=ce.style.height;ce.style.height="auto";let Ne=ce.getBoundingClientRect().height;ce.style.height=be,Nt(Ne),m(wr=>wr.find(Tr=>Tr.toastId===f.id)?wr.map(Tr=>Tr.toastId===f.id?{...Tr,height:Ne}:Tr):[{toastId:f.id,height:Ne,position:f.position},...wr])},[se,f.title,f.description,m,f.id]);let Bn=z.useCallback(()=>{qe(!0),it(mi.current),m(ce=>ce.filter(be=>be.toastId!==f.id)),setTimeout(()=>{A(f)},kk)},[f,A,m,mi]);z.useEffect(()=>{if(f.promise&&ot==="loading"||f.duration===1/0||f.type==="loading")return;let ce;return T||g||$&&zm?(()=>{if(Hm.current<Rd.current){let be=new Date().getTime()-Rd.current;ur.current=ur.current-be}Hm.current=new Date().getTime()})():ur.current!==1/0&&(Rd.current=new Date().getTime(),ce=setTimeout(()=>{var be;(be=f.onAutoClose)==null||be.call(f,f),Bn()},ur.current)),()=>clearTimeout(ce)},[T,g,f,ot,$,zm,Bn]),z.useEffect(()=>{f.delete&&Bn()},[Bn,f.delete]);function CR(){var ce,be,Ne;return j!=null&&j.loading?z.createElement("div",{className:Ar(k==null?void 0:k.loader,(ce=f==null?void 0:f.classNames)==null?void 0:ce.loader,"sonner-loader"),"data-visible":ot==="loading"},j.loading):K?z.createElement("div",{className:Ar(k==null?void 0:k.loader,(be=f==null?void 0:f.classNames)==null?void 0:be.loader,"sonner-loader"),"data-visible":ot==="loading"},K):z.createElement(dk,{className:Ar(k==null?void 0:k.loader,(Ne=f==null?void 0:f.classNames)==null?void 0:Ne.loader),visible:ot==="loading"})}return z.createElement("li",{tabIndex:0,ref:Kr,className:Ar(D,Ad,k==null?void 0:k.toast,(e=f==null?void 0:f.classNames)==null?void 0:e.toast,k==null?void 0:k.default,k==null?void 0:k[ot],(t=f==null?void 0:f.classNames)==null?void 0:t[ot]),"data-sonner-toast":"","data-rich-colors":(n=f.richColors)!=null?n:b,"data-styled":!(f.jsx||f.unstyled||p),"data-mounted":se,"data-promise":!!f.promise,"data-swiped":vl,"data-removed":Se,"data-visible":El,"data-y-position":RR,"data-x-position":IR,"data-index":E,"data-front":gi,"data-swiping":Et,"data-dismissible":pn,"data-type":ot,"data-invert":LR,"data-swipe-out":cr,"data-swipe-direction":Z,"data-expanded":!!(T||P&&se),style:{"--index":E,"--toasts-before":E,"--z-index":S.length-E,"--offset":`${Se?Xe:mi.current}px`,"--initial-height":P?"auto":`${Ot}px`,...L,...f.style},onDragEnd:()=>{$n(!1),Q(null),yi.current=null},onPointerDown:ce=>{Id||!pn||(Vr.current=new Date,it(mi.current),ce.target.setPointerCapture(ce.pointerId),ce.target.tagName!=="BUTTON"&&($n(!0),yi.current={x:ce.clientX,y:ce.clientY}))},onPointerUp:()=>{var ce,be,Ne,wr;if(cr||!pn)return;yi.current=null;let Tr=Number(((ce=Kr.current)==null?void 0:ce.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),jn=Number(((be=Kr.current)==null?void 0:be.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Os=new Date().getTime()-((Ne=Vr.current)==null?void 0:Ne.getTime()),br=q==="x"?Tr:jn,Gn=Math.abs(br)/Os;if(Math.abs(br)>=Ck||Gn>.11){it(mi.current),(wr=f.onDismiss)==null||wr.call(f,f),re(q==="x"?Tr>0?"right":"left":jn>0?"down":"up"),Bn(),Un(!0),pe(!1);return}$n(!1),Q(null)},onPointerMove:ce=>{var be,Ne,wr,Tr;if(!yi.current||!pn||((be=window.getSelection())==null?void 0:be.toString().length)>0)return;let jn=ce.clientY-yi.current.y,Os=ce.clientX-yi.current.x,br=(Ne=r.swipeDirections)!=null?Ne:Pk(V);!q&&(Math.abs(Os)>1||Math.abs(jn)>1)&&Q(Math.abs(Os)>Math.abs(jn)?"x":"y");let Gn={x:0,y:0};q==="y"?(br.includes("top")||br.includes("bottom"))&&(br.includes("top")&&jn<0||br.includes("bottom")&&jn>0)&&(Gn.y=jn):q==="x"&&(br.includes("left")||br.includes("right"))&&(br.includes("left")&&Os<0||br.includes("right")&&Os>0)&&(Gn.x=Os),(Math.abs(Gn.x)>0||Math.abs(Gn.y)>0)&&pe(!0),(wr=Kr.current)==null||wr.style.setProperty("--swipe-amount-x",`${Gn.x}px`),(Tr=Kr.current)==null||Tr.style.setProperty("--swipe-amount-y",`${Gn.y}px`)}},Ds&&!f.jsx?z.createElement("button",{"aria-label":U,"data-disabled":Id,"data-close-button":!0,onClick:Id||!pn?()=>{}:()=>{var ce;Bn(),(ce=f.onDismiss)==null||ce.call(f,f)},className:Ar(k==null?void 0:k.closeButton,(s=f==null?void 0:f.classNames)==null?void 0:s.closeButton)},(i=j==null?void 0:j.close)!=null?i:mk):null,f.jsx||w.isValidElement(f.title)?f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title:z.createElement(z.Fragment,null,ot||f.icon||f.promise?z.createElement("div",{"data-icon":"",className:Ar(k==null?void 0:k.icon,(o=f==null?void 0:f.classNames)==null?void 0:o.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||CR():null,f.type!=="loading"?f.icon||(j==null?void 0:j[ot])||ck(ot):null):null,z.createElement("div",{"data-content":"",className:Ar(k==null?void 0:k.content,(a=f==null?void 0:f.classNames)==null?void 0:a.content)},z.createElement("div",{"data-title":"",className:Ar(k==null?void 0:k.title,(l=f==null?void 0:f.classNames)==null?void 0:l.title)},typeof f.title=="function"?f.title():f.title),f.description?z.createElement("div",{"data-description":"",className:Ar(B,Sl,k==null?void 0:k.description,(c=f==null?void 0:f.classNames)==null?void 0:c.description)},typeof f.description=="function"?f.description():f.description):null),w.isValidElement(f.cancel)?f.cancel:f.cancel&&jl(f.cancel)?z.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||I,onClick:ce=>{var be,Ne;jl(f.cancel)&&pn&&((Ne=(be=f.cancel).onClick)==null||Ne.call(be,ce),Bn())},className:Ar(k==null?void 0:k.cancelButton,(u=f==null?void 0:f.classNames)==null?void 0:u.cancelButton)},f.cancel.label):null,w.isValidElement(f.action)?f.action:f.action&&jl(f.action)?z.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||C,onClick:ce=>{var be,Ne;jl(f.action)&&((Ne=(be=f.action).onClick)==null||Ne.call(be,ce),!ce.defaultPrevented&&Bn())},className:Ar(k==null?void 0:k.actionButton,(d=f==null?void 0:f.classNames)==null?void 0:d.actionButton)},f.action.label):null))};function my(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}function Ok(r,e){let t={};return[r,e].forEach((n,s)=>{let i=s===1,o=i?"--mobile-offset":"--offset",a=i?Rk:Ak;function l(c){["top","right","bottom","left"].forEach(u=>{t[`${o}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof n=="number"||typeof n=="string"?l(n):typeof n=="object"?["top","right","bottom","left"].forEach(c=>{n[c]===void 0?t[`${o}-${c}`]=a:t[`${o}-${c}`]=typeof n[c]=="number"?`${n[c]}px`:n[c]}):l(a)}),t}var Nk=w.forwardRef(function(r,e){let{invert:t,position:n="bottom-right",hotkey:s=["altKey","KeyT"],expand:i,closeButton:o,className:a,offset:l,mobileOffset:c,theme:u="light",richColors:d,duration:h,style:f,visibleToasts:p=_k,toastOptions:g,dir:m=my(),gap:y=Lk,loadingIcon:v,icons:E,containerAriaLabel:S="Notifications",pauseWhenPageIsHidden:T}=r,[A,b]=z.useState([]),R=z.useMemo(()=>Array.from(new Set([n].concat(A.filter($=>$.position).map($=>$.position)))),[A,n]),[L,I]=z.useState([]),[C,D]=z.useState(!1),[B,F]=z.useState(!1),[V,M]=z.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),K=z.useRef(null),P=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),k=z.useRef(null),j=z.useRef(!1),U=z.useCallback($=>{b(q=>{var Q;return(Q=q.find(Z=>Z.id===$.id))!=null&&Q.delete||Ft.dismiss($.id),q.filter(({id:Z})=>Z!==$.id)})},[]);return z.useEffect(()=>Ft.subscribe($=>{if($.dismiss){b(q=>q.map(Q=>Q.id===$.id?{...Q,delete:!0}:Q));return}setTimeout(()=>{ow.flushSync(()=>{b(q=>{let Q=q.findIndex(Z=>Z.id===$.id);return Q!==-1?[...q.slice(0,Q),{...q[Q],...$},...q.slice(Q+1)]:[$,...q]})})})}),[]),z.useEffect(()=>{if(u!=="system"){M(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?M("dark"):M("light")),typeof window>"u")return;let $=window.matchMedia("(prefers-color-scheme: dark)");try{$.addEventListener("change",({matches:q})=>{M(q?"dark":"light")})}catch{$.addListener(({matches:Q})=>{try{M(Q?"dark":"light")}catch(Z){console.error(Z)}})}},[u]),z.useEffect(()=>{A.length<=1&&D(!1)},[A]),z.useEffect(()=>{let $=q=>{var Q,Z;s.every(re=>q[re]||q.code===re)&&(D(!0),(Q=K.current)==null||Q.focus()),q.code==="Escape"&&(document.activeElement===K.current||(Z=K.current)!=null&&Z.contains(document.activeElement))&&D(!1)};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[s]),z.useEffect(()=>{if(K.current)return()=>{k.current&&(k.current.focus({preventScroll:!0}),k.current=null,j.current=!1)}},[K.current]),z.createElement("section",{ref:e,"aria-label":`${S} ${P}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},R.map(($,q)=>{var Q;let[Z,re]=$.split("-");return A.length?z.createElement("ol",{key:$,dir:m==="auto"?my():m,tabIndex:-1,ref:K,className:a,"data-sonner-toaster":!0,"data-theme":V,"data-y-position":Z,"data-lifted":C&&A.length>1&&!i,"data-x-position":re,style:{"--front-toast-height":`${((Q=L[0])==null?void 0:Q.height)||0}px`,"--width":`${Ik}px`,"--gap":`${y}px`,...f,...Ok(l,c)},onBlur:se=>{j.current&&!se.currentTarget.contains(se.relatedTarget)&&(j.current=!1,k.current&&(k.current.focus({preventScroll:!0}),k.current=null))},onFocus:se=>{se.target instanceof HTMLElement&&se.target.dataset.dismissible==="false"||j.current||(j.current=!0,k.current=se.relatedTarget)},onMouseEnter:()=>D(!0),onMouseMove:()=>D(!0),onMouseLeave:()=>{B||D(!1)},onDragEnd:()=>D(!1),onPointerDown:se=>{se.target instanceof HTMLElement&&se.target.dataset.dismissible==="false"||F(!0)},onPointerUp:()=>F(!1)},A.filter(se=>!se.position&&q===0||se.position===$).map((se,Ae)=>{var Se,qe;return z.createElement(Dk,{key:se.id,icons:E,index:Ae,toast:se,defaultRichColors:d,duration:(Se=g==null?void 0:g.duration)!=null?Se:h,className:g==null?void 0:g.className,descriptionClassName:g==null?void 0:g.descriptionClassName,invert:t,visibleToasts:p,closeButton:(qe=g==null?void 0:g.closeButton)!=null?qe:o,interacting:B,position:$,style:g==null?void 0:g.style,unstyled:g==null?void 0:g.unstyled,classNames:g==null?void 0:g.classNames,cancelButtonStyle:g==null?void 0:g.cancelButtonStyle,actionButtonStyle:g==null?void 0:g.actionButtonStyle,removeToast:U,toasts:A.filter(Et=>Et.position==se.position),heights:L.filter(Et=>Et.position==se.position),setHeights:I,expandByDefault:i,gap:y,loadingIcon:v,expanded:C,pauseWhenPageIsHidden:T,swipeDirections:r.swipeDirections})})):null}))});const Mk=({...r})=>{const{theme:e="system"}=lk();return _.jsx(Nk,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})};var Fk=zp[" useId ".trim().toString()]||(()=>{}),$k=0;function lu(r){const[e,t]=w.useState(Fk());return Pn(()=>{r||t(n=>n??String($k++))},[r]),r||(e?`radix-${e}`:"")}const Uk=["top","right","bottom","left"],bs=Math.min,Qt=Math.max,cu=Math.round,Gl=Math.floor,ln=r=>({x:r,y:r}),Bk={left:"right",right:"left",bottom:"top",top:"bottom"},jk={start:"end",end:"start"};function Yf(r,e,t){return Qt(r,bs(e,t))}function Dn(r,e){return typeof r=="function"?r(e):r}function On(r){return r.split("-")[0]}function Mo(r){return r.split("-")[1]}function Hg(r){return r==="x"?"y":"x"}function Wg(r){return r==="y"?"height":"width"}const Gk=new Set(["top","bottom"]);function rn(r){return Gk.has(On(r))?"y":"x"}function zg(r){return Hg(rn(r))}function Vk(r,e,t){t===void 0&&(t=!1);const n=Mo(r),s=zg(r),i=Wg(s);let o=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=uu(o)),[o,uu(o)]}function Kk(r){const e=uu(r);return[Qf(r),e,Qf(e)]}function Qf(r){return r.replace(/start|end/g,e=>jk[e])}const yy=["left","right"],vy=["right","left"],Hk=["top","bottom"],Wk=["bottom","top"];function zk(r,e,t){switch(r){case"top":case"bottom":return t?e?vy:yy:e?yy:vy;case"left":case"right":return e?Hk:Wk;default:return[]}}function qk(r,e,t,n){const s=Mo(r);let i=zk(On(r),t==="start",n);return s&&(i=i.map(o=>o+"-"+s),e&&(i=i.concat(i.map(Qf)))),i}function uu(r){return r.replace(/left|right|bottom|top/g,e=>Bk[e])}function Yk(r){return{top:0,right:0,bottom:0,left:0,...r}}function Ww(r){return typeof r!="number"?Yk(r):{top:r,right:r,bottom:r,left:r}}function du(r){const{x:e,y:t,width:n,height:s}=r;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function Ey(r,e,t){let{reference:n,floating:s}=r;const i=rn(e),o=zg(e),a=Wg(o),l=On(e),c=i==="y",u=n.x+n.width/2-s.width/2,d=n.y+n.height/2-s.height/2,h=n[a]/2-s[a]/2;let f;switch(l){case"top":f={x:u,y:n.y-s.height};break;case"bottom":f={x:u,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:d};break;case"left":f={x:n.x-s.width,y:d};break;default:f={x:n.x,y:n.y}}switch(Mo(e)){case"start":f[o]-=h*(t&&c?-1:1);break;case"end":f[o]+=h*(t&&c?-1:1);break}return f}const Qk=async(r,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:i=[],platform:o}=t,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:r,floating:e,strategy:s}),{x:u,y:d}=Ey(c,n,l),h=n,f={},p=0;for(let g=0;g<a.length;g++){const{name:m,fn:y}=a[g],{x:v,y:E,data:S,reset:T}=await y({x:u,y:d,initialPlacement:n,placement:h,strategy:s,middlewareData:f,rects:c,platform:o,elements:{reference:r,floating:e}});u=v??u,d=E??d,f={...f,[m]:{...f[m],...S}},T&&p<=50&&(p++,typeof T=="object"&&(T.placement&&(h=T.placement),T.rects&&(c=T.rects===!0?await o.getElementRects({reference:r,floating:e,strategy:s}):T.rects),{x:u,y:d}=Ey(c,h,l)),g=-1)}return{x:u,y:d,placement:h,strategy:s,middlewareData:f}};async function $a(r,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:i,rects:o,elements:a,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=Dn(e,r),p=Ww(f),m=a[h?d==="floating"?"reference":"floating":d],y=du(await i.getClippingRect({element:(t=await(i.isElement==null?void 0:i.isElement(m)))==null||t?m:m.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),v=d==="floating"?{x:n,y:s,width:o.floating.width,height:o.floating.height}:o.reference,E=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),S=await(i.isElement==null?void 0:i.isElement(E))?await(i.getScale==null?void 0:i.getScale(E))||{x:1,y:1}:{x:1,y:1},T=du(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:E,strategy:l}):v);return{top:(y.top-T.top+p.top)/S.y,bottom:(T.bottom-y.bottom+p.bottom)/S.y,left:(y.left-T.left+p.left)/S.x,right:(T.right-y.right+p.right)/S.x}}const Xk=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:n,placement:s,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Dn(r,e)||{};if(c==null)return{};const d=Ww(u),h={x:t,y:n},f=zg(s),p=Wg(f),g=await o.getDimensions(c),m=f==="y",y=m?"top":"left",v=m?"bottom":"right",E=m?"clientHeight":"clientWidth",S=i.reference[p]+i.reference[f]-h[f]-i.floating[p],T=h[f]-i.reference[f],A=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let b=A?A[E]:0;(!b||!await(o.isElement==null?void 0:o.isElement(A)))&&(b=a.floating[E]||i.floating[p]);const R=S/2-T/2,L=b/2-g[p]/2-1,I=bs(d[y],L),C=bs(d[v],L),D=I,B=b-g[p]-C,F=b/2-g[p]/2+R,V=Yf(D,F,B),M=!l.arrow&&Mo(s)!=null&&F!==V&&i.reference[p]/2-(F<D?I:C)-g[p]/2<0,K=M?F<D?F-D:F-B:0;return{[f]:h[f]+K,data:{[f]:V,centerOffset:F-V-K,...M&&{alignmentOffset:K}},reset:M}}}),Jk=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:s,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:g=!0,...m}=Dn(r,e);if((t=i.arrow)!=null&&t.alignmentOffset)return{};const y=On(s),v=rn(a),E=On(a)===a,S=await(l.isRTL==null?void 0:l.isRTL(c.floating)),T=h||(E||!g?[uu(a)]:Kk(a)),A=p!=="none";!h&&A&&T.push(...qk(a,g,p,S));const b=[a,...T],R=await $a(e,m),L=[];let I=((n=i.flip)==null?void 0:n.overflows)||[];if(u&&L.push(R[y]),d){const F=Vk(s,o,S);L.push(R[F[0]],R[F[1]])}if(I=[...I,{placement:s,overflows:L}],!L.every(F=>F<=0)){var C,D;const F=(((C=i.flip)==null?void 0:C.index)||0)+1,V=b[F];if(V&&(!(d==="alignment"?v!==rn(V):!1)||I.every(P=>P.overflows[0]>0&&rn(P.placement)===v)))return{data:{index:F,overflows:I},reset:{placement:V}};let M=(D=I.filter(K=>K.overflows[0]<=0).sort((K,P)=>K.overflows[1]-P.overflows[1])[0])==null?void 0:D.placement;if(!M)switch(f){case"bestFit":{var B;const K=(B=I.filter(P=>{if(A){const k=rn(P.placement);return k===v||k==="y"}return!0}).map(P=>[P.placement,P.overflows.filter(k=>k>0).reduce((k,j)=>k+j,0)]).sort((P,k)=>P[1]-k[1])[0])==null?void 0:B[0];K&&(M=K);break}case"initialPlacement":M=a;break}if(s!==M)return{reset:{placement:M}}}return{}}}};function Sy(r,e){return{top:r.top-e.height,right:r.right-e.width,bottom:r.bottom-e.height,left:r.left-e.width}}function xy(r){return Uk.some(e=>r[e]>=0)}const Zk=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...s}=Dn(r,e);switch(n){case"referenceHidden":{const i=await $a(e,{...s,elementContext:"reference"}),o=Sy(i,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:xy(o)}}}case"escaped":{const i=await $a(e,{...s,altBoundary:!0}),o=Sy(i,t.floating);return{data:{escapedOffsets:o,escaped:xy(o)}}}default:return{}}}}},zw=new Set(["left","top"]);async function eP(r,e){const{placement:t,platform:n,elements:s}=r,i=await(n.isRTL==null?void 0:n.isRTL(s.floating)),o=On(t),a=Mo(t),l=rn(t)==="y",c=zw.has(o)?-1:1,u=i&&l?-1:1,d=Dn(e,r);let{mainAxis:h,crossAxis:f,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof p=="number"&&(f=a==="end"?p*-1:p),l?{x:f*u,y:h*c}:{x:h*c,y:f*u}}const tP=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:s,y:i,placement:o,middlewareData:a}=e,l=await eP(e,r);return o===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+l.x,y:i+l.y,data:{...l,placement:o}}}}},rP=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:m=>{let{x:y,y:v}=m;return{x:y,y:v}}},...l}=Dn(r,e),c={x:t,y:n},u=await $a(e,l),d=rn(On(s)),h=Hg(d);let f=c[h],p=c[d];if(i){const m=h==="y"?"top":"left",y=h==="y"?"bottom":"right",v=f+u[m],E=f-u[y];f=Yf(v,f,E)}if(o){const m=d==="y"?"top":"left",y=d==="y"?"bottom":"right",v=p+u[m],E=p-u[y];p=Yf(v,p,E)}const g=a.fn({...e,[h]:f,[d]:p});return{...g,data:{x:g.x-t,y:g.y-n,enabled:{[h]:i,[d]:o}}}}}},nP=function(r){return r===void 0&&(r={}),{options:r,fn(e){const{x:t,y:n,placement:s,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Dn(r,e),u={x:t,y:n},d=rn(s),h=Hg(d);let f=u[h],p=u[d];const g=Dn(a,e),m=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const E=h==="y"?"height":"width",S=i.reference[h]-i.floating[E]+m.mainAxis,T=i.reference[h]+i.reference[E]-m.mainAxis;f<S?f=S:f>T&&(f=T)}if(c){var y,v;const E=h==="y"?"width":"height",S=zw.has(On(s)),T=i.reference[d]-i.floating[E]+(S&&((y=o.offset)==null?void 0:y[d])||0)+(S?0:m.crossAxis),A=i.reference[d]+i.reference[E]+(S?0:((v=o.offset)==null?void 0:v[d])||0)-(S?m.crossAxis:0);p<T?p=T:p>A&&(p=A)}return{[h]:f,[d]:p}}}},sP=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,n;const{placement:s,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Dn(r,e),u=await $a(e,c),d=On(s),h=Mo(s),f=rn(s)==="y",{width:p,height:g}=i.floating;let m,y;d==="top"||d==="bottom"?(m=d,y=h===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(y=d,m=h==="end"?"top":"bottom");const v=g-u.top-u.bottom,E=p-u.left-u.right,S=bs(g-u[m],v),T=bs(p-u[y],E),A=!e.middlewareData.shift;let b=S,R=T;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(R=E),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(b=v),A&&!h){const I=Qt(u.left,0),C=Qt(u.right,0),D=Qt(u.top,0),B=Qt(u.bottom,0);f?R=p-2*(I!==0||C!==0?I+C:Qt(u.left,u.right)):b=g-2*(D!==0||B!==0?D+B:Qt(u.top,u.bottom))}await l({...e,availableWidth:R,availableHeight:b});const L=await o.getDimensions(a.floating);return p!==L.width||g!==L.height?{reset:{rects:!0}}:{}}}};function td(){return typeof window<"u"}function Fo(r){return qw(r)?(r.nodeName||"").toLowerCase():"#document"}function nr(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function fn(r){var e;return(e=(qw(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function qw(r){return td()?r instanceof Node||r instanceof nr(r).Node:!1}function jr(r){return td()?r instanceof Element||r instanceof nr(r).Element:!1}function cn(r){return td()?r instanceof HTMLElement||r instanceof nr(r).HTMLElement:!1}function wy(r){return!td()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof nr(r).ShadowRoot}const iP=new Set(["inline","contents"]);function fl(r){const{overflow:e,overflowX:t,overflowY:n,display:s}=Gr(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!iP.has(s)}const oP=new Set(["table","td","th"]);function aP(r){return oP.has(Fo(r))}const lP=[":popover-open",":modal"];function rd(r){return lP.some(e=>{try{return r.matches(e)}catch{return!1}})}const cP=["transform","translate","scale","rotate","perspective"],uP=["transform","translate","scale","rotate","perspective","filter"],dP=["paint","layout","strict","content"];function qg(r){const e=Yg(),t=jr(r)?Gr(r):r;return cP.some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||uP.some(n=>(t.willChange||"").includes(n))||dP.some(n=>(t.contain||"").includes(n))}function hP(r){let e=_s(r);for(;cn(e)&&!Io(e);){if(qg(e))return e;if(rd(e))return null;e=_s(e)}return null}function Yg(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const fP=new Set(["html","body","#document"]);function Io(r){return fP.has(Fo(r))}function Gr(r){return nr(r).getComputedStyle(r)}function nd(r){return jr(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function _s(r){if(Fo(r)==="html")return r;const e=r.assignedSlot||r.parentNode||wy(r)&&r.host||fn(r);return wy(e)?e.host:e}function Yw(r){const e=_s(r);return Io(e)?r.ownerDocument?r.ownerDocument.body:r.body:cn(e)&&fl(e)?e:Yw(e)}function Ua(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=Yw(r),i=s===((n=r.ownerDocument)==null?void 0:n.body),o=nr(s);if(i){const a=Xf(o);return e.concat(o,o.visualViewport||[],fl(s)?s:[],a&&t?Ua(a):[])}return e.concat(s,Ua(s,[],t))}function Xf(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function Qw(r){const e=Gr(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=cn(r),i=s?r.offsetWidth:t,o=s?r.offsetHeight:n,a=cu(t)!==i||cu(n)!==o;return a&&(t=i,n=o),{width:t,height:n,$:a}}function Qg(r){return jr(r)?r:r.contextElement}function so(r){const e=Qg(r);if(!cn(e))return ln(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:i}=Qw(e);let o=(i?cu(t.width):t.width)/n,a=(i?cu(t.height):t.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const pP=ln(0);function Xw(r){const e=nr(r);return!Yg()||!e.visualViewport?pP:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function gP(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==nr(r)?!1:e}function ci(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=r.getBoundingClientRect(),i=Qg(r);let o=ln(1);e&&(n?jr(n)&&(o=so(n)):o=so(r));const a=gP(i,t,n)?Xw(i):ln(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,u=s.width/o.x,d=s.height/o.y;if(i){const h=nr(i),f=n&&jr(n)?nr(n):n;let p=h,g=Xf(p);for(;g&&n&&f!==p;){const m=so(g),y=g.getBoundingClientRect(),v=Gr(g),E=y.left+(g.clientLeft+parseFloat(v.paddingLeft))*m.x,S=y.top+(g.clientTop+parseFloat(v.paddingTop))*m.y;l*=m.x,c*=m.y,u*=m.x,d*=m.y,l+=E,c+=S,p=nr(g),g=Xf(p)}}return du({width:u,height:d,x:l,y:c})}function Xg(r,e){const t=nd(r).scrollLeft;return e?e.left+t:ci(fn(r)).left+t}function Jw(r,e,t){t===void 0&&(t=!1);const n=r.getBoundingClientRect(),s=n.left+e.scrollLeft-(t?0:Xg(r,n)),i=n.top+e.scrollTop;return{x:s,y:i}}function mP(r){let{elements:e,rect:t,offsetParent:n,strategy:s}=r;const i=s==="fixed",o=fn(n),a=e?rd(e.floating):!1;if(n===o||a&&i)return t;let l={scrollLeft:0,scrollTop:0},c=ln(1);const u=ln(0),d=cn(n);if((d||!d&&!i)&&((Fo(n)!=="body"||fl(o))&&(l=nd(n)),cn(n))){const f=ci(n);c=so(n),u.x=f.x+n.clientLeft,u.y=f.y+n.clientTop}const h=o&&!d&&!i?Jw(o,l,!0):ln(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:t.y*c.y-l.scrollTop*c.y+u.y+h.y}}function yP(r){return Array.from(r.getClientRects())}function vP(r){const e=fn(r),t=nd(r),n=r.ownerDocument.body,s=Qt(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),i=Qt(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+Xg(r);const a=-t.scrollTop;return Gr(n).direction==="rtl"&&(o+=Qt(e.clientWidth,n.clientWidth)-s),{width:s,height:i,x:o,y:a}}function EP(r,e){const t=nr(r),n=fn(r),s=t.visualViewport;let i=n.clientWidth,o=n.clientHeight,a=0,l=0;if(s){i=s.width,o=s.height;const c=Yg();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:i,height:o,x:a,y:l}}const SP=new Set(["absolute","fixed"]);function xP(r,e){const t=ci(r,!0,e==="fixed"),n=t.top+r.clientTop,s=t.left+r.clientLeft,i=cn(r)?so(r):ln(1),o=r.clientWidth*i.x,a=r.clientHeight*i.y,l=s*i.x,c=n*i.y;return{width:o,height:a,x:l,y:c}}function Ty(r,e,t){let n;if(e==="viewport")n=EP(r,t);else if(e==="document")n=vP(fn(r));else if(jr(e))n=xP(e,t);else{const s=Xw(r);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return du(n)}function Zw(r,e){const t=_s(r);return t===e||!jr(t)||Io(t)?!1:Gr(t).position==="fixed"||Zw(t,e)}function wP(r,e){const t=e.get(r);if(t)return t;let n=Ua(r,[],!1).filter(a=>jr(a)&&Fo(a)!=="body"),s=null;const i=Gr(r).position==="fixed";let o=i?_s(r):r;for(;jr(o)&&!Io(o);){const a=Gr(o),l=qg(o);!l&&a.position==="fixed"&&(s=null),(i?!l&&!s:!l&&a.position==="static"&&!!s&&SP.has(s.position)||fl(o)&&!l&&Zw(r,o))?n=n.filter(u=>u!==o):s=a,o=_s(o)}return e.set(r,n),n}function TP(r){let{element:e,boundary:t,rootBoundary:n,strategy:s}=r;const o=[...t==="clippingAncestors"?rd(e)?[]:wP(e,this._c):[].concat(t),n],a=o[0],l=o.reduce((c,u)=>{const d=Ty(e,u,s);return c.top=Qt(d.top,c.top),c.right=bs(d.right,c.right),c.bottom=bs(d.bottom,c.bottom),c.left=Qt(d.left,c.left),c},Ty(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function bP(r){const{width:e,height:t}=Qw(r);return{width:e,height:t}}function _P(r,e,t){const n=cn(e),s=fn(e),i=t==="fixed",o=ci(r,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=ln(0);function c(){l.x=Xg(s)}if(n||!n&&!i)if((Fo(e)!=="body"||fl(s))&&(a=nd(e)),n){const f=ci(e,!0,i,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else s&&c();i&&!n&&s&&c();const u=s&&!n&&!i?Jw(s,a):ln(0),d=o.left+a.scrollLeft-l.x-u.x,h=o.top+a.scrollTop-l.y-u.y;return{x:d,y:h,width:o.width,height:o.height}}function oh(r){return Gr(r).position==="static"}function by(r,e){if(!cn(r)||Gr(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return fn(r)===t&&(t=t.ownerDocument.body),t}function eT(r,e){const t=nr(r);if(rd(r))return t;if(!cn(r)){let s=_s(r);for(;s&&!Io(s);){if(jr(s)&&!oh(s))return s;s=_s(s)}return t}let n=by(r,e);for(;n&&aP(n)&&oh(n);)n=by(n,e);return n&&Io(n)&&oh(n)&&!qg(n)?t:n||hP(r)||t}const AP=async function(r){const e=this.getOffsetParent||eT,t=this.getDimensions,n=await t(r.floating);return{reference:_P(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function RP(r){return Gr(r).direction==="rtl"}const IP={convertOffsetParentRelativeRectToViewportRelativeRect:mP,getDocumentElement:fn,getClippingRect:TP,getOffsetParent:eT,getElementRects:AP,getClientRects:yP,getDimensions:bP,getScale:so,isElement:jr,isRTL:RP};function tT(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function LP(r,e){let t=null,n;const s=fn(r);function i(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const c=r.getBoundingClientRect(),{left:u,top:d,width:h,height:f}=c;if(a||e(),!h||!f)return;const p=Gl(d),g=Gl(s.clientWidth-(u+h)),m=Gl(s.clientHeight-(d+f)),y=Gl(u),E={rootMargin:-p+"px "+-g+"px "+-m+"px "+-y+"px",threshold:Qt(0,bs(1,l))||1};let S=!0;function T(A){const b=A[0].intersectionRatio;if(b!==l){if(!S)return o();b?o(!1,b):n=setTimeout(()=>{o(!1,1e-7)},1e3)}b===1&&!tT(c,r.getBoundingClientRect())&&o(),S=!1}try{t=new IntersectionObserver(T,{...E,root:s.ownerDocument})}catch{t=new IntersectionObserver(T,E)}t.observe(r)}return o(!0),i}function CP(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Qg(r),u=s||i?[...c?Ua(c):[],...Ua(e)]:[];u.forEach(y=>{s&&y.addEventListener("scroll",t,{passive:!0}),i&&y.addEventListener("resize",t)});const d=c&&a?LP(c,t):null;let h=-1,f=null;o&&(f=new ResizeObserver(y=>{let[v]=y;v&&v.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var E;(E=f)==null||E.observe(e)})),t()}),c&&!l&&f.observe(c),f.observe(e));let p,g=l?ci(r):null;l&&m();function m(){const y=ci(r);g&&!tT(g,y)&&t(),g=y,p=requestAnimationFrame(m)}return t(),()=>{var y;u.forEach(v=>{s&&v.removeEventListener("scroll",t),i&&v.removeEventListener("resize",t)}),d==null||d(),(y=f)==null||y.disconnect(),f=null,l&&cancelAnimationFrame(p)}}const kP=tP,PP=rP,DP=Jk,OP=sP,NP=Zk,_y=Xk,MP=nP,FP=(r,e,t)=>{const n=new Map,s={platform:IP,...t},i={...s.platform,_c:n};return Qk(r,e,{...s,platform:i})};var $P=typeof document<"u",UP=function(){},Rc=$P?w.useLayoutEffect:UP;function hu(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="function"&&r.toString()===e.toString())return!0;let t,n,s;if(r&&e&&typeof r=="object"){if(Array.isArray(r)){if(t=r.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!hu(r[n],e[n]))return!1;return!0}if(s=Object.keys(r),t=s.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,s[n]))return!1;for(n=t;n--!==0;){const i=s[n];if(!(i==="_owner"&&r.$$typeof)&&!hu(r[i],e[i]))return!1}return!0}return r!==r&&e!==e}function rT(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function Ay(r,e){const t=rT(r);return Math.round(e*t)/t}function ah(r){const e=w.useRef(r);return Rc(()=>{e.current=r}),e}function BP(r){r===void 0&&(r={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:s,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=r,[u,d]=w.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=w.useState(n);hu(h,n)||f(n);const[p,g]=w.useState(null),[m,y]=w.useState(null),v=w.useCallback(P=>{P!==A.current&&(A.current=P,g(P))},[]),E=w.useCallback(P=>{P!==b.current&&(b.current=P,y(P))},[]),S=i||p,T=o||m,A=w.useRef(null),b=w.useRef(null),R=w.useRef(u),L=l!=null,I=ah(l),C=ah(s),D=ah(c),B=w.useCallback(()=>{if(!A.current||!b.current)return;const P={placement:e,strategy:t,middleware:h};C.current&&(P.platform=C.current),FP(A.current,b.current,P).then(k=>{const j={...k,isPositioned:D.current!==!1};F.current&&!hu(R.current,j)&&(R.current=j,ul.flushSync(()=>{d(j)}))})},[h,e,t,C,D]);Rc(()=>{c===!1&&R.current.isPositioned&&(R.current.isPositioned=!1,d(P=>({...P,isPositioned:!1})))},[c]);const F=w.useRef(!1);Rc(()=>(F.current=!0,()=>{F.current=!1}),[]),Rc(()=>{if(S&&(A.current=S),T&&(b.current=T),S&&T){if(I.current)return I.current(S,T,B);B()}},[S,T,B,I,L]);const V=w.useMemo(()=>({reference:A,floating:b,setReference:v,setFloating:E}),[v,E]),M=w.useMemo(()=>({reference:S,floating:T}),[S,T]),K=w.useMemo(()=>{const P={position:t,left:0,top:0};if(!M.floating)return P;const k=Ay(M.floating,u.x),j=Ay(M.floating,u.y);return a?{...P,transform:"translate("+k+"px, "+j+"px)",...rT(M.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:k,top:j}},[t,a,M.floating,u.x,u.y]);return w.useMemo(()=>({...u,update:B,refs:V,elements:M,floatingStyles:K}),[u,B,V,M,K])}const jP=r=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:r,fn(t){const{element:n,padding:s}=typeof r=="function"?r(t):r;return n&&e(n)?n.current!=null?_y({element:n.current,padding:s}).fn(t):{}:n?_y({element:n,padding:s}).fn(t):{}}}},GP=(r,e)=>({...kP(r),options:[r,e]}),VP=(r,e)=>({...PP(r),options:[r,e]}),KP=(r,e)=>({...MP(r),options:[r,e]}),HP=(r,e)=>({...DP(r),options:[r,e]}),WP=(r,e)=>({...OP(r),options:[r,e]}),zP=(r,e)=>({...NP(r),options:[r,e]}),qP=(r,e)=>({...jP(r),options:[r,e]});var YP="Arrow",nT=w.forwardRef((r,e)=>{const{children:t,width:n=10,height:s=5,...i}=r;return _.jsx(Ee.svg,{...i,ref:e,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?t:_.jsx("polygon",{points:"0,0 30,0 15,10"})})});nT.displayName=YP;var QP=nT;function sT(r){const[e,t]=w.useState(void 0);return Pn(()=>{if(r){t({width:r.offsetWidth,height:r.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const i=s[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=r.offsetWidth,a=r.offsetHeight;t({width:o,height:a})});return n.observe(r,{box:"border-box"}),()=>n.unobserve(r)}else t(void 0)},[r]),e}var Jg="Popper",[iT,sd]=Mn(Jg),[XP,oT]=iT(Jg),aT=r=>{const{__scopePopper:e,children:t}=r,[n,s]=w.useState(null);return _.jsx(XP,{scope:e,anchor:n,onAnchorChange:s,children:t})};aT.displayName=Jg;var lT="PopperAnchor",cT=w.forwardRef((r,e)=>{const{__scopePopper:t,virtualRef:n,...s}=r,i=oT(lT,t),o=w.useRef(null),a=Fe(e,o);return w.useEffect(()=>{i.onAnchorChange((n==null?void 0:n.current)||o.current)}),n?null:_.jsx(Ee.div,{...s,ref:a})});cT.displayName=lT;var Zg="PopperContent",[JP,ZP]=iT(Zg),uT=w.forwardRef((r,e)=>{var se,Ae,Se,qe,Et,$n;const{__scopePopper:t,side:n="bottom",sideOffset:s=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:f="optimized",onPlaced:p,...g}=r,m=oT(Zg,t),[y,v]=w.useState(null),E=Fe(e,cr=>v(cr)),[S,T]=w.useState(null),A=sT(S),b=(A==null?void 0:A.width)??0,R=(A==null?void 0:A.height)??0,L=n+(i!=="center"?"-"+i:""),I=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},C=Array.isArray(c)?c:[c],D=C.length>0,B={padding:I,boundary:C.filter(tD),altBoundary:D},{refs:F,floatingStyles:V,placement:M,isPositioned:K,middlewareData:P}=BP({strategy:"fixed",placement:L,whileElementsMounted:(...cr)=>CP(...cr,{animationFrame:f==="always"}),elements:{reference:m.anchor},middleware:[GP({mainAxis:s+R,alignmentAxis:o}),l&&VP({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?KP():void 0,...B}),l&&HP({...B}),WP({...B,apply:({elements:cr,rects:Un,availableWidth:vl,availableHeight:pe})=>{const{width:Xe,height:it}=Un.reference,Ot=cr.floating.style;Ot.setProperty("--radix-popper-available-width",`${vl}px`),Ot.setProperty("--radix-popper-available-height",`${pe}px`),Ot.setProperty("--radix-popper-anchor-width",`${Xe}px`),Ot.setProperty("--radix-popper-anchor-height",`${it}px`)}}),S&&qP({element:S,padding:a}),rD({arrowWidth:b,arrowHeight:R}),h&&zP({strategy:"referenceHidden",...B})]}),[k,j]=fT(M),U=or(p);Pn(()=>{K&&(U==null||U())},[K,U]);const $=(se=P.arrow)==null?void 0:se.x,q=(Ae=P.arrow)==null?void 0:Ae.y,Q=((Se=P.arrow)==null?void 0:Se.centerOffset)!==0,[Z,re]=w.useState();return Pn(()=>{y&&re(window.getComputedStyle(y).zIndex)},[y]),_.jsx("div",{ref:F.setFloating,"data-radix-popper-content-wrapper":"",style:{...V,transform:K?V.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Z,"--radix-popper-transform-origin":[(qe=P.transformOrigin)==null?void 0:qe.x,(Et=P.transformOrigin)==null?void 0:Et.y].join(" "),...(($n=P.hide)==null?void 0:$n.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:_.jsx(JP,{scope:t,placedSide:k,onArrowChange:T,arrowX:$,arrowY:q,shouldHideArrow:Q,children:_.jsx(Ee.div,{"data-side":k,"data-align":j,...g,ref:E,style:{...g.style,animation:K?void 0:"none"}})})})});uT.displayName=Zg;var dT="PopperArrow",eD={top:"bottom",right:"left",bottom:"top",left:"right"},hT=w.forwardRef(function(e,t){const{__scopePopper:n,...s}=e,i=ZP(dT,n),o=eD[i.placedSide];return _.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:_.jsx(QP,{...s,ref:t,style:{...s.style,display:"block"}})})});hT.displayName=dT;function tD(r){return r!==null}var rD=r=>({name:"transformOrigin",options:r,fn(e){var m,y,v;const{placement:t,rects:n,middlewareData:s}=e,o=((m=s.arrow)==null?void 0:m.centerOffset)!==0,a=o?0:r.arrowWidth,l=o?0:r.arrowHeight,[c,u]=fT(t),d={start:"0%",center:"50%",end:"100%"}[u],h=(((y=s.arrow)==null?void 0:y.x)??0)+a/2,f=(((v=s.arrow)==null?void 0:v.y)??0)+l/2;let p="",g="";return c==="bottom"?(p=o?d:`${h}px`,g=`${-l}px`):c==="top"?(p=o?d:`${h}px`,g=`${n.floating.height+l}px`):c==="right"?(p=`${-l}px`,g=o?d:`${f}px`):c==="left"&&(p=`${n.floating.width+l}px`,g=o?d:`${f}px`),{data:{x:p,y:g}}}});function fT(r){const[e,t="center"]=r.split("-");return[e,t]}var nD=aT,pT=cT,gT=uT,mT=hT,[id,C8]=Mn("Tooltip",[sd]),em=sd(),yT="TooltipProvider",sD=700,Ry="tooltip.open",[iD,vT]=id(yT),ET=r=>{const{__scopeTooltip:e,delayDuration:t=sD,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:i}=r,o=w.useRef(!0),a=w.useRef(!1),l=w.useRef(0);return w.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),_.jsx(iD,{scope:e,isOpenDelayedRef:o,delayDuration:t,onOpen:w.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:w.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,n)},[n]),isPointerInTransitRef:a,onPointerInTransitChange:w.useCallback(c=>{a.current=c},[]),disableHoverableContent:s,children:i})};ET.displayName=yT;var ST="Tooltip",[k8,od]=id(ST),Jf="TooltipTrigger",oD=w.forwardRef((r,e)=>{const{__scopeTooltip:t,...n}=r,s=od(Jf,t),i=vT(Jf,t),o=em(t),a=w.useRef(null),l=Fe(e,a,s.onTriggerChange),c=w.useRef(!1),u=w.useRef(!1),d=w.useCallback(()=>c.current=!1,[]);return w.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),_.jsx(pT,{asChild:!0,...o,children:_.jsx(Ee.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:l,onPointerMove:te(r.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(s.onTriggerEnter(),u.current=!0)}),onPointerLeave:te(r.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:te(r.onPointerDown,()=>{s.open&&s.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:te(r.onFocus,()=>{c.current||s.onOpen()}),onBlur:te(r.onBlur,s.onClose),onClick:te(r.onClick,s.onClose)})})});oD.displayName=Jf;var aD="TooltipPortal",[P8,lD]=id(aD,{forceMount:void 0}),Lo="TooltipContent",xT=w.forwardRef((r,e)=>{const t=lD(Lo,r.__scopeTooltip),{forceMount:n=t.forceMount,side:s="top",...i}=r,o=od(Lo,r.__scopeTooltip);return _.jsx(ks,{present:n||o.open,children:o.disableHoverableContent?_.jsx(wT,{side:s,...i,ref:e}):_.jsx(cD,{side:s,...i,ref:e})})}),cD=w.forwardRef((r,e)=>{const t=od(Lo,r.__scopeTooltip),n=vT(Lo,r.__scopeTooltip),s=w.useRef(null),i=Fe(e,s),[o,a]=w.useState(null),{trigger:l,onClose:c}=t,u=s.current,{onPointerInTransitChange:d}=n,h=w.useCallback(()=>{a(null),d(!1)},[d]),f=w.useCallback((p,g)=>{const m=p.currentTarget,y={x:p.clientX,y:p.clientY},v=pD(y,m.getBoundingClientRect()),E=gD(y,v),S=mD(g.getBoundingClientRect()),T=vD([...E,...S]);a(T),d(!0)},[d]);return w.useEffect(()=>()=>h(),[h]),w.useEffect(()=>{if(l&&u){const p=m=>f(m,u),g=m=>f(m,l);return l.addEventListener("pointerleave",p),u.addEventListener("pointerleave",g),()=>{l.removeEventListener("pointerleave",p),u.removeEventListener("pointerleave",g)}}},[l,u,f,h]),w.useEffect(()=>{if(o){const p=g=>{const m=g.target,y={x:g.clientX,y:g.clientY},v=(l==null?void 0:l.contains(m))||(u==null?void 0:u.contains(m)),E=!yD(y,o);v?h():E&&(h(),c())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[l,u,o,c,h]),_.jsx(wT,{...r,ref:i})}),[uD,dD]=id(ST,{isInside:!1}),hD=dL("TooltipContent"),wT=w.forwardRef((r,e)=>{const{__scopeTooltip:t,children:n,"aria-label":s,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=r,l=od(Lo,t),c=em(t),{onClose:u}=l;return w.useEffect(()=>(document.addEventListener(Ry,u),()=>document.removeEventListener(Ry,u)),[u]),w.useEffect(()=>{if(l.trigger){const d=h=>{const f=h.target;f!=null&&f.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),_.jsx(Ju,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:_.jsxs(gT,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[_.jsx(hD,{children:n}),_.jsx(uD,{scope:t,isInside:!0,children:_.jsx(OL,{id:l.contentId,role:"tooltip",children:s||n})})]})})});xT.displayName=Lo;var TT="TooltipArrow",fD=w.forwardRef((r,e)=>{const{__scopeTooltip:t,...n}=r,s=em(t);return dD(TT,t).isInside?null:_.jsx(mT,{...s,...n,ref:e})});fD.displayName=TT;function pD(r,e){const t=Math.abs(e.top-r.y),n=Math.abs(e.bottom-r.y),s=Math.abs(e.right-r.x),i=Math.abs(e.left-r.x);switch(Math.min(t,n,s,i)){case i:return"left";case s:return"right";case t:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function gD(r,e,t=5){const n=[];switch(e){case"top":n.push({x:r.x-t,y:r.y+t},{x:r.x+t,y:r.y+t});break;case"bottom":n.push({x:r.x-t,y:r.y-t},{x:r.x+t,y:r.y-t});break;case"left":n.push({x:r.x+t,y:r.y-t},{x:r.x+t,y:r.y+t});break;case"right":n.push({x:r.x-t,y:r.y-t},{x:r.x-t,y:r.y+t});break}return n}function mD(r){const{top:e,right:t,bottom:n,left:s}=r;return[{x:s,y:e},{x:t,y:e},{x:t,y:n},{x:s,y:n}]}function yD(r,e){const{x:t,y:n}=r;let s=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i],l=e[o],c=a.x,u=a.y,d=l.x,h=l.y;u>n!=h>n&&t<(d-c)*(n-u)/(h-u)+c&&(s=!s)}return s}function vD(r){const e=r.slice();return e.sort((t,n)=>t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0),ED(e)}function ED(r){if(r.length<=1)return r.slice();const e=[];for(let n=0;n<r.length;n++){const s=r[n];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))e.pop();else break}e.push(s)}e.pop();const t=[];for(let n=r.length-1;n>=0;n--){const s=r[n];for(;t.length>=2;){const i=t[t.length-1],o=t[t.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))t.pop();else break}t.push(s)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var SD=ET,bT=xT;const xD=SD,wD=w.forwardRef(({className:r,sideOffset:e=4,...t},n)=>_.jsx(bT,{ref:n,sideOffset:e,className:ye("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));wD.displayName=bT.displayName;var ad=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ld=typeof window>"u"||"Deno"in globalThis;function kr(){}function TD(r,e){return typeof r=="function"?r(e):r}function bD(r){return typeof r=="number"&&r>=0&&r!==1/0}function _D(r,e){return Math.max(r+(e||0)-Date.now(),0)}function Zf(r,e){return typeof r=="function"?r(e):r}function AD(r,e){return typeof r=="function"?r(e):r}function Iy(r,e){const{type:t="all",exact:n,fetchStatus:s,predicate:i,queryKey:o,stale:a}=r;if(o){if(n){if(e.queryHash!==tm(o,e.options))return!1}else if(!ja(e.queryKey,o))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||s&&s!==e.state.fetchStatus||i&&!i(e))}function Ly(r,e){const{exact:t,status:n,predicate:s,mutationKey:i}=r;if(i){if(!e.options.mutationKey)return!1;if(t){if(Ba(e.options.mutationKey)!==Ba(i))return!1}else if(!ja(e.options.mutationKey,i))return!1}return!(n&&e.state.status!==n||s&&!s(e))}function tm(r,e){return((e==null?void 0:e.queryKeyHashFn)||Ba)(r)}function Ba(r){return JSON.stringify(r,(e,t)=>ep(t)?Object.keys(t).sort().reduce((n,s)=>(n[s]=t[s],n),{}):t)}function ja(r,e){return r===e?!0:typeof r!=typeof e?!1:r&&e&&typeof r=="object"&&typeof e=="object"?Object.keys(e).every(t=>ja(r[t],e[t])):!1}function _T(r,e){if(r===e)return r;const t=Cy(r)&&Cy(e);if(t||ep(r)&&ep(e)){const n=t?r:Object.keys(r),s=n.length,i=t?e:Object.keys(e),o=i.length,a=t?[]:{},l=new Set(n);let c=0;for(let u=0;u<o;u++){const d=t?u:i[u];(!t&&l.has(d)||t)&&r[d]===void 0&&e[d]===void 0?(a[d]=void 0,c++):(a[d]=_T(r[d],e[d]),a[d]===r[d]&&r[d]!==void 0&&c++)}return s===o&&c===s?r:a}return e}function Cy(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function ep(r){if(!ky(r))return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!ky(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function ky(r){return Object.prototype.toString.call(r)==="[object Object]"}function RD(r){return new Promise(e=>{setTimeout(e,r)})}function ID(r,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(r,e):t.structuralSharing!==!1?_T(r,e):e}function LD(r,e,t=0){const n=[...r,e];return t&&n.length>t?n.slice(1):n}function CD(r,e,t=0){const n=[e,...r];return t&&n.length>t?n.slice(0,-1):n}var rm=Symbol();function AT(r,e){return!r.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!r.queryFn||r.queryFn===rm?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var Ys,ss,fo,UE,kD=(UE=class extends ad{constructor(){super();ve(this,Ys);ve(this,ss);ve(this,fo);ue(this,fo,e=>{if(!ld&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){H(this,ss)||this.setEventListener(H(this,fo))}onUnsubscribe(){var e;this.hasListeners()||((e=H(this,ss))==null||e.call(this),ue(this,ss,void 0))}setEventListener(e){var t;ue(this,fo,e),(t=H(this,ss))==null||t.call(this),ue(this,ss,e(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(e){H(this,Ys)!==e&&(ue(this,Ys,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof H(this,Ys)=="boolean"?H(this,Ys):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ys=new WeakMap,ss=new WeakMap,fo=new WeakMap,UE),RT=new kD,po,is,go,BE,PD=(BE=class extends ad{constructor(){super();ve(this,po,!0);ve(this,is);ve(this,go);ue(this,go,e=>{if(!ld&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}})}onSubscribe(){H(this,is)||this.setEventListener(H(this,go))}onUnsubscribe(){var e;this.hasListeners()||((e=H(this,is))==null||e.call(this),ue(this,is,void 0))}setEventListener(e){var t;ue(this,go,e),(t=H(this,is))==null||t.call(this),ue(this,is,e(this.setOnline.bind(this)))}setOnline(e){H(this,po)!==e&&(ue(this,po,e),this.listeners.forEach(n=>{n(e)}))}isOnline(){return H(this,po)}},po=new WeakMap,is=new WeakMap,go=new WeakMap,BE),fu=new PD;function DD(){let r,e;const t=new Promise((s,i)=>{r=s,e=i});t.status="pending",t.catch(()=>{});function n(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{n({status:"fulfilled",value:s}),r(s)},t.reject=s=>{n({status:"rejected",reason:s}),e(s)},t}function OD(r){return Math.min(1e3*2**r,3e4)}function IT(r){return(r??"online")==="online"?fu.isOnline():!0}var LT=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function lh(r){return r instanceof LT}function CT(r){let e=!1,t=0,n=!1,s;const i=DD(),o=g=>{var m;n||(h(new LT(g)),(m=r.abort)==null||m.call(r))},a=()=>{e=!0},l=()=>{e=!1},c=()=>RT.isFocused()&&(r.networkMode==="always"||fu.isOnline())&&r.canRun(),u=()=>IT(r.networkMode)&&r.canRun(),d=g=>{var m;n||(n=!0,(m=r.onSuccess)==null||m.call(r,g),s==null||s(),i.resolve(g))},h=g=>{var m;n||(n=!0,(m=r.onError)==null||m.call(r,g),s==null||s(),i.reject(g))},f=()=>new Promise(g=>{var m;s=y=>{(n||c())&&g(y)},(m=r.onPause)==null||m.call(r)}).then(()=>{var g;s=void 0,n||(g=r.onContinue)==null||g.call(r)}),p=()=>{if(n)return;let g;const m=t===0?r.initialPromise:void 0;try{g=m??r.fn()}catch(y){g=Promise.reject(y)}Promise.resolve(g).then(d).catch(y=>{var A;if(n)return;const v=r.retry??(ld?0:3),E=r.retryDelay??OD,S=typeof E=="function"?E(t,y):E,T=v===!0||typeof v=="number"&&t<v||typeof v=="function"&&v(t,y);if(e||!T){h(y);return}t++,(A=r.onFail)==null||A.call(r,t,y),RD(S).then(()=>c()?void 0:f()).then(()=>{e?h(y):p()})})};return{promise:i,cancel:o,continue:()=>(s==null||s(),i),cancelRetry:a,continueRetry:l,canStart:u,start:()=>(u()?p():f().then(p),i)}}var ND=r=>setTimeout(r,0);function MD(){let r=[],e=0,t=a=>{a()},n=a=>{a()},s=ND;const i=a=>{e?r.push(a):s(()=>{t(a)})},o=()=>{const a=r;r=[],a.length&&s(()=>{n(()=>{a.forEach(l=>{t(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{i(()=>{a(...l)})},schedule:i,setNotifyFunction:a=>{t=a},setBatchNotifyFunction:a=>{n=a},setScheduler:a=>{s=a}}}var It=MD(),Qs,jE,kT=(jE=class{constructor(){ve(this,Qs)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),bD(this.gcTime)&&ue(this,Qs,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(ld?1/0:5*60*1e3))}clearGcTimeout(){H(this,Qs)&&(clearTimeout(H(this,Qs)),ue(this,Qs,void 0))}},Qs=new WeakMap,jE),mo,Xs,hr,Js,Tt,nl,Zs,Dr,vn,GE,FD=(GE=class extends kT{constructor(e){super();ve(this,Dr);ve(this,mo);ve(this,Xs);ve(this,hr);ve(this,Js);ve(this,Tt);ve(this,nl);ve(this,Zs);ue(this,Zs,!1),ue(this,nl,e.defaultOptions),this.setOptions(e.options),this.observers=[],ue(this,Js,e.client),ue(this,hr,H(this,Js).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ue(this,mo,UD(this.options)),this.state=e.state??H(this,mo),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=H(this,Tt))==null?void 0:e.promise}setOptions(e){this.options={...H(this,nl),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&H(this,hr).remove(this)}setData(e,t){const n=ID(this.state.data,e,this.options);return St(this,Dr,vn).call(this,{data:n,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),n}setState(e,t){St(this,Dr,vn).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var n,s;const t=(n=H(this,Tt))==null?void 0:n.promise;return(s=H(this,Tt))==null||s.cancel(e),t?t.then(kr).catch(kr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(H(this,mo))}isActive(){return this.observers.some(e=>AD(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===rm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Zf(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!_D(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(n=>n.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=H(this,Tt))==null||t.continue()}onOnline(){var t;const e=this.observers.find(n=>n.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=H(this,Tt))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),H(this,hr).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(H(this,Tt)&&(H(this,Zs)?H(this,Tt).cancel({revert:!0}):H(this,Tt).cancelRetry()),this.scheduleGc()),H(this,hr).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||St(this,Dr,vn).call(this,{type:"invalidate"})}fetch(e,t){var c,u,d;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(H(this,Tt))return H(this,Tt).continueRetry(),H(this,Tt).promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const n=new AbortController,s=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(ue(this,Zs,!0),n.signal)})},i=()=>{const h=AT(this.options,t),p=(()=>{const g={client:H(this,Js),queryKey:this.queryKey,meta:this.meta};return s(g),g})();return ue(this,Zs,!1),this.options.persister?this.options.persister(h,p,this):h(p)},a=(()=>{const h={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:H(this,Js),state:this.state,fetchFn:i};return s(h),h})();(c=this.options.behavior)==null||c.onFetch(a,this),ue(this,Xs,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=a.fetchOptions)==null?void 0:u.meta))&&St(this,Dr,vn).call(this,{type:"fetch",meta:(d=a.fetchOptions)==null?void 0:d.meta});const l=h=>{var f,p,g,m;lh(h)&&h.silent||St(this,Dr,vn).call(this,{type:"error",error:h}),lh(h)||((p=(f=H(this,hr).config).onError)==null||p.call(f,h,this),(m=(g=H(this,hr).config).onSettled)==null||m.call(g,this.state.data,h,this)),this.scheduleGc()};return ue(this,Tt,CT({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:n.abort.bind(n),onSuccess:h=>{var f,p,g,m;if(h===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(h)}catch(y){l(y);return}(p=(f=H(this,hr).config).onSuccess)==null||p.call(f,h,this),(m=(g=H(this,hr).config).onSettled)==null||m.call(g,h,this.state.error,this),this.scheduleGc()},onError:l,onFail:(h,f)=>{St(this,Dr,vn).call(this,{type:"failed",failureCount:h,error:f})},onPause:()=>{St(this,Dr,vn).call(this,{type:"pause"})},onContinue:()=>{St(this,Dr,vn).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),H(this,Tt).start()}},mo=new WeakMap,Xs=new WeakMap,hr=new WeakMap,Js=new WeakMap,Tt=new WeakMap,nl=new WeakMap,Zs=new WeakMap,Dr=new WeakSet,vn=function(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...$D(n.data,this.options),fetchMeta:e.meta??null};case"success":return ue(this,Xs,void 0),{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return lh(s)&&s.revert&&H(this,Xs)?{...H(this,Xs),fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),It.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),H(this,hr).notify({query:this,type:"updated",action:e})})},GE);function $D(r,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:IT(e.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function UD(r){const e=typeof r.initialData=="function"?r.initialData():r.initialData,t=e!==void 0,n=t?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var Qr,VE,BD=(VE=class extends ad{constructor(e={}){super();ve(this,Qr);this.config=e,ue(this,Qr,new Map)}build(e,t,n){const s=t.queryKey,i=t.queryHash??tm(s,t);let o=this.get(i);return o||(o=new FD({client:e,queryKey:s,queryHash:i,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(s)}),this.add(o)),o}add(e){H(this,Qr).has(e.queryHash)||(H(this,Qr).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=H(this,Qr).get(e.queryHash);t&&(e.destroy(),t===e&&H(this,Qr).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){It.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return H(this,Qr).get(e)}getAll(){return[...H(this,Qr).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>Iy(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>Iy(e,n)):t}notify(e){It.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){It.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){It.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Qr=new WeakMap,VE),Xr,At,ei,Jr,qn,KE,jD=(KE=class extends kT{constructor(e){super();ve(this,Jr);ve(this,Xr);ve(this,At);ve(this,ei);this.mutationId=e.mutationId,ue(this,At,e.mutationCache),ue(this,Xr,[]),this.state=e.state||GD(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){H(this,Xr).includes(e)||(H(this,Xr).push(e),this.clearGcTimeout(),H(this,At).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ue(this,Xr,H(this,Xr).filter(t=>t!==e)),this.scheduleGc(),H(this,At).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){H(this,Xr).length||(this.state.status==="pending"?this.scheduleGc():H(this,At).remove(this))}continue(){var e;return((e=H(this,ei))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,o,a,l,c,u,d,h,f,p,g,m,y,v,E,S,T,A,b,R;const t=()=>{St(this,Jr,qn).call(this,{type:"continue"})};ue(this,ei,CT({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(L,I)=>{St(this,Jr,qn).call(this,{type:"failed",failureCount:L,error:I})},onPause:()=>{St(this,Jr,qn).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>H(this,At).canRun(this)}));const n=this.state.status==="pending",s=!H(this,ei).canStart();try{if(n)t();else{St(this,Jr,qn).call(this,{type:"pending",variables:e,isPaused:s}),await((o=(i=H(this,At).config).onMutate)==null?void 0:o.call(i,e,this));const I=await((l=(a=this.options).onMutate)==null?void 0:l.call(a,e));I!==this.state.context&&St(this,Jr,qn).call(this,{type:"pending",context:I,variables:e,isPaused:s})}const L=await H(this,ei).start();return await((u=(c=H(this,At).config).onSuccess)==null?void 0:u.call(c,L,e,this.state.context,this)),await((h=(d=this.options).onSuccess)==null?void 0:h.call(d,L,e,this.state.context)),await((p=(f=H(this,At).config).onSettled)==null?void 0:p.call(f,L,null,this.state.variables,this.state.context,this)),await((m=(g=this.options).onSettled)==null?void 0:m.call(g,L,null,e,this.state.context)),St(this,Jr,qn).call(this,{type:"success",data:L}),L}catch(L){try{throw await((v=(y=H(this,At).config).onError)==null?void 0:v.call(y,L,e,this.state.context,this)),await((S=(E=this.options).onError)==null?void 0:S.call(E,L,e,this.state.context)),await((A=(T=H(this,At).config).onSettled)==null?void 0:A.call(T,void 0,L,this.state.variables,this.state.context,this)),await((R=(b=this.options).onSettled)==null?void 0:R.call(b,void 0,L,e,this.state.context)),L}finally{St(this,Jr,qn).call(this,{type:"error",error:L})}}finally{H(this,At).runNext(this)}}},Xr=new WeakMap,At=new WeakMap,ei=new WeakMap,Jr=new WeakSet,qn=function(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),It.batch(()=>{H(this,Xr).forEach(n=>{n.onMutationUpdate(e)}),H(this,At).notify({mutation:this,type:"updated",action:e})})},KE);function GD(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var bn,Or,sl,HE,VD=(HE=class extends ad{constructor(e={}){super();ve(this,bn);ve(this,Or);ve(this,sl);this.config=e,ue(this,bn,new Set),ue(this,Or,new Map),ue(this,sl,0)}build(e,t,n){const s=new jD({mutationCache:this,mutationId:++xl(this,sl)._,options:e.defaultMutationOptions(t),state:n});return this.add(s),s}add(e){H(this,bn).add(e);const t=Vl(e);if(typeof t=="string"){const n=H(this,Or).get(t);n?n.push(e):H(this,Or).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(H(this,bn).delete(e)){const t=Vl(e);if(typeof t=="string"){const n=H(this,Or).get(t);if(n)if(n.length>1){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}else n[0]===e&&H(this,Or).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Vl(e);if(typeof t=="string"){const n=H(this,Or).get(t),s=n==null?void 0:n.find(i=>i.state.status==="pending");return!s||s===e}else return!0}runNext(e){var n;const t=Vl(e);if(typeof t=="string"){const s=(n=H(this,Or).get(t))==null?void 0:n.find(i=>i!==e&&i.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){It.batch(()=>{H(this,bn).forEach(e=>{this.notify({type:"removed",mutation:e})}),H(this,bn).clear(),H(this,Or).clear()})}getAll(){return Array.from(H(this,bn))}find(e){const t={exact:!0,...e};return this.getAll().find(n=>Ly(t,n))}findAll(e={}){return this.getAll().filter(t=>Ly(e,t))}notify(e){It.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return It.batch(()=>Promise.all(e.map(t=>t.continue().catch(kr))))}},bn=new WeakMap,Or=new WeakMap,sl=new WeakMap,HE);function Vl(r){var e;return(e=r.options.scope)==null?void 0:e.id}function Py(r){return{onFetch:(e,t)=>{var u,d,h,f,p;const n=e.options,s=(h=(d=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:d.fetchMore)==null?void 0:h.direction,i=((f=e.state.data)==null?void 0:f.pages)||[],o=((p=e.state.data)==null?void 0:p.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let g=!1;const m=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},y=AT(e.options,e.fetchOptions),v=async(E,S,T)=>{if(g)return Promise.reject();if(S==null&&E.pages.length)return Promise.resolve(E);const b=(()=>{const C={client:e.client,queryKey:e.queryKey,pageParam:S,direction:T?"backward":"forward",meta:e.options.meta};return m(C),C})(),R=await y(b),{maxPages:L}=e.options,I=T?CD:LD;return{pages:I(E.pages,R,L),pageParams:I(E.pageParams,S,L)}};if(s&&i.length){const E=s==="backward",S=E?KD:Dy,T={pages:i,pageParams:o},A=S(n,T);a=await v(T,A,E)}else{const E=r??i.length;do{const S=l===0?o[0]??n.initialPageParam:Dy(n,a);if(l>0&&S==null)break;a=await v(a,S),l++}while(l<E)}return a};e.options.persister?e.fetchFn=()=>{var g,m;return(m=(g=e.options).persister)==null?void 0:m.call(g,c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=c}}}function Dy(r,{pages:e,pageParams:t}){const n=e.length-1;return e.length>0?r.getNextPageParam(e[n],e,t[n],t):void 0}function KD(r,{pages:e,pageParams:t}){var n;return e.length>0?(n=r.getPreviousPageParam)==null?void 0:n.call(r,e[0],e,t[0],t):void 0}var He,os,as,yo,vo,ls,Eo,So,WE,HD=(WE=class{constructor(r={}){ve(this,He);ve(this,os);ve(this,as);ve(this,yo);ve(this,vo);ve(this,ls);ve(this,Eo);ve(this,So);ue(this,He,r.queryCache||new BD),ue(this,os,r.mutationCache||new VD),ue(this,as,r.defaultOptions||{}),ue(this,yo,new Map),ue(this,vo,new Map),ue(this,ls,0)}mount(){xl(this,ls)._++,H(this,ls)===1&&(ue(this,Eo,RT.subscribe(async r=>{r&&(await this.resumePausedMutations(),H(this,He).onFocus())})),ue(this,So,fu.subscribe(async r=>{r&&(await this.resumePausedMutations(),H(this,He).onOnline())})))}unmount(){var r,e;xl(this,ls)._--,H(this,ls)===0&&((r=H(this,Eo))==null||r.call(this),ue(this,Eo,void 0),(e=H(this,So))==null||e.call(this),ue(this,So,void 0))}isFetching(r){return H(this,He).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return H(this,os).findAll({...r,status:"pending"}).length}getQueryData(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=H(this,He).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(r){const e=this.defaultQueryOptions(r),t=H(this,He).build(this,e),n=t.state.data;return n===void 0?this.fetchQuery(r):(r.revalidateIfStale&&t.isStaleByTime(Zf(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(r){return H(this,He).findAll(r).map(({queryKey:e,state:t})=>{const n=t.data;return[e,n]})}setQueryData(r,e,t){const n=this.defaultQueryOptions({queryKey:r}),s=H(this,He).get(n.queryHash),i=s==null?void 0:s.state.data,o=TD(e,i);if(o!==void 0)return H(this,He).build(this,n).setData(o,{...t,manual:!0})}setQueriesData(r,e,t){return It.batch(()=>H(this,He).findAll(r).map(({queryKey:n})=>[n,this.setQueryData(n,e,t)]))}getQueryState(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=H(this,He).get(e.queryHash))==null?void 0:t.state}removeQueries(r){const e=H(this,He);It.batch(()=>{e.findAll(r).forEach(t=>{e.remove(t)})})}resetQueries(r,e){const t=H(this,He);return It.batch(()=>(t.findAll(r).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...r},e)))}cancelQueries(r,e={}){const t={revert:!0,...e},n=It.batch(()=>H(this,He).findAll(r).map(s=>s.cancel(t)));return Promise.all(n).then(kr).catch(kr)}invalidateQueries(r,e={}){return It.batch(()=>(H(this,He).findAll(r).forEach(t=>{t.invalidate()}),(r==null?void 0:r.refetchType)==="none"?Promise.resolve():this.refetchQueries({...r,type:(r==null?void 0:r.refetchType)??(r==null?void 0:r.type)??"active"},e)))}refetchQueries(r,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},n=It.batch(()=>H(this,He).findAll(r).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let i=s.fetch(void 0,t);return t.throwOnError||(i=i.catch(kr)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(n).then(kr)}fetchQuery(r){const e=this.defaultQueryOptions(r);e.retry===void 0&&(e.retry=!1);const t=H(this,He).build(this,e);return t.isStaleByTime(Zf(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(kr).catch(kr)}fetchInfiniteQuery(r){return r.behavior=Py(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(kr).catch(kr)}ensureInfiniteQueryData(r){return r.behavior=Py(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return fu.isOnline()?H(this,os).resumePausedMutations():Promise.resolve()}getQueryCache(){return H(this,He)}getMutationCache(){return H(this,os)}getDefaultOptions(){return H(this,as)}setDefaultOptions(r){ue(this,as,r)}setQueryDefaults(r,e){H(this,yo).set(Ba(r),{queryKey:r,defaultOptions:e})}getQueryDefaults(r){const e=[...H(this,yo).values()],t={};return e.forEach(n=>{ja(r,n.queryKey)&&Object.assign(t,n.defaultOptions)}),t}setMutationDefaults(r,e){H(this,vo).set(Ba(r),{mutationKey:r,defaultOptions:e})}getMutationDefaults(r){const e=[...H(this,vo).values()],t={};return e.forEach(n=>{ja(r,n.mutationKey)&&Object.assign(t,n.defaultOptions)}),t}defaultQueryOptions(r){if(r._defaulted)return r;const e={...H(this,as).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return e.queryHash||(e.queryHash=tm(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===rm&&(e.enabled=!1),e}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...H(this,as).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){H(this,He).clear(),H(this,os).clear()}},He=new WeakMap,os=new WeakMap,as=new WeakMap,yo=new WeakMap,vo=new WeakMap,ls=new WeakMap,Eo=new WeakMap,So=new WeakMap,WE),WD=w.createContext(void 0),zD=({client:r,children:e})=>(w.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),_.jsx(WD.Provider,{value:r,children:e}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pu(){return pu=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},pu.apply(this,arguments)}var ds;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(ds||(ds={}));const Oy="popstate";function qD(r){r===void 0&&(r={});function e(n,s){let{pathname:i,search:o,hash:a}=n.location;return tp("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(n,s){return typeof s=="string"?s:DT(s)}return QD(e,t,null,r)}function Kt(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function PT(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function YD(){return Math.random().toString(36).substr(2,8)}function Ny(r,e){return{usr:r.state,key:r.key,idx:e}}function tp(r,e,t,n){return t===void 0&&(t=null),pu({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?cd(e):e,{state:t,key:e&&e.key||n||YD()})}function DT(r){let{pathname:e="/",search:t="",hash:n=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function cd(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}function QD(r,e,t,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:i=!1}=n,o=s.history,a=ds.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(pu({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=ds.Pop;let m=u(),y=m==null?null:m-c;c=m,l&&l({action:a,location:g.location,delta:y})}function h(m,y){a=ds.Push;let v=tp(g.location,m,y);c=u()+1;let E=Ny(v,c),S=g.createHref(v);try{o.pushState(E,"",S)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;s.location.assign(S)}i&&l&&l({action:a,location:g.location,delta:1})}function f(m,y){a=ds.Replace;let v=tp(g.location,m,y);c=u();let E=Ny(v,c),S=g.createHref(v);o.replaceState(E,"",S),i&&l&&l({action:a,location:g.location,delta:0})}function p(m){let y=s.location.origin!=="null"?s.location.origin:s.location.href,v=typeof m=="string"?m:DT(m);return v=v.replace(/ $/,"%20"),Kt(y,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,y)}let g={get action(){return a},get location(){return r(s,o)},listen(m){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(Oy,d),l=m,()=>{s.removeEventListener(Oy,d),l=null}},createHref(m){return e(s,m)},createURL:p,encodeLocation(m){let y=p(m);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:h,replace:f,go(m){return o.go(m)}};return g}var My;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(My||(My={}));function XD(r,e,t){return t===void 0&&(t="/"),JD(r,e,t,!1)}function JD(r,e,t,n){let s=typeof e=="string"?cd(e):e,i=MT(s.pathname||"/",t);if(i==null)return null;let o=OT(r);ZD(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=uO(i);a=lO(o[l],c,n)}return a}function OT(r,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(Kt(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let c=io([n,l.relativePath]),u=t.concat(l);i.children&&i.children.length>0&&(Kt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),OT(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:oO(c,i.index),routesMeta:u})};return r.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of NT(i.path))s(i,o,l)}),e}function NT(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let o=NT(n.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>r.startsWith("/")&&l===""?"/":l)}function ZD(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:aO(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const eO=/^:[\w-]+$/,tO=3,rO=2,nO=1,sO=10,iO=-2,Fy=r=>r==="*";function oO(r,e){let t=r.split("/"),n=t.length;return t.some(Fy)&&(n+=iO),e&&(n+=rO),t.filter(s=>!Fy(s)).reduce((s,i)=>s+(eO.test(i)?tO:i===""?nO:sO),n)}function aO(r,e){return r.length===e.length&&r.slice(0,-1).every((n,s)=>n===e[s])?r[r.length-1]-e[e.length-1]:0}function lO(r,e,t){let{routesMeta:n}=r,s={},i="/",o=[];for(let a=0;a<n.length;++a){let l=n[a],c=a===n.length-1,u=i==="/"?e:e.slice(i.length)||"/",d=$y({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d&&c&&t&&!n[n.length-1].route.index&&(d=$y({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(s,d.params),o.push({params:s,pathname:io([i,d.pathname]),pathnameBase:dO(io([i,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(i=io([i,d.pathnameBase]))}return o}function $y(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=cO(r.path,r.caseSensitive,r.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:n.reduce((c,u,d)=>{let{paramName:h,isOptional:f}=u;if(h==="*"){let g=a[d]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const p=a[d];return f&&!p?c[h]=void 0:c[h]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:r}}function cO(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),PT(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let n=[],s="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(n.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),s+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":r!==""&&r!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function uO(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return PT(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function MT(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}const io=r=>r.join("/").replace(/\/\/+/g,"/"),dO=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/");function hO(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const FT=["post","put","patch","delete"];new Set(FT);const fO=["get",...FT];new Set(fO);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gu(){return gu=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},gu.apply(this,arguments)}const pO=w.createContext(null),gO=w.createContext(null),$T=w.createContext(null),ud=w.createContext(null),dd=w.createContext({outlet:null,matches:[],isDataRoute:!1}),UT=w.createContext(null);function nm(){return w.useContext(ud)!=null}function BT(){return nm()||Kt(!1),w.useContext(ud).location}function mO(r,e){return yO(r,e)}function yO(r,e,t,n){nm()||Kt(!1);let{navigator:s}=w.useContext($T),{matches:i}=w.useContext(dd),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=BT(),u;if(e){var d;let m=typeof e=="string"?cd(e):e;l==="/"||(d=m.pathname)!=null&&d.startsWith(l)||Kt(!1),u=m}else u=c;let h=u.pathname||"/",f=h;if(l!=="/"){let m=l.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(m.length).join("/")}let p=XD(r,{pathname:f}),g=wO(p&&p.map(m=>Object.assign({},m,{params:Object.assign({},a,m.params),pathname:io([l,s.encodeLocation?s.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?l:io([l,s.encodeLocation?s.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),i,t,n);return e&&g?w.createElement(ud.Provider,{value:{location:gu({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ds.Pop}},g):g}function vO(){let r=AO(),e=hO(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),t?w.createElement("pre",{style:s},t):null,null)}const EO=w.createElement(vO,null);class SO extends w.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?w.createElement(dd.Provider,{value:this.props.routeContext},w.createElement(UT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xO(r){let{routeContext:e,match:t,children:n}=r,s=w.useContext(pO);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),w.createElement(dd.Provider,{value:e},n)}function wO(r,e,t,n){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),r==null){var i;if(!t)return null;if(t.errors)r=t.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let o=r,a=(s=t)==null?void 0:s.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||Kt(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(t&&n&&n.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:f}=t,p=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||p){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let f,p=!1,g=null,m=null;t&&(f=a&&d.route.id?a[d.route.id]:void 0,g=d.route.errorElement||EO,l&&(c<0&&h===0?(p=!0,m=null):c===h&&(p=!0,m=d.route.hydrateFallbackElement||null)));let y=e.concat(o.slice(0,h+1)),v=()=>{let E;return f?E=g:p?E=m:d.route.Component?E=w.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=u,w.createElement(xO,{match:d,routeContext:{outlet:u,matches:y,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?w.createElement(SO,{location:t.location,revalidation:t.revalidation,component:g,error:f,children:v(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):v()},null)}var rp=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(rp||{});function TO(r){let e=w.useContext(gO);return e||Kt(!1),e}function bO(r){let e=w.useContext(dd);return e||Kt(!1),e}function _O(r){let e=bO(),t=e.matches[e.matches.length-1];return t.route.id||Kt(!1),t.route.id}function AO(){var r;let e=w.useContext(UT),t=TO(rp.UseRouteError),n=_O(rp.UseRouteError);return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function RO(r,e){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function np(r){Kt(!1)}function IO(r){let{basename:e="/",children:t=null,location:n,navigationType:s=ds.Pop,navigator:i,static:o=!1,future:a}=r;nm()&&Kt(!1);let l=e.replace(/^\/*/,"/"),c=w.useMemo(()=>({basename:l,navigator:i,static:o,future:gu({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof n=="string"&&(n=cd(n));let{pathname:u="/",search:d="",hash:h="",state:f=null,key:p="default"}=n,g=w.useMemo(()=>{let m=MT(u,l);return m==null?null:{location:{pathname:m,search:d,hash:h,state:f,key:p},navigationType:s}},[l,u,d,h,f,p,s]);return g==null?null:w.createElement($T.Provider,{value:c},w.createElement(ud.Provider,{children:t,value:g}))}function LO(r){let{children:e,location:t}=r;return mO(sp(e),t)}new Promise(()=>{});function sp(r,e){e===void 0&&(e=[]);let t=[];return w.Children.forEach(r,(n,s)=>{if(!w.isValidElement(n))return;let i=[...e,s];if(n.type===w.Fragment){t.push.apply(t,sp(n.props.children,i));return}n.type!==np&&Kt(!1),!n.props.index||!n.props.children||Kt(!1);let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=sp(n.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const CO="6";try{window.__reactRouterVersion=CO}catch{}const kO="startTransition",Uy=zp[kO];function PO(r){let{basename:e,children:t,future:n,window:s}=r,i=w.useRef();i.current==null&&(i.current=qD({window:s,v5Compat:!0}));let o=i.current,[a,l]=w.useState({action:o.action,location:o.location}),{v7_startTransition:c}=n||{},u=w.useCallback(d=>{c&&Uy?Uy(()=>l(d)):l(d)},[l,c]);return w.useLayoutEffect(()=>o.listen(u),[o,u]),w.useEffect(()=>RO(n),[n]),w.createElement(IO,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:n})}var By;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(By||(By={}));var jy;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(jy||(jy={}));const DO={theme:"system",setTheme:()=>null},jT=w.createContext(DO);function OO({children:r,defaultTheme:e="system",storageKey:t="vite-ui-theme",...n}){const[s,i]=w.useState(()=>localStorage.getItem(t)||e);w.useEffect(()=>{const a=window.document.documentElement;if(a.classList.remove("light","dark"),s==="system"){const l=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";a.classList.add(l);return}a.classList.add(s)},[s]);const o={theme:s,setTheme:a=>{localStorage.setItem(t,a),i(a)}};return _.jsx(jT.Provider,{...n,value:o,children:r})}const NO=()=>{const r=w.useContext(jT);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r};var MO=w.createContext(void 0);function hd(r){const e=w.useContext(MO);return r||e||"ltr"}var ch="rovingFocusGroup.onEntryFocus",FO={bubbles:!1,cancelable:!0},pl="RovingFocusGroup",[ip,GT,$O]=Xu(pl),[UO,fd]=Mn(pl,[$O]),[BO,jO]=UO(pl),VT=w.forwardRef((r,e)=>_.jsx(ip.Provider,{scope:r.__scopeRovingFocusGroup,children:_.jsx(ip.Slot,{scope:r.__scopeRovingFocusGroup,children:_.jsx(GO,{...r,ref:e})})}));VT.displayName=pl;var GO=w.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:s=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=r,h=w.useRef(null),f=Fe(e,h),p=hd(i),[g,m]=dl({prop:o,defaultProp:a??null,onChange:l,caller:pl}),[y,v]=w.useState(!1),E=or(c),S=GT(t),T=w.useRef(!1),[A,b]=w.useState(0);return w.useEffect(()=>{const R=h.current;if(R)return R.addEventListener(ch,E),()=>R.removeEventListener(ch,E)},[E]),_.jsx(BO,{scope:t,orientation:n,dir:p,loop:s,currentTabStopId:g,onItemFocus:w.useCallback(R=>m(R),[m]),onItemShiftTab:w.useCallback(()=>v(!0),[]),onFocusableItemAdd:w.useCallback(()=>b(R=>R+1),[]),onFocusableItemRemove:w.useCallback(()=>b(R=>R-1),[]),children:_.jsx(Ee.div,{tabIndex:y||A===0?-1:0,"data-orientation":n,...d,ref:f,style:{outline:"none",...r.style},onMouseDown:te(r.onMouseDown,()=>{T.current=!0}),onFocus:te(r.onFocus,R=>{const L=!T.current;if(R.target===R.currentTarget&&L&&!y){const I=new CustomEvent(ch,FO);if(R.currentTarget.dispatchEvent(I),!I.defaultPrevented){const C=S().filter(M=>M.focusable),D=C.find(M=>M.active),B=C.find(M=>M.id===g),V=[D,B,...C].filter(Boolean).map(M=>M.ref.current);WT(V,u)}}T.current=!1}),onBlur:te(r.onBlur,()=>v(!1))})})}),KT="RovingFocusGroupItem",HT=w.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:s=!1,tabStopId:i,children:o,...a}=r,l=lu(),c=i||l,u=jO(KT,t),d=u.currentTabStopId===c,h=GT(t),{onFocusableItemAdd:f,onFocusableItemRemove:p,currentTabStopId:g}=u;return w.useEffect(()=>{if(n)return f(),()=>p()},[n,f,p]),_.jsx(ip.ItemSlot,{scope:t,id:c,focusable:n,active:s,children:_.jsx(Ee.span,{tabIndex:d?0:-1,"data-orientation":u.orientation,...a,ref:e,onMouseDown:te(r.onMouseDown,m=>{n?u.onItemFocus(c):m.preventDefault()}),onFocus:te(r.onFocus,()=>u.onItemFocus(c)),onKeyDown:te(r.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){u.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const y=HO(m,u.orientation,u.dir);if(y!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let E=h().filter(S=>S.focusable).map(S=>S.ref.current);if(y==="last")E.reverse();else if(y==="prev"||y==="next"){y==="prev"&&E.reverse();const S=E.indexOf(m.currentTarget);E=u.loop?WO(E,S+1):E.slice(S+1)}setTimeout(()=>WT(E))}}),children:typeof o=="function"?o({isCurrentTabStop:d,hasTabStop:g!=null}):o})})});HT.displayName=KT;var VO={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function KO(r,e){return e!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function HO(r,e,t){const n=KO(r.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return VO[n]}function WT(r,e=!1){const t=document.activeElement;for(const n of r)if(n===t||(n.focus({preventScroll:e}),document.activeElement!==t))return}function WO(r,e){return r.map((t,n)=>r[(e+n)%r.length])}var zT=VT,qT=HT,pd="Tabs",[zO,D8]=Mn(pd,[fd]),YT=fd(),[qO,sm]=zO(pd),QT=w.forwardRef((r,e)=>{const{__scopeTabs:t,value:n,onValueChange:s,defaultValue:i,orientation:o="horizontal",dir:a,activationMode:l="automatic",...c}=r,u=hd(a),[d,h]=dl({prop:n,onChange:s,defaultProp:i??"",caller:pd});return _.jsx(qO,{scope:t,baseId:lu(),value:d,onValueChange:h,orientation:o,dir:u,activationMode:l,children:_.jsx(Ee.div,{dir:u,"data-orientation":o,...c,ref:e})})});QT.displayName=pd;var XT="TabsList",JT=w.forwardRef((r,e)=>{const{__scopeTabs:t,loop:n=!0,...s}=r,i=sm(XT,t),o=YT(t);return _.jsx(zT,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:n,children:_.jsx(Ee.div,{role:"tablist","aria-orientation":i.orientation,...s,ref:e})})});JT.displayName=XT;var ZT="TabsTrigger",eb=w.forwardRef((r,e)=>{const{__scopeTabs:t,value:n,disabled:s=!1,...i}=r,o=sm(ZT,t),a=YT(t),l=nb(o.baseId,n),c=sb(o.baseId,n),u=n===o.value;return _.jsx(qT,{asChild:!0,...a,focusable:!s,active:u,children:_.jsx(Ee.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:l,...i,ref:e,onMouseDown:te(r.onMouseDown,d=>{!s&&d.button===0&&d.ctrlKey===!1?o.onValueChange(n):d.preventDefault()}),onKeyDown:te(r.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&o.onValueChange(n)}),onFocus:te(r.onFocus,()=>{const d=o.activationMode!=="manual";!u&&!s&&d&&o.onValueChange(n)})})})});eb.displayName=ZT;var tb="TabsContent",rb=w.forwardRef((r,e)=>{const{__scopeTabs:t,value:n,forceMount:s,children:i,...o}=r,a=sm(tb,t),l=nb(a.baseId,n),c=sb(a.baseId,n),u=n===a.value,d=w.useRef(u);return w.useEffect(()=>{const h=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(h)},[]),_.jsx(ks,{present:s||u,children:({present:h})=>_.jsx(Ee.div,{"data-state":u?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":l,hidden:!h,id:c,tabIndex:0,...o,ref:e,style:{...r.style,animationDuration:d.current?"0s":void 0},children:h&&i})})});rb.displayName=tb;function nb(r,e){return`${r}-trigger-${e}`}function sb(r,e){return`${r}-content-${e}`}var YO=QT,ib=JT,ob=eb,ab=rb;const QO=YO,lb=w.forwardRef(({className:r,...e},t)=>_.jsx(ib,{ref:t,className:ye("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...e}));lb.displayName=ib.displayName;const op=w.forwardRef(({className:r,...e},t)=>_.jsx(ob,{ref:t,className:ye("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...e}));op.displayName=ob.displayName;const ap=w.forwardRef(({className:r,...e},t)=>_.jsx(ab,{ref:t,className:ye("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...e}));ap.displayName=ab.displayName;const XO=Dw("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ct=w.forwardRef(({className:r,variant:e,size:t,asChild:n=!1,...s},i)=>{const o=n?cL:"button";return _.jsx(o,{className:ye(XO({variant:e,size:t,className:r})),ref:i,...s})});ct.displayName="Button";var uh=0;function JO(){w.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??Gy()),document.body.insertAdjacentElement("beforeend",r[1]??Gy()),uh++,()=>{uh===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),uh--}},[])}function Gy(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var dh="focusScope.autoFocusOnMount",hh="focusScope.autoFocusOnUnmount",Vy={bubbles:!1,cancelable:!0},ZO="FocusScope",cb=w.forwardRef((r,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...o}=r,[a,l]=w.useState(null),c=or(s),u=or(i),d=w.useRef(null),h=Fe(e,g=>l(g)),f=w.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;w.useEffect(()=>{if(n){let g=function(E){if(f.paused||!a)return;const S=E.target;a.contains(S)?d.current=S:Yn(d.current,{select:!0})},m=function(E){if(f.paused||!a)return;const S=E.relatedTarget;S!==null&&(a.contains(S)||Yn(d.current,{select:!0}))},y=function(E){if(document.activeElement===document.body)for(const T of E)T.removedNodes.length>0&&Yn(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",m);const v=new MutationObserver(y);return a&&v.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",m),v.disconnect()}}},[n,a,f.paused]),w.useEffect(()=>{if(a){Hy.add(f);const g=document.activeElement;if(!a.contains(g)){const y=new CustomEvent(dh,Vy);a.addEventListener(dh,c),a.dispatchEvent(y),y.defaultPrevented||(eN(iN(ub(a)),{select:!0}),document.activeElement===g&&Yn(a))}return()=>{a.removeEventListener(dh,c),setTimeout(()=>{const y=new CustomEvent(hh,Vy);a.addEventListener(hh,u),a.dispatchEvent(y),y.defaultPrevented||Yn(g??document.body,{select:!0}),a.removeEventListener(hh,u),Hy.remove(f)},0)}}},[a,c,u,f]);const p=w.useCallback(g=>{if(!t&&!n||f.paused)return;const m=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,y=document.activeElement;if(m&&y){const v=g.currentTarget,[E,S]=tN(v);E&&S?!g.shiftKey&&y===S?(g.preventDefault(),t&&Yn(E,{select:!0})):g.shiftKey&&y===E&&(g.preventDefault(),t&&Yn(S,{select:!0})):y===v&&g.preventDefault()}},[t,n,f.paused]);return _.jsx(Ee.div,{tabIndex:-1,...o,ref:h,onKeyDown:p})});cb.displayName=ZO;function eN(r,{select:e=!1}={}){const t=document.activeElement;for(const n of r)if(Yn(n,{select:e}),document.activeElement!==t)return}function tN(r){const e=ub(r),t=Ky(e,r),n=Ky(e.reverse(),r);return[t,n]}function ub(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function Ky(r,e){for(const t of r)if(!rN(t,{upTo:e}))return t}function rN(r,{upTo:e}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(e!==void 0&&r===e)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function nN(r){return r instanceof HTMLInputElement&&"select"in r}function Yn(r,{select:e=!1}={}){if(r&&r.focus){const t=document.activeElement;r.focus({preventScroll:!0}),r!==t&&nN(r)&&e&&r.select()}}var Hy=sN();function sN(){let r=[];return{add(e){const t=r[0];e!==t&&(t==null||t.pause()),r=Wy(r,e),r.unshift(e)},remove(e){var t;r=Wy(r,e),(t=r[0])==null||t.resume()}}}function Wy(r,e){const t=[...r],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function iN(r){return r.filter(e=>e.tagName!=="A")}var oN=function(r){if(typeof document>"u")return null;var e=Array.isArray(r)?r[0]:r;return e.ownerDocument.body},Ei=new WeakMap,Kl=new WeakMap,Hl={},fh=0,db=function(r){return r&&(r.host||db(r.parentNode))},aN=function(r,e){return e.map(function(t){if(r.contains(t))return t;var n=db(t);return n&&r.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",r,". Doing nothing"),null)}).filter(function(t){return!!t})},lN=function(r,e,t,n){var s=aN(e,Array.isArray(r)?r:[r]);Hl[t]||(Hl[t]=new WeakMap);var i=Hl[t],o=[],a=new Set,l=new Set(s),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};s.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var f=h.getAttribute(n),p=f!==null&&f!=="false",g=(Ei.get(h)||0)+1,m=(i.get(h)||0)+1;Ei.set(h,g),i.set(h,m),o.push(h),g===1&&p&&Kl.set(h,!0),m===1&&h.setAttribute(t,"true"),p||h.setAttribute(n,"true")}catch(y){console.error("aria-hidden: cannot operate on ",h,y)}})};return u(e),a.clear(),fh++,function(){o.forEach(function(d){var h=Ei.get(d)-1,f=i.get(d)-1;Ei.set(d,h),i.set(d,f),h||(Kl.has(d)||d.removeAttribute(n),Kl.delete(d)),f||d.removeAttribute(t)}),fh--,fh||(Ei=new WeakMap,Ei=new WeakMap,Kl=new WeakMap,Hl={})}},cN=function(r,e,t){t===void 0&&(t="data-aria-hidden");var n=Array.from(Array.isArray(r)?r:[r]),s=oN(r);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live]"))),lN(n,s,t,"aria-hidden")):function(){return null}},tn=function(){return tn=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},tn.apply(this,arguments)};function $o(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function uN(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})}function dN(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Ic="right-scroll-bar-position",Lc="width-before-scroll-bar",hN="with-scroll-bars-hidden",fN="--removed-body-scroll-bar-size";function ph(r,e){return typeof r=="function"?r(e):r&&(r.current=e),r}function pN(r,e){var t=w.useState(function(){return{value:r,callback:e,facade:{get current(){return t.value},set current(n){var s=t.value;s!==n&&(t.value=n,t.callback(n,s))}}}})[0];return t.callback=e,t.facade}var gN=typeof window<"u"?w.useLayoutEffect:w.useEffect,zy=new WeakMap;function mN(r,e){var t=pN(null,function(n){return r.forEach(function(s){return ph(s,n)})});return gN(function(){var n=zy.get(t);if(n){var s=new Set(n),i=new Set(r),o=t.current;s.forEach(function(a){i.has(a)||ph(a,null)}),i.forEach(function(a){s.has(a)||ph(a,o)})}zy.set(t,r)},[r]),t}function yN(r){return r}function vN(r,e){e===void 0&&(e=yN);var t=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:r},useMedium:function(i){var o=e(i,n);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(i){for(n=!0;t.length;){var o=t;t=[],o.forEach(i)}t={push:function(a){return i(a)},filter:function(){return t}}},assignMedium:function(i){n=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(i),o=t}var l=function(){var u=o;o=[],u.forEach(i)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),t}}}};return s}function EN(r){r===void 0&&(r={});var e=vN(null);return e.options=tn({async:!0,ssr:!1},r),e}var hb=function(r){var e=r.sideCar,t=$o(r,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return w.createElement(n,tn({},t))};hb.isSideCarExport=!0;function SN(r,e){return r.useMedium(e),hb}var fb=EN(),gh=function(){},gd=w.forwardRef(function(r,e){var t=w.useRef(null),n=w.useState({onScrollCapture:gh,onWheelCapture:gh,onTouchMoveCapture:gh}),s=n[0],i=n[1],o=r.forwardProps,a=r.children,l=r.className,c=r.removeScrollBar,u=r.enabled,d=r.shards,h=r.sideCar,f=r.noRelative,p=r.noIsolation,g=r.inert,m=r.allowPinchZoom,y=r.as,v=y===void 0?"div":y,E=r.gapMode,S=$o(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),T=h,A=mN([t,e]),b=tn(tn({},S),s);return w.createElement(w.Fragment,null,u&&w.createElement(T,{sideCar:fb,removeScrollBar:c,shards:d,noRelative:f,noIsolation:p,inert:g,setCallbacks:i,allowPinchZoom:!!m,lockRef:t,gapMode:E}),o?w.cloneElement(w.Children.only(a),tn(tn({},b),{ref:A})):w.createElement(v,tn({},b,{className:l,ref:A}),a))});gd.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gd.classNames={fullWidth:Lc,zeroRight:Ic};var xN=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function wN(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var e=xN();return e&&r.setAttribute("nonce",e),r}function TN(r,e){r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}function bN(r){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(r)}var _N=function(){var r=0,e=null;return{add:function(t){r==0&&(e=wN())&&(TN(e,t),bN(e)),r++},remove:function(){r--,!r&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},AN=function(){var r=_N();return function(e,t){w.useEffect(function(){return r.add(e),function(){r.remove()}},[e&&t])}},pb=function(){var r=AN(),e=function(t){var n=t.styles,s=t.dynamic;return r(n,s),null};return e},RN={left:0,top:0,right:0,gap:0},mh=function(r){return parseInt(r||"",10)||0},IN=function(r){var e=window.getComputedStyle(document.body),t=e[r==="padding"?"paddingLeft":"marginLeft"],n=e[r==="padding"?"paddingTop":"marginTop"],s=e[r==="padding"?"paddingRight":"marginRight"];return[mh(t),mh(n),mh(s)]},LN=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return RN;var e=IN(r),t=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-t+e[2]-e[0])}},CN=pb(),oo="data-scroll-locked",kN=function(r,e,t,n){var s=r.left,i=r.top,o=r.right,a=r.gap;return t===void 0&&(t="margin"),`
  .`.concat(hN,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(oo,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Ic,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Lc,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Ic," .").concat(Ic,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Lc," .").concat(Lc,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(oo,`] {
    `).concat(fN,": ").concat(a,`px;
  }
`)},qy=function(){var r=parseInt(document.body.getAttribute(oo)||"0",10);return isFinite(r)?r:0},PN=function(){w.useEffect(function(){return document.body.setAttribute(oo,(qy()+1).toString()),function(){var r=qy()-1;r<=0?document.body.removeAttribute(oo):document.body.setAttribute(oo,r.toString())}},[])},DN=function(r){var e=r.noRelative,t=r.noImportant,n=r.gapMode,s=n===void 0?"margin":n;PN();var i=w.useMemo(function(){return LN(s)},[s]);return w.createElement(CN,{styles:kN(i,!e,s,t?"":"!important")})},lp=!1;if(typeof window<"u")try{var Wl=Object.defineProperty({},"passive",{get:function(){return lp=!0,!0}});window.addEventListener("test",Wl,Wl),window.removeEventListener("test",Wl,Wl)}catch{lp=!1}var Si=lp?{passive:!1}:!1,ON=function(r){return r.tagName==="TEXTAREA"},gb=function(r,e){if(!(r instanceof Element))return!1;var t=window.getComputedStyle(r);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!ON(r)&&t[e]==="visible")},NN=function(r){return gb(r,"overflowY")},MN=function(r){return gb(r,"overflowX")},Yy=function(r,e){var t=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=mb(r,n);if(s){var i=yb(r,n),o=i[1],a=i[2];if(o>a)return!0}n=n.parentNode}while(n&&n!==t.body);return!1},FN=function(r){var e=r.scrollTop,t=r.scrollHeight,n=r.clientHeight;return[e,t,n]},$N=function(r){var e=r.scrollLeft,t=r.scrollWidth,n=r.clientWidth;return[e,t,n]},mb=function(r,e){return r==="v"?NN(e):MN(e)},yb=function(r,e){return r==="v"?FN(e):$N(e)},UN=function(r,e){return r==="h"&&e==="rtl"?-1:1},BN=function(r,e,t,n,s){var i=UN(r,window.getComputedStyle(e).direction),o=i*n,a=t.target,l=e.contains(a),c=!1,u=o>0,d=0,h=0;do{if(!a)break;var f=yb(r,a),p=f[0],g=f[1],m=f[2],y=g-m-i*p;(p||y)&&mb(r,a)&&(d+=y,h+=p);var v=a.parentNode;a=v&&v.nodeType===Node.DOCUMENT_FRAGMENT_NODE?v.host:v}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(Math.abs(d)<1||!s)||!u&&(Math.abs(h)<1||!s))&&(c=!0),c},zl=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},Qy=function(r){return[r.deltaX,r.deltaY]},Xy=function(r){return r&&"current"in r?r.current:r},jN=function(r,e){return r[0]===e[0]&&r[1]===e[1]},GN=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},VN=0,xi=[];function KN(r){var e=w.useRef([]),t=w.useRef([0,0]),n=w.useRef(),s=w.useState(VN++)[0],i=w.useState(pb)[0],o=w.useRef(r);w.useEffect(function(){o.current=r},[r]),w.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(s));var g=dN([r.lockRef.current],(r.shards||[]).map(Xy),!0).filter(Boolean);return g.forEach(function(m){return m.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),g.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(s))})}}},[r.inert,r.lockRef.current,r.shards]);var a=w.useCallback(function(g,m){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!o.current.allowPinchZoom;var y=zl(g),v=t.current,E="deltaX"in g?g.deltaX:v[0]-y[0],S="deltaY"in g?g.deltaY:v[1]-y[1],T,A=g.target,b=Math.abs(E)>Math.abs(S)?"h":"v";if("touches"in g&&b==="h"&&A.type==="range")return!1;var R=Yy(b,A);if(!R)return!0;if(R?T=b:(T=b==="v"?"h":"v",R=Yy(b,A)),!R)return!1;if(!n.current&&"changedTouches"in g&&(E||S)&&(n.current=T),!T)return!0;var L=n.current||T;return BN(L,m,g,L==="h"?E:S,!0)},[]),l=w.useCallback(function(g){var m=g;if(!(!xi.length||xi[xi.length-1]!==i)){var y="deltaY"in m?Qy(m):zl(m),v=e.current.filter(function(T){return T.name===m.type&&(T.target===m.target||m.target===T.shadowParent)&&jN(T.delta,y)})[0];if(v&&v.should){m.cancelable&&m.preventDefault();return}if(!v){var E=(o.current.shards||[]).map(Xy).filter(Boolean).filter(function(T){return T.contains(m.target)}),S=E.length>0?a(m,E[0]):!o.current.noIsolation;S&&m.cancelable&&m.preventDefault()}}},[]),c=w.useCallback(function(g,m,y,v){var E={name:g,delta:m,target:y,should:v,shadowParent:HN(y)};e.current.push(E),setTimeout(function(){e.current=e.current.filter(function(S){return S!==E})},1)},[]),u=w.useCallback(function(g){t.current=zl(g),n.current=void 0},[]),d=w.useCallback(function(g){c(g.type,Qy(g),g.target,a(g,r.lockRef.current))},[]),h=w.useCallback(function(g){c(g.type,zl(g),g.target,a(g,r.lockRef.current))},[]);w.useEffect(function(){return xi.push(i),r.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Si),document.addEventListener("touchmove",l,Si),document.addEventListener("touchstart",u,Si),function(){xi=xi.filter(function(g){return g!==i}),document.removeEventListener("wheel",l,Si),document.removeEventListener("touchmove",l,Si),document.removeEventListener("touchstart",u,Si)}},[]);var f=r.removeScrollBar,p=r.inert;return w.createElement(w.Fragment,null,p?w.createElement(i,{styles:GN(s)}):null,f?w.createElement(DN,{noRelative:r.noRelative,gapMode:r.gapMode}):null)}function HN(r){for(var e=null;r!==null;)r instanceof ShadowRoot&&(e=r.host,r=r.host),r=r.parentNode;return e}const WN=SN(fb,KN);var vb=w.forwardRef(function(r,e){return w.createElement(gd,tn({},r,{ref:e,sideCar:WN}))});vb.classNames=gd.classNames;var cp=["Enter"," "],zN=["ArrowDown","PageUp","Home"],Eb=["ArrowUp","PageDown","End"],qN=[...zN,...Eb],YN={ltr:[...cp,"ArrowRight"],rtl:[...cp,"ArrowLeft"]},QN={ltr:["ArrowLeft"],rtl:["ArrowRight"]},gl="Menu",[Ga,XN,JN]=Xu(gl),[fi,Sb]=Mn(gl,[JN,sd,fd]),md=sd(),xb=fd(),[ZN,pi]=fi(gl),[eM,ml]=fi(gl),wb=r=>{const{__scopeMenu:e,open:t=!1,children:n,dir:s,onOpenChange:i,modal:o=!0}=r,a=md(e),[l,c]=w.useState(null),u=w.useRef(!1),d=or(i),h=hd(s);return w.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),_.jsx(nD,{...a,children:_.jsx(ZN,{scope:e,open:t,onOpenChange:d,content:l,onContentChange:c,children:_.jsx(eM,{scope:e,onClose:w.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:o,children:n})})})};wb.displayName=gl;var tM="MenuAnchor",im=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,s=md(t);return _.jsx(pT,{...s,...n,ref:e})});im.displayName=tM;var om="MenuPortal",[rM,Tb]=fi(om,{forceMount:void 0}),bb=r=>{const{__scopeMenu:e,forceMount:t,children:n,container:s}=r,i=pi(om,e);return _.jsx(rM,{scope:e,forceMount:t,children:_.jsx(ks,{present:t||i.open,children:_.jsx(Ug,{asChild:!0,container:s,children:n})})})};bb.displayName=om;var yr="MenuContent",[nM,am]=fi(yr),_b=w.forwardRef((r,e)=>{const t=Tb(yr,r.__scopeMenu),{forceMount:n=t.forceMount,...s}=r,i=pi(yr,r.__scopeMenu),o=ml(yr,r.__scopeMenu);return _.jsx(Ga.Provider,{scope:r.__scopeMenu,children:_.jsx(ks,{present:n||i.open,children:_.jsx(Ga.Slot,{scope:r.__scopeMenu,children:o.modal?_.jsx(sM,{...s,ref:e}):_.jsx(iM,{...s,ref:e})})})})}),sM=w.forwardRef((r,e)=>{const t=pi(yr,r.__scopeMenu),n=w.useRef(null),s=Fe(e,n);return w.useEffect(()=>{const i=n.current;if(i)return cN(i)},[]),_.jsx(lm,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:te(r.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),iM=w.forwardRef((r,e)=>{const t=pi(yr,r.__scopeMenu);return _.jsx(lm,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),oM=Fa("MenuContent.ScrollLock"),lm=w.forwardRef((r,e)=>{const{__scopeMenu:t,loop:n=!1,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f,disableOutsideScroll:p,...g}=r,m=pi(yr,t),y=ml(yr,t),v=md(t),E=xb(t),S=XN(t),[T,A]=w.useState(null),b=w.useRef(null),R=Fe(e,b,m.onContentChange),L=w.useRef(0),I=w.useRef(""),C=w.useRef(0),D=w.useRef(null),B=w.useRef("right"),F=w.useRef(0),V=p?vb:w.Fragment,M=p?{as:oM,allowPinchZoom:!0}:void 0,K=k=>{var se,Ae;const j=I.current+k,U=S().filter(Se=>!Se.disabled),$=document.activeElement,q=(se=U.find(Se=>Se.ref.current===$))==null?void 0:se.textValue,Q=U.map(Se=>Se.textValue),Z=vM(Q,j,q),re=(Ae=U.find(Se=>Se.textValue===Z))==null?void 0:Ae.ref.current;(function Se(qe){I.current=qe,window.clearTimeout(L.current),qe!==""&&(L.current=window.setTimeout(()=>Se(""),1e3))})(j),re&&setTimeout(()=>re.focus())};w.useEffect(()=>()=>window.clearTimeout(L.current),[]),JO();const P=w.useCallback(k=>{var U,$;return B.current===((U=D.current)==null?void 0:U.side)&&SM(k,($=D.current)==null?void 0:$.area)},[]);return _.jsx(nM,{scope:t,searchRef:I,onItemEnter:w.useCallback(k=>{P(k)&&k.preventDefault()},[P]),onItemLeave:w.useCallback(k=>{var j;P(k)||((j=b.current)==null||j.focus(),A(null))},[P]),onTriggerLeave:w.useCallback(k=>{P(k)&&k.preventDefault()},[P]),pointerGraceTimerRef:C,onPointerGraceIntentChange:w.useCallback(k=>{D.current=k},[]),children:_.jsx(V,{...M,children:_.jsx(cb,{asChild:!0,trapped:s,onMountAutoFocus:te(i,k=>{var j;k.preventDefault(),(j=b.current)==null||j.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:_.jsx(Ju,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f,children:_.jsx(zT,{asChild:!0,...E,dir:y.dir,orientation:"vertical",loop:n,currentTabStopId:T,onCurrentTabStopIdChange:A,onEntryFocus:te(l,k=>{y.isUsingKeyboardRef.current||k.preventDefault()}),preventScrollOnEntryFocus:!0,children:_.jsx(gT,{role:"menu","aria-orientation":"vertical","data-state":jb(m.open),"data-radix-menu-content":"",dir:y.dir,...v,...g,ref:R,style:{outline:"none",...g.style},onKeyDown:te(g.onKeyDown,k=>{const U=k.target.closest("[data-radix-menu-content]")===k.currentTarget,$=k.ctrlKey||k.altKey||k.metaKey,q=k.key.length===1;U&&(k.key==="Tab"&&k.preventDefault(),!$&&q&&K(k.key));const Q=b.current;if(k.target!==Q||!qN.includes(k.key))return;k.preventDefault();const re=S().filter(se=>!se.disabled).map(se=>se.ref.current);Eb.includes(k.key)&&re.reverse(),mM(re)}),onBlur:te(r.onBlur,k=>{k.currentTarget.contains(k.target)||(window.clearTimeout(L.current),I.current="")}),onPointerMove:te(r.onPointerMove,Va(k=>{const j=k.target,U=F.current!==k.clientX;if(k.currentTarget.contains(j)&&U){const $=k.clientX>F.current?"right":"left";B.current=$,F.current=k.clientX}}))})})})})})})});_b.displayName=yr;var aM="MenuGroup",cm=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return _.jsx(Ee.div,{role:"group",...n,ref:e})});cm.displayName=aM;var lM="MenuLabel",Ab=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return _.jsx(Ee.div,{...n,ref:e})});Ab.displayName=lM;var mu="MenuItem",Jy="menu.itemSelect",yd=w.forwardRef((r,e)=>{const{disabled:t=!1,onSelect:n,...s}=r,i=w.useRef(null),o=ml(mu,r.__scopeMenu),a=am(mu,r.__scopeMenu),l=Fe(e,i),c=w.useRef(!1),u=()=>{const d=i.current;if(!t&&d){const h=new CustomEvent(Jy,{bubbles:!0,cancelable:!0});d.addEventListener(Jy,f=>n==null?void 0:n(f),{once:!0}),$g(d,h),h.defaultPrevented?c.current=!1:o.onClose()}};return _.jsx(Rb,{...s,ref:l,disabled:t,onClick:te(r.onClick,u),onPointerDown:d=>{var h;(h=r.onPointerDown)==null||h.call(r,d),c.current=!0},onPointerUp:te(r.onPointerUp,d=>{var h;c.current||(h=d.currentTarget)==null||h.click()}),onKeyDown:te(r.onKeyDown,d=>{const h=a.searchRef.current!=="";t||h&&d.key===" "||cp.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});yd.displayName=mu;var Rb=w.forwardRef((r,e)=>{const{__scopeMenu:t,disabled:n=!1,textValue:s,...i}=r,o=am(mu,t),a=xb(t),l=w.useRef(null),c=Fe(e,l),[u,d]=w.useState(!1),[h,f]=w.useState("");return w.useEffect(()=>{const p=l.current;p&&f((p.textContent??"").trim())},[i.children]),_.jsx(Ga.ItemSlot,{scope:t,disabled:n,textValue:s??h,children:_.jsx(qT,{asChild:!0,...a,focusable:!n,children:_.jsx(Ee.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...i,ref:c,onPointerMove:te(r.onPointerMove,Va(p=>{n?o.onItemLeave(p):(o.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:te(r.onPointerLeave,Va(p=>o.onItemLeave(p))),onFocus:te(r.onFocus,()=>d(!0)),onBlur:te(r.onBlur,()=>d(!1))})})})}),cM="MenuCheckboxItem",Ib=w.forwardRef((r,e)=>{const{checked:t=!1,onCheckedChange:n,...s}=r;return _.jsx(Db,{scope:r.__scopeMenu,checked:t,children:_.jsx(yd,{role:"menuitemcheckbox","aria-checked":yu(t)?"mixed":t,...s,ref:e,"data-state":dm(t),onSelect:te(s.onSelect,()=>n==null?void 0:n(yu(t)?!0:!t),{checkForDefaultPrevented:!1})})})});Ib.displayName=cM;var Lb="MenuRadioGroup",[uM,dM]=fi(Lb,{value:void 0,onValueChange:()=>{}}),Cb=w.forwardRef((r,e)=>{const{value:t,onValueChange:n,...s}=r,i=or(n);return _.jsx(uM,{scope:r.__scopeMenu,value:t,onValueChange:i,children:_.jsx(cm,{...s,ref:e})})});Cb.displayName=Lb;var kb="MenuRadioItem",Pb=w.forwardRef((r,e)=>{const{value:t,...n}=r,s=dM(kb,r.__scopeMenu),i=t===s.value;return _.jsx(Db,{scope:r.__scopeMenu,checked:i,children:_.jsx(yd,{role:"menuitemradio","aria-checked":i,...n,ref:e,"data-state":dm(i),onSelect:te(n.onSelect,()=>{var o;return(o=s.onValueChange)==null?void 0:o.call(s,t)},{checkForDefaultPrevented:!1})})})});Pb.displayName=kb;var um="MenuItemIndicator",[Db,hM]=fi(um,{checked:!1}),Ob=w.forwardRef((r,e)=>{const{__scopeMenu:t,forceMount:n,...s}=r,i=hM(um,t);return _.jsx(ks,{present:n||yu(i.checked)||i.checked===!0,children:_.jsx(Ee.span,{...s,ref:e,"data-state":dm(i.checked)})})});Ob.displayName=um;var fM="MenuSeparator",Nb=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return _.jsx(Ee.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});Nb.displayName=fM;var pM="MenuArrow",Mb=w.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,s=md(t);return _.jsx(mT,{...s,...n,ref:e})});Mb.displayName=pM;var gM="MenuSub",[O8,Fb]=fi(gM),ta="MenuSubTrigger",$b=w.forwardRef((r,e)=>{const t=pi(ta,r.__scopeMenu),n=ml(ta,r.__scopeMenu),s=Fb(ta,r.__scopeMenu),i=am(ta,r.__scopeMenu),o=w.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=i,c={__scopeMenu:r.__scopeMenu},u=w.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return w.useEffect(()=>u,[u]),w.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),l(null)}},[a,l]),_.jsx(im,{asChild:!0,...c,children:_.jsx(Rb,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":s.contentId,"data-state":jb(t.open),...r,ref:Qu(e,s.onTriggerChange),onClick:d=>{var h;(h=r.onClick)==null||h.call(r,d),!(r.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:te(r.onPointerMove,Va(d=>{i.onItemEnter(d),!d.defaultPrevented&&!r.disabled&&!t.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:te(r.onPointerLeave,Va(d=>{var f,p;u();const h=(f=t.content)==null?void 0:f.getBoundingClientRect();if(h){const g=(p=t.content)==null?void 0:p.dataset.side,m=g==="right",y=m?-5:5,v=h[m?"left":"right"],E=h[m?"right":"left"];i.onPointerGraceIntentChange({area:[{x:d.clientX+y,y:d.clientY},{x:v,y:h.top},{x:E,y:h.top},{x:E,y:h.bottom},{x:v,y:h.bottom}],side:g}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(d),d.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:te(r.onKeyDown,d=>{var f;const h=i.searchRef.current!=="";r.disabled||h&&d.key===" "||YN[n.dir].includes(d.key)&&(t.onOpenChange(!0),(f=t.content)==null||f.focus(),d.preventDefault())})})})});$b.displayName=ta;var Ub="MenuSubContent",Bb=w.forwardRef((r,e)=>{const t=Tb(yr,r.__scopeMenu),{forceMount:n=t.forceMount,...s}=r,i=pi(yr,r.__scopeMenu),o=ml(yr,r.__scopeMenu),a=Fb(Ub,r.__scopeMenu),l=w.useRef(null),c=Fe(e,l);return _.jsx(Ga.Provider,{scope:r.__scopeMenu,children:_.jsx(ks,{present:n||i.open,children:_.jsx(Ga.Slot,{scope:r.__scopeMenu,children:_.jsx(lm,{id:a.contentId,"aria-labelledby":a.triggerId,...s,ref:c,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;o.isUsingKeyboardRef.current&&((d=l.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:te(r.onFocusOutside,u=>{u.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:te(r.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:te(r.onKeyDown,u=>{var f;const d=u.currentTarget.contains(u.target),h=QN[o.dir].includes(u.key);d&&h&&(i.onOpenChange(!1),(f=a.trigger)==null||f.focus(),u.preventDefault())})})})})})});Bb.displayName=Ub;function jb(r){return r?"open":"closed"}function yu(r){return r==="indeterminate"}function dm(r){return yu(r)?"indeterminate":r?"checked":"unchecked"}function mM(r){const e=document.activeElement;for(const t of r)if(t===e||(t.focus(),document.activeElement!==e))return}function yM(r,e){return r.map((t,n)=>r[(e+n)%r.length])}function vM(r,e,t){const s=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=t?r.indexOf(t):-1;let o=yM(r,Math.max(i,0));s.length===1&&(o=o.filter(c=>c!==t));const l=o.find(c=>c.toLowerCase().startsWith(s.toLowerCase()));return l!==t?l:void 0}function EM(r,e){const{x:t,y:n}=r;let s=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i],l=e[o],c=a.x,u=a.y,d=l.x,h=l.y;u>n!=h>n&&t<(d-c)*(n-u)/(h-u)+c&&(s=!s)}return s}function SM(r,e){if(!e)return!1;const t={x:r.clientX,y:r.clientY};return EM(t,e)}function Va(r){return e=>e.pointerType==="mouse"?r(e):void 0}var xM=wb,wM=im,TM=bb,bM=_b,_M=cm,AM=Ab,RM=yd,IM=Ib,LM=Cb,CM=Pb,kM=Ob,PM=Nb,DM=Mb,OM=$b,NM=Bb,vd="DropdownMenu",[MM,N8]=Mn(vd,[Sb]),Dt=Sb(),[FM,Gb]=MM(vd),Vb=r=>{const{__scopeDropdownMenu:e,children:t,dir:n,open:s,defaultOpen:i,onOpenChange:o,modal:a=!0}=r,l=Dt(e),c=w.useRef(null),[u,d]=dl({prop:s,defaultProp:i??!1,onChange:o,caller:vd});return _.jsx(FM,{scope:e,triggerId:lu(),triggerRef:c,contentId:lu(),open:u,onOpenChange:d,onOpenToggle:w.useCallback(()=>d(h=>!h),[d]),modal:a,children:_.jsx(xM,{...l,open:u,onOpenChange:d,dir:n,modal:a,children:t})})};Vb.displayName=vd;var Kb="DropdownMenuTrigger",Hb=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,disabled:n=!1,...s}=r,i=Gb(Kb,t),o=Dt(t);return _.jsx(wM,{asChild:!0,...o,children:_.jsx(Ee.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:Qu(e,i.triggerRef),onPointerDown:te(r.onPointerDown,a=>{!n&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:te(r.onKeyDown,a=>{n||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});Hb.displayName=Kb;var $M="DropdownMenuPortal",Wb=r=>{const{__scopeDropdownMenu:e,...t}=r,n=Dt(e);return _.jsx(TM,{...n,...t})};Wb.displayName=$M;var zb="DropdownMenuContent",qb=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Gb(zb,t),i=Dt(t),o=w.useRef(!1);return _.jsx(bM,{id:s.contentId,"aria-labelledby":s.triggerId,...i,...n,ref:e,onCloseAutoFocus:te(r.onCloseAutoFocus,a=>{var l;o.current||(l=s.triggerRef.current)==null||l.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:te(r.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!s.modal||u)&&(o.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});qb.displayName=zb;var UM="DropdownMenuGroup",BM=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(_M,{...s,...n,ref:e})});BM.displayName=UM;var jM="DropdownMenuLabel",Yb=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(AM,{...s,...n,ref:e})});Yb.displayName=jM;var GM="DropdownMenuItem",Qb=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(RM,{...s,...n,ref:e})});Qb.displayName=GM;var VM="DropdownMenuCheckboxItem",Xb=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(IM,{...s,...n,ref:e})});Xb.displayName=VM;var KM="DropdownMenuRadioGroup",HM=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(LM,{...s,...n,ref:e})});HM.displayName=KM;var WM="DropdownMenuRadioItem",Jb=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(CM,{...s,...n,ref:e})});Jb.displayName=WM;var zM="DropdownMenuItemIndicator",Zb=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(kM,{...s,...n,ref:e})});Zb.displayName=zM;var qM="DropdownMenuSeparator",e_=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(PM,{...s,...n,ref:e})});e_.displayName=qM;var YM="DropdownMenuArrow",QM=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(DM,{...s,...n,ref:e})});QM.displayName=YM;var XM="DropdownMenuSubTrigger",t_=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(OM,{...s,...n,ref:e})});t_.displayName=XM;var JM="DropdownMenuSubContent",r_=w.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Dt(t);return _.jsx(NM,{...s,...n,ref:e,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});r_.displayName=JM;var ZM=Vb,eF=Hb,tF=Wb,n_=qb,s_=Yb,i_=Qb,o_=Xb,a_=Jb,l_=Zb,c_=e_,u_=t_,d_=r_;const h_=ZM,f_=eF,rF=w.forwardRef(({className:r,inset:e,children:t,...n},s)=>_.jsxs(u_,{ref:s,className:ye("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",e&&"pl-8",r),...n,children:[t,_.jsx(nC,{className:"ml-auto h-4 w-4"})]}));rF.displayName=u_.displayName;const nF=w.forwardRef(({className:r,...e},t)=>_.jsx(d_,{ref:t,className:ye("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...e}));nF.displayName=d_.displayName;const hm=w.forwardRef(({className:r,sideOffset:e=4,...t},n)=>_.jsx(tF,{children:_.jsx(n_,{ref:n,sideOffset:e,className:ye("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));hm.displayName=n_.displayName;const hs=w.forwardRef(({className:r,inset:e,...t},n)=>_.jsx(i_,{ref:n,className:ye("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e&&"pl-8",r),...t}));hs.displayName=i_.displayName;const sF=w.forwardRef(({className:r,children:e,checked:t,...n},s)=>_.jsxs(o_,{ref:s,className:ye("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),checked:t,...n,children:[_.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:_.jsx(l_,{children:_.jsx(rC,{className:"h-4 w-4"})})}),e]}));sF.displayName=o_.displayName;const iF=w.forwardRef(({className:r,children:e,...t},n)=>_.jsxs(a_,{ref:n,className:ye("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[_.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:_.jsx(l_,{children:_.jsx(sC,{className:"h-2 w-2 fill-current"})})}),e]}));iF.displayName=a_.displayName;const oF=w.forwardRef(({className:r,inset:e,...t},n)=>_.jsx(s_,{ref:n,className:ye("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",r),...t}));oF.displayName=s_.displayName;const aF=w.forwardRef(({className:r,...e},t)=>_.jsx(c_,{ref:t,className:ye("-mx-1 my-1 h-px bg-muted",r),...e}));aF.displayName=c_.displayName;function lF(){const{setTheme:r}=NO();return _.jsxs(h_,{children:[_.jsx(f_,{asChild:!0,children:_.jsxs(ct,{variant:"ghost",size:"icon",children:[_.jsx(EC,{className:"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),_.jsx(pC,{className:"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),_.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),_.jsxs(hm,{align:"end",children:[_.jsx(hs,{onClick:()=>r("light"),children:"Light"}),_.jsx(hs,{onClick:()=>r("dark"),children:"Dark"}),_.jsx(hs,{onClick:()=>r("system"),children:"System"})]})]})}const fm=w.forwardRef(({className:r,type:e,...t},n)=>_.jsx("input",{type:e,className:ye("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:n,...t}));fm.displayName="Input";const vu=w.forwardRef(({className:r,...e},t)=>_.jsx("div",{ref:t,className:ye("rounded-lg border bg-card text-card-foreground shadow-sm",r),...e}));vu.displayName="Card";const p_=w.forwardRef(({className:r,...e},t)=>_.jsx("div",{ref:t,className:ye("flex flex-col space-y-1.5 p-6",r),...e}));p_.displayName="CardHeader";const g_=w.forwardRef(({className:r,...e},t)=>_.jsx("h3",{ref:t,className:ye("text-2xl font-semibold leading-none tracking-tight",r),...e}));g_.displayName="CardTitle";const cF=w.forwardRef(({className:r,...e},t)=>_.jsx("p",{ref:t,className:ye("text-sm text-muted-foreground",r),...e}));cF.displayName="CardDescription";const Eu=w.forwardRef(({className:r,...e},t)=>_.jsx("div",{ref:t,className:ye("p-6 pt-0",r),...e}));Eu.displayName="CardContent";const uF=w.forwardRef(({className:r,...e},t)=>_.jsx("div",{ref:t,className:ye("flex items-center p-6 pt-0",r),...e}));uF.displayName="CardFooter";const dF=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);class pm extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class hF extends pm{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Zy extends pm{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ev extends pm{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var up;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(up||(up={}));class fF{constructor(e,{headers:t={},customFetch:n,region:s=up.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=dF(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return uN(this,arguments,void 0,function*(t,n={}){var s;let i,o;try{const{headers:a,method:l,body:c,signal:u,timeout:d}=n;let h={},{region:f}=n;f||(f=this.region);const p=new URL(`${this.url}/${t}`);f&&f!=="any"&&(h["x-region"]=f,p.searchParams.set("forceFunctionRegion",f));let g;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",g=c):typeof c=="string"?(h["Content-Type"]="text/plain",g=c):typeof FormData<"u"&&c instanceof FormData?g=c:(h["Content-Type"]="application/json",g=JSON.stringify(c)):g=c;let m=u;d&&(o=new AbortController,i=setTimeout(()=>o.abort(),d),u?(m=o.signal,u.addEventListener("abort",()=>o.abort())):m=o.signal);const y=yield this.fetch(p.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:g,signal:m}).catch(T=>{throw new hF(T)}),v=y.headers.get("x-relay-error");if(v&&v==="true")throw new Zy(y);if(!y.ok)throw new ev(y);let E=((s=y.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),S;return E==="application/json"?S=yield y.json():E==="application/octet-stream"||E==="application/pdf"?S=yield y.blob():E==="text/event-stream"?S=y:E==="multipart/form-data"?S=yield y.formData():S=yield y.text(),{data:S,error:null,response:y}}catch(a){return{data:null,error:a,response:a instanceof ev||a instanceof Zy?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var pF=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}},gF=class{constructor(r){var e,t;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(e=r.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=r.signal,this.isMaybeSingle=(t=r.isMaybeSingle)!==null&&t!==void 0?t:!1,r.fetch?this.fetch=r.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,e){return this.headers=new Headers(this.headers),this.headers.set(r,e),this}then(r,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,c=i.status,u=i.statusText;if(i.ok){var d,h;if(t.method!=="HEAD"){var f;const y=await i.text();y===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((f=t.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=y:a=JSON.parse(y))}const g=(d=t.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),m=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");g&&m&&m.length>1&&(l=parseInt(m[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,u="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var p;const g=await i.text();try{o=JSON.parse(g),Array.isArray(o)&&i.status===404&&(a=[],o=null,c=200,u="OK")}catch{i.status===404&&g===""?(c=204,u="No Content"):o={message:g}}if(o&&t.isMaybeSingle&&(!(o==null||(p=o.details)===null||p===void 0)&&p.includes("0 rows"))&&(o=null,c=200,u="OK"),o&&t.shouldThrowOnError)throw new pF(o)}return{error:o,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(s=s.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var c,u,d,h;const p=(c=l==null?void 0:l.message)!==null&&c!==void 0?c:"",g=(u=l==null?void 0:l.code)!==null&&u!==void 0?u:"";a=`${(d=i==null?void 0:i.name)!==null&&d!==void 0?d:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${p}`,g&&(a+=` (${g})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var f;a=(f=i==null?void 0:i.stack)!==null&&f!==void 0?f:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(r,e)}returns(){return this}overrideTypes(){return this}},mF=class extends gF{select(r){let e=!1;const t=(r??"*").split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:n,referencedTable:s=n}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${r}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e,referencedTable:t=e}={}){const n=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(n,`${r}`),this}range(r,e,{foreignTable:t,referencedTable:n=t}={}){const s=typeof n>"u"?"offset":`${n}.offset`,i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${r}`),this.url.searchParams.set(i,`${e-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:s=!1,format:i="text"}={}){var o;const a=[r?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};const tv=new RegExp("[,()]");var Di=class extends mF{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}regexMatch(r,e){return this.url.searchParams.append(r,`match.${e}`),this}regexIMatch(r,e){return this.url.searchParams.append(r,`imatch.${e}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}isDistinct(r,e){return this.url.searchParams.append(r,`isdistinct.${e}`),this}in(r,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&tv.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}notIn(r,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&tv.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`not.in.(${t})`),this}contains(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return typeof e=="string"?this.url.searchParams.append(r,`ov.${e}`):this.url.searchParams.append(r,`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:n}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const i=t===void 0?"":`(${t})`;return this.url.searchParams.append(r,`${s}fts${i}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e,referencedTable:t=e}={}){const n=t?`${t}.or`:"or";return this.url.searchParams.append(n,`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}},yF=class{constructor(r,{headers:e={},schema:t,fetch:n}){this.url=r,this.headers=new Headers(e),this.schema=t,this.fetch=n}select(r,e){const{head:t=!1,count:n}=e??{},s=t?"HEAD":"GET";let i=!1;const o=(r??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new Di({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(r,{count:e,defaultToNull:t=!0}={}){var n;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),t||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const i=r.reduce((o,a)=>o.concat(Object.keys(a)),[]);if(i.length>0){const o=[...new Set(i)].map(a=>`"${a}"`);this.url.searchParams.set("columns",o.join(","))}}return new Di({method:s,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:s=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),n&&this.headers.append("Prefer",`count=${n}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const a=r.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new Di({method:o,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(r,{count:e}={}){var t;const n="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Di({method:n,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}delete({count:r}={}){var e;const t="DELETE";return r&&this.headers.append("Prefer",`count=${r}`),new Di({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},vF=class m_{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new yF(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new m_(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:s=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;n||s?(a=n?"HEAD":"GET",Object.entries(t).filter(([d,h])=>h!==void 0).map(([d,h])=>[d,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([d,h])=>{l.searchParams.append(d,h)})):(a="POST",c=t);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new Di({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class EF{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const SF="2.89.0",xF=`realtime-js/${SF}`,y_="1.0.0",wF="2.0.0",rv=y_,dp=1e4,TF=1e3,bF=100;var Jn;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Jn||(Jn={}));var et;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(et||(et={}));var Mr;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Mr||(Mr={}));var hp;(function(r){r.websocket="websocket"})(hp||(hp={}));var Vs;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Vs||(Vs={}));class _F{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const s=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,n;const s=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,n){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},d=Object.keys(u).length===0?"":JSON.stringify(u);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`metadata length ${d.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+d.length,f=new ArrayBuffer(this.HEADER_LENGTH+h);let p=new DataView(f),g=0;p.setUint8(g++,this.KINDS.userBroadcastPush),p.setUint8(g++,l.length),p.setUint8(g++,a.length),p.setUint8(g++,o.length),p.setUint8(g++,c.length),p.setUint8(g++,d.length),p.setUint8(g++,t),Array.from(l,y=>p.setUint8(g++,y.charCodeAt(0))),Array.from(a,y=>p.setUint8(g++,y.charCodeAt(0))),Array.from(o,y=>p.setUint8(g++,y.charCodeAt(0))),Array.from(c,y=>p.setUint8(g++,y.charCodeAt(0))),Array.from(d,y=>p.setUint8(g++,y.charCodeAt(0)));var m=new Uint8Array(f.byteLength+n.byteLength);return m.set(new Uint8Array(f),0),m.set(new Uint8Array(n),f.byteLength),m.buffer}decode(e,t){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return t(n)}if(typeof e=="string"){const n=JSON.parse(e),[s,i,o,a,l]=n;return t({join_ref:s,ref:i,topic:o,event:a,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,s)}}_decodeUserBroadcast(e,t,n){const s=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+4;const c=n.decode(e.slice(l,l+s));l=l+s;const u=n.decode(e.slice(l,l+i));l=l+i;const d=n.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),f=a===this.JSON_ENCODING?JSON.parse(n.decode(h)):h,p={type:this.BROADCAST_EVENT,event:u,payload:f};return o>0&&(p.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n)))}}class v_{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Le;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Le||(Le={}));const nv=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=AF(o,r,e,s),i),{}):{}},AF=(r,e,t,n)=>{const s=e.find(a=>a.name===r),i=s==null?void 0:s.type,o=t[r];return i&&!n.includes(i)?E_(i,o):fp(o)},E_=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return CF(e,t)}switch(r){case Le.bool:return RF(e);case Le.float4:case Le.float8:case Le.int2:case Le.int4:case Le.int8:case Le.numeric:case Le.oid:return IF(e);case Le.json:case Le.jsonb:return LF(e);case Le.timestamp:return kF(e);case Le.abstime:case Le.date:case Le.daterange:case Le.int4range:case Le.int8range:case Le.money:case Le.reltime:case Le.text:case Le.time:case Le.timestamptz:case Le.timetz:case Le.tsrange:case Le.tstzrange:return fp(e);default:return fp(e)}},fp=r=>r,RF=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},IF=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},LF=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch{return r}return r},CF=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>E_(e,a))}return r},kF=r=>typeof r=="string"?r.replace(" ","T"):r,S_=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class yh{constructor(e,t,n={},s=dp){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var sv;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(sv||(sv={}));class ga{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ga.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=ga.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=ga.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=i[c];if(d){const h=u.map(m=>m.presence_ref),f=d.map(m=>m.presence_ref),p=u.filter(m=>f.indexOf(m.presence_ref)<0),g=d.filter(m=>h.indexOf(m.presence_ref)<0);p.length>0&&(a[c]=p),g.length>0&&(l[c]=g)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(f=>f.presence_ref),h=u.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...h)}n(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var iv;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(iv||(iv={}));var ma;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(ma||(ma={}));var Sn;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Sn||(Sn={}));class Yi{constructor(e,t={config:{}},n){var s,i;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=et.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new yh(this,Mr.join,this.params,this.timeout),this.rejoinTimer=new v_(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=et.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=et.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=et.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Mr.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new ga(this),this.broadcastEndpointURL=S_(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==et.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(f=>f.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[ma.PRESENCE]&&this.bindings[ma.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(Sn.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(Sn.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var p;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){e==null||e(Sn.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,m=(p=g==null?void 0:g.length)!==null&&p!==void 0?p:0,y=[];for(let v=0;v<m;v++){const E=g[v],{filter:{event:S,schema:T,table:A,filter:b}}=E,R=f&&f[v];if(R&&R.event===S&&Yi.isFilterValueEqual(R.schema,T)&&Yi.isFilterValueEqual(R.table,A)&&Yi.isFilterValueEqual(R.filter,b))y.push(Object.assign(Object.assign({},E),{id:R.id}));else{this.unsubscribe(),this.state=et.errored,e==null||e(Sn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(Sn.SUBSCRIBED);return}}).receive("error",f=>{this.state=et.errored,e==null||e(Sn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Sn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===et.joined&&e===ma.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var s;if(t==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=et.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Mr.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new yh(this,Mr.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=et.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new yh(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>bF){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Mr;if(n&&[a,l,c,u].indexOf(o)>=0&&n!==this._joinRef())return;let h=this._onMessage(o,t,n);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var p,g,m;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(g=f.filter)===null||g===void 0?void 0:g.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(h,n)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var p,g,m,y,v,E;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const S=f.id,T=(p=f.filter)===null||p===void 0?void 0:p.event;return S&&((g=t.ids)===null||g===void 0?void 0:g.includes(S))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const S=(v=(y=f==null?void 0:f.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return S==="*"||S===((E=t==null?void 0:t.event)===null||E===void 0?void 0:E.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const p=h.data,{schema:g,table:m,commit_timestamp:y,type:v,errors:E}=p;h=Object.assign(Object.assign({},{schema:g,table:m,commit_timestamp:y,eventType:v,new:{},old:{},errors:E}),this._getPayloadRecords(p))}f.callback(h,n)})}_isClosed(){return this.state===et.closed}_isJoined(){return this.state===et.joined}_isJoining(){return this.state===et.joining}_isLeaving(){return this.state===et.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Yi.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Mr.close,{},e)}_onError(e){this._on(Mr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=et.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=nv(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=nv(e.columns,e.old_record)),t}}const vh=()=>{},ql={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},PF=[1e3,2e3,5e3,1e4],DF=1e4,OF=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class NF{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=dp,this.transport=null,this.heartbeatIntervalMs=ql.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=vh,this.ref=0,this.reconnectTimer=null,this.vsn=rv,this.logger=vh,this.conn=null,this.sendBuffer=[],this.serializer=new _F,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${hp.websocket}`,this.httpEndpoint=S_(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=EF.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Jn.connecting:return Vs.Connecting;case Jn.open:return Vs.Open;case Jn.closing:return Vs.Closing;default:return Vs.Closed}}isConnected(){return this.connectionState()===Vs.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new Yi(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${n} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(TF,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ql.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:o}=t,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(s,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Jn.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Jn.open||this.conn.readyState===Jn.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Mr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([OF],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,n=!1;if(e)t=e,n=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),t=this.accessTokenValue}else t=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:xF};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(Mr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new v_(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ql.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,i,o,a,l,c,u,d,h,f;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:dp,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:ql.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:vh,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:rv,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:p=>PF[p-1]||DF,this.vsn){case y_:this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(p,g)=>g(JSON.stringify(p)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:(p,g)=>g(JSON.parse(p));break;case wF:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Ka=class extends Error{constructor(r,e){var t;super(r),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((t=e.icebergType)==null?void 0:t.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function MF(r,e,t){const n=new URL(e,r);if(t)for(const[s,i]of Object.entries(t))i!==void 0&&n.searchParams.set(s,i);return n.toString()}async function FF(r){return!r||r.type==="none"?{}:r.type==="bearer"?{Authorization:`Bearer ${r.token}`}:r.type==="header"?{[r.name]:r.value}:r.type==="custom"?await r.getHeaders():{}}function $F(r){const e=r.fetchImpl??globalThis.fetch;return{async request({method:t,path:n,query:s,body:i,headers:o}){const a=MF(r.baseUrl,n,s),l=await FF(r.auth),c=await e(a,{method:t,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),u=await c.text(),d=(c.headers.get("content-type")||"").includes("application/json"),h=d&&u?JSON.parse(u):u;if(!c.ok){const f=d?h:void 0,p=f==null?void 0:f.error;throw new Ka((p==null?void 0:p.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:p==null?void 0:p.type,icebergCode:p==null?void 0:p.code,details:f})}return{status:c.status,headers:c.headers,data:h}}}}function Yl(r){return r.join("")}var UF=class{constructor(r,e=""){this.client=r,this.prefix=e}async listNamespaces(r){const e=r?{parent:Yl(r.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(r,e){const t={namespace:r.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Yl(r.namespace)}`})}async loadNamespaceMetadata(r){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Yl(r.namespace)}`})).data.properties}}async namespaceExists(r){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Yl(r.namespace)}`}),!0}catch(e){if(e instanceof Ka&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(r,e){try{return await this.createNamespace(r,e)}catch(t){if(t instanceof Ka&&t.status===409)return;throw t}}};function wi(r){return r.join("")}var BF=class{constructor(r,e="",t){this.client=r,this.prefix=e,this.accessDelegation=t}async listTables(r){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${wi(r.namespace)}/tables`})).data.identifiers}async createTable(r,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${wi(r.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(r,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${wi(r.namespace)}/tables/${r.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(r,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${wi(r.namespace)}/tables/${r.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(r){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${wi(r.namespace)}/tables/${r.name}`,headers:e})).data.metadata}async tableExists(r){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${wi(r.namespace)}/tables/${r.name}`,headers:e}),!0}catch(t){if(t instanceof Ka&&t.status===404)return!1;throw t}}async createTableIfNotExists(r,e){try{return await this.createTable(r,e)}catch(t){if(t instanceof Ka&&t.status===409)return await this.loadTable({namespace:r.namespace,name:e.name});throw t}}},jF=class{constructor(r){var n;let e="v1";r.catalogName&&(e+=`/${r.catalogName}`);const t=r.baseUrl.endsWith("/")?r.baseUrl:`${r.baseUrl}/`;this.client=$F({baseUrl:t,auth:r.auth,fetchImpl:r.fetch}),this.accessDelegation=(n=r.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new UF(this.client,e),this.tableOps=new BF(this.client,e,this.accessDelegation)}async listNamespaces(r){return this.namespaceOps.listNamespaces(r)}async createNamespace(r,e){return this.namespaceOps.createNamespace(r,e)}async dropNamespace(r){await this.namespaceOps.dropNamespace(r)}async loadNamespaceMetadata(r){return this.namespaceOps.loadNamespaceMetadata(r)}async listTables(r){return this.tableOps.listTables(r)}async createTable(r,e){return this.tableOps.createTable(r,e)}async updateTable(r,e){return this.tableOps.updateTable(r,e)}async dropTable(r,e){await this.tableOps.dropTable(r,e)}async loadTable(r){return this.tableOps.loadTable(r)}async namespaceExists(r){return this.namespaceOps.namespaceExists(r)}async tableExists(r){return this.tableOps.tableExists(r)}async createNamespaceIfNotExists(r,e){return this.namespaceOps.createNamespaceIfNotExists(r,e)}async createTableIfNotExists(r,e){return this.tableOps.createTableIfNotExists(r,e)}},Ed=class extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}};function Ue(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var GF=class extends Ed{constructor(r,e,t){super(r),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},pp=class extends Ed{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}};const gm=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),VF=()=>Response,gp=r=>{if(Array.isArray(r))return r.map(t=>gp(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=gp(n)}),e},KF=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},HF=r=>!r||typeof r!="string"||r.length===0||r.length>100||r.trim()!==r||r.includes("/")||r.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(r);function Ha(r){"@babel/helpers - typeof";return Ha=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ha(r)}function WF(r,e){if(Ha(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(Ha(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function zF(r){var e=WF(r,"string");return Ha(e)=="symbol"?e:e+""}function qF(r,e,t){return(e=zF(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ov(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function oe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ov(Object(t),!0).forEach(function(n){qF(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ov(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const Eh=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},YF=async(r,e,t)=>{r instanceof await VF()&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{const s=r.status||500,i=(n==null?void 0:n.statusCode)||s+"";e(new GF(Eh(n),s,i))}).catch(n=>{e(new pp(Eh(n),n))}):e(new pp(Eh(r),r))},QF=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!n?s:(KF(n)?(s.headers=oe({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,e!=null&&e.duplex&&(s.duplex=e.duplex),oe(oe({},s),t))};async function yl(r,e,t,n,s,i){return new Promise((o,a)=>{r(t,QF(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>YF(l,a,n))})}async function Wa(r,e,t,n){return yl(r,"GET",e,t,n)}async function Pr(r,e,t,n,s){return yl(r,"POST",e,n,s,t)}async function mp(r,e,t,n,s){return yl(r,"PUT",e,n,s,t)}async function XF(r,e,t,n){return yl(r,"HEAD",e,oe(oe({},t),{},{noResolveJson:!0}),n)}async function mm(r,e,t,n,s){return yl(r,"DELETE",e,n,s,t)}var JF=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e}then(r,e){return this.execute().then(r,e)}async execute(){var r=this;try{return{data:(await r.downloadFn()).body,error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Ue(e))return{data:null,error:e};throw e}}};let x_;x_=Symbol.toStringTag;var ZF=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e,this[x_]="BlobDownloadBuilder",this.promise=null}asStream(){return new JF(this.downloadFn,this.shouldThrowOnError)}then(r,e){return this.getPromise().then(r,e)}catch(r){return this.getPromise().catch(r)}finally(r){return this.getPromise().finally(r)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var r=this;try{return{data:await(await r.downloadFn()).blob(),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Ue(e))return{data:null,error:e};throw e}}};const e$={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},av={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var t$=class{constructor(r,e={},t,n){this.shouldThrowOnError=!1,this.url=r,this.headers=e,this.bucketId=t,this.fetch=gm(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(r,e,t,n){var s=this;try{let i;const o=oe(oe({},av),n);let a=oe(oe({},s.headers),r==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&t instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",t)):typeof FormData<"u"&&t instanceof FormData?(i=t,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n!=null&&n.headers&&(a=oe(oe({},a),n.headers));const c=s._removeEmptyFolders(e),u=s._getFinalPath(c),d=await(r=="PUT"?mp:Pr)(s.fetch,`${s.url}/object/${u}`,i,oe({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Ue(i))return{data:null,error:i};throw i}}async upload(r,e,t){return this.uploadOrUpdate("POST",r,e,t)}async uploadToSignedUrl(r,e,t,n){var s=this;const i=s._removeEmptyFolders(r),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const c=oe({upsert:av.upsert},n),u=oe(oe({},s.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",c.cacheControl)):(l=t,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType),{data:{path:i,fullPath:(await mp(s.fetch,a.toString(),l,{headers:u})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Ue(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(r,e){var t=this;try{let n=t._getFinalPath(r);const s=oe({},t.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await Pr(t.fetch,`${t.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(t.url+i.url),a=o.searchParams.get("token");if(!a)throw new Ed("No token returned by API");return{data:{signedUrl:o.toString(),path:r,token:a},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async update(r,e,t){return this.uploadOrUpdate("PUT",r,e,t)}async move(r,e,t){var n=this;try{return{data:await Pr(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async copy(r,e,t){var n=this;try{return{data:{path:(await Pr(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:n.headers})).Key},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async createSignedUrl(r,e,t){var n=this;try{let s=n._getFinalPath(r),i=await Pr(n.fetch,`${n.url}/object/sign/${s}`,oe({expiresIn:e},t!=null&&t.transform?{transform:t.transform}:{}),{headers:n.headers});const o=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return i={signedUrl:encodeURI(`${n.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async createSignedUrls(r,e,t){var n=this;try{const s=await Pr(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:e,paths:r},{headers:n.headers}),i=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return{data:s.map(o=>oe(oe({},o),{},{signedUrl:o.signedURL?encodeURI(`${n.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}download(r,e){const t=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=n?`?${n}`:"",i=this._getFinalPath(r),o=()=>Wa(this.fetch,`${this.url}/${t}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new ZF(o,this.shouldThrowOnError)}async info(r){var e=this;const t=e._getFinalPath(r);try{return{data:gp(await Wa(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async exists(r){var e=this;const t=e._getFinalPath(r);try{return await XF(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ue(n)&&n instanceof pp){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}}getPublicUrl(r,e){const t=this._getFinalPath(r),n=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&n.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&n.push(o);let a=n.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${t}${a}`)}}}async remove(r){var e=this;try{return{data:await mm(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async list(r,e,t){var n=this;try{const s=oe(oe(oe({},e$),e),{},{prefix:r||""});return{data:await Pr(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},t),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async listV2(r,e){var t=this;try{const n=oe({},r);return{data:await Pr(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,n,{headers:t.headers},e),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}};const w_="2.89.0",T_={"X-Client-Info":`storage-js/${w_}`};var r$=class{constructor(r,e={},t,n){this.shouldThrowOnError=!1;const s=new URL(r);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=oe(oe({},T_),e),this.fetch=gm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(r){var e=this;try{const t=e.listBucketOptionsToQueryString(r);return{data:await Wa(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await Wa(e.fetch,`${e.url}/bucket/${r}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async createBucket(r,e={public:!1}){var t=this;try{return{data:await Pr(t.fetch,`${t.url}/bucket`,{id:r,name:r,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async updateBucket(r,e){var t=this;try{return{data:await mp(t.fetch,`${t.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async emptyBucket(r){var e=this;try{return{data:await Pr(e.fetch,`${e.url}/bucket/${r}/empty`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await mm(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}listBucketOptionsToQueryString(r){const e={};return r&&("limit"in r&&(e.limit=String(r.limit)),"offset"in r&&(e.offset=String(r.offset)),r.search&&(e.search=r.search),r.sortColumn&&(e.sortColumn=r.sortColumn),r.sortOrder&&(e.sortOrder=r.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},n$=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=oe(oe({},T_),e),this.fetch=gm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await Pr(e.fetch,`${e.url}/bucket`,{name:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async listBuckets(r){var e=this;try{const t=new URLSearchParams;(r==null?void 0:r.limit)!==void 0&&t.set("limit",r.limit.toString()),(r==null?void 0:r.offset)!==void 0&&t.set("offset",r.offset.toString()),r!=null&&r.sortColumn&&t.set("sortColumn",r.sortColumn),r!=null&&r.sortOrder&&t.set("sortOrder",r.sortOrder),r!=null&&r.search&&t.set("search",r.search);const n=t.toString(),s=n?`${e.url}/bucket?${n}`:`${e.url}/bucket`;return{data:await Wa(e.fetch,s,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await mm(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}from(r){var e=this;if(!HF(r))throw new Ed("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new jF({baseUrl:this.url,catalogName:r,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(t,{get(s,i){const o=s[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(n)throw l;return{data:null,error:l}}}}})}};const ym={"X-Client-Info":`storage-js/${w_}`,"Content-Type":"application/json"};var b_=class extends Error{constructor(r){super(r),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Zt(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}var Sh=class extends b_{constructor(r,e,t){super(r),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},s$=class extends b_{constructor(r,e){super(r),this.name="StorageVectorsUnknownError",this.originalError=e}};const vm=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),i$=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},lv=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),o$=async(r,e,t)=>{if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!(t!=null&&t.noResolveJson)){const n=r.status||500,s=r;if(typeof s.json=="function")s.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||n+"";e(new Sh(lv(i),n,o))}).catch(()=>{const i=n+"";e(new Sh(s.statusText||`HTTP ${n} error`,n,i))});else{const i=n+"";e(new Sh(s.statusText||`HTTP ${n} error`,n,i))}}else e(new s$(lv(r),r))},a$=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return n?(i$(n)?(s.headers=oe({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,oe(oe({},s),t)):s};async function l$(r,e,t,n,s,i){return new Promise((o,a)=>{r(t,a$(e,n,s,i)).then(l=>{if(!l.ok)throw l;if(n!=null&&n.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>o$(l,a,n))})}async function er(r,e,t,n,s){return l$(r,"POST",e,n,s,t)}var c$=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=oe(oe({},ym),e),this.fetch=vm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(r){var e=this;try{return{data:await er(e.fetch,`${e.url}/CreateIndex`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async getIndex(r,e){var t=this;try{return{data:await er(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Zt(n))return{data:null,error:n};throw n}}async listIndexes(r){var e=this;try{return{data:await er(e.fetch,`${e.url}/ListIndexes`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async deleteIndex(r,e){var t=this;try{return{data:await er(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Zt(n))return{data:null,error:n};throw n}}},u$=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=oe(oe({},ym),e),this.fetch=vm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(r){var e=this;try{if(r.vectors.length<1||r.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await er(e.fetch,`${e.url}/PutVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async getVectors(r){var e=this;try{return{data:await er(e.fetch,`${e.url}/GetVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async listVectors(r){var e=this;try{if(r.segmentCount!==void 0){if(r.segmentCount<1||r.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(r.segmentIndex!==void 0&&(r.segmentIndex<0||r.segmentIndex>=r.segmentCount))throw new Error(`segmentIndex must be between 0 and ${r.segmentCount-1}`)}return{data:await er(e.fetch,`${e.url}/ListVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async queryVectors(r){var e=this;try{return{data:await er(e.fetch,`${e.url}/QueryVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async deleteVectors(r){var e=this;try{if(r.keys.length<1||r.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await er(e.fetch,`${e.url}/DeleteVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}},d$=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=oe(oe({},ym),e),this.fetch=vm(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await er(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await er(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async listBuckets(r={}){var e=this;try{return{data:await er(e.fetch,`${e.url}/ListVectorBuckets`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await er(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}},h$=class extends d${constructor(r,e={}){super(r,e.headers||{},e.fetch)}from(r){return new f$(this.url,this.headers,r,this.fetch)}async createBucket(r){var e=()=>super.createBucket,t=this;return e().call(t,r)}async getBucket(r){var e=()=>super.getBucket,t=this;return e().call(t,r)}async listBuckets(r={}){var e=()=>super.listBuckets,t=this;return e().call(t,r)}async deleteBucket(r){var e=()=>super.deleteBucket,t=this;return e().call(t,r)}},f$=class extends c${constructor(r,e,t,n){super(r,e,n),this.vectorBucketName=t}async createIndex(r){var e=()=>super.createIndex,t=this;return e().call(t,oe(oe({},r),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(r={}){var e=()=>super.listIndexes,t=this;return e().call(t,oe(oe({},r),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(r){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,r)}async deleteIndex(r){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,r)}index(r){return new p$(this.url,this.headers,this.vectorBucketName,r,this.fetch)}},p$=class extends u${constructor(r,e,t,n,s){super(r,e,s),this.vectorBucketName=t,this.indexName=n}async putVectors(r){var e=()=>super.putVectors,t=this;return e().call(t,oe(oe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(r){var e=()=>super.getVectors,t=this;return e().call(t,oe(oe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(r={}){var e=()=>super.listVectors,t=this;return e().call(t,oe(oe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(r){var e=()=>super.queryVectors,t=this;return e().call(t,oe(oe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(r){var e=()=>super.deleteVectors,t=this;return e().call(t,oe(oe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},g$=class extends r${constructor(r,e={},t,n){super(r,e,t,n)}from(r){return new t$(this.url,this.headers,r,this.fetch)}get vectors(){return new h$(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new n$(this.url+"/iceberg",this.headers,this.fetch)}};const __="2.89.0",Oi=30*1e3,yp=3,xh=yp*Oi,m$="http://localhost:9999",y$="supabase.auth.token",v$={"X-Client-Info":`gotrue-js/${__}`},vp="X-Supabase-Api-Version",A_={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},E$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,S$=10*60*1e3;class za extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function ne(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class x$ extends za{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function w$(r){return ne(r)&&r.name==="AuthApiError"}class Ks extends za{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Fn extends za{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Ht extends Fn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function T$(r){return ne(r)&&r.name==="AuthSessionMissingError"}class Ti extends Fn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ql extends Fn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Xl extends Fn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function b$(r){return ne(r)&&r.name==="AuthImplicitGrantRedirectError"}class cv extends Fn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class _$ extends Fn{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ep extends Fn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function wh(r){return ne(r)&&r.name==="AuthRetryableFetchError"}class uv extends Fn{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Sp extends Fn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Su="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),dv=` 	
\r=`.split(""),A$=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<dv.length;e+=1)r[dv[e].charCodeAt(0)]=-2;for(let e=0;e<Su.length;e+=1)r[Su[e].charCodeAt(0)]=e;return r})();function hv(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Su[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Su[n]),e.queuedBits-=6}}function R_(r,e,t){const n=A$[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function fv(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{L$(o,n,t)};for(let o=0;o<r.length;o+=1)R_(r.charCodeAt(o),s,i);return e.join("")}function R$(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function I$(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}R$(n,e)}}function L$(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if(!(r>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ao(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)R_(r.charCodeAt(s),t,n);return new Uint8Array(e)}function C$(r){const e=[];return I$(r,t=>e.push(t)),new Uint8Array(e)}function qs(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>hv(s,t,n)),hv(null,t,n),e.join("")}function k$(r){return Math.round(Date.now()/1e3)+r}function P$(){return Symbol("auth-callback")}const ht=()=>typeof window<"u"&&typeof document<"u",Ns={tested:!1,writable:!1},I_=()=>{if(!ht())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ns.tested)return Ns.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Ns.tested=!0,Ns.writable=!0}catch{Ns.tested=!0,Ns.writable=!1}return Ns.writable};function D$(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const L_=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),O$=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Ni=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Ms=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},dt=async(r,e)=>{await r.removeItem(e)};class Sd{constructor(){this.promise=new Sd.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Sd.promiseConstructor=Promise;function Th(r){const e=r.split(".");if(e.length!==3)throw new Sp("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!E$.test(e[n]))throw new Sp("JWT not in base64url format");return{header:JSON.parse(fv(e[0])),payload:JSON.parse(fv(e[1])),signature:ao(e[2]),raw:{header:e[0],payload:e[1]}}}async function N$(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function M$(r,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function F$(r){return("0"+r.toString(16)).substr(-2)}function $$(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,F$).join("")}async function U$(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function B$(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await U$(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function bi(r,e,t=!1){const n=$$();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await Ni(r,`${e}-code-verifier`,s);const i=await B$(n);return[i,n===i?"plain":"s256"]}const j$=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function G$(r){const e=r.headers.get(vp);if(!e||!e.match(j$))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function V$(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function K$(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const H$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function _i(r){if(!H$.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function bh(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function W$(r,e){return new Proxy(r,{get:(t,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,n,s)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,n,s)}})}function pv(r){return JSON.parse(JSON.stringify(r))}const js=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),z$=[502,503,504];async function gv(r){var e;if(!O$(r))throw new Ep(js(r),0);if(z$.includes(r.status))throw new Ep(js(r),r.status);let t;try{t=await r.json()}catch(i){throw new Ks(js(i),i)}let n;const s=G$(r);if(s&&s.getTime()>=A_["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new uv(js(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Ht}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new uv(js(t),r.status,t.weak_password.reasons);throw new x$(js(t),r.status||500,n)}const q$=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function ie(r,e,t,n){var s;const i=Object.assign({},n==null?void 0:n.headers);i[vp]||(i[vp]=A_["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Y$(r,e,t+a,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function Y$(r,e,t,n,s,i){const o=q$(e,n,s,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new Ep(js(l),0)}if(a.ok||await gv(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await gv(l)}}function Ir(r){var e;let t=null;J$(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=k$(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function mv(r){const e=Ir(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function ns(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Q$(r){return{data:r,error:null}}function X$(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i}=r,o=$o(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function yv(r){return r}function J$(r){return r.access_token&&r.refresh_token&&r.expires_in}const _h=["global","local","others"];class Z${constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=L_(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=_h[0]){if(_h.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_h.join(", ")}`);try{return await ie(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ne(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await ie(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ns})}catch(n){if(ne(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=$o(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await ie(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:X$,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(ne(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ie(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ns})}catch(t){if(ne(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await ie(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:yv});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=g}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(ne(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){_i(e);try{return await ie(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ns})}catch(t){if(ne(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){_i(e);try{return await ie(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ns})}catch(n){if(ne(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){_i(e);try{return await ie(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ns})}catch(n){if(ne(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){_i(e.userId);try{const{data:t,error:n}=await ie(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(ne(t))return{data:null,error:t};throw t}}async _deleteFactor(e){_i(e.userId),_i(e.id);try{return{data:await ie(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ne(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await ie(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:yv});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=g}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(ne(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await ie(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ne(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await ie(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ne(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await ie(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ne(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await ie(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(ne(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await ie(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ne(t))return{data:null,error:t};throw t}}}function vv(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const Ai={debug:!!(globalThis&&I_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class C_ extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class e2 extends C_{}async function t2(r,e,t){Ai.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Ai.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Ai.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{Ai.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw Ai.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new e2(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Ai.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function r2(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function k_(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function n2(r){return parseInt(r,16)}function s2(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function i2(r){var e;const{chainId:t,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:d,version:h}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const f=k_(r.address),p=u?`${u}://${n}`:n,g=r.statement?`${r.statement}
`:"",m=`${p} wants you to sign in with your Ethereum account:
${f}

${g}`;let y=`URI: ${d}
Version: ${h}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(y+=`
Expiration Time: ${s.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let v=`
Resources:`;for(const E of c){if(!E||typeof E!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${E}`);v+=`
- ${E}`}y+=v}return`${m}
${y}`}class Je extends Error{constructor({message:e,code:t,cause:n,name:s}){var i;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class xu extends Je{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function o2({error:r,options:e}){var t,n,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Je({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Je({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Je({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Je({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new Je({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new Je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Je({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new Je({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const o=window.location.hostname;if(P_(o)){if(i.rp.id!==o)return new Je({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Je({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new Je({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function a2({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Je({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new Je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const n=window.location.hostname;if(P_(n)){if(t.rpId!==n)return new Je({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new Je({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class l2{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const c2=new l2;function u2(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:n}=r,s=$o(r,["challenge","user","excludeCredentials"]),i=ao(e).buffer,o=Object.assign(Object.assign({},t),{id:ao(t.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const c=n[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:ao(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function d2(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,n=$o(r,["challenge","allowCredentials"]),s=ao(e).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const a=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:ao(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function h2(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:qs(new Uint8Array(r.response.attestationObject)),clientDataJSON:qs(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function f2(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,n=r.getClientExtensionResults(),s=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:qs(new Uint8Array(s.authenticatorData)),clientDataJSON:qs(new Uint8Array(s.clientDataJSON)),signature:qs(new Uint8Array(s.signature)),userHandle:s.userHandle?qs(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function P_(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Ev(){var r,e;return!!(ht()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function p2(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new xu("Browser returned unexpected credential type",e)}:{data:null,error:new xu("Empty credential response",e)}}catch(e){return{data:null,error:o2({error:e,options:r})}}}async function g2(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new xu("Browser returned unexpected credential type",e)}:{data:null,error:new xu("Empty credential response",e)}}catch(e){return{data:null,error:a2({error:e,options:r})}}}const m2={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},y2={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function wu(...r){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of r)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))n[i]=o;else if(t(o))n[i]=o;else if(e(o)){const a=n[i];e(a)?n[i]=wu(a,o):n[i]=wu(o)}else n[i]=o}return n}function v2(r,e){return wu(m2,r,e||{})}function E2(r,e){return wu(y2,r,e||{})}class S2{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};const l=s??c2.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${n}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=v2(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:d}=await p2({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}case"request":{const c=E2(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:d}=await g2(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}}}catch(o){return ne(o)?{data:null,error:o}:{data:null,error:new Ks("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new za("rpId is required for WebAuthn authentication")};try{if(!Ev())return{data:null,error:new Ks("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:n,credential_response:l.credential_response}})}catch(o){return ne(o)?{data:null,error:o}:{data:null,error:new Ks("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new za("rpId is required for WebAuthn registration")};try{if(!Ev())return{data:null,error:new Ks("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var d;return(d=u.data)===null||d===void 0?void 0:d.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return ne(o)?{data:null,error:o}:{data:null,error:new Ks("Unexpected error in register",o)}}}}r2();const x2={url:m$,storageKey:y$,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:v$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Sv(r,e,t){return await t()}const Ri={};class qa{get jwks(){var e,t;return(t=(e=Ri[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Ri[this.storageKey]=Object.assign(Object.assign({},Ri[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Ri[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ri[this.storageKey]=Object.assign(Object.assign({},Ri[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},x2),e);if(this.storageKey=i.storageKey,this.instanceID=(t=qa.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,qa.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&ht()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Z$({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=L_(i.fetch),this.lock=i.lock||Sv,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&ht()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=t2:this.lock=Sv,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new S2(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:I_()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=vv(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=vv(this.memoryStorage)),ht()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${__}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},n="none";if(ht()&&(t=D$(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),ht()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),b$(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ne(t)?this._returnResult({error:t}):this._returnResult({error:new Ks("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const i=await ie(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Ir}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(ne(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,n,s;try{let i;if("email"in e){const{email:u,password:d,options:h}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await bi(this.storage,this.storageKey)),i=await ie(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:d,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:p},xform:Ir})}else if("phone"in e){const{phone:u,password:d,options:h}=e;i=await ie(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Ir})}else throw new Ql("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await dt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(await dt(this.storage,`${this.storageKey}-code-verifier`),ne(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await ie(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:mv})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await ie(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:mv})}else throw new Ql("You must provide either an email or phone number and a password");const{data:n,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const i=new Ti;return this._returnResult({data:{user:null,session:null},error:i})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(ne(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,s,i,o,a,l,c,u,d,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:g,wallet:m,statement:y,options:v}=e;let E;if(ht())if(typeof m=="object")E=m;else{const L=window;if("ethereum"in L&&typeof L.ethereum=="object"&&"request"in L.ethereum&&typeof L.ethereum.request=="function")E=L.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=m}const S=new URL((t=v==null?void 0:v.url)!==null&&t!==void 0?t:window.location.href),T=await E.request({method:"eth_requestAccounts"}).then(L=>L).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!T||T.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const A=k_(T[0]);let b=(n=v==null?void 0:v.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!b){const L=await E.request({method:"eth_chainId"});b=n2(L)}const R={domain:S.host,address:A,statement:y,uri:S.href,version:"1",chainId:b,nonce:(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=v==null?void 0:v.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=i2(R),p=await E.request({method:"personal_sign",params:[s2(f),A]})}try{const{data:g,error:m}=await ie(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Ir});if(m)throw m;if(!g||!g.session||!g.user){const y=new Ti;return this._returnResult({data:{user:null,session:null},error:y})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:m})}catch(g){if(ne(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var t,n,s,i,o,a,l,c,u,d,h,f;let p,g;if("message"in e)p=e.message,g=e.signature;else{const{chain:m,wallet:y,statement:v,options:E}=e;let S;if(ht())if(typeof y=="object")S=y;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))S=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(E!=null&&E.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=y}const T=new URL((t=E==null?void 0:E.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in S&&S.signIn){const A=await S.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},E==null?void 0:E.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),v?{statement:v}:null));let b;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")b=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)b=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in b&&"signature"in b&&(typeof b.signedMessage=="string"||b.signedMessage instanceof Uint8Array)&&b.signature instanceof Uint8Array)p=typeof b.signedMessage=="string"?b.signedMessage:new TextDecoder().decode(b.signedMessage),g=b.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in S)||typeof S.signMessage!="function"||!("publicKey"in S)||typeof S!="object"||!S.publicKey||!("toBase58"in S.publicKey)||typeof S.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${T.host} wants you to sign in with your Solana account:`,S.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${T.href}`,`Issued At: ${(s=(n=E==null?void 0:E.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=E==null?void 0:E.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${E.signInWithSolana.notBefore}`]:[],...!((o=E==null?void 0:E.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${E.signInWithSolana.expirationTime}`]:[],...!((a=E==null?void 0:E.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${E.signInWithSolana.chainId}`]:[],...!((l=E==null?void 0:E.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${E.signInWithSolana.nonce}`]:[],...!((c=E==null?void 0:E.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${E.signInWithSolana.requestId}`]:[],...!((d=(u=E==null?void 0:E.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...E.signInWithSolana.resources.map(b=>`- ${b}`)]:[]].join(`
`);const A=await S.signMessage(new TextEncoder().encode(p),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=A}}try{const{data:m,error:y}=await ie(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:qs(g)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Ir});if(y)throw y;if(!m||!m.session||!m.user){const v=new Ti;return this._returnResult({data:{user:null,session:null},error:v})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:y})}catch(m){if(ne(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const t=await Ms(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{if(!n&&this.flowType==="pkce")throw new _$;const{data:i,error:o}=await ie(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Ir});if(await dt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new Ti;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await dt(this.storage,`${this.storageKey}-code-verifier`),ne(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:i,nonce:o}=e,a=await ie(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Ir}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new Ti;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(t){if(ne(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await bi(this.storage,this.storageKey));const{error:d}=await ie(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await ie(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u})}throw new Ql("You must provide either an email or phone number.")}catch(a){if(await dt(this.storage,`${this.storageKey}-code-verifier`),ne(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,n;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await ie(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Ir});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(ne(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var t,n,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await bi(this.storage,this.storageKey));const c=await ie(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:Q$});return!((i=c.data)===null||i===void 0)&&i.url&&ht()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await dt(this.storage,`${this.storageKey}-code-verifier`),ne(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Ht;const{error:s}=await ie(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(ne(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:o}=await ie(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:o,error:a}=await ie(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Ql("You must provide either an email or phone number and a type")}catch(t){if(ne(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ms(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<xh:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await Ms(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=bh()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=W$(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await ie(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ns}):await this._useSession(async t=>{var n,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ht}:await ie(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:ns})})}catch(t){if(ne(t))return T$(t)&&(await this._removeSession(),await dt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new Ht;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await bi(this.storage,this.storageKey));const{data:c,error:u}=await ie(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:ns});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await dt(this.storage,`${this.storageKey}-code-verifier`),ne(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ht;const t=Date.now()/1e3;let n=t,s=!0,i=null;const{payload:o}=Th(e.access_token);if(o.exp&&(n=o.exp,s=n<=t),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(ne(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Ht;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(ne(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!ht())throw new Xl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Xl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new cv("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Xl("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new cv("No code detected.");const{data:v,error:E}=await this._exchangeCodeForSession(e.code);if(E)throw E;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new Xl("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const f=h-u;f*1e3<=Oi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const p=h-d;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,u);const{data:g,error:m}=await this._getUser(i);if(m)throw m;const y={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:h,refresh_token:o,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:y,redirectType:e.type},error:null})}catch(n){if(ne(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ms(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return this._returnResult({error:i});const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(w$(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await dt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=P$(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await bi(this.storage,this.storageKey,!0));try{return await ie(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(await dt(this.storage,`${this.storageKey}-code-verifier`),ne(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:s}=await this._useSession(async i=>{var o,a,l,c,u;const{data:d,error:h}=i;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await ie(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return ht()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:e.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(ne(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:s,data:{session:i}}=t;if(s)throw s;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,d=await ie(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i==null?void 0:i.access_token)!==null&&n!==void 0?n:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Ir}),{data:h,error:f}=d;return f?this._returnResult({data:{user:null,session:null},error:f}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new Ti}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:f}))}catch(s){if(await dt(this.storage,`${this.storageKey}-code-verifier`),ne(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)throw o;return await ie(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await M$(async s=>(s>0&&await N$(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await ie(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ir})),(s,i)=>{const o=200*Math.pow(2,s);return i&&wh(i)&&Date.now()+o-n<Oi})}catch(n){if(this._debug(t,"error",n),ne(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),ht()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Ms(this.storage,this.storageKey);if(s&&this.userStorage){let o=await Ms(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Ni(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:bh()}else if(s&&!s.user&&!s.user){const o=await Ms(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await dt(this.storage,this.storageKey+"-user"),await Ni(this.storage,this.storageKey,s)):s.user=bh()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<xh;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${xh}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),wh(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Ht;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Sd;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Ht;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),ne(i)){const o={data:null,error:i};return wh(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await dt(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Ni(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const i=pv(s);await Ni(this.storage,this.storageKey,i)}else{const s=pv(t);await Ni(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await dt(this.storage,this.storageKey),await dt(this.storage,this.storageKey+"-code-verifier"),await dt(this.storage,this.storageKey+"-user"),this.userStorage&&await dt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ht()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Oi);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Oi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Oi}ms, refresh threshold is ${yp} ticks`),s<=yp&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof C_)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ht()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await bi(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?this._returnResult({data:null,error:i}):await ie(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await ie(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?h2(e.webauthn.credential_response):f2(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await ie(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=await ie(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:u2(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:d2(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Th(n.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=n.user.factors)===null||e===void 0?void 0:e.filter(u=>u.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const c=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?await ie(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ht})})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ht});const o=await ie(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ht()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(ne(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ht});const o=await ie(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ht()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(ne(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await ie(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ht})})}catch(e){if(ne(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?(await ie(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ht})})}catch(t){if(ne(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(a=>a.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+S$>s)return n;const{data:i,error:o}=await ie(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:f,error:p}=await this.getSession();if(p||!f.session)return this._returnResult({data:null,error:p});n=f.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=Th(n);t!=null&&t.allowExpired||V$(i.exp);const c=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:i,header:s,signature:o},error:null}}const u=K$(s.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,C$(`${a}.${l}`)))throw new Sp("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(n){if(ne(n))return this._returnResult({data:null,error:n});throw n}}}qa.nextInstanceID={};const w2=qa,T2="2.89.0";let ra="";typeof Deno<"u"?ra="deno":typeof document<"u"?ra="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ra="react-native":ra="node";const b2={"X-Client-Info":`supabase-js-${ra}/${T2}`},_2={headers:b2},A2={schema:"public"},R2={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},I2={};function Ya(r){"@babel/helpers - typeof";return Ya=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ya(r)}function L2(r,e){if(Ya(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(Ya(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function C2(r){var e=L2(r,"string");return Ya(e)=="symbol"?e:e+""}function k2(r,e,t){return(e=C2(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function xv(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function We(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?xv(Object(t),!0).forEach(function(n){k2(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):xv(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const P2=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),D2=()=>Headers,O2=(r,e,t)=>{const n=P2(t),s=D2();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:r;let c=new s(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(i,We(We({},o),{},{headers:c}))}};function N2(r){return r.endsWith("/")?r:r+"/"}function M2(r,e){var t,n;const{db:s,auth:i,realtime:o,global:a}=r,{db:l,auth:c,realtime:u,global:d}=e,h={db:We(We({},l),s),auth:We(We({},c),i),realtime:We(We({},u),o),storage:{},global:We(We(We({},d),a),{},{headers:We(We({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(n=a==null?void 0:a.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return r.accessToken?h.accessToken=r.accessToken:delete h.accessToken,h}function F2(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(N2(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var $2=class extends w2{constructor(r){super(r)}},U2=class{constructor(r,e,t){var n,s;this.supabaseUrl=r,this.supabaseKey=e;const i=F2(r);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:A2,realtime:I2,auth:We(We({},R2),{},{storageKey:o}),global:_2},l=M2(t??{},a);if(this.storageKey=(n=l.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(u,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=O2(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(We({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new vF(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new g$(this.storageUrl.href,this.headers,this.fetch,t==null?void 0:t.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new fF(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var r=this,e,t;if(r.accessToken)return await r.accessToken();const{data:n}=await r.auth.getSession();return(e=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:s,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $2({url:this.authUrl.href,headers:We(We({},h),u),storageKey:i,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:c,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(r){return new NF(this.realtimeUrl.href,We(We({},r),{},{params:We(We({},{apikey:this.supabaseKey}),r==null?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,e)=>{this._handleTokenChanged(r,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(r,e,t){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):r==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const B2=(r,e,t)=>new U2(r,e,t);function j2(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}j2()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const G2="https://zcutunjldksydhddkobi.supabase.co",V2="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjdXR1bmpsZGtzeWRoZGRrb2JpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NDAxOTgsImV4cCI6MjA4MzMxNjE5OH0.G2ZJfpQMv1Wj_Cq3xkhMjJBu-zGk81O2xSfSR9-3_uE",K2=B2(G2,V2,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}});async function H2(r){const{data:e,error:t}=await K2.functions.invoke("extract-video",{body:{url:r}});return t?{success:!1,error:t.message}:e}function W2({onVideoReady:r}){const[e,t]=w.useState(""),[n,s]=w.useState([]),i=async()=>{try{const u=await navigator.clipboard.readText();t(u),dr({title:"Pasted from clipboard",description:u.slice(0,50)+(u.length>50?"...":"")})}catch{dr({title:"Failed to paste",description:"Please allow clipboard access or paste manually",variant:"destructive"})}},o=()=>{if(!e.trim())return;const u={id:crypto.randomUUID(),originalUrl:e.trim(),status:"pending"};s(d=>[u,...d]),t("")},a=async u=>{var h,f,p;const d=n.find(g=>g.id===u);if(d){s(g=>g.map(m=>m.id===u?{...m,status:"fetching",error:void 0}:m));try{const g=await H2(d.originalUrl);g.success&&((h=g.data)!=null&&h.streamUrl||(f=g.data)!=null&&f.downloadUrl)?(s(m=>m.map(y=>{var v,E,S,T;return y.id===u?{...y,status:"ready",title:((v=g.data)==null?void 0:v.title)||"Untitled Video",streamUrl:(E=g.data)==null?void 0:E.streamUrl,downloadUrl:(S=g.data)==null?void 0:S.downloadUrl,thumbnail:(T=g.data)==null?void 0:T.thumbnail}:y})),dr({title:"Video extracted successfully",description:((p=g.data)==null?void 0:p.title)||"Video is ready to play or download"})):(s(m=>m.map(y=>y.id===u?{...y,status:"error",error:g.error||"Could not find video stream"}:y)),dr({title:"Extraction failed",description:g.error||"Could not find video stream on this page",variant:"destructive"}))}catch(g){console.error("Extraction error:",g),s(m=>m.map(y=>y.id===u?{...y,status:"error",error:"Failed to extract video. Please try again."}:y)),dr({title:"Error",description:"Failed to extract video. Please try again.",variant:"destructive"})}}},l=u=>{u.streamUrl&&r&&(r({url:u.streamUrl,title:u.title||"Untitled Video",thumbnail:u.thumbnail}),dr({title:"Saved to Library",description:u.title||"Video added to your library"}))},c=async u=>{const d=u.downloadUrl||u.streamUrl;if(!d){dr({title:"Download failed",description:"No download URL available for this video",variant:"destructive"});return}try{s(y=>y.map(v=>v.id===u.id?{...v,status:"downloading",downloadProgress:0}:v)),dr({title:"Download started",description:"Fetching video file..."});const h=await fetch(d);if(!h.ok)throw new Error(`Failed to download: ${h.statusText}`);const f=await h.blob(),p=URL.createObjectURL(f),g=document.createElement("a");g.href=p;const m=u.title?`${u.title.replace(/[^a-z0-9]/gi,"_")}.mp4`:`video_${Date.now()}.mp4`;g.download=m,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(p),s(y=>y.map(v=>v.id===u.id?{...v,status:"ready",downloadProgress:void 0}:v)),dr({title:"Download complete",description:`${u.title||"Video"} has been downloaded`})}catch(h){console.error("Download error:",h),s(f=>f.map(p=>p.id===u.id?{...p,status:"ready",downloadProgress:void 0}:p)),dr({title:"Download failed",description:h instanceof Error?h.message:"Failed to download video",variant:"destructive"})}};return _.jsxs("div",{className:"space-y-6",children:[_.jsxs(vu,{children:[_.jsx(p_,{children:_.jsx(g_,{className:"text-lg",children:"Add Video URL"})}),_.jsx(Eu,{children:_.jsxs("div",{className:"flex gap-2",children:[_.jsx(fm,{placeholder:"Paste video URL here...",value:e,onChange:u=>t(u.target.value),onKeyDown:u=>u.key==="Enter"&&o(),className:"flex-1"}),_.jsx(ct,{variant:"outline",size:"icon",onClick:i,title:"Paste from clipboard",children:_.jsx(iC,{className:"h-4 w-4"})}),_.jsxs(ct,{onClick:o,disabled:!e.trim(),children:[_.jsx(yC,{className:"h-4 w-4 mr-2"}),"Send"]})]})})]}),n.length>0&&_.jsxs("div",{className:"space-y-3",children:[_.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Processing Queue"}),n.map(u=>_.jsx(vu,{children:_.jsx(Eu,{className:"p-4",children:_.jsxs("div",{className:"flex items-start justify-between gap-4",children:[_.jsxs("div",{className:"flex-1 min-w-0",children:[_.jsx("p",{className:"text-sm font-medium truncate",children:u.title||u.originalUrl}),u.title&&_.jsx("p",{className:"text-xs text-muted-foreground truncate",children:u.originalUrl}),u.error&&_.jsx("p",{className:"text-xs text-destructive mt-1",children:u.error})]}),_.jsxs("div",{className:"flex items-center gap-2",children:[u.status==="pending"&&_.jsx(ct,{size:"sm",onClick:()=>a(u.id),children:"Fetch"}),u.status==="fetching"&&_.jsxs(ct,{size:"sm",disabled:!0,children:[_.jsx(dy,{className:"h-4 w-4 animate-spin mr-2"}),"Fetching..."]}),u.status==="downloading"&&_.jsxs(ct,{size:"sm",disabled:!0,children:[_.jsx(dy,{className:"h-4 w-4 animate-spin mr-2"}),"Downloading..."]}),u.status==="ready"&&_.jsxs(_.Fragment,{children:[_.jsxs(ct,{size:"sm",variant:"outline",onClick:()=>l(u),children:[_.jsx(pa,{className:"h-4 w-4 mr-1"}),"Save"]}),_.jsxs(ct,{size:"sm",variant:"secondary",onClick:()=>c(u),children:[_.jsx(Vg,{className:"h-4 w-4 mr-1"}),"Download"]})]}),u.status==="error"&&_.jsx(ct,{size:"sm",variant:"destructive",onClick:()=>a(u.id),children:"Retry"})]})]})})},u.id))]})]})}const Y=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},z2=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=q2},q2=Number.MAX_SAFE_INTEGER||9007199254740991;let ee=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),N=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),x=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({});var fe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},X={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ii{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Y2{constructor(e,t,n,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ii(e),this.fast_=new Ii(t),this.defaultTTFB_=s,this.ttfb_=new Ii(e)}update(e,t){const{slow_:n,fast_:s,ttfb_:i}=this;n.halfLife!==e&&(this.slow_=new Ii(e,n.getEstimate(),n.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Ii(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Ii(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,s=e/1e3,i=n/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Q2(r,e,t){return(e=J2(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _e(){return _e=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_e.apply(null,arguments)}function wv(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function xe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wv(Object(t),!0).forEach(function(n){Q2(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):wv(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function X2(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function J2(r){var e=X2(r,"string");return typeof e=="symbol"?e:e+""}class xr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=Zn,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const Zn=function(){},Z2={trace:Zn,debug:Zn,log:Zn,warn:Zn,info:Zn,error:Zn};function xp(){return _e({},Z2)}function eU(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):Zn}function Tv(r,e,t){return e[r]?e[r].bind(e):eU(r,t)}const wp=xp();function tU(r,e,t){const n=xp();if(typeof console=="object"&&r===!0||typeof r=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{n[i]=Tv(i,r,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return xp()}s.forEach(i=>{wp[i]=Tv(i,r)})}else _e(wp,n);return n}const we=wp;function As(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function rU(r){return typeof self<"u"&&r===self.ManagedMediaSource}function D_(r,e){const t=Object.keys(r),n=Object.keys(e),s=t.length,i=n.length;return!s||!i||s===i&&!t.some(o=>n.indexOf(o)===-1)}function sr(r,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(r);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=r.length;let n,s,i,o="",a=0;for(;a<t;){if(n=r[a++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:s=r[a++],o+=String.fromCharCode((n&31)<<6|s&63);break;case 14:s=r[a++],i=r[a++],o+=String.fromCharCode((n&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function gt(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function O_(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function nU(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ah={exports:{}},bv;function sU(){return bv||(bv=1,function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var h=a.parseURL(c);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=a.normalizePath(h.path),a.buildURLFromParts(h)):c;var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var p=s.exec(f.path);f.netLoc=p[1],f.path=p[2]}f.netLoc&&!f.path&&(f.path="/");var g={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)g.path=f.path,h.params||(g.params=f.params,h.query||(g.query=f.query));else{var m=f.path,y=m.substring(0,m.lastIndexOf("/")+1)+h.path;g.path=a.normalizePath(y)}return g.path===null&&(g.path=u.alwaysNormalize?a.normalizePath(h.path):h.path),a.buildURLFromParts(g)},parseURL:function(l){var c=n.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=a})()}(Ah)),Ah.exports}var Em=sU();class Sm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Re={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class N_{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,oU(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let s;n.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(n[1]),this._byteRange=[s,parseInt(n[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Re.AUDIO]:null,[Re.VIDEO]:null,[Re.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Sm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Em.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Re.AUDIO]=null,e[Re.VIDEO]=null,e[Re.AUDIOVIDEO]=null}}function Qe(r){return r.sn!=="initSegment"}class Rh extends N_{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Y(e)&&Y(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const s=this._decryptdata=t[n[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Y(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),s=n.length;if(s>1||s===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Y(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Qe(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const s=t[e];s&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,s,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:n,startDTS:s,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class iU extends N_{constructor(e,t,n,s,i){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function M_(r,e){const t=Object.getPrototypeOf(r);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||M_(t,e)}}function oU(r,e){const t=M_(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const _v=Math.pow(2,32)-1,aU=[].push,F_={video:1,audio:2,id3:3,text:4};function tt(r){return String.fromCharCode.apply(null,r)}function $_(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function ae(r,e){const t=U_(r,e);return t<0?4294967296+t:t}function Av(r,e){let t=ae(r,e);return t*=Math.pow(2,32),t+=ae(r,e+4),t}function U_(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function lU(r){const e=r.byteLength;for(let t=0;t<e;){const n=ae(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function he(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let s=0;s<n;){const i=ae(r,s),o=tt(r.subarray(s+4,s+8)),a=i>1?s+i:n;if(o===e[0])if(e.length===1)t.push(r.subarray(s+8,a));else{const l=he(r.subarray(s+8,a),e.slice(1));l.length&&aU.apply(t,l)}s=a}return t}function cU(r){const e=[],t=r[0];let n=8;const s=ae(r,n);n+=4;let i=0,o=0;t===0?(i=ae(r,n),o=ae(r,n+4),n+=8):(i=Av(r,n),o=Av(r,n+8),n+=16),n+=2;let a=r.length+o;const l=$_(r,n);n+=2;for(let c=0;c<l;c++){let u=n;const d=ae(r,u);u+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return we.warn("SIDX has hierarchical references (not supported)"),null;const p=ae(r,u);u+=4,e.push({referenceSize:h,subsegmentDuration:p,info:{duration:p/s,start:a,end:a+h-1}}),a+=h,u+=4,n=u}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function B_(r){const e=[],t=he(r,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=he(i,["tkhd"])[0];if(o){let a=o[0];const l=ae(o,a===0?12:20),c=he(i,["mdia","mdhd"])[0];if(c){a=c[0];const u=ae(c,a===0?12:20),d=he(i,["mdia","hdlr"])[0];if(d){const h=tt(d.subarray(8,12)),f={soun:Re.AUDIO,vide:Re.VIDEO}[h],p=he(i,["mdia","minf","stbl","stsd"])[0],g=uU(p);f?(e[l]={timescale:u,type:f,stsd:g},e[f]=xe({timescale:u,id:l},g)):e[l]={timescale:u,type:h,stsd:g}}}}}return he(r,["moov","mvex","trex"]).forEach(s=>{const i=ae(s,4),o=e[i];o&&(o.default={duration:ae(s,12),flags:ae(s,20)})}),e}function uU(r){const e=r.subarray(8),t=e.subarray(86),n=tt(e.subarray(4,8));let s=n,i;const o=n==="enca"||n==="encv";if(o){const c=he(e,[n])[0].subarray(n==="enca"?28:78);he(c,["sinf"]).forEach(d=>{const h=he(d,["schm"])[0];if(h){const f=tt(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const p=he(d,["frma"])[0];p&&(s=tt(p))}}})}const a=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=he(t,["avcC"])[0];l&&l.length>3&&(s+="."+Zl(l[1])+Zl(l[2])+Zl(l[3]),i=Jl(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=he(e,[n])[0],c=he(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=Ih(c,u),u+=2;const d=c[u++];if(d&128&&(u+=2),d&64&&(u+=c[u++]),c[u++]!==4)break;u=Ih(c,u);const h=c[u++];if(h===64)s+="."+Zl(h);else break;if(u+=12,c[u++]!==5)break;u=Ih(c,u);const f=c[u++];let p=(f&248)>>3;p===31&&(p+=1+((f&7)<<3)+((c[u]&224)>>5)),s+="."+p}break}case"hvc1":case"hev1":{const l=he(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=c&31,h=ae(l,2),f=(c&32)>>5?"H":"L",p=l[12],g=l.subarray(6,12);s+="."+u+d,s+="."+dU(h).toString(16).toUpperCase(),s+="."+f+p;let m="";for(let y=g.length;y--;){const v=g[y];(v||m)&&(m="."+v.toString(16).toUpperCase()+m)}s+=m}i=Jl(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Jl(s,t)||s;break}case"vp09":{const l=he(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],d=l[6]>>4&15;s+="."+Yr(c)+"."+Yr(u)+"."+Yr(d)}break}case"av01":{const l=he(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,f=(l[2]&32)>>5,p=c===2&&h?f?12:10:h?10:8,g=(l[2]&16)>>4,m=(l[2]&8)>>3,y=(l[2]&4)>>2,v=l[2]&3;s+="."+c+"."+Yr(u)+d+"."+Yr(p)+"."+g+"."+m+y+v+"."+Yr(1)+"."+Yr(1)+"."+Yr(1)+"."+0,i=Jl("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function Jl(r,e){const t=he(e,["dvvC"]),n=t.length?t[0]:he(e,["dvcC"])[0];if(n){const s=n[2]>>1&127,i=n[2]<<5&32|n[3]>>3&31;return r+"."+Yr(s)+"."+Yr(i)}}function dU(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function Ih(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function Zl(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Yr(r){return(r<10?"0":"")+r}function hU(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&j_(r,(n,s)=>{const i=n.subarray(8,24);i.some(o=>o!==0)||(we.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${gt(i)} -> ${gt(t)}`),n.set(t,8))})}function fU(r){const e=[];return j_(r,t=>e.push(t.subarray(8,24))),e}function j_(r,e){he(r,["moov","trak"]).forEach(n=>{const s=he(n,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let o=he(i,["enca"]);const a=o.length>0;a||(o=he(i,["encv"])),o.forEach(l=>{const c=a?l.subarray(28):l.subarray(78);he(c,["sinf"]).forEach(d=>{const h=G_(d);h&&e(h,a)})})})}function G_(r){const e=he(r,["schm"])[0];if(e){const t=tt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=he(r,["schi","tenc"])[0];if(n)return n}}}function pU(r,e,t){const n={},s=he(r,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],a=he(o,["tfhd"])[0],l=ae(a,4),c=e[l];if(!c)continue;n[l]||(n[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=n[l],d=he(o,["tfdt"])[0];if(d){const E=d[0];let S=ae(d,4);E===1&&(S===_v?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(S*=_v+1,S+=ae(d,8))),Y(S)&&(!Y(u.start)||S<u.start)&&(u.start=S)}const h=c.default,f=ae(a,0)|(h==null?void 0:h.flags);let p=(h==null?void 0:h.duration)||0;f&8&&(f&2?p=ae(a,12):p=ae(a,8));const g=he(o,["trun"]);let m=u.start||0,y=0,v=p;for(let E=0;E<g.length;E++){const S=g[E],T=ae(S,4),A=u.sampleCount;u.sampleCount+=T;const b=S[3]&1,R=S[3]&4,L=S[2]&1,I=S[2]&2,C=S[2]&4,D=S[2]&8;let B=8,F=T;for(b&&(B+=4),R&&T&&(!(S[B+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=A),B+=4,L?(v=ae(S,B),B+=4):v=p,I&&(B+=4),D&&(B+=4),m+=v,y+=v,F--);F--;)L?(v=ae(S,B),B+=4):v=p,I&&(B+=4),C&&(S[B+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(F+1),u.keyFrameStart=m),B+=4),D&&(B+=4),m+=v,y+=v;!y&&p&&(y+=p*T)}u.duration+=y}if(!Object.keys(n).some(i=>n[i].duration)){let i=1/0,o=0;const a=he(r,["sidx"]);for(let l=0;l<a.length;l++){const c=cU(a[l]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,h)=>d+h.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&Y(o)&&Object.keys(n).forEach(l=>{n[l].duration||(n[l].duration=o*n[l].timescale-n[l].start)})}return n}function gU(r){const e={valid:null,remainder:null},t=he(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=r.slice(0,n.byteOffset-8),e.remainder=r.slice(n.byteOffset-8),e}function Sr(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Rv(r,e){const t=[],n=e.samples,s=e.timescale,i=e.id;let o=!1;return he(n,["moof"]).map(l=>{const c=l.byteOffset-8;he(l,["traf"]).map(d=>{const h=he(d,["tfdt"]).map(f=>{const p=f[0];let g=ae(f,4);return p===1&&(g*=Math.pow(2,32),g+=ae(f,8)),g/s})[0];return h!==void 0&&(r=h),he(d,["tfhd"]).map(f=>{const p=ae(f,4),g=ae(f,0)&16777215,m=(g&1)!==0,y=(g&2)!==0,v=(g&8)!==0;let E=0;const S=(g&16)!==0;let T=0;const A=(g&32)!==0;let b=8;p===i&&(m&&(b+=8),y&&(b+=4),v&&(E=ae(f,b),b+=4),S&&(T=ae(f,b),b+=4),A&&(b+=4),e.type==="video"&&(o=xd(e.codec)),he(d,["trun"]).map(R=>{const L=R[0],I=ae(R,0)&16777215,C=(I&1)!==0;let D=0;const B=(I&4)!==0,F=(I&256)!==0;let V=0;const M=(I&512)!==0;let K=0;const P=(I&1024)!==0,k=(I&2048)!==0;let j=0;const U=ae(R,4);let $=8;C&&(D=ae(R,$),$+=4),B&&($+=4);let q=D+c;for(let Q=0;Q<U;Q++){if(F?(V=ae(R,$),$+=4):V=E,M?(K=ae(R,$),$+=4):K=T,P&&($+=4),k&&(L===0?j=ae(R,$):j=U_(R,$),$+=4),e.type===Re.VIDEO){let Z=0;for(;Z<K;){const re=ae(n,q);if(q+=4,mU(o,n[q])){const se=n.subarray(q,q+re);xm(se,o?2:1,r+j/s,t)}q+=re,Z+=re+4}}r+=V/s}}))})})}),t}function xd(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function mU(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function xm(r,e,t,n){const s=V_(r);let i=0;i+=e;let o=0,a=0,l=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);const c=s.length-i;let u=i;if(a<c)i+=a;else if(a>c){we.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(s[u++]===181){const h=$_(s,u);if(u+=2,h===49){const f=ae(s,u);if(u+=4,f===1195456820){const p=s[u++];if(p===3){const g=s[u++],m=31&g,y=64&g,v=y?2+m*3:0,E=new Uint8Array(v);if(y){E[0]=g;for(let S=1;S<v;S++)E[S]=s[u++]}n.push({type:p,payloadType:o,pts:t,bytes:E})}}}}}else if(o===5&&a>16){const d=[];for(let p=0;p<16;p++){const g=s[u++].toString(16);d.push(g.length==1?"0"+g:g),(p===3||p===5||p===7||p===9)&&d.push("-")}const h=a-16,f=new Uint8Array(h);for(let p=0;p<h;p++)f[p]=s[u++];n.push({payloadType:o,pts:t,uuid:d.join(""),userData:sr(f),userDataBytes:f})}}}function V_(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const s=e-t.length,i=new Uint8Array(s);let o=0;for(n=0;n<s;o++,n++)o===t[0]&&(o++,t.shift()),i[n]=r[o];return i}function yU(r){const e=r[0];let t="",n="",s=0,i=0,o=0,a=0,l=0,c=0;if(e===0){for(;tt(r.subarray(c,c+1))!=="\0";)t+=tt(r.subarray(c,c+1)),c+=1;for(t+=tt(r.subarray(c,c+1)),c+=1;tt(r.subarray(c,c+1))!=="\0";)n+=tt(r.subarray(c,c+1)),c+=1;n+=tt(r.subarray(c,c+1)),c+=1,s=ae(r,12),i=ae(r,16),a=ae(r,20),l=ae(r,24),c=28}else if(e===1){c+=4,s=ae(r,c),c+=4;const d=ae(r,c);c+=4;const h=ae(r,c);for(c+=4,o=2**32*d+h,z2(o)||(o=Number.MAX_SAFE_INTEGER,we.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=ae(r,c),c+=4,l=ae(r,c),c+=4;tt(r.subarray(c,c+1))!=="\0";)t+=tt(r.subarray(c,c+1)),c+=1;for(t+=tt(r.subarray(c,c+1)),c+=1;tt(r.subarray(c,c+1))!=="\0";)n+=tt(r.subarray(c,c+1)),c+=1;n+=tt(r.subarray(c,c+1)),c+=1}const u=r.subarray(c,r.byteLength);return{schemeIdUri:t,value:n,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:u}}function vU(r,...e){const t=e.length;let n=8,s=t;for(;s--;)n+=e[s].byteLength;const i=new Uint8Array(n);for(i[0]=n>>24&255,i[1]=n>>16&255,i[2]=n>>8&255,i[3]=n&255,i.set(r,4),s=0,n=8;s<t;s++)i.set(e[s],n),n+=e[s].byteLength;return i}function EU(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,s;n=0,s=new Uint8Array;let i;n>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),vU([112,115,115,104],new Uint8Array([n,0,0,0]),r,i,s,o,t)}function SU(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let n=0;for(;n+32<t;){const s=new DataView(r,n),i=xU(s);e.push(i),n+=i.size}}return e}function xU(r){const e=r.getUint32(0),t=r.byteOffset,n=r.byteLength;if(n<e)return{offset:t,size:n};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const i=r.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=r.buffer,a=gt(new Uint8Array(o,t+12,16));let l=null,c=null,u=0;if(i===0)u=28;else{const h=r.getUint32(28);if(!h||n<32+h*16)return{offset:t,size:e};l=[];for(let f=0;f<h;f++)l.push(new Uint8Array(o,t+32+f*16,16));u=32+h*16}if(!u)return{offset:t,size:e};const d=r.getUint32(u);return e-32<d?{offset:t,size:e}:(c=new Uint8Array(o,t+u+4,d),{version:i,systemId:a,kids:l,data:c,offset:t,size:e})}const K_=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Co={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function wm(r,e){const t=Co[e];return!!t&&!!t[r.slice(0,4)]}function Qa(r,e,t=!0){return!r.split(",").some(n=>!Tm(n,e,t))}function Tm(r,e,t=!0){var n;const s=As(t);return(n=s==null?void 0:s.isTypeSupported(Xa(r,e)))!=null?n:!1}function Xa(r,e){return`${e}/mp4;codecs=${r}`}function Iv(r){if(r){const e=r.substring(0,4);return Co.video[e]}return 2}function Tu(r){const e=K_();return r.split(",").reduce((t,n)=>{const i=e&&xd(n)?9:Co.video[n];return i?(i*2+t)/(t?3:2):(Co.audio[n]+t)/(t?2:1)},0)}const Lh={};function wU(r,e=!0){if(Lh[r])return Lh[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let s=0;s<t.length;s++){var n;if(Tm(t[s],"audio",e))return Lh[r]=t[s],t[s];if(t[s]==="mp3"&&(n=As(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return r}const TU=/flac|opus|mp4a\.40\.34/i;function bu(r,e=!0){return r.replace(TU,t=>wU(t.toLowerCase(),e))}function bU(r,e){const t=[];if(r){const n=r.split(",");for(let s=0;s<n.length;s++)wm(n[s],"video")||t.push(n[s])}return e&&t.push(e),t.join(",")}function Cc(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(Lv(r,"audio")||Lv(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let n=t.length;n--;)if(t[n].substring(0,4)===r.substring(0,4))return t[n]}return t[0]}}return e||r}function Lv(r,e){return wm(r,e)&&Tm(r,e)}function _U(r){const e=r.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function AU(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return r}function Cv(r){const e=As(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Tp(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const RU={supported:!0,powerEfficient:!0,smooth:!0},IU={supported:!1,smooth:!1,powerEfficient:!1},H_={supported:!0,configurations:[],decodingInfoResults:[RU]};function W_(r,e){return{supported:!1,configurations:e,decodingInfoResults:[IU],error:r}}function LU(r,e,t,n,s,i){const o=r.videoCodec,a=r.audioCodec?r.audioGroups:null,l=i==null?void 0:i.audioCodec,c=i==null?void 0:i.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=e.groups[a[0]].channels:d=a.reduce((h,f)=>{if(f){const p=e.groups[f];if(!p)throw new Error(`Audio track group ${f} not found`);Object.keys(p.channels).forEach(g=>{h[g]=(h[g]||0)+p.channels[g]})}return h},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(h=>xd(h))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(s,8e6))||!!d&&Y(u)&&Object.keys(d).some(h=>parseInt(h)>u)}function z_(r,e,t,n={}){const s=r.videoCodec;if(!s&&!r.audioCodec||!t)return Promise.resolve(H_);const i=[],o=CU(r),a=o.length,l=kU(r,e,a>0),c=l.length;for(let u=a||1*c||1;u--;){const d={type:"media-source"};if(a&&(d.video=o[u%a]),c){d.audio=l[u%c];const h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}i.push(d)}if(s){const u=navigator.userAgent;if(s.split(",").some(d=>xd(d))&&K_())return Promise.resolve(W_(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),i))}return Promise.all(i.map(u=>{const d=DU(u);return n[d]||(n[d]=t.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:i,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:i,decodingInfoResults:[],error:u}))}function CU(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),n=q_(r),s=r.width||640,i=r.height||480,o=r.frameRate||30,a=r.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:Xa(AU(l),"video"),width:s,height:i,bitrate:n,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function kU(r,e,t){var n;const s=(n=r.audioCodec)==null?void 0:n.split(","),i=q_(r);return s&&r.audioGroups?r.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===a){const h=parseFloat(d.channels||"");s.forEach(f=>{const p={contentType:Xa(f,"audio"),bitrate:t?PU(f,i):i};h&&(p.channels=""+h),u.push(p)})}return u},o):o},[]):[]}function PU(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function q_(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function DU(r){let e="";const{audio:t,video:n}=r;if(n){const s=Tp(n.contentType);e+=`${s}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const s=Tp(t.contentType);e+=`${n?"_":""}${s}_c${t.channels}`}return e}const bp=["NONE","TYPE-0","TYPE-1",null];function OU(r){return bp.indexOf(r)>-1}const _u=["SDR","PQ","HLG"];function NU(r){return!!r&&_u.indexOf(r)>-1}var kc={No:"",Yes:"YES",v2:"v2"};function kv(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,s=n<e/2;return e&&s?t?kc.v2:kc.Yes:kc.No}class Pv{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ja{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Dv(this._audioGroups,e)}hasSubtitleGroup(e){return Dv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Dv(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function MU(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function FU(r,e){let t=!1,n=[];if(r&&(t=r!=="SDR",n=[r]),e){n=e.allowedVideoRanges||_u.slice(0);const s=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&MU(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const $U=r=>{const e=new WeakSet;return(t,n)=>{if(r&&(n=r(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},Ie=(r,e)=>JSON.stringify(r,$U(e));function UU(r,e,t,n,s){const i=Object.keys(r),o=n==null?void 0:n.channels,a=n==null?void 0:n.audioCodec,l=s==null?void 0:s.videoCodec,c=o&&parseInt(o)===2;let u=!1,d=!1,h=1/0,f=1/0,p=1/0,g=1/0,m=0,y=[];const{preferHDR:v,allowedVideoRanges:E}=FU(e,s);for(let R=i.length;R--;){const L=r[i[R]];u||(u=L.channels[2]>0),h=Math.min(h,L.minHeight),f=Math.min(f,L.minFramerate),p=Math.min(p,L.minBitrate),E.filter(C=>L.videoRanges[C]>0).length>0&&(d=!0)}h=Y(h)?h:0,f=Y(f)?f:0;const S=Math.max(1080,h),T=Math.max(30,f);p=Y(p)?p:t,t=Math.max(p,t),d||(e=void 0);const A=i.length>1;return{codecSet:i.reduce((R,L)=>{const I=r[L];if(L===R)return R;if(y=d?E.filter(C=>I.videoRanges[C]>0):[],A){if(I.minBitrate>t)return Wr(L,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),R;if(!I.hasDefaultAudio)return Wr(L,"no renditions with default or auto-select sound found"),R;if(a&&L.indexOf(a.substring(0,4))%5!==0)return Wr(L,`audio codec preference "${a}" not found`),R;if(o&&!c){if(!I.channels[o])return Wr(L,`no renditions with ${o} channel sound found (channels options: ${Object.keys(I.channels)})`),R}else if((!a||c)&&u&&I.channels[2]===0)return Wr(L,"no renditions with stereo sound found"),R;if(I.minHeight>S)return Wr(L,`min resolution of ${I.minHeight} > maximum of ${S}`),R;if(I.minFramerate>T)return Wr(L,`min framerate of ${I.minFramerate} > maximum of ${T}`),R;if(!y.some(C=>I.videoRanges[C]>0))return Wr(L,`no variants with VIDEO-RANGE of ${Ie(y)} found`),R;if(l&&L.indexOf(l.substring(0,4))%5!==0)return Wr(L,`video codec preference "${l}" not found`),R;if(I.maxScore<m)return Wr(L,`max score of ${I.maxScore} < selected max of ${m}`),R}return R&&(Tu(L)>=Tu(R)||I.fragmentError>r[R].fragmentError)?R:(g=I.minIndex,m=I.maxScore,L)},void 0),videoRanges:y,preferHDR:v,minFramerate:f,minBitrate:p,minIndex:g}}function Wr(r,e){we.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function Y_(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const s=t.channels||"2";return n.channels[s]=(n.channels[s]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function BU(r,e,t,n){return r.slice(t,n+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const a=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const d=e.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),s},{})}function Ov(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}=r;return{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}}function nn(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const s=e[n];if(ni(r,s,t))return n}return-1}function ni(r,e,t){const{groupId:n,name:s,lang:i,assocLang:o,default:a}=r,l=r.forced;return(n===void 0||e.groupId===n)&&(s===void 0||e.name===s)&&(i===void 0||jU(i,e.lang))&&(i===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in r)||GU(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function jU(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function GU(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(s=>n.indexOf(s)===-1)}function Gs(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function VU(r,e,t,n,s){const i=e[n],a=e.reduce((h,f,p)=>{const g=f.uri;return(h[g]||(h[g]=[])).push(p),h},{})[i.uri];a.length>1&&(n=Math.max.apply(Math,a));const l=i.videoRange,c=i.frameRate,u=i.codecSet.substring(0,4),d=Nv(e,n,h=>{if(h.videoRange!==l||h.frameRate!==c||h.codecSet.substring(0,4)!==u)return!1;const f=h.audioGroups,p=t.filter(g=>!f||f.indexOf(g.groupId)!==-1);return nn(r,p,s)>-1});return d>-1?d:Nv(e,n,h=>{const f=h.audioGroups,p=t.filter(g=>!f||f.indexOf(g.groupId)!==-1);return nn(r,p,s)>-1})}function Nv(r,e,t){for(let n=e;n>-1;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}function Au(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class KU extends xr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!s||!l)return;const c=performance.now(),u=i?i.stats:s.stats,d=i?i.duration:s.duration,h=c-u.loading.start,f=o.minAutoLevel,p=s.level,g=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||p<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const m=g>-1&&g!==p,y=!!t||m;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const v=o.mainForwardBufferInfo;if(!y&&v===null)return;const E=this.bwEstimator.getEstimateTTFB(),S=Math.abs(l.playbackRate);if(h<=Math.max(E,1e3*(d/(S*2))))return;const T=v?v.len/S:0,A=u.loading.first?u.loading.first-u.loading.start:-1,b=u.loaded&&A>-1,R=this.getBwEstimate(),L=o.levels,I=L[p],C=Math.max(u.loaded,Math.round(d*(s.bitrate||I.averageBitrate)/8));let D=b?h-A:h;D<1&&b&&(D=Math.min(h,u.loaded*8/R));const B=b?u.loaded*1e3/D:0,F=E/1e3,V=B?(C-u.loaded)/B:C*8/R+F;if(V<=T)return;const M=B?B*8:R,K=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,P=this.hls.config.abrBandWidthUpFactor;let k=Number.POSITIVE_INFINITY,j;for(j=p-1;j>f;j--){const Q=L[j].maxBitrate,Z=!L[j].details||K;if(k=this.getTimeToLoadFrag(F,M,d*Q,Z),k<Math.min(T,d+F))break}if(k>=V||k>d*10)return;b?this.bwEstimator.sample(h-Math.min(E,A),u.loaded):this.bwEstimator.sampleTTFB(h);const U=L[j].maxBitrate;this.getBwEstimate()*P>U&&this.resetEstimator(U);const $=this.findBestLevel(U,f,j,0,T,1,1);$>-1&&(j=$),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${T.toFixed(3)} s
      Estimated load time for current fragment: ${V.toFixed(3)} s
      Estimated load time for down switch fragment: ${k.toFixed(3)} s
      TTFB estimate: ${A|0} ms
      Current BW estimate: ${Y(R)?R|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${j} @ ${U|0} bps`),o.nextLoadLevel=o.nextAutoLevel=j,this.clearTimer();const q=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===j&&j>0){const Q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${j>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${Q.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,j>f){let Z=this.findBestLevel(this.hls.levels[f].bitrate,f,j,0,Q,1,1);Z===-1&&(Z=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Z,this.resetEstimator(this.hls.levels[Z].bitrate)}}};m||V>k*2?q():this.timer=self.setInterval(q,k*1e3),o.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Y2(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var s;this.fragCurrent=n,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case N.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:s,partCurrent:i}=this;if(n&&s&&n.sn===s.sn&&n.level===s.level){const o=performance.now(),a=i?i.stats:n.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,n,s){const i=e+n/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const n=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;Y(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const s=n?n.stats:t.stats;if(t.type===X.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=n?n.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+s.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:n,id:t.type};this.onFragBuffered(x.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:n.stats;if(i.aborted||this.ignoreFragment(n))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==X.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(n,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=n&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=n,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(c){const m=this.findBestLevel(l,o,s,c,0,u,d);if(m>=0)return this.rebufferNotice=-1,m}let h=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const m=this.bitrateTestDelay;m&&(h=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-m,this.info(`bitrate test took ${Math.round(1e3*m)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),u=d=1)}const f=this.findBestLevel(l,o,s,c,h,u,d);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const p=n.levels[o],g=n.loadLevelObj;return g&&(p==null?void 0:p.bitrate)<g.bitrate?o:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,s,i,o,a){var l;const c=s+i,u=this.lastLoadedFragLevel,d=u===-1?this.hls.firstLevel:u,{fragCurrent:h,partCurrent:f}=this,{levels:p,allAudioTracks:g,loadLevel:m,config:y}=this.hls;if(p.length===1)return 0;const v=p[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),S=m===-1||u===-1;let T,A="SDR",b=(v==null?void 0:v.frameRate)||0;const{audioPreference:R,videoPreference:L}=y,I=this.audioTracksByGroup||(this.audioTracksByGroup=Y_(g));let C=-1;if(S){if(this.firstSelection!==-1)return this.firstSelection;const M=this.codecTiers||(this.codecTiers=BU(p,I,t,n)),K=UU(M,A,e,R,L),{codecSet:P,videoRanges:k,minFramerate:j,minBitrate:U,minIndex:$,preferHDR:q}=K;C=$,T=P,A=q?k[k.length-1]:k[0],b=j,e=Math.max(e,U),this.log(`picked start tier ${Ie(K)}`)}else T=v==null?void 0:v.codecSet,A=v==null?void 0:v.videoRange;const D=f?f.duration:h?h.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,F=[];for(let M=n;M>=t;M--){var V;const K=p[M],P=M>d;if(!K)continue;if(y.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const Z=navigator.mediaCapabilities;typeof(Z==null?void 0:Z.decodingInfo)=="function"&&LU(K,I,A,b,e,R)?(K.supportedPromise=z_(K,I,Z,this.supportedCache),K.supportedPromise.then(re=>{if(!this.hls)return;K.supportedResult=re;const se=this.hls.levels,Ae=se.indexOf(K);re.error?this.warn(`MediaCapabilities decodingInfo error: "${re.error}" for level ${Ae} ${Ie(re)}`):re.supported?re.decodingInfoResults.some(Se=>Se.smooth===!1||Se.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ae} not smooth or powerEfficient: ${Ie(re)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ae} ${Ie(re)}`),Ae>-1&&se.length>1&&(this.log(`Removing unsupported level ${Ae}`),this.hls.removeLevel(Ae),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(re=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${re}`)})):K.supportedResult=H_}if((T&&K.codecSet!==T||A&&K.videoRange!==A||P&&b>K.frameRate||!P&&b>0&&b<K.frameRate||(V=K.supportedResult)!=null&&(V=V.decodingInfoResults)!=null&&V.some(Z=>Z.smooth===!1))&&(!S||M!==C)){F.push(M);continue}const k=K.details,j=(f?k==null?void 0:k.partTarget:k==null?void 0:k.averagetargetduration)||D;let U;P?U=a*e:U=o*e;const $=D&&s>=D*2&&i===0?K.averageBitrate:K.maxBitrate,q=this.getTimeToLoadFrag(B,U,$*j,k===void 0);if(U>=$&&(M===u||K.loadError===0&&K.fragmentError===0)&&(q<=B||!Y(q)||E&&!this.bitrateTestDelay||q<c)){const Z=this.forcedAutoLevel;return M!==m&&(Z===-1||Z!==m)&&(F.length&&this.trace(`Skipped level(s) ${F.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${p[F[0]].codecs}" ${p[F[0]].videoRange}; not compatible with "${T}" ${A}`),this.info(`switch candidate:${d}->${M} adjustedbw(${Math.round(U)})-bitrate=${Math.round(U-$)} ttfb:${B.toFixed(1)} avgDuration:${j.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${q.toFixed(1)} firstSelection:${S} codecSet:${K.codecSet} videoRange:${K.videoRange} hls.loadLevel:${m}`)),S&&(this.firstSelection=M),M}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const Q_={search:function(r,e){let t=0,n=r.length-1,s=null,i=null;for(;t<=n;){s=(t+n)/2|0,i=r[s];const o=e(i);if(o>0)t=s+1;else if(o<0)n=s-1;else return i}return null}};function HU(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!Y(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const s=r[r.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<r.length;++i){const o=r[i];if(zU(e,t,o))return o}return null}function ui(r,e,t=0,n=0,s=.005){let i=null;if(r){i=e[1+r.sn-e[0].sn]||null;const a=r.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),i&&r.level!==i.level&&i.end<=r.end&&(i=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!r||r.level===i.level)&&Mv(t,n,i)===0||WU(i,r,Math.min(s,n))))return i;const o=Q_.search(e,Mv.bind(null,t,n));return o&&(o!==r||!i)?o:i}function WU(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return r.start<=n}return!1}function Mv(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function zU(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function X_(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let n=r.fragments;const{fragmentHint:s}=r;s&&(n=n.concat(s));let i;return Q_.search(n,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function Ru(r){switch(r.details){case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_TIMEOUT:case N.LEVEL_LOAD_TIMEOUT:case N.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function J_(r){return r.details.startsWith("key")}function Z_(r){return J_(r)&&!!r.frag&&!r.frag.decryptdata}function Fv(r,e){const t=Ru(e);return r.default[`${t?"timeout":"error"}Retry`]}function bm(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function $v(r){return xe(xe({},r),{errorRetry:null,timeoutRetry:null})}function Iu(r,e,t,n){if(!r)return!1;const s=n==null?void 0:n.code,i=e<r.maxNumRetry&&(qU(s)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,i):i}function qU(r){return _p(r)||!!r&&(r<400||r>499)}function _p(r){return r===0&&navigator.onLine===!1}var pt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},zt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class YU extends xr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.ERROR,this.onError,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.ERROR,this.onError,this),e.off(x.ERROR,this.onErrorOut,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===X.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case N.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=lo();return}case N.FRAG_GAP:case N.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=pt.SendAlternateToPenaltyBox;return}case N.LEVEL_EMPTY_ERROR:case N.LEVEL_PARSING_ERROR:{var o;const l=t.parent===X.MAIN?t.level:s.loadLevel;t.details===N.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.SUBTITLE_LOAD_ERROR:case N.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=s.loadLevelObj;if(l&&(i.type===fe.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===fe.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=pt.SendAlternateToPenaltyBox,t.errorAction.flags=zt.MoveAllAlternatesMatchingHost;return}}return;case N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:pt.SendAlternateToPenaltyBox,flags:zt.MoveAllAlternatesMatchingHDCP};return;case N.KEY_SYSTEM_SESSION_UPDATE_FAILED:case N.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case N.KEY_SYSTEM_NO_SESSION:t.errorAction={action:pt.SendAlternateToPenaltyBox,flags:zt.MoveAllAlternatesMatchingKey};return;case N.BUFFER_ADD_CODEC_ERROR:case N.REMUX_ALLOC_ERROR:case N.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:s.loadLevel)}return;case N.INTERNAL_EXCEPTION:case N.BUFFER_APPENDING_ERROR:case N.BUFFER_FULL_ERROR:case N.LEVEL_SWITCH_ERROR:case N.BUFFER_STALLED_ERROR:case N.BUFFER_SEEK_OVER_HOLE:case N.BUFFER_NUDGE_ON_STALL:t.errorAction=lo();return}t.type===ee.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=lo())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,s=Fv(n.config.playlistLoadPolicy,e),i=this.playlistError++;if(Iu(s,i,Ru(e),e.response))return{action:pt.RetryRequest,flags:zt.None,retryConfig:s,retryCount:i};const a=this.getLevelSwitchAction(e,t);return s&&(a.retryConfig=s,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),s=t.levels[n],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=Fv(J_(e)?o:i,e),l=t.levels.reduce((u,d)=>u+d.fragmentError,0);if(s&&(e.details!==N.FRAG_GAP&&s.fragmentError++,!Z_(e)&&Iu(a,l,Ru(e),e.response)))return{action:pt.RetryRequest,flags:zt.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,n);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const c=e.details;s.loadError++,c===N.BUFFER_APPEND_ERROR&&s.fragmentError++;let u=-1;const{levels:d,loadLevel:h,minAutoLevel:f,maxAutoLevel:p}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const g=(i=e.frag)==null?void 0:i.type,y=(g===X.AUDIO&&c===N.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===N.BUFFER_ADD_CODEC_ERROR||c===N.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:A})=>s.audioCodec!==A),E=e.sourceBufferName==="video"&&(c===N.BUFFER_ADD_CODEC_ERROR||c===N.BUFFER_APPEND_ERROR)&&d.some(({codecSet:A,audioCodec:b})=>s.codecSet!==A&&s.audioCodec===b),{type:S,groupId:T}=(o=e.context)!=null?o:{};for(let A=d.length;A--;){const b=(A+h)%d.length;if(b!==h&&b>=f&&b<=p&&d[b].loadError===0){var a,l;const R=d[b];if(c===N.FRAG_GAP&&g===X.MAIN&&e.frag){const L=d[b].details;if(L){const I=ui(e.frag,L.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(S===fe.AUDIO_TRACK&&R.hasAudioGroup(T)||S===fe.SUBTITLE_TRACK&&R.hasSubtitleGroup(T))continue;if(g===X.AUDIO&&(a=s.audioGroups)!=null&&a.some(L=>R.hasAudioGroup(L))||g===X.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(L=>R.hasSubtitleGroup(L))||y&&s.audioCodec===R.audioCodec||E&&s.codecSet===R.codecSet||!y&&s.codecSet!==R.codecSet)continue}u=b;break}}if(u>-1&&n.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:pt.SendAlternateToPenaltyBox,flags:zt.None,nextAutoLevel:u}}return{action:pt.SendAlternateToPenaltyBox,flags:zt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case pt.DoNothing:break;case pt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==N.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:s}=n,i=n.nextAutoLevel;switch(s){case zt.None:this.switchLevel(e,i);break;case zt.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c==null?void 0:c.attrs["HDCP-LEVEL"];if(n.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=bp[bp.indexOf(u)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case zt.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let h=u;h--;)if(this.variantHasKey(c[h],l)){var o,a;this.log(`Banned key found in level ${h} (${c[h].bitrate}bps) or audio group "${(o=c[h].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${gt(l.keyId||[])}`),c[h].fragmentError++,c[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}const d=e.frag;if(this.hls.levels.length<u)n.resolved=!0;else if(d&&d.type!==X.MAIN){const h=d.decryptdata;h&&!l.matches(h)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===N.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Tp(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${i} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(i))}}}function lo(r){const e={action:pt.DoNothing,flags:zt.None};return r&&(e.resolved=!0),e}var nt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class QU{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let s=n.length;s--;){const i=n[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const a=s[i[o]];if((a==null?void 0:a.body.type)===t&&(!n||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,n,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===n&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,s=Li(n),i=this.fragments[s];if(!i||i.buffered&&n.gap)return;const o=!n.relurl;Object.keys(t).forEach(a=>{const l=n.elementaryStreams[a];if(!l)return;const c=t[a],u=o||l.partial===!0;i.range[a]=this.getBufferedTimes(n,e.part,u,c)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,n),ec(i)||this.removeParts(n.sn-1,n.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Uv(n,s=>s.fragment.sn>=e))}fragBuffered(e,t){const n=Li(e);let s=this.fragments[n];!s&&t&&(s=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,n,s){const i={time:[],partial:n},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<s.length;u++){const d=s.start(u)-this.bufferPadding,h=s.end(u)+this.bufferPadding;if(c>=d&&l<=h){i.time.push({startPTS:Math.max(o,s.start(u)),endPTS:Math.min(a,s.end(u))});break}else if(o<h&&a>d){const f=Math.max(o,s.start(u)),p=Math.min(a,s.end(u));p>f&&(i.partial=!0,i.time.push({startPTS:f,endPTS:p}))}else if(a<=d)break}return i}getPartialFragment(e){let t=null,n,s,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&ec(u)&&(s=u.body.start-a,i=u.body.end+a,e>=s&&e<=i&&(n=Math.min(e-s,i-e),o<=n&&(t=u.body,o=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ec(t))}getState(e){const t=Li(e),n=this.fragments[t];return n?n.buffered?ec(n)?nt.PARTIAL:nt.OK:nt.APPENDING:nt.NOT_LOADED}isTimeBuffered(e,t,n){let s,i;for(let o=0;o<n.length;o++){if(s=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,s=t.part?null:t,i=Li(n);this.fragments[i]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:s,timeRanges:i,type:o}=t;if(n.sn==="initSegment")return;const a=n.type;if(s){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(s)}this.timeRanges=i;const l=i[o];this.detectEvictedFragments(o,l,a,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Li(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let s=n.length;s--;){const i=t[n[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==n||s&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Li(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const s=e.sn;this.activePartLists[e.type]=Uv(n,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function ec(r){var e,t,n;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(n=r.range.audiovideo)!=null&&n.partial)}function Li(r){return`${r.type}_${r.level}_${r.sn}`}function Uv(r,e){return r.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var Rs={cbc:0,ctr:1};class XU{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Rs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Rs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function JU(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class ZU{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let s=0;s<4;s++)n[s]=t.getUint32(s*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,s=n[0],i=n[1],o=n[2],a=n[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let p=0,g=0,m=0;for(m=0;m<256;m++)m<128?f[m]=m<<1:f[m]=m<<1^283;for(m=0;m<256;m++){let y=g^g<<1^g<<2^g<<3^g<<4;y=y>>>8^y&255^99,e[p]=y,t[y]=p;const v=f[p],E=f[v],S=f[E];let T=f[y]*257^y*16843008;s[p]=T<<24|T>>>8,i[p]=T<<16|T>>>16,o[p]=T<<8|T>>>24,a[p]=T,T=S*16843009^E*65537^v*257^p*16843008,c[y]=T<<24|T>>>8,u[y]=T<<16|T>>>16,d[y]=T<<8|T>>>24,h[y]=T,p?(p=v^f[f[f[S^v]]],g^=f[f[g]]):p=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,s=0;for(;s<t.length&&n;)n=t[s]===this.key[s],s++;if(n)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,h=this.rcon,f=this.invSubMix,p=f[0],g=f[1],m=f[2],y=f[3];let v,E;for(a=0;a<o;a++){if(a<i){v=c[a]=t[a];continue}E=v,a%i===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=h[a/i|0]<<24):i>6&&a%i===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),c[a]=v=(c[a-i]^E)>>>0}for(l=0;l<o;l++)a=o-l,l&3?E=c[a]:E=c[a-4],l<4||a<=4?u[l]=E:u[l]=p[d[E>>>24]]^g[d[E>>>16&255]]^m[d[E>>>8&255]]^y[d[E&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],d=a[3],h=this.uint8ArrayToUint32Array_(n);let f=h[0],p=h[1],g=h[2],m=h[3];const y=new Int32Array(e),v=new Int32Array(y.length);let E,S,T,A,b,R,L,I,C,D,B,F,V,M;const K=this.networkToHostOrderSwap;for(;t<y.length;){for(C=K(y[t]),D=K(y[t+1]),B=K(y[t+2]),F=K(y[t+3]),b=C^i[0],R=F^i[1],L=B^i[2],I=D^i[3],V=4,M=1;M<s;M++)E=l[b>>>24]^c[R>>16&255]^u[L>>8&255]^d[I&255]^i[V],S=l[R>>>24]^c[L>>16&255]^u[I>>8&255]^d[b&255]^i[V+1],T=l[L>>>24]^c[I>>16&255]^u[b>>8&255]^d[R&255]^i[V+2],A=l[I>>>24]^c[b>>16&255]^u[R>>8&255]^d[L&255]^i[V+3],b=E,R=S,L=T,I=A,V=V+4;E=o[b>>>24]<<24^o[R>>16&255]<<16^o[L>>8&255]<<8^o[I&255]^i[V],S=o[R>>>24]<<24^o[L>>16&255]<<16^o[I>>8&255]<<8^o[b&255]^i[V+1],T=o[L>>>24]<<24^o[I>>16&255]<<16^o[b>>8&255]<<8^o[R&255]^i[V+2],A=o[I>>>24]<<24^o[b>>16&255]<<16^o[R>>8&255]<<8^o[L&255]^i[V+3],v[t]=K(E^f),v[t+1]=K(A^p),v[t+2]=K(T^g),v[t+3]=K(S^m),f=C,p=D,g=B,m=F,t=t+4}return v.buffer}}class eB{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=tB(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function tB(r){switch(r){case Rs.cbc:return"AES-CBC";case Rs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const rB=16;class _m{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?JU(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,s){return this.useSoftware?new Promise((i,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,s);const l=this.flush();l?i(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,s)}softwareDecrypt(e,t,n,s){const{currentIV:i,currentResult:o,remainderData:a}=this;if(s!==Rs.cbc||t.byteLength!==16)return we.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Sr(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(n=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new ZU),c.expandKey(t);const u=o;return this.currentResult=c.decrypt(l.buffer,0,n),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,n,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,s));this.key=t,this.fastAesKey=new eB(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new XU(this.subtle,new Uint8Array(n),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(we.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,n,s)))}onWebCryptoError(e,t,n,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%rB;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(we.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Bv=Math.pow(2,17);class nB{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new xn({type:ee.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){l(Gv(e));return}else e.gap=!1;const c=this.loader=i?new i(s):new o(s),u=jv(e);e.loader=c;const d=$v(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Bv};e.stats=c.stats;const f={onSuccess:(p,g,m,y)=>{this.resetLoader(e,c);let v=p.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),a({frag:e,part:null,payload:v,networkDetails:y})},onError:(p,g,m,y)=>{this.resetLoader(e,c),l(new xn({type:ee.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:xe({url:n,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:m,stats:y}))},onAbort:(p,g,m)=>{this.resetLoader(e,c),l(new xn({type:ee.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:p}))},onTimeout:(p,g,m)=>{this.resetLoader(e,c),l(new xn({type:ee.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:m,stats:p}))}};t&&(f.onProgress=(p,g,m,y)=>t({frag:e,part:null,payload:m,networkDetails:y})),c.load(u,h,f)})}loadPart(e,t,n){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Gv(e,t));return}const c=this.loader=i?new i(s):new o(s),u=jv(e,t);e.loader=c;const d=$v(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Bv};t.stats=c.stats,c.load(u,h,{onSuccess:(f,p,g,m)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:f.data,networkDetails:m};n(y),a(y)},onError:(f,p,g,m)=>{this.resetLoader(e,c),l(new xn({type:ee.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:xe({url:u.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:g,stats:m}))},onAbort:(f,p,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new xn({type:ee.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:f}))},onTimeout:(f,p,g)=>{this.resetLoader(e,c),l(new xn({type:ee.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:g,stats:f}))}})})}updateStatsFromPart(e,t){const n=e.stats,s=t.stats,i=s.total;if(n.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/i),l),d=(l-c)*Math.round(n.loaded/c);n.total=n.loaded+d}else n.total=Math.max(n.loaded,n.total);const o=n.loading,a=s.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function jv(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(Y(s)&&Y(i)){var o;let a=s,l=i;if(r.sn==="initSegment"&&sB((o=r.decryptdata)==null?void 0:o.method)){const c=i-s;c%16&&(l=i+(16-c%16)),s!==0&&(n.resetIV=!0,a=s-16)}n.rangeStart=a,n.rangeEnd=l}return n}function Gv(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:ee.MEDIA_ERROR,details:N.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new xn(n)}function sB(r){return r==="AES-128"||r==="AES-256"}class xn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class eA extends xr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Am{constructor(e,t,n,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=tc(),this.buffering={audio:tc(),video:tc(),audiovideo:tc()},this.level=e,this.sn=t,this.id=n,this.size=s,this.part=i,this.partial=o}}function tc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Vv={length:0,start:()=>0,end:()=>0};class le{static isBuffered(e,t){if(e){const n=le.getBuffered(e);for(let s=n.length;s--;)if(t>=n.start(s)&&t<=n.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=le.getBuffered(e);return le.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const s=le.bufferedRanges(e);if(s.length)return le.bufferedInfo(s,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((u,d)=>u.start-d.start||d.end-u.end);let s=-1,i=[];if(n)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(s=u);const d=i.length;if(d){const h=i[d-1].end;e[u].start-h<n?e[u].end>h&&(i[d-1].end=e[u].end):i.push(e[u])}else i.push(e[u])}else i=e;let o=0,a,l=t,c=t;for(let u=0;u<i.length;u++){const d=i[u].start,h=i[u].end;if(s===-1&&t>=d&&t<=h&&(s=u),t+n>=d&&t<h)l=d,c=h,o=c-t;else if(t+n<d){a=d;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Vv}catch(t){return we.log("failed to get media.buffered",t),Vv}}}const tA=/\{\$([a-zA-Z0-9-_]+)\}/g;function Kv(r){return tA.test(r)}function Ap(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(tA,n=>{const s=n.substring(2,n.length-1),i=t==null?void 0:t[s];return i===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),n):i})}return e}function Hv(r,e,t){let n=r.variableList;n||(r.variableList=n={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):n[s]=i||""}function iB(r,e,t){const n=e.IMPORT;if(t&&n in t){let s=r.variableList;s||(r.variableList=s={}),s[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const oB=/^(\d+)x(\d+)$/,Wv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class $e{constructor(e,t){typeof e=="string"&&(e=$e.parseAttrList(e,t)),_e(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)n[s]=parseInt(t.slice(s*2,s*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=oB.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const s={},i='"';for(Wv.lastIndex=0;(n=Wv.exec(e))!==null;){const o=n[1].trim();let a=n[2];const l=a.indexOf(i)===0&&a.lastIndexOf(i)===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=Ap(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":we.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=a}return s}}const aB="com.apple.hls.interstitial";function lB(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function cB(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class rA{constructor(e,t,n=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:n,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){we.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=_e(new $e({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Y(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(we.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Y(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===aB}get isValid(){return!!this.id&&!this._badValueForSameId&&Y(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const uB=10;class dB{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?Y(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||uB}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Lu(r,e){return r.length===e.length?!r.some((t,n)=>t!==e[n]):!1}function zv(r,e){return!r&&!e?!0:!r||!e?!1:Lu(r,e)}function co(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function Rm(r){switch(r){case"AES-128":case"AES-256":return Rs.cbc;case"AES-256-CTR":return Rs.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function Im(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Rp(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function hB(r){const e=Rp(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function nA(r){const e=function(n,s,i){const o=n[s];n[s]=n[i],n[i]=o};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function sA(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),s=n[n.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(n.splice(-1,1),t=Im(o)):t=hB(o)}}return t}const Cu=typeof self<"u"?self:void 0;var je={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},mt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Pc(r){switch(r){case mt.FAIRPLAY:return je.FAIRPLAY;case mt.PLAYREADY:return je.PLAYREADY;case mt.WIDEVINE:return je.WIDEVINE;case mt.CLEARKEY:return je.CLEARKEY}}function Ch(r){switch(r){case je.FAIRPLAY:return mt.FAIRPLAY;case je.PLAYREADY:return mt.PLAYREADY;case je.WIDEVINE:return mt.WIDEVINE;case je.CLEARKEY:return mt.CLEARKEY}}function na(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[je.FAIRPLAY,je.WIDEVINE,je.PLAYREADY,je.CLEARKEY].filter(s=>!!e[s]):[];return!n[je.WIDEVINE]&&t&&n.push(je.WIDEVINE),n}const iA=function(r){return Cu!=null&&(r=Cu.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function fB(r,e,t,n){let s;switch(r){case je.FAIRPLAY:s=["cenc","sinf"];break;case je.WIDEVINE:case je.PLAYREADY:s=["cenc"];break;case je.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return pB(s,e,t,n)}function pB(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function gB(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function oA(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=Im(a).subarray(0,16);return nA(l),l}}return null}let Ci={};class xs{static clearKeyUriToKeyIdMap(){Ci={}}static setKeyIdForUri(e,t){Ci[e]=t}static addKeyIdForUri(e){const t=Object.keys(Ci).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),Ci[e]=n,n}constructor(e,t,n,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!co(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(O_(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Lu(e.keyFormatVersions,this.keyFormatVersions)&&zv(e.iv,this.iv)&&zv(e.keyId,this.keyId)}isSupported(){if(this.method){if(co(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case mt.FAIRPLAY:case mt.WIDEVINE:case mt.PLAYREADY:case mt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(co(this.method)){let i=this.iv;return i||(typeof e!="number"&&(we.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=yB(e)),new xs(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Ci[this.uri];if(i&&!Lu(this.keyId,i)&&xs.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=sA(this.uri);if(n)switch(this.keyFormat){case mt.WIDEVINE:if(this.pssh=n,!this.keyId){const i=SU(n.buffer);if(i.length){var s;const o=i[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=qv(t));break;case mt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=EU(i,null,n),this.keyId=oA(n);break}default:{let i=n.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=mB(t),i||(i=qv(t),i||(i=Ci[this.uri])),i&&(this.keyId=i,xs.setKeyIdForUri(this.uri,i))}return this}}function mB(r){const e=r==null?void 0:r[mt.WIDEVINE];return e?e.keyId:null}function qv(r){const e=r==null?void 0:r[mt.PLAYREADY];if(e){const t=sA(e.uri);if(t)return oA(t)}return null}function yB(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const Yv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Qv=/#EXT-X-MEDIA:(.*)/g,vB=/^#EXT(?:INF|-X-TARGETDURATION):/m,kh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),EB=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class sn{static findGroup(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(s.id===t)return s}}static resolve(e,t){return Em.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return vB.test(e)}static parseMasterPlaylist(e,t){const n=Kv(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},i=[];if(Yv.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=Yv.exec(e))!=null;)if(o[1]){var a;const c=new $e(o[1],s),u=Ap(s,o[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:sn.resolve(u,t)},h=c.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),Zv(c.CODECS,d);const f=c["SUPPLEMENTAL-CODECS"];f&&(d.supplemental={},Zv(f,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||i.push(d),s.levels.push(d)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const d=new $e(u,s),h=d["DATA-ID"];h&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[h]=d);break}case"SESSION-KEY":{const d=Xv(u,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):we.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const d=new $e(u,s);Hv(s,d,t)}break}case"CONTENT-STEERING":{const d=new $e(u,s);s.contentSteering={uri:sn.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Jv(u);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,n){let s;const i={},o=n.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Qv.lastIndex=0;(s=Qv.exec(e))!==null;){const c=new $e(s[1],n),u=c.TYPE;if(u){const d=a[u],h=i[u]||[];i[u]=h;const f=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],g=c.CHANNELS,m=c.CHARACTERISTICS,y=c["INSTREAM-ID"],v={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||f||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:f,url:c.URI?sn.resolve(c.URI,t):""};if(p&&(v.assocLang=p),g&&(v.channels=g),m&&(v.characteristics=m),y&&(v.instreamId=y),d!=null&&d.length){const E=sn.findGroup(d,v.groupId)||d[0];eE(v,E,"audioCodec"),eE(v,E,"textCodec")}h.push(v)}}return i}static parseLevelPlaylist(e,t,n,s,i,o){var a;const l={url:t},c=new dB(t),u=c.fragments,d=[];let h=null,f=0,p=0,g=0,m=0,y=0,v=null,E=new Rh(s,l),S,T,A,b=-1,R=!1,L=null,I;if(kh.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Kv(e),((a=kh.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(S=kh.exec(e))!==null;){R&&(R=!1,E=new Rh(s,l),E.playlistOffset=g,E.setStart(g),E.sn=f,E.cc=m,y&&(E.bitrate=y),E.level=n,h&&(E.initSegment=h,h.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),L&&(E.setByteRange(L),L=null)));const F=S[1];if(F){E.duration=parseFloat(F);const V=(" "+S[2]).slice(1);E.title=V||null,E.tagList.push(V?["INF",F,V]:["INF",F])}else if(S[3]){if(Y(E.duration)){E.playlistOffset=g,E.setStart(g),A&&rE(E,A,c),E.sn=f,E.level=n,E.cc=m,u.push(E);const V=(" "+S[3]).slice(1);E.relurl=Ap(c,V),Ip(E,v,d),v=E,g+=E.duration,f++,p=0,R=!0}}else{if(S=S[0].match(EB),!S){we.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<S.length&&S[T]===void 0;T++);const V=(" "+S[T]).slice(1),M=(" "+S[T+1]).slice(1),K=S[T+2]?(" "+S[T+2]).slice(1):null;switch(V){case"BYTERANGE":v?E.setByteRange(M,v):E.setByteRange(M);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=M,E.tagList.push(["PROGRAM-DATE-TIME",M]),b===-1&&(b=u.length);break;case"PLAYLIST-TYPE":c.type&&mn(c,V,S),c.type=M.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?mn(c,V,S):u.length>0&&nE(c,V,S),f=c.startSN=parseInt(M);break;case"SKIP":{c.skippedSegments&&mn(c,V,S);const P=new $e(M,c),k=P.decimalInteger("SKIPPED-SEGMENTS");if(Y(k)){c.skippedSegments+=k;for(let U=k;U--;)u.push(null);f+=k}const j=P.enumeratedString("RECENTLY-REMOVED-DATERANGES");j&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(j.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&mn(c,V,S),c.targetduration=Math.max(parseInt(M),1);break;case"VERSION":c.version!==null&&mn(c,V,S),c.version=parseInt(M);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||mn(c,V,S),c.live=!1;break;case"#":(M||K)&&E.tagList.push(K?[M,K]:[M]);break;case"DISCONTINUITY":m++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([V]);break;case"BITRATE":E.tagList.push([V,M]),y=parseInt(M)*1e3,Y(y)?E.bitrate=y:y=0;break;case"DATERANGE":{const P=new $e(M,c),k=new rA(P,c.dateRanges[P.ID],c.dateRangeTagCount);c.dateRangeTagCount++,k.isValid||c.skippedSegments?c.dateRanges[k.id]=k:we.warn(`Ignoring invalid DATERANGE tag: "${M}"`),E.tagList.push(["EXT-X-DATERANGE",M]);break}case"DEFINE":{{const P=new $e(M,c);"IMPORT"in P?iB(c,P,o):Hv(c,P,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?mn(c,V,S):u.length>0&&nE(c,V,S),c.startCC=m=parseInt(M);break;case"KEY":{const P=Xv(M,t,c);if(P.isSupported()){if(P.method==="NONE"){A=void 0;break}A||(A={});const k=A[P.keyFormat];k!=null&&k.matches(P)||(k&&(A=_e({},A)),A[P.keyFormat]=P)}else we.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${M}"`);break}case"START":c.startTimeOffset=Jv(M);break;case"MAP":{const P=new $e(M,c);if(E.duration){const k=new Rh(s,l);tE(k,P,n,A),h=k,E.initSegment=h,h.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime)}else{const k=E.byteRangeEndOffset;if(k){const j=E.byteRangeStartOffset;L=`${k-j}@${j}`}else L=null;tE(E,P,n,A),h=E,R=!0}h.cc=m;break}case"SERVER-CONTROL":{I&&mn(c,V,S),I=new $e(M),c.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),c.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&mn(c,V,S);const P=new $e(M);c.partTarget=P.decimalFloatingPoint("PART-TARGET");break}case"PART":{let P=c.partList;P||(P=c.partList=[]);const k=p>0?P[P.length-1]:void 0,j=p++,U=new $e(M,c),$=new iU(U,E,l,j,k);P.push($),E.duration+=$.duration;break}case"PRELOAD-HINT":{const P=new $e(M,c);c.preloadHint=P;break}case"RENDITION-REPORT":{const P=new $e(M,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(P);break}default:we.warn(`line parsed but not handled: ${S}`);break}}}v&&!v.relurl?(u.pop(),g-=v.duration,c.partList&&(c.fragmentHint=v)):c.partList&&(Ip(E,v,d),E.cc=m,c.fragmentHint=E,A&&rE(E,A,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const C=u.length,D=u[0],B=u[C-1];if(g+=c.skippedSegments*c.targetduration,g>0&&C&&B){c.averagetargetduration=g/C;const F=B.sn;c.endSN=F!=="initSegment"?F:0,c.live||(B.endList=!0),b>0&&(xB(u,b),D&&d.unshift(D))}return c.fragmentHint&&(g+=c.fragmentHint.duration),c.totalduration=g,d.length&&c.dateRangeTagCount&&D&&aA(d,c),c.endCC=m,c}}function aA(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];r.push(a),t++}else return;const n=r[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let a=i.length;a--;){const l=e.dateRanges[i[a]],c=l.startDate.getTime();l.tagAnchor=n.ref;for(let u=t;u--;){var o;if(((o=r[u])==null?void 0:o.sn)<e.startSN)break;const d=SB(e,c,r,u,s);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function SB(r,e,t,n,s){const i=t[n];if(i){const a=i.programDateTime;if(e>=a||n===0){var o;const l=(((o=t[n+1])==null?void 0:o.start)||s)-i.start;if(e<=a+l*1e3){const c=t[n].sn-r.startSN;if(c<0)return-1;const u=r.fragments;if(u.length>t.length){const h=(t[n+1]||u[u.length-1]).sn-r.startSN;for(let f=h;f>c;f--){const p=u[f].programDateTime;if(e>=p&&e<p+u[f].duration*1e3)return f}}return c}}}return-1}function Xv(r,e,t){var n,s;const i=new $e(r,t),o=(n=i.METHOD)!=null?n:"",a=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=(s=i.KEYFORMAT)!=null?s:"identity";a&&i.IV&&!l&&we.error(`Invalid IV: ${i.IV}`);const d=a?sn.resolve(a,e):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new xs(o,d,u,h,l,i.KEYID)}function Jv(r){const t=new $e(r).decimalFloatingPoint("TIME-OFFSET");return Y(t)?t:null}function Zv(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const s=t.filter(i=>wm(i,n));s.length&&(e[`${n}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function eE(r,e,t){const n=e[t];n&&(r[t]=n)}function xB(r,e){let t=r[e];for(let n=e;n--;){const s=r[n];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Ip(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function tE(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function rE(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&n.push(r)}function mn(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function nE(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Ph(r,e){const t=e.startPTS;if(Y(t)){let n=0,s;e.sn>r.sn?(n=t-r.start,s=r):(n=r.start-t,s=e),s.duration!==n&&s.setDuration(n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function lA(r,e,t,n,s,i,o){n-t<=0&&(o.warn("Fragment should have a positive duration",e),n=t+e.duration,i=s+e.duration);let l=t,c=n;const u=e.startPTS,d=e.endPTS;if(Y(u)){const y=Math.abs(u-t);r&&y>r.totalduration?o.warn(`media timestamps and playlist times differ by ${y}s for level ${e.level} ${r.url}`):Y(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,l=Math.max(t,u),t=Math.min(t,u),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,c=Math.min(n,d),n=Math.max(n,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=n,e.minEndPTS=c,e.endDTS=i;const f=e.sn;if(!r||f<r.startSN||f>r.endSN)return 0;let p;const g=f-r.startSN,m=r.fragments;for(m[g]=e,p=g;p>0;p--)Ph(m[p],m[p-1]);for(p=g;p<m.length-1;p++)Ph(m[p],m[p+1]);return r.fragmentHint&&Ph(m[m.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,h}function wB(r,e,t){if(r===e)return;let n=null;const s=r.fragments;for(let u=s.length-1;u>=0;u--){const d=s[u].initSegment;if(d){n=d;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let i;_B(r,e,(u,d,h,f)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==u.cc){const p=u.cc-d.cc;for(let g=h;g<f.length;g++)f[g].cc+=p;e.endCC=f[f.length-1].cc}Y(u.startPTS)&&Y(u.endPTS)&&(d.setStart(d.startPTS=u.startPTS),d.startDTS=u.startDTS,d.maxStartPTS=u.maxStartPTS,d.endPTS=u.endPTS,d.endDTS=u.endDTS,d.minEndPTS=u.minEndPTS,d.setDuration(u.endPTS-u.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(d.elementaryStreams=u.elementaryStreams),d.loader=u.loader,u.hasStats&&(d.stats=u.stats),u.initSegment&&(d.initSegment=u.initSegment,n=u.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(n&&a.forEach(u=>{var d;u&&(!u.initSegment||u.initSegment.relurl===((d=n)==null?void 0:d.relurl))&&(u.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=TB(r.dateRanges,e,t));const u=r.fragments.filter(d=>d.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<a.length;d++)a[d].programDateTime===null&&Ip(a[d],a[d-1],u);aA(u,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const u=dA(r,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:o[0].cc}bB(r.partList,e.partList,(u,d)=>{d.elementaryStreams=u.elementaryStreams,d.stats=u.stats}),i?lA(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):cA(r,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function TB(r,e,t){const{dateRanges:n,recentlyRemovedDateranges:s}=e,i=_e({},r);s&&s.forEach(l=>{delete i[l]});const a=Object.keys(i).length;return a?(Object.keys(n).forEach(l=>{const c=i[l],u=new rA(n[l].attr,c);u.isValid?(i[l]=u,c||(u.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ie(n[l].attr)}"`)}),i):n}function bB(r,e,t){if(r&&e){let n=0;for(let s=0,i=r.length;s<=i;s++){const o=r[s],a=e[s+n];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):n--}}}function _B(r,e,t){const n=e.skippedSegments,s=Math.max(r.startSN,e.startSN)-e.startSN,i=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,o=e.startSN-r.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let c=s;c<=i;c++){const u=l[o+c];let d=a[c];if(n&&!d&&u&&(d=e.fragments[c]=u),u&&d){t(u,d,c,a);const h=u.relurl,f=d.relurl;if(h&&AB(h,f)){e.playlistParsingError=sE(`media sequence mismatch ${d.sn}:`,r,e,u,d);return}else if(u.cc!==d.cc){e.playlistParsingError=sE(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,r,e,u,d);return}}}}function sE(r,e,t,n,s){return new Error(`${r} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function cA(r,e,t=!0){const n=e.startSN+e.skippedSegments-r.startSN,s=r.fragments,i=n>=0;let o=0;if(i&&n<s.length)o=s[n].start;else if(i&&e.startSN===r.endSN+1)o=r.fragmentEnd;else if(i&&t)o=r.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=r.fragmentStart;else return;Lp(e,o)}function Lp(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function uA(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const i=n[n.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function dA(r,e,t){if(!r)return null;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&t&&t.sn===e?t:null}function iE(r,e,t){return r?hA(r.partList,e,t):null}function hA(r,e,t){if(r)for(let n=r.length;n--;){const s=r[n];if(s.index===t&&s.fragment.sn===e)return s}return null}function fA(r){r.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function AB(r,e){return r!==e&&e?oE(r)!==oE(e):!1}function oE(r){return r.replace(/\?[^?]*$/,"")}function ya(r,e){for(let n=0,s=r.length;n<s;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function RB(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function aE(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function pA(r,e){const t=e.fragments;for(let n=0,s=t.length;n<s;n++)aE(t[n],r);e.fragmentHint&&aE(e.fragmentHint,r),e.alignedSliding=!0}function IB(r,e){r&&(gA(e,r),e.alignedSliding||ku(e,r),!e.alignedSliding&&!e.skippedSegments&&cA(r,e,!1))}function gA(r,e){if(!RB(e,r))return;const t=Math.min(e.endCC,r.endCC),n=ya(e.fragments,t),s=ya(r.fragments,t);if(!n||!s)return;we.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=n.start-s.start;pA(i,r)}function ku(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let s,i;const o=Math.min(e.endCC,r.endCC);e.startCC<o&&r.startCC<o&&(s=ya(n,o),i=ya(t,o)),(!s||!i)&&(s=n[Math.floor(n.length/2)],i=ya(t,s.cc)||t[Math.floor(t.length/2)]);const a=s.programDateTime,l=i.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(i.start-s.start);pA(c,r)}function Lt(r,e,t){Bt(r,e,t),r.addEventListener(e,t)}function Bt(r,e,t){r.removeEventListener(e,t)}const LB={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},G={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Lm extends eA{constructor(e,t,n,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=G.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,h=le.bufferInfo(c||l,d,o.maxBufferHole),f=!h.len;if(this.log(`Media seeking to ${Y(d)?d.toFixed(3):d}, state: ${u}, ${f?"out of":"in"} buffer`),this.state===G.ENDED)this.resetLoadingState();else if(a){const p=o.maxFragLookUpTolerance,g=a.start-p,m=a.start+a.duration+p;if(f||m<h.start||g>h.end){const y=d>m;(d<g||y)&&(y&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const p=this.lastCurrentTime;if(d>p&&(this.lastCurrentTime=d),!this.loadingParts){const g=Math.max(h.end,d),m=this.shouldLoadParts(this.getLevelDetails(),g);m&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${g.toFixed(2)}`),this.loadingParts=m)}}this.hls.hasEnoughToStart||(this.log(`Setting ${f?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,f&&(this.startPosition=d)),f&&this.state===G.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new nB(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new _m(e.config)}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===G.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=G.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,s=this.config.timelineOffset||0;if(n<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=le.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return le.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;Lt(n,"seeking",this.onMediaSeeking),Lt(n,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===G.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Bt(s,"seeking",this.onMediaSeeking),Bt(s,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=G.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,n,s).then(i=>{if(!i)return;const o=this.state,a=i.frag;if(this.fragContextChanged(a)){(o===G.FRAG_LOADING||!this.fragCurrent&&o===G.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=G.IDLE);return}"payload"in i&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(x.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===G.STOPPED||this.state===G.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===nt.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===nt.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:n};this.hls.trigger(x.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:s}=this,{frag:i,payload:o}=n,a=i.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&co(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,Rm(a.method)).catch(c=>{throw s.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const u=self.performance.now();return s.trigger(x.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:l,tdecrypt:u}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===G.STOPPED||this.state===G.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==G.STOPPED&&(this.state=G.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,s;const i=e.tracks;if(i&&!t.encrypted&&((n=i.audio)!=null&&n.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(x.ERROR,{type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?LB.toString(le.getBuffered(n)):"(detached)"})`),Qe(e)){var s;if(e.type!==X.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=G.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=G.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new Am(n.level,n.sn,n.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=G.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(x.KEY_LOADED,h),this.state===G.KEY_LOADING&&(this.state=G.IDLE),h}),this.hls.trigger(x.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Qe(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=h)}if(n=Math.max(e.start,n||0),this.loadingParts&&Qe(e)){const h=o.partList;if(h&&s){n>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const f=this.getNextPart(h,e,n);if(f>-1){const p=h[f];e=this.fragCurrent=p.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${p.index} (${f}/${h.length-1}) of ${this.fragInfo(e,!1,p)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=G.FRAG_LOADING;let g;return a?g=a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,p,t,s)).catch(m=>this.handleFragLoadError(m)):g=this.doFragPartsLoad(e,p,t,s).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(x.FRAG_LOADING,{frag:e,part:p,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(h,n))return Promise.resolve(null)}}if(Qe(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),Y(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=G.FRAG_LOADING;const u=this.config.progressive&&e.type!==X.SUBTITLE;let d;return u&&a?d=a.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,s)).catch(h=>this.handleFragLoadError(h)):d=Promise.all([this.fragmentLoader.load(e,u?s:void 0),a]).then(([h])=>(!u&&s&&s(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(x.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,n,s){return new Promise((i,o)=>{var a;const l=[],c=(a=n.details)==null?void 0:a.partList,u=d=>{this.fragmentLoader.loadPart(e,d,s).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(x.FRAG_LOADED,h);const p=iE(n.details,e.sn,d.index+1)||hA(c,e.sn,d.index+1);if(p)u(p);else return i({frag:e,part:f,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===N.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ee.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(x.ERROR,t)}else this.hls.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==G.PARSING){!this.fragCurrent&&this.state!==G.STOPPED&&this.state!==G.ERROR&&(this.state=G.IDLE);return}const{frag:n,part:s,level:i}=t,o=self.performance.now();n.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const i=e.partList[0];if(i.fragment.type===X.SUBTITLE)return!1;const o=i.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const a=t[s],l=a.details,c=o>-1?iE(l,i,o):null,u=c?c.fragment:dA(l,i,n);return u?(n&&n!==u&&(u.stats=n.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(e,t,n,s,i){if(this.state!==G.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=Sr(o,a)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,d={type:e.type,frag:t,part:n,chunkMeta:s,offset:u,parent:t.type,data:l};if(this.hls.trigger(x.BUFFER_APPENDING,d),e.dropped&&e.independent&&!n){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!le.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,s=le.bufferInfo(t,n,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,s.end-o),n+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const s=this.getLoadPosition();if(!Y(s))return null;const o=this.lastCurrentTime>s||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,n,s){const i=le.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,n);if(o&&(i.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(i.nextStart,o.end)-t,s);return le.bufferInfo(e,t,a)}}return i}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,s=Math.max(Math.min(e-t,n.maxBufferLength),t),i=Math.max(e-t*3,n.maxMaxBufferLength/2,s);return i>=s?(n.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=X.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,s=n.length;if(!s)return null;const{config:i}=this,o=n[0].start,a=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,p=l?(h!==-1&&h>=o?h:f)||l.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=o&&(l=n[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const d=l.sn-t.startSN;u=this.filterReplacedPrimary(n[d+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===nt.OK||n===nt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&n.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,s,0);if(a!==null&&n.len+a.len>=i){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(lE(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(lE(this.config)&&e.type!==X.SUBTITLE){const n=this.hls.interstitialsManager,s=n==null?void 0:n.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=n==null?void 0:n.playerQueue;if(i)for(let o=i.length;o--;){const a=i[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let s=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,s>-1&&n<c.start)break;const u=c.loaded;u?s=-1:(i||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),s=a),i=u}return s}loadedEndOfParts(e,t){let n;for(let s=e.length;s--;){if(n=e[s],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let s=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),s=HU(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];n.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=X_(e,n.cc,n.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,n){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=n;const{fragmentHint:l}=n,{maxFragLookUpTolerance:c}=s,u=n.partList,d=!!(this.loadingParts&&u!=null&&u.length&&l);d&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let h;if(e<t){var f;const g=e<this.lastCurrentTime||e>t-c||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:c;h=ui(i,o,e,g)}else h=o[o.length-1];if(h){const p=h.sn-n.startSN,g=this.fragmentTracker.getState(h);if((g===nt.OK||g===nt.PARTIAL&&h.gap)&&(i=h),i&&h.sn===i.sn&&(!d||u[0].fragment.sn>h.sn||!n.live)&&h.level===i.level){const y=o[p+1];h.sn<a&&this.fragmentTracker.getState(y)!==nt.OK?h=y:h=null}}return h}alignPlaylists(e,t,n){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,a=e.alignedSliding&&Y(i);if(o||!a&&!i){IB(n,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const s=this.timelineOffset;if(n===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&Y(o)?(n=t+o,o<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+s}this.nextLoadPosition=n+s}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Qe(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==G.FRAG_LOADING_WAITING_RETRY)&&(this.state=G.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===N.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const a=t.errorAction;if(!a){this.state=G.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:d}=a,h=!!d,f=h&&l===pt.RetryRequest,p=h&&!a.resolved&&c===zt.MoveAllAlternatesMatchingHost,g=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!f&&p&&Qe(s)&&!s.endList&&g&&!Z_(t))this.resetFragmentErrors(e),this.treatAsGap(s),a.resolved=!0;else if((f||p)&&u<d.maxNumRetry){var m;const y=_p((m=t.response)==null?void 0:m.code),v=bm(d,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+v,this.state=G.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,y){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${u+1}/${d.maxNumRetry} in ${v}ms`)}else if(d)if(this.resetFragmentErrors(e),u<d.maxNumRetry)!o&&l!==pt.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===pt.SendAlternateToPenaltyBox?this.state=G.WAITING_LEVEL:this.state=G.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!_p(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=G.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===G.PARSING||this.state===G.PARSED){const t=e.frag,n=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,n),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===X.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==G.STOPPED&&(this.state=G.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const s=le.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,n),this.state===G.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==G.STOPPED&&(this.state=G.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,s){const i=n.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const h=s?0:lA(i,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:i,level:n,drift:h,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var a;const l=((a=this.transmuxer)==null?void 0:a.error)===null;if((n.fragmentError===0||l&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),l){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=G.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(x.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===X.MAIN?"level":"track"}fragInfo(e,t=!0,n){var s,i;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((s=t&&!n?e.startPTS:(n||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!n?e.endPTS:(n||e).end)!=null?i:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function lE(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class mA{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=CB(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function CB(r,e){const t=new Uint8Array(e);let n=0;for(let s=0;s<r.length;s++){const i=r[s];t.set(i,n),n+=i.length}return t}var Dh={exports:{}},cE;function kB(){return cE||(cE=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||l,h),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},a.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,f,p){var g=t?t+c:c;if(!this._events[g])return!1;var m=this._events[g],y=arguments.length,v,E;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,d),!0;case 4:return m.fn.call(m.context,u,d,h),!0;case 5:return m.fn.call(m.context,u,d,h,f),!0;case 6:return m.fn.call(m.context,u,d,h,f,p),!0}for(E=1,v=new Array(y-1);E<y;E++)v[E-1]=arguments[E];m.fn.apply(m.context,v)}else{var S=m.length,T;for(E=0;E<S;E++)switch(m[E].once&&this.removeListener(c,m[E].fn,void 0,!0),y){case 1:m[E].fn.call(m[E].context);break;case 2:m[E].fn.call(m[E].context,u);break;case 3:m[E].fn.call(m[E].context,u,d);break;case 4:m[E].fn.call(m[E].context,u,d,h);break;default:if(!v)for(T=1,v=new Array(y-1);T<y;T++)v[T-1]=arguments[T];m[E].fn.apply(m[E].context,v)}}return!0},a.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&o(this,f);else{for(var g=0,m=[],y=p.length;g<y;g++)(p[g].fn!==u||h&&!p[g].once||d&&p[g].context!==d)&&m.push(p[g]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a}(Dh)),Dh.exports}var PB=kB(),Cm=nU(PB);const Za="1.6.15",ko={};function DB(){return typeof __HLS_WORKER_BUNDLE__=="function"}function OB(){const r=ko[Za];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return ko[Za]=s,s}function NB(r){const e=ko[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return ko[r]=s,s}function MB(r){const e=ko[r||Za];if(e&&e.clientCount--===1){const{worker:n,objectURL:s}=e;delete ko[r||Za],s&&self.URL.revokeObjectURL(s),n.terminate()}}function yA(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function km(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function wd(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function el(r,e){const t=e;let n=0;for(;km(r,e);){n+=10;const s=wd(r,e+6);n+=s,yA(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)}function FB(r,e,t,n){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const f=new Error(`invalid ADTS sampling index:${o}`);r.emit(x.ERROR,x.ERROR,{type:ee.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const a=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+a,u=s[o];let d=o;(a===5||a===29)&&(d-=3);const h=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return we.log(`manifest codec:${n}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:h,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:n}}function vA(r,e){return r[e]===255&&(r[e+1]&246)===240}function EA(r,e){return r[e+1]&1?7:9}function Pm(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function $B(r,e){return e+5<r.length}function Pu(r,e){return e+1<r.length&&vA(r,e)}function UB(r,e){return $B(r,e)&&vA(r,e)&&Pm(r,e)<=r.length-e}function BB(r,e){if(Pu(r,e)){const t=EA(r,e);if(e+t>=r.length)return!1;const n=Pm(r,e);if(n<=t)return!1;const s=e+n;return s===r.length||Pu(r,s)}return!1}function SA(r,e,t,n,s){if(!r.samplerate){const i=FB(e,t,n,s);if(!i)return;_e(r,i)}}function xA(r){return 1024*9e4/r}function jB(r,e){const t=EA(r,e);if(e+t<=r.length){const n=Pm(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function wA(r,e,t,n,s){const i=xA(r.samplerate),o=n+s*i,a=jB(e,t);let l;if(a){const{frameLength:d,headerLength:h}=a,f=h+d,p=Math.max(0,t+f-e.length);p?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const g={unit:l,pts:o};return p||r.samples.push(g),{sample:g,length:f,missing:p}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function GB(r,e){return km(r,e)&&wd(r,e+6)+10<=r.length-e}function VB(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function Oh(r,e=0,t=1/0){return KB(r,e,t,Uint8Array)}function KB(r,e,t,n){const s=HB(r);let i=1;"BYTES_PER_ELEMENT"in n&&(i=n.BYTES_PER_ELEMENT);const o=WB(r)?r.byteOffset:0,a=(o+r.byteLength)/i,l=(o+e)/i,c=Math.floor(Math.max(0,Math.min(l,a))),u=Math.floor(Math.min(c+Math.max(t,0),a));return new n(s,c,u-c)}function HB(r){return r instanceof ArrayBuffer?r:r.buffer}function WB(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function zB(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=r.data.subarray(1).indexOf(0);if(n===-1)return;const s=sr(Oh(r.data,1,n)),i=r.data[2+n],o=r.data.subarray(3+n).indexOf(0);if(o===-1)return;const a=sr(Oh(r.data,3+n,o));let l;return s==="-->"?l=sr(Oh(r.data,4+n+o)):l=VB(r.data.subarray(4+n+o)),e.mimeType=s,e.pictureType=i,e.description=a,e.data=l,e}function qB(r){if(r.size<2)return;const e=sr(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function YB(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=sr(r.data.subarray(t),!0);t+=n.length+1;const s=sr(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=sr(r.data.subarray(1));return{key:r.type,info:"",data:e}}function QB(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=sr(r.data.subarray(t),!0);t+=n.length+1;const s=sr(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=sr(r.data);return{key:r.type,info:"",data:e}}function XB(r){return r.type==="PRIV"?qB(r):r.type[0]==="W"?QB(r):r.type==="APIC"?zB(r):YB(r)}function JB(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=wd(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}}const rc=10,ZB=10;function TA(r){let e=0;const t=[];for(;km(r,e);){const n=wd(r,e+6);r[e+5]>>6&1&&(e+=rc),e+=rc;const s=e+n;for(;e+ZB<s;){const i=JB(r.subarray(e)),o=XB(i);o&&t.push(o),e+=i.size+rc}yA(r,e)&&(e+=rc)}return t}function bA(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function ej(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function Dm(r){const e=TA(r);for(let t=0;t<e.length;t++){const n=e[t];if(bA(n))return ej(n)}}let Xt=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function Zr(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Om{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Sr(this.cachedData,e),this.cachedData=null);let n=el(e,0),s=n?n.length:0,i;const o=this._audioTrack,a=this._id3Track,l=n?Dm(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Y(l))&&(this.basePTS=tj(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Xt.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const u=this.appendFrame(o,e,s);u?(this.frameIndex++,this.lastPTS=u.sample.pts,s+=u.length,i=s):s=c}else GB(e,s)?(n=el(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Xt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=n.length,i=s):s++;if(s===c&&i!==c){const u=e.slice(i);this.cachedData?this.cachedData=Sr(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:Zr(),id3Track:a,textTrack:Zr()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Zr(),id3Track:this._id3Track,textTrack:Zr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const tj=(r,e,t)=>{if(Y(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let nc=null;const rj=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],nj=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],sj=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ij=[0,1,1,4];function _A(r,e,t,n,s){if(t+24>e.length)return;const i=AA(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=n+s*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return r.config=[],r.channelCount=i.channelCount,r.samplerate=i.sampleRate,r.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function AA(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,s=r[e+2]>>4&15,i=r[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=r[e+2]>>1&1,a=r[e+3]>>6,l=t===3?3-n:n===3?3:4,c=rj[l*14+s-1]*1e3,d=nj[(t===3?0:t===2?1:2)*3+i],h=a===3?1:2,f=sj[t][n],p=ij[n],g=f*8*p,m=Math.floor(f*c/d+o)*p;if(nc===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);nc=E?parseInt(E[1]):0}return!!nc&&nc<=87&&n===2&&c>=224e3&&a===0&&(r[e+3]=r[e+3]|128),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:g}}}function Nm(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function RA(r,e){return e+1<r.length&&Nm(r,e)}function oj(r,e){return Nm(r,e)&&4<=r.length-e}function IA(r,e){if(e+1<r.length&&Nm(r,e)){const n=AA(r,e);let s=4;n!=null&&n.frameLength&&(s=n.frameLength);const i=e+s;return i===r.length||RA(r,i)}return!1}class aj extends Om{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=el(e,0);let s=(n==null?void 0:n.length)||0;if(IA(e,s))return!1;for(let i=e.length;s<i;s++)if(BB(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return UB(e,t)}appendFrame(e,t,n){SA(e,this.observer,t,n,e.manifestCodec);const s=wA(e,t,n,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const LA=(r,e)=>{let t=0,n=5;e+=n;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=r[e];const a=Math.min(n,8),l=8-a;i[0]=4278190080>>>24+l<<l,s[0]=(o[0]&i[0])>>l,t=t?t<<a|s[0]:s[0],e+=1,n-=a}return t};class lj extends Om{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const s=CA(e,t,n,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=el(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&Dm(t)!==void 0&&LA(e,n)<16}}function CA(r,e,t,n,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+u>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,g=[2,1,2,3,3,4,4,5][d]+f,m=e[t+5]>>3,y=e[t+5]&7,v=new Uint8Array([i<<6|m<<1|y>>2,(y&3)<<6|d<<3|f<<2|l>>4,l<<4&224]),E=1536/a*9e4,S=n+s*E,T=e.subarray(t,t+u);return r.config=v,r.channelCount=g,r.samplerate=a,r.samples.push({unit:T,pts:S}),u}class cj extends Om{resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=el(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&Dm(t)!==void 0&&LA(e,n)<=16)return!1;for(let s=e.length;n<s;n++)if(IA(e,n))return we.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return oj(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return _A(e,t,n,this.basePTS,this.frameIndex)}}const uj=/\/emsg[-/]ID3/i;class dj{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,s){const i=this.videoTrack=Zr("video",1),o=this.audioTrack=Zr("audio",1),a=this.txtTrack=Zr("text",1);if(this.id3Track=Zr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=B_(e);if(l.video){const{id:c,timescale:u,codec:d,supplemental:h}=l.video;i.id=c,i.timescale=a.timescale=u,i.codec=d,i.supplemental=h}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;o.id=c,o.timescale=u,o.codec=d}a.id=F_.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return lU(e)}demux(e,t){this.timeOffset=t;let n=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Sr(this.remainderData,e));const a=gU(n);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=n;const o=this.extractID3Track(s,t);return i.samples=Rv(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return n.samples=Rv(e,t),{videoTrack:t,audioTrack:Zr(),id3Track:s,textTrack:Zr()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const s=he(e.samples,["emsg"]);s&&s.forEach(i=>{const o=yU(i);if(uj.test(o.schemeIdUri)){const a=uE(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;n.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Xt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=uE(o,t);n.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Xt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function uE(r,e){return Y(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class hj{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new _m(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Rs.cbc)}decryptAacSample(e,t,n){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)n.set(e.subarray(i,i+16),s);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(n.subarray(s,s+16),i);return e}decryptAvcSample(e,t,n,s,i){const o=V_(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,s)}).catch(s)}decryptAvcSamples(e,t,n,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(n>=i.length);n++){const o=i[n];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,n,s,o),!this.decrypter.isSync()))return}}}}class kA{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,s;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const i=n.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,s=n.length;if(s){const i=n[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const s=t.byteLength;let i=e.naluState||0;const o=i,a=[];let l=0,c,u,d,h=-1,f=0;for(i===-1&&(h=0,f=this.getNALuType(t,0),i=0,l=1);l<s;){if(c=t[l++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(u=l-i-1,h>=0){const p={data:t.subarray(h,u),type:f};a.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(o&&l<=4-o&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-o)),u>0&&(p.data=Sr(p.data,t.subarray(0,u)),p.state=0))}l<s?(d=this.getNALuType(t,l),h=l,f=d,i=0):i=-1}else i=0}if(h>=0&&i>=0){const p={data:t.subarray(h,s),type:f,state:i};a.push(p)}if(a.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=Sr(p.data,t))}return e.naluState=i,a}}class va{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(n,n+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&we.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class fj extends kA{parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let o=this.VideoSample,a,l=!1;n.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(c=>{var u,d;switch(c.type){case 1:{let g=!1;a=!0;const m=c.data;if(l&&m.length>4){const y=this.readSliceType(m);(y===2||y===4||y===7||y===9)&&(g=!0)}if(g){var h;(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=g;break}case 5:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,xm(c.data,1,n.pts,t.samples);break}case 7:{var f,p;a=!0,l=!0;const g=c.data,m=this.readSPS(g);if(!e.sps||e.width!==m.width||e.height!==m.height||((f=e.pixelRatio)==null?void 0:f[0])!==m.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==m.pixelRatio[1]){e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.sps=[g];const y=g.subarray(1,4);let v="avc1.";for(let E=0;E<3;E++){let S=y[E].toString(16);S.length<2&&(S="0"+S),v+=S}e.codec=v}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new va(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(n+i+256)%256),n=s===0?n:s}readSPS(e){const t=new va(e);let n=0,s=0,i=0,o=0,a,l,c;const u=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),p=t.skipBits.bind(t),g=t.skipEG.bind(t),m=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);u();const v=u();if(d(5),p(3),u(),m(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const R=h();if(R===3&&p(1),m(),m(),p(1),f())for(l=R!==3?8:12,c=0;c<l;c++)f()&&(c<6?y(16,t):y(64,t))}m();const E=h();if(E===0)h();else if(E===1)for(p(1),g(),g(),a=h(),c=0;c<a;c++)g();m(),p(1);const S=h(),T=h(),A=d(1);A===0&&p(1),p(1),f()&&(n=h(),s=h(),i=h(),o=h());let b=[1,1];if(f()&&f())switch(u()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:{b=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((S+1)*16-n*2-s*2),height:(2-A)*(T+1)*16-(A?2:4)*(i+o),pixelRatio:b}}}class pj extends kA{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let o=this.VideoSample,a,l=!1;n.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var h;(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,xm(c.data,2,n.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=_e(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(c.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in f.params)e.params[p]=f.params[p]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(c.data);for(const p in f)e.params[p]=f[p]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[n]=e[s],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new va(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:s}}readSPS(e){const t=new va(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),g=t.readUByte(),m=t.readUByte(),y=t.readUByte(),v=[],E=[];for(let pe=0;pe<n;pe++)v.push(t.readBoolean()),E.push(t.readBoolean());if(n>0)for(let pe=n;pe<8;pe++)t.readBits(2);for(let pe=0;pe<n;pe++)v[pe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[pe]&&t.readUByte();t.readUEG();const S=t.readUEG();S==3&&t.skipBits(1);const T=t.readUEG(),A=t.readUEG(),b=t.readBoolean();let R=0,L=0,I=0,C=0;b&&(R+=t.readUEG(),L+=t.readUEG(),I+=t.readUEG(),C+=t.readUEG());const D=t.readUEG(),B=t.readUEG(),F=t.readUEG(),V=t.readBoolean();for(let pe=V?0:n;pe<=n;pe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Xe=0;Xe<4;Xe++)for(let it=0;it<(Xe===3?2:6);it++)if(!t.readBoolean())t.readUEG();else{const Nt=Math.min(64,1<<4+(Xe<<1));Xe>1&&t.readEG();for(let ur=0;ur<Nt;ur++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const P=t.readUEG();let k=0;for(let pe=0;pe<P;pe++){let Xe=!1;if(pe!==0&&(Xe=t.readBoolean()),Xe){pe===P&&t.readUEG(),t.readBoolean(),t.readUEG();let it=0;for(let Ot=0;Ot<=k;Ot++){const Nt=t.readBoolean();let ur=!1;Nt||(ur=t.readBoolean()),(Nt||ur)&&it++}k=it}else{const it=t.readUEG(),Ot=t.readUEG();k=it+Ot;for(let Nt=0;Nt<it;Nt++)t.readUEG(),t.readBoolean();for(let Nt=0;Nt<Ot;Nt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const pe=t.readUEG();for(let Xe=0;Xe<pe;Xe++){for(let it=0;it<F+4;it++)t.readBits(1);t.readBits(1)}}let U=0,$=1,q=1,Q=!0,Z=1,re=0;t.readBoolean(),t.readBoolean();let se=!1;if(t.readBoolean()){if(t.readBoolean()){const Vr=t.readUByte(),Kr=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],gi=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Vr>0&&Vr<16?($=Kr[Vr-1],q=gi[Vr-1]):Vr===255&&($=t.readBits(16),q=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),se=t.readBoolean(),se&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Z=t.readBits(32),re=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const gi=t.readBoolean(),El=t.readBoolean();let ot=!1;(gi||El)&&(ot=t.readBoolean(),ot&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ot&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let pn=0;pn<=n;pn++){Q=t.readBoolean();const Ad=Q||t.readBoolean();let Sl=!1;Ad?t.readEG():Sl=t.readBoolean();const Ps=Sl?1:t.readUEG()+1;if(gi)for(let Ds=0;Ds<Ps;Ds++)t.readUEG(),t.readUEG(),ot&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(El)for(let Ds=0;Ds<Ps;Ds++)t.readUEG(),t.readUEG(),ot&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readUEG())}let Se=T,qe=A;if(b){let pe=1,Xe=1;S===1?pe=Xe=2:S==2&&(pe=2),Se=T-pe*L-pe*R,qe=A-Xe*C-Xe*I}const Et=s?["A","B","C"][s]:"",$n=a<<24|l<<16|c<<8|u;let cr=0;for(let pe=0;pe<32;pe++)cr=(cr|($n>>pe&1)<<31-pe)>>>0;let Un=cr.toString(16);return o===1&&Un==="2"&&(Un="6"),{codecString:`hvc1.${Et}${o}.${Un}.${i?"H":"L"}${y}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[d,h,f,p,g,m],general_level_idc:y,bit_depth:D+8,bit_depth_luma_minus8:D,bit_depth_chroma_minus8:B,min_spatial_segmentation_idc:U,chroma_format_idc:S,frame_rate:{fixed:Q,fps:re/Z}},width:Se,height:qe,pixelRatio:[$,q]}}readPPS(e){const t=new va(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const at=188;class es{constructor(e,t,n,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=s,this.videoParser=null}static probe(e,t){const n=es.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(at*5,t-at)+1,s=0;for(;s<n;){let i=!1,o=-1,a=0;for(let l=s;l<t;l+=at)if(e[l]===71&&(t-l===at||e[l+at]===71)){if(a++,o===-1&&(o=l,o!==0&&(n=Math.min(o+at*99,e.length-at)+1)),i||(i=Cp(e,l)===0),i&&a>1&&(o===0&&a>2||l+at>n))return o}else{if(a)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:F_[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=es.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=es.createTrack("audio",s),this._id3Track=es.createTrack("id3"),this._txtTrack=es.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,s=!1){n||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,d=o.pesData,h=a.pid,f=l.pid,p=a.pesData,g=l.pesData,m=null,y=this.pmtParsed,v=this._pmtId,E=e.length;if(this.remainderData&&(e=Sr(this.remainderData,e),E=e.length,this.remainderData=null),E<at&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const S=Math.max(0,es.syncOffset(e));E-=(E-S)%at,E<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let T=0;for(let b=S;b<E;b+=at)if(e[b]===71){const R=!!(e[b+1]&64),L=Cp(e,b),I=(e[b+3]&48)>>4;let C;if(I>1){if(C=b+5+e[b+4],C===b+at)continue}else C=b+4;switch(L){case u:R&&(d&&(i=ki(d,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(C,b+at)),d.size+=b+at-C);break;case h:if(R){if(p&&(i=ki(p,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(C,b+at)),p.size+=b+at-C);break;case f:R&&(g&&(i=ki(g,this.logger))&&this.parseID3PES(l,i),g={data:[],size:0}),g&&(g.data.push(e.subarray(C,b+at)),g.size+=b+at-C);break;case 0:R&&(C+=e[C]+1),v=this._pmtId=gj(e,C);break;case v:{R&&(C+=e[C]+1);const D=mj(e,C,this.typeSupported,n,this.observer,this.logger);u=D.videoPid,u>0&&(o.pid=u,o.segmentCodec=D.segmentVideoCodec),h=D.audioPid,h>0&&(a.pid=h,a.segmentCodec=D.segmentAudioCodec),f=D.id3Pid,f>0&&(l.pid=f),m!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${b} after unknown PID '${m}'. Backtracking to sync byte @${S} to parse all TS packets.`),m=null,b=S-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=L;break}}else T++;T>0&&kp(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=p,l.pesData=g;const A={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return s&&this.extractRemainingSamples(A),A}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:s,textTrack:i}=e,o=n.pesData,a=t.pesData,l=s.pesData;let c;if(o&&(c=ki(o,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,i,c,!0),n.pesData=null)):n.pesData=o,a&&(c=ki(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=ki(l,this.logger))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,n){const s=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new hj(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new fj:e==="hevc"&&(this.videoParser=new pj))}decrypt(e,t){return new Promise(n=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{n(e)}):n(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,h=s.sample.unit.byteLength;if(d===-1)i=Sr(s.sample.unit,i);else{const f=h-d;s.sample.unit.set(i.subarray(0,d),f),e.samples.push(s.sample),n=s.missing}}let o,a;for(o=n,a=i.length;o<a-1&&!Pu(i,o);o++);if(o!==n){let d;const h=o<a-1;if(h?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",kp(this.observer,new Error(d),h,this.logger),!h)return}SA(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=xA(e.samplerate);l=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=wA(e,i,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!Pu(i,o);o++);}parseMPEGPES(e,t){const n=t.data,s=n.length;let i=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(RA(n,o)){const l=_A(e,n,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const n=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=n.length;let o=0,a=0,l;for(;a<i&&(l=CA(e,n,a,s,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=_e({},t,{type:this._videoTrack?Xt.emsg:Xt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Cp(r,e){return((r[e+1]&31)<<8)+r[e+2]}function gj(r,e){return(r[e+10]&31)<<8|r[e+11]}function mj(r,e,t,n,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(r[e+1]&15)<<8|r[e+2],l=e+3+a-4,c=(r[e+10]&15)<<8|r[e+11];for(e+=12+c;e<l;){const u=Cp(r,e),d=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){Nh("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=u);break;case 21:o.id3Pid===-1&&(o.id3Pid=u);break;case 219:if(!n){Nh("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="mp3");break;case 193:if(!n){Nh("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let h=e+5,f=d;for(;f>2;){switch(r[h]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3");break}const g=r[h+1]+2;h+=g,f-=g}}break;case 194:case 135:return kp(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=u,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return o}function kp(r,e,t,n){n.warn(`parsing error: ${e.message}`),r.emit(x.ERROR,x.ERROR,{type:ee.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Nh(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function ki(r,e){let t=0,n,s,i,o,a;const l=r.data;if(!r||r.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Sr(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(s=(n[4]<<8)+n[5],s&&s>r.size-6)return null;const u=n[7];u&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,u&64?(a=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),i=n[8];let d=i+9;if(r.size<=d)return null;r.size-=d;const h=new Uint8Array(r.size);for(let f=0,p=l.length;f<p;f++){n=l[f];let g=n.byteLength;if(d)if(d>g){d-=g;continue}else n=n.subarray(d),g-=d,d=0;h.set(n,t),t+=g}return s&&(s-=i+3),{data:h,pts:o,dts:a,len:s}}return null}class yj{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Wn=Math.pow(2,32)-1;class O{static init(){O.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in O.types)O.types.hasOwnProperty(e)&&(O.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);O.HDLR_TYPES={video:t,audio:n};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);O.STTS=O.STSC=O.STCO=i,O.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),O.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),O.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),O.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);O.FTYP=O.box(O.types.ftyp,o,l,o,a),O.DINF=O.box(O.types.dinf,O.box(O.types.dref,s))}static box(e,...t){let n=8,s=t.length;const i=s;for(;s--;)n+=t[s].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(e,4),s=0,n=8;s<i;s++)o.set(t[s],n),n+=t[s].byteLength;return o}static hdlr(e){return O.box(O.types.hdlr,O.HDLR_TYPES[e])}static mdat(e){return O.box(O.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Wn+1)),s=Math.floor(t%(Wn+1));return O.box(O.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return O.box(O.types.mdia,O.mdhd(e.timescale||0,e.duration||0),O.hdlr(e.type),O.minf(e))}static mfhd(e){return O.box(O.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?O.box(O.types.minf,O.box(O.types.smhd,O.SMHD),O.DINF,O.stbl(e)):O.box(O.types.minf,O.box(O.types.vmhd,O.VMHD),O.DINF,O.stbl(e))}static moof(e,t,n){return O.box(O.types.moof,O.mfhd(e),O.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=O.trak(e[t]);return O.box.apply(null,[O.types.moov,O.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(O.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=O.trex(e[t]);return O.box.apply(null,[O.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Wn+1)),s=Math.floor(t%(Wn+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return O.box(O.types.mvhd,i)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,n[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return O.box(O.types.sdtp,n)}static stbl(e){return O.box(O.types.stbl,O.stsd(e),O.box(O.types.stts,O.STTS),O.box(O.types.stsc,O.STSC),O.box(O.types.stsz,O.STSZ),O.box(O.types.stco,O.STCO))}static avc1(e){let t=[],n=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(i));const a=O.box(O.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return O.box(O.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return O.box(O.types.mp4a,O.audioStsd(e),O.box(O.types.esds,O.esds(e)))}static mp3(e){return O.box(O.types[".mp3"],O.audioStsd(e))}static ac3(e){return O.box(O.types["ac-3"],O.audioStsd(e),O.box(O.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return O.box(O.types.stsd,O.STSD,O.mp4a(e));if(t==="ac3"&&e.config)return O.box(O.types.stsd,O.STSD,O.ac3(e));if(t==="mp3"&&e.codec==="mp3")return O.box(O.types.stsd,O.STSD,O.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return O.box(O.types.stsd,O.STSD,O.avc1(e));if(t==="hevc"&&e.vps)return O.box(O.types.stsd,O.STSD,O.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(n/(Wn+1)),a=Math.floor(n%(Wn+1));return O.box(O.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const n=O.sdtp(e),s=e.id,i=Math.floor(t/(Wn+1)),o=Math.floor(t%(Wn+1));return O.box(O.types.traf,O.box(O.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),O.box(O.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),O.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,O.box(O.types.trak,O.tkhd(e),O.mdia(e))}static trex(e){const t=e.id;return O.box(O.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],s=n.length,i=12+16*s,o=new Uint8Array(i);let a,l,c,u,d,h;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<s;a++)l=n[a],c=l.duration,u=l.size,d=l.flags,h=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*a);return O.box(O.types.trun,o)}static initSegment(e){O.types||O.init();const t=O.moov(e);return Sr(O.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let o=i.length;for(let p=0;p<n.length;p+=1){o+=3;for(let g=0;g<n[p].length;g+=1)o+=2+n[p][g].length}const a=new Uint8Array(o);a.set(i,0),o=i.length;const l=n.length-1;for(let p=0;p<n.length;p+=1){a.set(new Uint8Array([32+p|(p===l?128:0),0,n[p].length]),o),o+=3;for(let g=0;g<n[p].length;g+=1)a.set(new Uint8Array([n[p][g].length>>8,n[p][g].length&255]),o),o+=2,a.set(n[p][g],o),o+=n[p][g].length}const c=O.box(O.types.hvcC,a),u=e.width,d=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return O.box(O.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}O.types=void 0;O.HDLR_TYPES=void 0;O.STTS=void 0;O.STSC=void 0;O.STCO=void 0;O.STSZ=void 0;O.VMHD=void 0;O.SMHD=void 0;O.STSD=void 0;O.FTYP=void 0;O.DINF=void 0;const PA=9e4;function Mm(r,e,t=1,n=!1){const s=r*e*t;return n?Math.round(s):s}function vj(r,e,t=1,n=!1){return Mm(r,e,1/t,n)}function Qo(r,e=!1){return Mm(r,1e3,1/PA,e)}function Ej(r,e=1){return Mm(r,PA,1/e)}function dE(r){const{baseTime:e,timescale:t,trackId:n}=r;return`${e/t} (${e}/${t}) trackId: ${n}`}const Sj=10*1e3,xj=1024,wj=1152,Tj=1536;let Pi=null,Mh=null;function hE(r,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Dc extends xr{constructor(e,t,n,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Pi===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pi=o?parseInt(o[1]):0}if(Mh===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Mh=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&dE(t)} > ${e&&dE(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,s=e.reduce((i,o)=>{let a=o.pts,l=a-i;return l<-4294967296&&(t=!0,a=qt(a,n),l=a-i),l>0?i:a},n);return t&&this.debug("PTS rollover detected"),s}remux(e,t,n,s,i,o,a,l){let c,u,d,h,f,p,g=i,m=i;const y=e.pid>-1,v=t.pid>-1,E=t.samples.length,S=e.samples.length>0,T=a&&E>0||E>1;if((!y||S)&&(!v||T)||this.ISGenerated||a){if(this.ISGenerated){var b,R,L,I;const F=this.videoTrackConfig;(F&&(t.width!==F.width||t.height!==F.height||((b=t.pixelRatio)==null?void 0:b[0])!==((R=F.pixelRatio)==null?void 0:R[0])||((L=t.pixelRatio)==null?void 0:L[1])!==((I=F.pixelRatio)==null?void 0:I[1]))||!F&&T||this.nextAudioTs===null&&S)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,o));const C=this.isVideoContiguous;let D=-1,B;if(T&&(D=bj(t.samples),!C&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,D>0){this.warn(`Dropped ${D} out of ${E} video samples due to a missing keyframe`);const F=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(D),t.dropped+=D,m+=(t.samples[0].pts-F)/t.inputTimeScale,B=m}else D===-1&&(this.warn(`No keyframe found out of ${E} video samples`),p=!1);if(this.ISGenerated){if(S&&T){const F=this.getVideoStartPts(t.samples),M=(qt(e.samples[0].pts,F)-F)/t.inputTimeScale;g+=Math.max(0,M),m+=Math.max(0,-M)}if(S){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,o)),u=this.remuxAudio(e,g,this.isAudioContiguous,o,v||T||l===X.AUDIO?m:void 0),T){const F=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,o)),c=this.remuxVideo(t,m,C,F)}}else T&&(c=this.remuxVideo(t,m,C,0));c&&(c.firstKeyFrame=D,c.independent=D!==-1,c.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(f=DA(n,i,this._initPTS,this._initDTS)),s.samples.length&&(h=OA(s,i,this._initPTS))),{audio:u,video:c,initSegment:d,independent:p,text:h,id3:f}}computeInitPts(e,t,n,s){const i=Math.round(n*t);let o=qt(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${s}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,n,s){const i=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||s,d="audio/mp4",h,f,p,g=-1;if(u&&(h=f=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):O.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(g=e.id,p=e.inputTimeScale,!c||p!==c.timescale?h=f=this.computeInitPts(i[0].pts,p,n,"audio"):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:O.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(g=t.id,p=t.inputTimeScale,!c||p!==c.timescale){const m=this.getVideoStartPts(o),y=qt(o[0].dts,m),v=this.computeInitPts(y,p,n,"video"),E=this.computeInitPts(m,p,n,"video");f=Math.min(f,v),h=Math.min(h,E)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${n} ${h/p} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${h/p} (${h}/${p}) trackId: ${g}`),this._initPTS={baseTime:h,timescale:p,trackId:g},this._initDTS={baseTime:f,timescale:p,trackId:g}):h=p=void 0,{tracks:l,initPTS:h,timescale:p,trackId:g}}remuxVideo(e,t,n,s){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*i/c.timescale;let d=this.nextVideoTs,h=8,f=this.videoSampleDuration,p,g,m=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,v=!1;if(!n||d===null){const U=u+t*i,$=o[0].pts-qt(o[0].dts,o[0].pts);Pi&&d!==null&&Math.abs(U-$-(d+u))<15e3?n=!0:d=U-$-u}const E=d+u;for(let U=0;U<l;U++){const $=o[U];$.pts=qt($.pts,E),$.dts=qt($.dts,E),$.dts<o[U>0?U-1:U].dts&&(v=!0)}v&&o.sort(function(U,$){const q=U.dts-$.dts,Q=U.pts-$.pts;return q||Q}),p=o[0].dts,g=o[o.length-1].dts;const S=g-p,T=S?Math.round(S/(l-1)):f||e.inputTimeScale/30;if(n){const U=p-E,$=U>T,q=U<-1;if(($||q)&&($?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Qo(U,!0)} ms (${U}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Qo(-U,!0)} ms (${U}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!q||E>=o[0].pts||Pi)){p=E;const Q=o[0].pts-U;if($)o[0].dts=p,o[0].pts=Q;else{let Z=!0;for(let re=0;re<o.length&&!(o[re].dts>Q&&Z);re++){const se=o[re].pts;if(o[re].dts-=U,o[re].pts-=U,re<o.length-1){const Ae=o[re+1].pts,Se=o[re].pts,qe=Ae<=Se,Et=Ae<=se;Z=qe==Et}}}this.log(`Video: Initial PTS/DTS adjusted: ${Qo(Q,!0)}/${Qo(p,!0)}, delta: ${Qo(U,!0)} ms`)}}p=Math.max(0,p);let A=0,b=0,R=p;for(let U=0;U<l;U++){const $=o[U],q=$.units,Q=q.length;let Z=0;for(let re=0;re<Q;re++)Z+=q[re].data.length;b+=Z,A+=Q,$.length=Z,$.dts<R?($.dts=R,R+=T/4|0||1):R=$.dts,m=Math.min($.pts,m),y=Math.max($.pts,y)}g=o[l-1].dts;const L=b+4*A+8;let I;try{I=new Uint8Array(L)}catch(U){this.observer.emit(x.ERROR,x.ERROR,{type:ee.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:L,reason:`fail allocating video mdat ${L}`});return}const C=new DataView(I.buffer);C.setUint32(0,L),I.set(O.types.mdat,4);let D=!1,B=Number.POSITIVE_INFINITY,F=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let U=0;U<l;U++){const $=o[U],q=$.units;let Q=0;for(let se=0,Ae=q.length;se<Ae;se++){const Se=q[se],qe=Se.data,Et=Se.data.byteLength;C.setUint32(h,Et),h+=4,I.set(qe,h),h+=Et,Q+=4+Et}let Z;if(U<l-1)f=o[U+1].dts-$.dts,Z=o[U+1].pts-$.pts;else{const se=this.config,Ae=U>0?$.dts-o[U-1].dts:T;if(Z=U>0?$.pts-o[U-1].pts:T,se.stretchShortVideoTrack&&this.nextAudioTs!==null){const Se=Math.floor(se.maxBufferHole*i),qe=(s?m+s*i:this.nextAudioTs+u)-$.pts;qe>Se?(f=qe-Ae,f<0?f=Ae:D=!0,this.log(`It is approximately ${qe/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=Ae}else f=Ae}const re=Math.round($.pts-$.dts);B=Math.min(B,f),V=Math.max(V,f),F=Math.min(F,Z),M=Math.max(M,Z),a.push(hE($.key,f,Q,re))}if(a.length){if(Pi){if(Pi<70){const U=a[0].flags;U.dependsOn=2,U.isNonSync=0}}else if(Mh&&M-F<V-B&&T/V<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let U=p;for(let $=0,q=a.length;$<q;$++){const Q=U+a[$].duration,Z=U+a[$].cts;if($<q-1){const re=Q+a[$+1].cts;a[$].duration=re-Z}else a[$].duration=$?a[$-1].duration:T;a[$].cts=0,U=Q}}}f=D||!f?T:f;const K=g+f;this.nextVideoTs=d=K-u,this.videoSampleDuration=f,this.isVideoContiguous=!0;const j={data1:O.moof(e.sequenceNumber++,p,_e(e,{samples:a})),data2:I,startPTS:(m-u)/i,endPTS:(y+f-u)/i,startDTS:(p-u)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,j}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return wj;case"ac3":return Tj;default:return xj}}remuxAudio(e,t,n,s,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],p=i!==void 0;let g=e.samples,m=h?0:8,y=this.nextAudioTs||-1;const v=d.baseTime*o/d.timescale,E=v+t*o;if(this.isAudioContiguous=n=n||g.length&&y>0&&(s&&Math.abs(E-(y+v))<9e3||Math.abs(qt(g[0].pts,E)-(y+v))<20*u),g.forEach(function(M){M.pts=qt(M.pts,E)}),!n||y<0){const M=g.length;if(g=g.filter(K=>K.pts>=0),M!==g.length&&this.warn(`Removed ${g.length-M} of ${M} samples (initPTS ${v} / ${o})`),!g.length)return;i===0?y=0:s&&!p?y=Math.max(0,E-v):y=g[0].pts-v}if(e.segmentCodec==="aac"){const M=this.config.maxAudioFramesDrift;for(let K=0,P=y+v;K<g.length;K++){const k=g[K],j=k.pts,U=j-P,$=Math.abs(1e3*U/o);if(U<=-M*u&&p)K===0&&(this.warn(`Audio frame @ ${(j/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*U/o)} ms.`),this.nextAudioTs=y=j-v,P=j);else if(U>=M*u&&$<Sj&&p){let q=Math.round(U/u);for(P=j-q*u;P<0&&q&&u;)q--,P+=u;K===0&&(this.nextAudioTs=y=P-v),this.warn(`Injecting ${q} audio frames @ ${((P-v)/o).toFixed(3)}s due to ${Math.round(1e3*U/o)} ms gap.`);for(let Q=0;Q<q;Q++){let Z=yj.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Z||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Z=k.unit.subarray()),g.splice(K,0,{unit:Z,pts:P}),P+=u,K++}}k.pts=P,P+=u}}let S=null,T=null,A,b=0,R=g.length;for(;R--;)b+=g[R].unit.byteLength;for(let M=0,K=g.length;M<K;M++){const P=g[M],k=P.unit;let j=P.pts;if(T!==null){const $=f[M-1];$.duration=Math.round((j-T)/l)}else if(n&&e.segmentCodec==="aac"&&(j=y+v),S=j,b>0){b+=m;try{A=new Uint8Array(b)}catch($){this.observer.emit(x.ERROR,x.ERROR,{type:ee.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:b,reason:`fail allocating audio mdat ${b}`});return}h||(new DataView(A.buffer).setUint32(0,b),A.set(O.types.mdat,4))}else return;A.set(k,m);const U=k.byteLength;m+=U,f.push(hE(!0,c,U,0)),T=j}const L=f.length;if(!L)return;const I=f[f.length-1];y=T-v,this.nextAudioTs=y+l*I.duration;const C=h?new Uint8Array(0):O.moof(e.sequenceNumber++,S/l,_e({},e,{samples:f}));e.samples=[];const D=(S-v)/o,B=this.nextAudioTs/o,V={data1:C,data2:A,startPTS:D,endPTS:B,startDTS:D,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:L};return this.isAudioContiguous=!0,V}}function qt(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function bj(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function DA(r,e,t,n){const s=r.samples.length;if(!s)return;const i=r.inputTimeScale;for(let a=0;a<s;a++){const l=r.samples[a];l.pts=qt(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=qt(l.dts-n.baseTime*i/n.timescale,e*i)/i}const o=r.samples;return r.samples=[],{samples:o}}function OA(r,e,t){const n=r.samples.length;if(!n)return;const s=r.inputTimeScale;for(let o=0;o<n;o++){const a=r.samples[o];a.pts=qt(a.pts-t.baseTime*s/t.timescale,e*s)/s}r.samples.sort((o,a)=>o.pts-a.pts);const i=r.samples;return r.samples=[],{samples:i}}class _j extends xr{constructor(e,t,n,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,s){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=B_(e);if(t)hU(e,t);else{const l=i||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(n=fE(i,Re.AUDIO,this)),o&&(s=fE(o,Re.VIDEO,this));const a={};i&&o?a.audiovideo={container:"video/mp4",codec:n+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:n,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,s,i,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};Y(u)||(u=this.lastEndTime=i||0);const h=t.samples;if(!h.length)return d;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if((a=p)!=null&&a.length||(this.generateInitSegment(h),p=this.initData),!((l=p)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const g=pU(h,p,this),m=p.audio?g[p.audio.id]:null,y=p.video?g[p.video.id]:null,v=sc(y,1/0),E=sc(m,1/0),S=sc(y,0,!0),T=sc(m,0,!0);let A=i,b=0;const R=m&&(!y||!c&&E<v||c&&c.trackId===p.audio.id),L=R?m:y;if(L){const P=L.timescale,k=L.start-i*P,j=R?p.audio.id:p.video.id;A=L.start/P,b=R?T-E:S-v,(o||!c)&&(Aj(c,A,i,b)||P!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${k/P} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${A-i} (${k}/${P}) trackId: ${j}`),c=null,f.initPTS=k,f.timescale=P,f.trackId=j)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(f.initPTS=c.baseTime,f.timescale=c.timescale,f.trackId=c.trackId):((!f.timescale||f.trackId===void 0||f.initPTS===void 0)&&(this.warn("Could not set initPTS"),f.initPTS=A,f.timescale=1,f.trackId=-1),this.initPTS=c={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});const I=A-c.baseTime/c.timescale,C=I+b;b>0?this.lastEndTime=C:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const D=!!p.audio,B=!!p.video;let F="";D&&(F+="audio"),B&&(F+="video");const V=(p.audio?p.audio.encrypted:!1)||(p.video?p.video.encrypted:!1),M={data1:h,startPTS:I,startDTS:I,endPTS:C,endDTS:C,type:F,hasAudio:D,hasVideo:B,nb:1,dropped:0,encrypted:V};d.audio=D&&!B?M:void 0,d.video=B?M:void 0;const K=y==null?void 0:y.sampleCount;if(K){const P=y.keyFrameIndex,k=P!==-1;M.nb=K,M.dropped=P===0||this.isVideoContiguous?0:k?P:K,M.independent=k,M.firstKeyFrame=P,k&&y.keyFrameStart&&(M.firstKeyFramePTS=(y.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=k),this.isVideoContiguous||(this.isVideoContiguous=k),M.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${P}/${K} dropped: ${M.dropped} start: ${M.firstKeyFramePTS||"NA"}`)}return d.initSegment=f,d.id3=DA(n,i,c,c),s.samples.length&&(d.text=OA(s,i,c)),d}}function sc(r,e,t=!1){return(r==null?void 0:r.start)!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function Aj(r,e,t,n){if(r===null)return!0;const s=Math.max(n,1),i=e-r.baseTime/r.timescale;return Math.abs(i-t)>s}function fE(r,e,t){const n=r.codec;return n&&n.length>4?n:e===Re.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?bu(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let wn;try{wn=self.performance.now.bind(self.performance)}catch{wn=Date.now}const Oc=[{demux:dj,remux:_j},{demux:es,remux:Dc},{demux:aj,remux:Dc},{demux:cj,remux:Dc}];Oc.splice(2,0,{demux:lj,remux:Dc});class pE{constructor(e,t,n,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,s){const i=n.transmuxing;i.executeStart=wn();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:p}=s||a,{audioCodec:g,videoCodec:m,defaultInitPts:y,duration:v,initSegmentData:E}=l,S=Rj(o,t);if(S&&co(S.method)){const R=this.getDecrypter(),L=Rm(S.method);if(R.isSync()){let I=R.softwareDecrypt(o,S.key.buffer,S.iv.buffer,L);if(n.part>-1){const D=R.flush();I=D&&D.buffer}if(!I)return i.executeEnd=wn(),Fh(n);o=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=R.webCryptoDecrypt(o,S.key.buffer,S.iv.buffer,L).then(I=>{const C=this.push(I,null,n);return this.decryptionPromise=null,C}),this.decryptionPromise}const T=this.needsProbing(u,d);if(T){const R=this.configureTransmuxer(o);if(R)return this.logger.warn(`[transmuxer] ${R.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:ee.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:R,reason:R.message}),i.executeEnd=wn(),Fh(n)}(u||d||p||T)&&this.resetInitSegment(E,g,m,v,t),(u||p||T)&&this.resetInitialTimestamp(y),c||this.resetContiguity();const A=this.transmux(o,S,f,h,n);this.asyncResult=tl(A);const b=this.currentTransmuxState;return b.contiguous=!0,b.discontinuity=!1,b.trackSwitch=!1,i.executeEnd=wn(),A}flush(e){const t=e.transmuxing;t.executeStart=wn();const{decrypter:n,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:a}=s;if(n){const d=n.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=wn();const d=[Fh(e)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(a);return tl(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,u,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,n){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===X.MAIN?"level":"track"} ${n.level}`);const u=this.remuxer.remux(s,i,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=wn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,s,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,n,s),a.resetInitSegment(e,t,n,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,n,s,i):o=this.transmuxUnencrypted(e,n,s,i),o}transmuxUnencrypted(e,t,n,s){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,n,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,n,s,i){return this.demuxer.demuxSampleAes(e,t,n).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,n,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:s}=this;let i;for(let d=0,h=Oc.length;d<h;d++){var o;if((o=Oc[d].demux)!=null&&o.probe(e,this.logger)){i=Oc[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=i.remux,u=i.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(n,t,s,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(n,t,s,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new _m(this.config)),e}}function Rj(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Fh=r=>({remuxResult:{},chunkMeta:r});function tl(r){return"then"in r&&r.then instanceof Function}class Ij{constructor(e,t,n,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=s,this.defaultInitPts=i||null}}class Lj{constructor(e,t,n,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let gE=0;class NA{constructor(e,t,n,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=gE++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=n,this.onFlush=s;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===x.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new Cm,this.observer.on(x.FRAG_DECRYPTED,o),this.observer.on(x.ERROR,o);const a=Cv(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||DB()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=NB(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=OB());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Ie(i)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new pE(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new pE(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=gE++;const t=this.hls.config,n=Cv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Ie(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),MB(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,s,i,o,a,l,c,u){var d,h;c.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:p}=this,g=o?o.start:i.start,m=i.decryptdata,y=this.frag,v=!(y&&i.cc===y.cc),E=!(y&&c.level===y.level),S=y?c.sn-y.sn:-1,T=this.part?c.part-this.part.index:-1,A=S===0&&c.id>1&&c.id===(y==null?void 0:y.stats.chunkCount),b=!E&&(S===1||S===0&&(T===1||A&&T<=0)),R=self.performance.now();(E||S||i.stats.parsing.start===0)&&(i.stats.parsing.start=R),o&&(T||!b)&&(o.stats.parsing.start=R);const L=!(y&&((d=i.initSegment)==null?void 0:d.url)===((h=y.initSegment)==null?void 0:h.url)),I=new Lj(v,b,l,E,g,L);if(!b||v||L){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===X.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${v}
        trackSwitch: ${E}
        contiguous: ${b}
        accurateTimeOffset: ${l}
        timeOffset: ${g}
        initSegmentChange: ${L}`);const C=new Ij(n,s,t,a,u);this.configureTransmuxer(C)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:I},e instanceof ArrayBuffer?[e]:[]);else if(p){const C=p.push(e,m,c,I);tl(C)?C.then(D=>{this.handleTransmuxComplete(D)}).catch(D=>{this.transmuxerError(D,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(C)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const s=n.flush(e);tl(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const mE=100;class Cj extends Lm{constructor(e,t,n){super(e,t,n,"audio-stream-controller",X.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:o}){if(n===X.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===G.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===G.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const s=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=X_(o,i,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===G.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=G.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(mE),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=G.IDLE):this.state=G.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case G.IDLE:this.doTickIdle();break;case G.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(s))break;this.state=G.WAITING_INIT_PTS}break}case G.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case G.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=G.FRAG_LOADING;const a=s.flush().buffer,l={frag:t,part:n,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=G.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(n!=null&&n[i]))return;const a=n[i],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=G.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Re.AUDIO,X.AUDIO));const u=this.getFwdBufferInfo(c,X.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(x.BUFFER_EOS,{type:"audio"}),this.state=G.ENDED;return}const d=u.len,h=t.maxBufferLength,f=l.fragments,p=f[0].start,g=this.getLoadPosition(),m=this.flushing?g:u.end;if(this.switchingTrack&&s){const E=g;l.PTSKnown&&E<p&&(u.end>p||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=p+.05)}if(d>=h&&!this.switchingTrack&&m<f[f.length-1].start)return;let y=this.getNextFragment(m,l);if(y&&this.isLoopLoading(y,m)&&(y=this.getNextFragmentLoopLoading(y,l,u,X.MAIN,h)),!y){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&Qe(y)&&!y.endList&&(!l.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===nt.OK&&(this.mainFragLoading=v=null),v&&Qe(v))){if(y.start>v.end){const S=this.fragmentTracker.getFragAtPos(m,X.MAIN);S&&S.end>v.end&&(v=S,this.mainFragLoading={frag:S,targetBufferTime:null})}if(y.start>v.end)return}this.loadFragment(y,a,m)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Ja(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==G.STOPPED&&(this.setInterval(mE),this.state=G.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(x.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:s}=this,{details:i,id:o,groupId:a,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==G.STOPPED&&(this.state=G.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const u=s[o];let d=0;if(i.live||(n=u.details)!=null&&n.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(u.details){var h;d=this.alignPlaylists(i,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}i.alignedSliding||(gA(i,c),i.alignedSliding||ku(i,c),d=i.fragmentStart)}u.details=i,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(x.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===G.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=G.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const d=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new NA(this.hls,X.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[n.cc],p=(t=n.initSegment)==null?void 0:t.data;if(f!==void 0){const m=s?s.index:-1,y=m!==-1,v=new Am(n.level,n.sn,n.stats.chunkCount,i.byteLength,m,y);h.push(i,p,d,"",n,s,u.totalduration,!1,v,f)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:g}=this.waitingData=this.waitingData||{frag:n,part:s,cache:new mA,complete:!1};g.push(new Uint8Array(i)),this.state!==G.STOPPED&&(this.state=G.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===X.MAIN&&Qe(t.frag)&&(this.mainFragLoading=t,this.state===G.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:s}=t;if(n.type!==X.AUDIO){!this.audioOnly&&n.type===X.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Qe(n)){this.fragPrevious=n;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,xe({},i)))}this.fragBufferedComplete(n,s),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=G.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(X.AUDIO,t);break;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===G.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===fe.AUDIO_TRACK&&(this.state=G.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Re.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Re.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===G.ENDED&&(this.state=G.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,X.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:d}=u,{audio:h,text:f,id3:p,initSegment:g}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=G.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const m=l.initSegment||l;if(this.unhandledEncryptionError(g,l))return;this._bufferInitSegment(u,g.tracks,m,o),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:n,tracks:g.tracks})}if(h){const{startPTS:m,endPTS:y,startDTS:v,endDTS:E}=h;c&&(c.elementaryStreams[Re.AUDIO]={startPTS:m,endPTS:y,startDTS:v,endDTS:E}),l.setElementaryStreamInfo(Re.AUDIO,m,y,v,E),this.bufferFragmentData(h,l,c,o)}if(p!=null&&(t=p.samples)!=null&&t.length){const m=_e({id:n,frag:l,details:d},p);s.trigger(x.FRAG_PARSING_METADATA,m)}if(f){const m=_e({id:n,frag:l,details:d},f);s.trigger(x.FRAG_PARSING_USERDATA,m)}}_bufferInitSegment(e,t,n,s){if(this.state!==G.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=X.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(x.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:n,part:null,chunkMeta:s,parent:n.type,data:a};this.hls.trigger(x.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===nt.NOT_LOADED||s===nt.PARTIAL){var i;if(!Qe(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=G.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&ku(t.details,o)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:s,characteristics:i,audioCodec:o,channels:a}=this.bufferedTrack;ni({name:t,lang:n,assocLang:s,characteristics:i,audioCodec:o,channels:a},e,Gs)||(Au(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(x.AUDIO_TRACK_SWITCHED,xe({},e))}}class Fm extends xr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const a=s[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=s[i],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=n&&kv(n);return new Pv(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:s,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const u=Math.max(l||0,0);s.appliedTimelineOffset=u,s.fragments.forEach(d=>{d.setStart(d.playlistOffset+u)})}if(s.live||n!=null&&n.live){const u="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(n),n&&s.fragments.length>0){wB(n,s,this);const v=s.playlistParsingError;if(v){this.warn(v);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var c;const{networkDetails:S}=t;E.trigger(x.ERROR,{type:ee.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:v,reason:v.message,level:t.level||void 0,parent:(c=s.fragments[0])==null?void 0:c.type,networkDetails:S,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(s.edge-h)*1e3,p=uA(s,f);if(s.requestScheduled+p<o?s.requestScheduled=o:s.requestScheduled+=p,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let g,m,y;if(s.canBlockReload&&s.endSN&&s.advanced){const v=this.hls.config.lowLatencyMode,E=s.lastPartSn,S=s.endSN,T=s.lastPartIndex,A=T!==-1,b=E===S;A?b?(m=S+1,y=v?0:T):(m=E,y=v?T+1:s.maxPartIndex):m=S+1;const R=s.age,L=R+s.ageHeader;let I=Math.min(L-s.partTarget,s.targetduration*1.5);if(I>0){if(L>s.targetduration*3)this.log(`Playlist last advanced ${R.toFixed(2)}s ago. Omitting segment and part directives.`),m=void 0,y=void 0;else if(n!=null&&n.tuneInGoal&&L-s.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${I} with playlist age: ${s.age}`),I=0;else{const C=Math.floor(I/s.targetduration);if(m+=C,y!==void 0){const D=Math.round(I%s.targetduration/s.partTarget);y+=D}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${R.toFixed(2)}s goal: ${I} skip sn ${C} to part ${y}`)}s.tuneInGoal=I}if(g=this.getDeliveryDirectives(s,t.deliveryDirectives,m,y),v||!b){s.requestScheduled=o,this.loadingPlaylist(u,g);return}}else(s.canBlockReload||s.canSkipUntil)&&(g=this.getDeliveryDirectives(s,t.deliveryDirectives,m,y));g&&m!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(p-a*2,p/2)),this.scheduleLoading(u,g,s)}else this.clearTimer()}scheduleLoading(e,t,n){const s=n||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const a=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,s){let i=kv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,s=t.part,i=kc.No),new Pv(n,s,i)}checkRetry(e){const t=e.details,n=Ru(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=s||{},l=!!s&&!!a&&(i===pt.RetryRequest||!s.resolved&&i===pt.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=bm(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function MA(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!rl(r[t].attrs,e[t].attrs))return!1;return!0}function rl(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>r[s]!==e[s])}function Pp(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class kj extends Fm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==s){this.warn(`Audio track with id:${n} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${n} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,f)=>{h.id=f});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const h=nn(l,a,Gs);if(h>-1)i=a[h];else{const f=nn(l,this.tracks);i=this.tracks[f]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(a.length&&d===-1){var o;const h=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(h.message),this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===fe.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const s=this.currentTrack;if(s&&ni(e,s,Gs))return s;const i=nn(e,this.tracksInGroup,Gs);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=VU(e,t.levels,n,o,Gs);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=nn(e,n);if(o>-1)return n[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===n&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,xe({},s)),i))return;const o=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(!(this.selectDefaultTrack&&!s.default)&&(!e||ni(e,s,Gs)))return n}if(e){const{name:n,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(ni({name:n,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l},u,Gs))return c}for(let c=0;c<t.length;c++){const u=t[c];if(rl(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(rl(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Au(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}}class Pj{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var n;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(n=this.tracks[e])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],s=n==null?void 0:n.buffer;return s?`SourceBuffer${s.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const yE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,FA="HlsJsTrackRemovedError";class Dj extends Error{constructor(e){super(e),this.name=FA}}class Oj extends xr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:s,mediaSource:i}=this;n&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:s}=this;n!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=rU(As(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_APPENDING,this.onBufferAppending,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.BUFFER_EOS,this.onBufferEos,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.FRAG_PARSED,this.onFragParsed,this),e.on(x.FRAG_CHANGED,this.onFragChanged,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_APPENDING,this.onBufferAppending,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_EOS,this.onBufferEos,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.FRAG_PARSED,this.onFragParsed,this),e.off(x.FRAG_CHANGED,this.onFragChanged,this),e.off(x.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?_e(n,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(n[o]=_e({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const s=As(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=n.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");const l=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||l&&o instanceof l,vE(n),Nj(n,a),n.load()}catch{n.src=a}else n.src=a}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ie(n,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${Ie(s,(l,c)=>l==="initSegment"?void 0:c)}}`),!D_(s,n)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(n)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(x.MEDIA_DETACHING,{}),this.onMediaAttaching(x.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,i.forEach(l=>{const c=l,u=s[c];if(u){const d=u.buffer;if(d){const h=this.fragmentTracker,f=u.id;if(h.hasFragments(f)||h.hasParts(f)){const m=le.getBuffered(d);h.detectEvictedFragments(c,m,f,null,!0)}const p=$h(c),g=[c,d];this.sourceBuffers[p]=g,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=i.readyState==="open";try{const l=i.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),i.removeSourceBuffer(l[c]);a&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),n||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&vE(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(x.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[$h(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Pj(this.tracks)}onBufferCodecs(e,t){var n;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&i.some(l=>!s[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var c,u;const d=t[l],{id:h,codec:f,levelCodec:p,container:g,metadata:m,supplemental:y}=d;let v=s[l];const E=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],S=E!=null&&E.buffer?E:v,T=(S==null?void 0:S.pendingCodec)||(S==null?void 0:S.codec),A=S==null?void 0:S.levelCodec;v||(v=s[l]={buffer:void 0,listeners:[],codec:f,supplemental:y,container:g,levelCodec:p,metadata:m,id:h});const b=Cc(T,A),R=b==null?void 0:b.replace(yE,"$1");let L=Cc(f,p);const I=(u=L)==null?void 0:u.replace(yE,"$1");L&&b&&R!==I&&(l.slice(0,5)==="audio"&&(L=bu(L,this.appendSource)),this.log(`switching codec ${T} to ${L}`),L!==(v.pendingCodec||v.codec)&&(v.pendingCodec=L),v.container=g,this.appendChangeType(l,g,L))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const s=`${t};codecs=${n}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),a.changeType(s),o.codec=n,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,s=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,X.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&le.isBuffered(l.buffer,s)||((a=this.fragmentTracker.getAppendedFrag(s,X.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:s,type:i,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=t,d=c.buffering[i],{sn:h,cc:f}=a,p=self.performance.now();d.start=p;const g=a.stats.buffering,m=l?l.stats.buffering:null;g.start===0&&(g.start=p),m&&m.start===0&&(m.start=p);const y=n.audio;let v=!1;i==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(v=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const E=n.video,S=E==null?void 0:E.buffer;if(S&&h!=="initSegment"){const b=l||a,R=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(E.ending||E.ended)){const I=b.start+b.duration*.05,C=S.buffered,D=this.currentOp("video");!C.length&&!D?this.blockAudio(b):!D&&!le.isBuffered(S,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(b)}else if(i==="video"){const L=b.end;if(R){const I=R.frag.start;(L>I||L<this.lastVideoAppendEnd||le.isBuffered(S,I))&&this.unblockAudio()}this.lastVideoAppendEnd=L}}const T=(l||a).start,A={label:`append-${i}`,execute:()=>{var b;d.executeStart=self.performance.now();const R=(b=this.tracks[i])==null?void 0:b.buffer;R&&(v?this.updateTimestampOffset(R,T,.1,i,h,f):u!==void 0&&Y(u)&&this.updateTimestampOffset(R,u,1e-6,i,h,f)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const b=self.performance.now();d.executeEnd=d.end=b,g.first===0&&(g.first=b),m&&m.first===0&&(m.first=b);const R={};this.sourceBuffers.forEach(([L,I])=>{L&&(R[L]=le.getBuffered(I))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:i,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:R})},onError:b=>{var R;const L={type:ee.MEDIA_ERROR,parent:a.type,details:N.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:l,chunkMeta:c,error:b,err:b,fatal:!1},I=(R=this.media)==null?void 0:R.error;if(b.code===DOMException.QUOTA_EXCEEDED_ERR||b.name=="QuotaExceededError"||"quota"in b)L.details=N.BUFFER_FULL_ERROR;else if(b.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)L.errorAction=lo(!0);else if(b.name===FA&&this.sourceBufferCount===0)L.errorAction=lo(!0);else{const C=++this.appendErrors[i];this.warn(`Failed ${C}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${I||"no media error"})`),(C>=this.hls.config.appendErrorMaxRetry||I)&&(L.fatal=!0)}this.hls.trigger(x.ERROR,L)}};this.log(`queuing "${i}" append sn: ${h}${l?" p: "+l.index:""} of ${a.type===X.MAIN?"level":"track"} ${a.level} cc: ${f}`),this.append(A,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:n,startOffset:s,endOffset:i}=t;n?this.append(this.getFlushOp(n,s,i),n):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:n,part:s}=t,i=[],o=s?s.elementaryStreams:n.elementaryStreams;o[Re.AUDIOVIDEO]?i.push("audiovideo"):(o[Re.AUDIO]&&i.push("audio"),o[Re.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();n.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const c=s?s.stats:n.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:n,part:s,stats:c,id:n.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(a,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(x.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(x.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===N.BUFFER_APPEND_ERROR&&t.frag){var n;const s=(n=t.errorAction)==null?void 0:n.nextAutoLevel;Y(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const s=e.config,i=n.currentTime,o=t.levelTargetDuration,a=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(Y(a)&&a>=0){const c=Math.max(a,o),u=Math.floor(i/o)*o-c;this.flushBackBuffer(i,o,u)}const l=s.frontBufferFlushThreshold;if(Y(l)&&l>0){const c=Math.max(s.maxBufferLength,l),u=Math.max(c,o),d=Math.floor(i/o)*o+u;this.flushFrontBuffer(i,o,d)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=le.getBuffered(i);if(a.length>0&&n>a.start(0)){var o;this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:n});const l=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=le.getBuffered(i),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(n>l||e>=l&&e<=c)return;this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,s);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return Y(i)?{duration:i}:null;const o=this.media.duration,a=Y(n.duration)?n.duration:0;return s>a&&s>o||!Y(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:n}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(Y(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${n}.`),s.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ie(n)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const s=this.tracks[t];e[t]={buffer:n,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(x.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${Ie(a)}`);try{const u=n.addSourceBuffer(c),d=$h(o),h=[o,u];t[d]=h,a.buffer=u}catch(u){var s;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let s=e.codec;n&&(t==="video"||t==="audiovideo")&&Qa(n,"video")&&(s=bU(s,n));const i=Cc(s,e.levelCodec);return i?t.slice(0,5)==="audio"?bu(i,this.appendSource):i:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${s}`,t),this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,n,s,i,o){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:s,mediaSource:i}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!s||!i||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=Y(s.duration)?s.duration:1/0,c=Y(i.duration)?i.duration:1/0,u=Math.max(0,t),d=Math.min(n,l,c);d>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),a.remove(u,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],s=n==null?void 0:n.buffer;if(!s)throw new Dj(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const s=(n=this.tracks[t])==null?void 0:n.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=n.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(s=>{n.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function vE(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function Nj(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function $h(r){return r==="audio"?1:0}class $m{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Y(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,$m.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const s=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,n);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&s(l,e[a+1])){i=a;break}}return i}}const Mj={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Mt=Mj,Fj={HLS:"h"},$j=Fj;class un{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof un?n:new un(n))),this.value=e,this.params=t}}const Uj="Dict";function Bj(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function jj(r,e,t,n){return new Error(`failed to ${r} "${Bj(e)}" as ${t}`,{cause:n})}function dn(r,e,t){return jj("serialize",r,e,t)}class $A{constructor(e){this.description=e}}const EE="Bare Item",Gj="Boolean";function Vj(r){if(typeof r!="boolean")throw dn(r,Gj);return r?"?1":"?0"}function Kj(r){return btoa(String.fromCharCode(...r))}const Hj="Byte Sequence";function Wj(r){if(ArrayBuffer.isView(r)===!1)throw dn(r,Hj);return`:${Kj(r)}:`}const zj="Integer";function qj(r){return r<-999999999999999||999999999999999<r}function UA(r){if(qj(r))throw dn(r,zj);return r.toString()}function Yj(r){return`@${UA(r.getTime()/1e3)}`}function BA(r,e){if(r<0)return-BA(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const s=Math.floor(r*t);return(s%2===0?s:s+1)/t}else return Math.round(r*t)/t}const Qj="Decimal";function Xj(r){const e=BA(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw dn(r,Qj);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Jj="String",Zj=/[\x00-\x1f\x7f]+/;function e3(r){if(Zj.test(r))throw dn(r,Jj);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function t3(r){return r.description||r.toString().slice(7,-1)}const r3="Token";function SE(r){const e=t3(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw dn(e,r3);return e}function Dp(r){switch(typeof r){case"number":if(!Y(r))throw dn(r,EE);return Number.isInteger(r)?UA(r):Xj(r);case"string":return e3(r);case"symbol":return SE(r);case"boolean":return Vj(r);case"object":if(r instanceof Date)return Yj(r);if(r instanceof Uint8Array)return Wj(r);if(r instanceof $A)return SE(r);default:throw dn(r,EE)}}const n3="Key";function Op(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw dn(r,n3);return r}function Um(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${Op(e)}`:`;${Op(e)}=${Dp(t)}`).join("")}function jA(r){return r instanceof un?`${Dp(r.value)}${Um(r.params)}`:Dp(r)}function s3(r){return`(${r.value.map(jA).join(" ")})${Um(r.params)}`}function i3(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw dn(r,Uj);const t=r instanceof Map?r.entries():Object.entries(r),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof un||(i=new un(i));let o=Op(s);return i.value===!0?o+=Um(i.params):(o+="=",Array.isArray(i.value)?o+=s3(i):o+=jA(i)),o}).join(`,${n}`)}function GA(r,e){return i3(r,e)}const zr="CMCD-Object",Ke="CMCD-Request",Fs="CMCD-Session",zn="CMCD-Status",o3={br:zr,ab:zr,d:zr,ot:zr,tb:zr,tpb:zr,lb:zr,tab:zr,lab:zr,url:zr,pb:Ke,bl:Ke,tbl:Ke,dl:Ke,ltc:Ke,mtp:Ke,nor:Ke,nrr:Ke,rc:Ke,sn:Ke,sta:Ke,su:Ke,ttfb:Ke,ttfbb:Ke,ttlb:Ke,cmsdd:Ke,cmsds:Ke,smrt:Ke,df:Ke,cs:Ke,ts:Ke,cid:Fs,pr:Fs,sf:Fs,sid:Fs,st:Fs,v:Fs,msd:Fs,bs:zn,bsd:zn,cdn:zn,rtp:zn,bg:zn,pt:zn,ec:zn,e:zn},a3={REQUEST:Ke};function l3(r){return Object.keys(r).reduce((e,t)=>{var n;return(n=r[t])===null||n===void 0||n.forEach(s=>e[s]=t),e},{})}function c3(r,e){const t={};if(!r)return t;const n=Object.keys(r),s=e?l3(e):{};return n.reduce((i,o)=>{var a;const l=o3[o]||s[o]||a3.REQUEST,c=(a=i[l])!==null&&a!==void 0?a:i[l]={};return c[o]=r[o],i},t)}function u3(r){return["ot","sf","st","e","sta"].includes(r)}function d3(r){return typeof r=="number"?Y(r):r!=null&&r!==""&&r!==!1}const VA="event";function h3(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const s=t.pathname.split("/").slice(1),i=n.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const Nc=r=>Math.round(r),Np=(r,e)=>Array.isArray(r)?r.map(t=>Np(t,e)):r instanceof un&&typeof r.value=="string"?new un(Np(r.value,e),r.params):(e.baseUrl&&(r=h3(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),ic=r=>Nc(r/100)*100,f3=(r,e)=>{let t=r;return e.version>=2&&(r instanceof un&&typeof r.value=="string"?t=new un([r]):typeof r=="string"&&(t=[r])),Np(t,e)},p3={br:Nc,d:Nc,bl:ic,dl:ic,mtp:ic,nor:f3,rtp:ic,tb:Nc},KA="request",HA="response",Bm=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],g3=["e"],m3=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Td(r){return m3.test(r)}function y3(r){return Bm.includes(r)||g3.includes(r)||Td(r)}const WA=["d","dl","nor","ot","rtp","su"];function v3(r){return Bm.includes(r)||WA.includes(r)||Td(r)}const E3=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function S3(r){return Bm.includes(r)||WA.includes(r)||E3.includes(r)||Td(r)}const x3=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function w3(r){return x3.includes(r)||Td(r)}const T3={[HA]:S3,[VA]:y3,[KA]:v3};function zA(r,e={}){const t={};if(r==null||typeof r!="object")return t;const n=e.version||r.v||1,s=e.reportingMode||KA,i=n===1?w3:T3[s];let o=Object.keys(r).filter(i);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=s===HA||s===VA;l&&!o.includes("ts")&&o.push("ts"),n>1&&!o.includes("v")&&o.push("v");const c=_e({},p3,e.formatters),u={version:n,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(d=>{let h=r[d];const f=c[d];if(typeof f=="function"&&(h=f(h,u)),d==="v"){if(n===1)return;h=n}d=="pr"&&h===1||(l&&d==="ts"&&!Y(h)&&(h=Date.now()),d3(h)&&(u3(d)&&typeof h=="string"&&(h=new $A(h)),t[d]=h))}),t}function b3(r,e={}){const t={};if(!r)return t;const n=zA(r,e),s=c3(n,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[o,a])=>{const l=GA(a,{whitespace:!1});return l&&(i[o]=l),i},t)}function _3(r,e,t){return _e(r,b3(e,t))}const A3="CMCD";function R3(r,e={}){return r?GA(zA(r,e),{whitespace:!1}):""}function I3(r,e={}){if(!r)return"";const t=R3(r,e);return encodeURIComponent(t)}function L3(r,e={}){if(!r)return"";const t=I3(r,e);return`${A3}=${t}`}const xE=/CMCD=[^&#]+/;function C3(r,e,t){const n=L3(e,t);if(!n)return r;if(xE.test(r))return r.replace(xE,n);const s=r.includes("?")?"&":"?";return`${r}${s}${n}`}class k3{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Mt.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,a=this.hls.levels[i.level],l=this.getObjectType(i),c={d:(o||i).duration*1e3,ot:l};(l===Mt.VIDEO||l===Mt.AUDIO||l==Mt.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(i);u!=null&&u.url&&u.url!==i.url&&(c.nor=u.url),this.apply(s,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHED,this.onMediaDetached,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHED,this.onMediaDetached,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,s;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:$j.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){_e(t,this.createData());const n=t.ot===Mt.INIT||t.ot===Mt.VIDEO||t.ot===Mt.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,a)=>(s.includes(a)&&(o[a]=t[a]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),_3(e.headers,t,i)):e.url=C3(e.url,t,i)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const s=e.sn-n.startSN;return n.fragments[s+1]}}getNextPart(e){var t;const{index:n,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.index===n&&l.fragment.sn===o)return i[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Mt.TIMED_TEXT;if(e.sn==="initSegment")return Mt.INIT;if(t==="audio")return Mt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Mt.VIDEO:Mt.MUXED}getTopBandwidth(e){let t=0,n;const s=this.hls;if(e===Mt.AUDIO)n=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;n=s.levels.slice(0,o)}return n.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Mt.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:le.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const P3=3e5;class D3 extends xr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===pt.SendAlternateToPenaltyBox&&n.flags===zt.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&s?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==o),t.details===N.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${Ie(i)} penalized: ${Ie(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,s=performance.now();Object.keys(n).forEach(i=>{s-n[i]>P3&&delete n[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in n)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,fA(t),this.hls.trigger(x.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,n){const s=this.getLevelsForPathway(n).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===fe.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===fe.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const d=new $e(u.attrs);d["PATHWAY-ID"]=o;const h=d.AUDIO&&`${d.AUDIO}_clone_${o}`,f=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;h&&(n[d.AUDIO]=h,d.AUDIO=h),f&&(s[d.SUBTITLES]=f,d.SUBTITLES=f);const p=qA(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),g=new Ja({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:p,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let m=1;m<u.audioGroups.length;m++)g.addGroupId("audio",`${u.audioGroups[m]}_clone_${o}`);if(u.subtitleGroups)for(let m=1;m<u.subtitleGroups.length;m++)g.addGroupId("text",`${u.subtitleGroups[m]}_clone_${o}`);return g});t.push(...c),wE(this.audioTracks,n,l,o),wE(this.subtitleTracks,s,l,o)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+u)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,d,h,f)=>{this.log(`Loaded steering manifest: "${s}"`);const p=u.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":y}=p;if(g)try{this.uri=new self.URL(g,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||h.url),m&&this.clonePathways(m);const v={steeringManifest:p,url:s.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,v),y&&this.updatePathwayPriority(y)},onError:(u,d,h,f)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let p=this.timeToLoad*1e3;if(u.code===429){const g=this.loader;if(typeof(g==null?void 0:g.getResponseHeader)=="function"){const m=g.getResponseHeader("Retry-After");m&&(p=parseFloat(m)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,p)},onTimeout:(u,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const s=(n=this.hls)==null?void 0:n.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function wE(r,e,t,n){r&&Object.keys(e).forEach(s=>{const i=r.filter(o=>o.groupId===s).map(o=>{const a=_e({},o);return a.details=void 0,a.attrs=new $e(a.attrs),a.url=a.attrs.URI=qA(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[s],a.attrs["PATHWAY-ID"]=n,a});r.push(...i)})}function qA(r,e,t,n){const{HOST:s,PARAMS:i,[t]:o}=n;let a;e&&(a=o==null?void 0:o[e],a&&(r=a));const l=new self.URL(r);return s&&!a&&(l.host=s),i&&Object.keys(i).sort().forEach(c=>{c&&l.searchParams.set(c,i[c])}),l.href}class uo extends xr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=uo.CDMCleanupPromise?[uo.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:s}=t,i=`"${t.type}" event: init data type: "${n}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=na(this.config));const a=o.map(Ch).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=Pc(o);if(n!=="sinf"||a!==je.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${a}`);return}let l;try{const f=tt(new Uint8Array(s)),p=Im(JSON.parse(f).sinf),g=G_(p);if(!g)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(g.subarray(8,24))}catch(f){this.warn(`${i} Failed to parse sinf: ${f}`);return}const c=gt(l),{keyIdToKeySessionPromise:u,mediaKeySessions:d}=this;let h=u[c];for(let f=0;f<d.length;f++){const p=d[f],g=p.decryptdata;if(!g.keyId)continue;const m=gt(g.keyId);if(Lu(l,g.keyId)||g.uri.replace(/-/g,"").indexOf(c)!==-1){if(h=u[m],!h)continue;if(g.pssh)break;delete u[m],g.pssh=new Uint8Array(s),g.keyId=l,h=u[c]=h.then(()=>this.generateRequestWithPreferredKeySession(p,n,s,"encrypted-event-key-match")),h.catch(y=>this.handleError(y));break}}h||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(x.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===je.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(o,a,l)=>!!o&&l.indexOf(o)===a,s=t.map(o=>o.audioCodec).filter(n),i=t.map(o=>o.videoCodec).filter(n);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,s,i).then(d=>o({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof Wt?a(d):a(new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${n}`;return iA===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return n(e,t)}getMediaKeysPromise(e,t,n){var s;const i=fB(e,t,n,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(s=o)==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ie(i)}`),a=this.requestMediaKeySystemAccess(e,i);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=c.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(f=>f?this.setMediaKeysServerCertificate(h,e,f):h)));return d.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),d})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${gt(e.keyId||[])} keyUri: ${e.uri}`);const s=n.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),s=oc(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(n,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${gt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Ch(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=Ch(s);i?t(i):n(new Error(`Unable to find format for key-system "${s}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=na(this.config),n=e.map(Pc).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const s=O3(e,t[n]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,n=oc(t),s=this.bannedKeyIds[n];if(s||this.getKeyStatus(t)==="internal-error"){const a=TE(s||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[n];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[n]=a,a}return o.catch(a=>{if(a instanceof Wt){const l=xe({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new Wt(l,a.message);this.handleError(c,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Wt){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${gt(n.keyId||[])})`:""}`),this.hls.trigger(x.ERROR,e.data)}else this.error(e.message),this.hls.trigger(x.ERROR,{type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=oc(e),n=this.keyIdToKeySessionPromise[t];if(!n){const s=Pc(e.keyFormat),i=s?[s]:na(this.config);return this.attemptKeySystemAccess(i)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=na(this.config)),e.length===0)throw new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ie({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>n.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,n,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const p=o.call(this.hls,t,n,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,n=p.initData?p.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(n===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const a=oc(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${n.byteLength})`);const c=new Cm,u=e._onmessage=p=>{const g=e.mediaKeysSession;if(!g){c.emit("error",new Error("invalid state"));return}const{messageType:m,message:y}=p;this.log(`"${m}" message event for session "${g.sessionId}" message size: ${y.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,y).catch(v=>{c.eventNames().length?c.emit("error",v):this.handleError(v)}):m==="license-release"?e.keySystem===je.FAIRPLAY&&this.updateKeySession(e,Rp("acknowledged")).then(()=>this.removeSession(e)).catch(v=>this.handleError(v)):this.warn(`unhandled media key message type "${m}"`)},d=(p,g)=>{g.keyStatus=p;let m;p.startsWith("usable")?c.emit("resolved"):p==="internal-error"||p==="output-restricted"||p==="output-downscaled"?m=TE(p,g.decryptdata):p==="expired"?m=new Error(`key expired (keyId: ${a})`):p==="released"?m=new Error("key released"):p==="status-pending"||this.warn(`unhandled key status change "${p}" (keyId: ${a})`),m&&(c.eventNames().length?c.emit("error",m):this.handleError(m))},h=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const m=this.getKeyStatuses(e);if(!Object.keys(m).some(S=>m[S]!=="status-pending"))return;if(m[a]==="expired"){this.log(`Expired key ${Ie(m)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let v=m[a];if(v)d(v,e);else{var E;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(E=e.keyStatusTimeouts)[a]||(E[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const T=this.getKeyStatus(e.decryptdata);if(T&&T!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${T} from other session.`),d(T,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),v="internal-error",d(v,e)},1e3)),this.log(`No status for keyId ${a} (${Ie(m)}).`)}};Lt(e.mediaKeysSession,"message",u),Lt(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((p,g)=>{c.on("error",g),c.on("resolved",p)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(p=>{throw new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>f).catch(p=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw p}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,s)=>{if(typeof s=="string"&&typeof n=="object"){const a=s;s=n,n=a}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===je.PLAYREADY&&i.length===16){const a=gt(i);t[a]=n,nA(i)}const o=gt(i);n==="internal-error"&&(this.bannedKeyIds[o]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,s=new n(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,p,g)=>{o(h.data)},onError:(h,f,p,g)=>{a(new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:xe({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${i}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,p)=>{a(new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(h,f,p)=>{a(new Error("aborted"))}};s.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((s,i)=>{e.setServerCertificate(n).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(s=>{throw new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(n,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let u;for(let d=0,h=i.length;d<h;d++){var o,a;u=i[d];const f=(o=u.querySelector("name"))==null?void 0:o.textContent,p=(a=u.querySelector("value"))==null?void 0:a.textContent;f&&p&&e.setRequestHeader(f,p)}}const l=s.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Rp(atob(c))}setupLicenseXHR(e,t,n,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,n,s)}).catch(o=>{if(!n.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,n,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}s(l)}else{const l=n.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)i(new Wt({type:ee.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==je.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Lt(n,"encrypted",this.onMediaEncrypted),Lt(n,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Bt(e,"encrypted",this.onMediaEncrypted),Bt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,xs.clearKeyUriToKeyIdMap();const i=s.length;uo.CDMCleanupPromise=Promise.all(s.map(o=>this.removeSession(o)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${gt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(c=>self.clearTimeout(o[c]));const{drmSystemOptions:a}=this.config;return(gB(a)?new Promise((c,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(u)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}uo.CDMCleanupPromise=void 0;function oc(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return gt(r.keyId)}function O3(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class Wt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function TE(r,e){const t=r==="output-restricted",n=t?N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:N.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Wt({type:ee.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class N3{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,c=this.hls;if(c.trigger(x.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function YA(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function QA(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){we.debug(`[texttrack-utils]: ${n}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,r.addCue(s)}catch(s){we.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(r.mode=t)}function Qi(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let n=r.cues.length;n--;)e&&r.cues[n].removeEventListener("enter",e),r.removeCue(r.cues[n]);t==="disabled"&&(r.mode=t)}function Mp(r,e,t,n){const s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const i=F3(r.cues,e,t);for(let o=0;o<i.length;o++)(!n||n(i[o]))&&r.removeCue(i[o])}s==="disabled"&&(r.mode=s)}function M3(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,s=t,i;for(;n<=s;)if(i=Math.floor((s+n)/2),e<r[i].startTime)s=i-1;else if(e>r[i].startTime&&n<t)n=i+1;else return i;return r[n].startTime-e<e-r[s].startTime?n:s}function F3(r,e,t){const n=[],s=M3(r,e);if(s>-1)for(let i=s,o=r.length;i<o;i++){const a=r[i];if(a.startTime>=e&&a.endTime<=t)n.push(a);else if(a.startTime>t)return n}return n}function Mc(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}class $3 extends Fm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=Mc(this.media.textTracks);for(let i=0;i<n.length;i++)if(n[i].mode==="hidden")t=n[i];else if(n[i].mode==="showing"){t=n[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Mc(n.textTracks).forEach(o=>{Qi(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${n} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${n} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!n||n.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,d)=>{u.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const u=nn(a,o);if(u>-1)i=o[u];else{const d=nn(a,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(n&&!i.default||!n&&!e)&&(!e||ni(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(rl(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(rl(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(Pp(s,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===fe.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&ni(e,n))return n;const s=nn(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(n)return null;{const i=nn(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Mc(e.textTracks),n=this.currentTrack;let s;if(n&&(s=t.filter(i=>Pp(n,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Y(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===n&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=s;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const d=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(d)}}function U3(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function Ea(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const ho=.025;let Du=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function B3(r,e,t){return`${r.identifier}-${t+1}-${Ea(e)}`}class j3{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Uh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Uh(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Y(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Uh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ho))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Du.Range:Du.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return G3(this)}}function Uh(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<ho)?e.start:e.start+e.duration}function XA(r,e,t){const n=new self.URL(r,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function Bh(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function G3(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function Mi(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class V3{constructor(e,t,n,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(x.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=n,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(x.LEVEL_LOADED,o),i.once(x.AUDIO_TRACK_LOADED,o),i.once(x.SUBTITLE_TRACK_LOADED,o),i.on(x.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(x.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,i.trigger(x.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=XA(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=le.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=le.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,n){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,n){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Mi(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const bE=.033;class K3 extends xr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(i=s[n])!=null&&i.event;){var i;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let s=0;s<n.length;s++){let i=n[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let s=e;s<=t&&n[s];s++){const i=n[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var n;if(((n=t[s].event)==null?void 0:n.identifier)===e)return s}return-1}findAssetIndex(e,t){const n=e.assetList,s=n.length;if(s>1)for(let i=0;i<s;i++){const o=n[i];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,s=n[n.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:s}=n,i=this.events,o=this.parseDateRanges(s,{url:n.url},t),a=Object.keys(s),l=i?i.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const d=c.cue.pre,h=c.cue.post,f=u.cue.pre,p=u.cue.post;if(d&&!f)return-1;if(f&&!d||h&&!p)return 1;if(p&&!h)return-1;if(!d&&!f&&!h&&!p){const g=c.startTime,m=u.startTime;if(g!==m)return g-m}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],n=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(n||t.length||(i==null?void 0:i.length)!==o.length||o.some((l,c)=>Math.abs(l.playout.start-i[c].playout.start)>.005||Math.abs(l.playout.end-i[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,n){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new j3(l,t),this.eventMap[a]=c,n===!1&&(c.appendInPlace=n)),s.push(c)}}return s}parseSchedule(e,t){const n=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,d)=>{const h=u.cue.pre,f=u.cue.post,p=e[d-1]||null,g=u.appendInPlace,m=f?i:u.startOffset,y=u.duration,v=u.timelineOccupancy===Du.Range?y:0,E=u.resumptionOffset,S=(p==null?void 0:p.startTime)===m,T=m+u.cumulativeDuration;let A=g?T+y:m+E;if(h||!f&&m<=0){const R=c;c+=v,u.timelineStart=T;const L=o;o+=y,n.push({event:u,start:T,end:A,playout:{start:L,end:o},integrated:{start:R,end:c}})}else if(m<=i){if(!S){const I=m-l;if(I>bE){const C=l,D=c;c+=I;const B=o;o+=I;const F={previousEvent:e[d-1]||null,nextEvent:u,start:C,end:C+I,playout:{start:B,end:o},integrated:{start:D,end:c}};n.push(F)}else I>0&&p&&(p.cumulativeDuration+=I,n[n.length-1].end=m)}f&&(A=T),u.timelineStart=T;const R=c;c+=v;const L=o;o+=y,n.push({event:u,start:T,end:A,playout:{start:L,end:o},integrated:{start:R,end:c}})}else return;const b=u.resumeTime;f||b>i?l=i:l=b}),l<i){var a;const u=l,d=c,h=i-l;c+=h;const f=o;o+=h,n.push({previousEvent:((a=n[n.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:u+h,playout:{start:f,end:o},integrated:{start:d,end:c}})}this.setDurations(i,o,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,s=n.live?1/0:n.edge;let i=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,u=a.cue.post,d=c?0:u?s:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=i:(i=0,o=d),!u&&a.snapOptions.in&&(a.resumeAnchor=ui(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<bE&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const f=Y(a.resumeOffset)?a.resumeOffset:a.duration;i+=f})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(n-s)>ho?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(n>=l)return this.log(`"${e.identifier}" resumption ${n} past ${o} playlist end ${l}`),!1;const c=ui(null,a.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u=o==="audio"?.175:0;return Math.abs(c.start-n)<ho+u||Math.abs(c.end-n)<ho+u?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+n;a.startOffset=n,a.timelineStart=l,s||(s=a.duration===null),i||(i=!!a.error);const c=a.error?0:a.duration||0;n+=c}s&&!i?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Rr(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class H3{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let s;try{s=XA(n,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,h,n);this.hls.trigger(x.ERROR,f);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,a=new o(i),l={responseType:"json",url:s.href},c=i.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,p,g)=>{const m=h.data,y=m==null?void 0:m.ASSETS;if(!Array.isArray(y)){const v=this.assignAssetListError(e,N.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,f,g);this.hls.trigger(x.ERROR,v);return}e.assetListResponse=m,this.hls.trigger(x.ASSET_LIST_LOADED,{event:e,assetListResponse:m,networkDetails:g})},onError:(h,f,p,g)=>{const m=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,g,p);this.hls.trigger(x.ERROR,m)},onTimeout:(h,f,p)=>{const g=this.assignAssetListError(e,N.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,p);this.hls.trigger(x.ERROR,g)}};return a.load(l,u,d),this.hls.trigger(x.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,n,s,i,o){return e.error=n,{type:ee.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:n,networkDetails:o,stats:i}}}function _E(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function ac(r,e){return`[${r}] Advancing timeline position to ${e}`}class W3 extends xr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const s=n-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=n,this.bufferedPos=n;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(n,n-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&n<a.start||n>=a.end){var l;const f=this.findItemIndex(a);let p=this.schedule.findItemIndexAtTime(n);if(p===-1&&(p=f+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${n} (resolving from ${f} to ${p})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&p>f){const g=this.schedule.findJumpRestrictedIndex(f+1,p);if(g>f){this.setSchedulePosition(g);return}}this.setSchedulePosition(p);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const f=a.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,f))}return}const u=c.timelineStart,d=c.duration||0;if(o&&n<u||n>=u+d){var h;(h=a.event)!=null&&h.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(n>=s.end){this.timelinePos=s.end;const a=this.findItemIndex(s);this.setSchedulePosition(a+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);n>=o&&this.setScheduleToAssetAtTime(n,i)},this.onScheduleUpdate=(n,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,a=i.events||[],l=i.items||[],c=i.durations,u=n.map(g=>g.identifier),d=!!(a.length||u.length);(d||s)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(g=>Rr(g))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let h=null,f=null;o&&(h=this.updateItem(o,this.timelinePos),this.itemsMatch(o,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const p=this.bufferingItem;if(p&&(f=this.updateItem(p,this.bufferedPos),this.itemsMatch(p,f)?this.bufferingItem=f:p.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(p.event,null))),n.forEach(g=>{g.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const m=g.assetItem.timelineStart,y=g.timelineOffset-m;if(y)try{g.timelineOffset=m}catch(v){Math.abs(y)>ho&&this.warn(`${v} ("${g.assetId}" ${g.timelineOffset}->${m})`)}}}),d||s){if(this.hls.trigger(x.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(h,o),p&&f!==h&&this.trimInPlace(f,p),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new H3(e),this.schedule=new K3(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(x.MEDIA_ENDED,this.onMediaEnded,this),e.on(x.ERROR,this.onError,this),e.on(x.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(x.MEDIA_ENDED,this.onMediaEnded,this),e.off(x.ERROR,this.onError,this),e.off(x.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Bt(e,"play",this.onPlay),Bt(e,"pause",this.onPause),Bt(e,"seeking",this.onSeeking),Bt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Lt(n,"seeking",this.onSeeking),Lt(n,"timeupdate",this.onTimeupdate),Lt(n,"play",this.onPlay),Lt(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(n);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(this.media=null,!n&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=d=>d&&e.getAssetPlayer(d.identifier),s=(d,h,f,p,g)=>{if(d){let m=d[h].start;const y=d.event;if(y){if(h==="playout"||y.timelineOccupancy!==Du.Point){const v=n(f);(v==null?void 0:v.interstitial)===y&&(m+=v.assetItem.startOffset+v[g])}}else{const v=p==="bufferedPos"?o():e[p];m+=v-d.start}return m}return 0},i=(d,h)=>{var f;if(d!==0&&h!=="primary"&&(f=e.schedule)!=null&&f.length){var p;const g=e.schedule.findItemIndexAtTime(d),m=(p=e.schedule.items)==null?void 0:p[g];if(m){const y=m[h].start-m.start;return d+y}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var h,f;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((f=e.schedule)==null?void 0:f.durations[d])||0},l=(d,h)=>{var f,p;const g=e.effectivePlayingItem;if(g!=null&&(f=g.event)!=null&&f.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${h}"`);const m=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(d,h),v=(p=e.schedule.items)==null?void 0:p[y],E=e.getBufferingPlayer(),S=E==null?void 0:E.interstitial,T=S==null?void 0:S.appendInPlace,A=m&&e.itemsMatch(m,v);if(m&&(T||A)){const b=n(e.playingAsset),R=(b==null?void 0:b.media)||e.primaryMedia;if(R){const L=h==="primary"?R.currentTime:s(m,h,e.playingAsset,"timelinePos","currentTime"),I=d-L,C=(T?L:R.currentTime)+I;if(C>=0&&(!b||T||C<=b.duration)){R.currentTime=C;return}}}if(v){let b=d;if(h!=="primary"){const L=v[h].start,I=d-L;b=v.start+I}const R=!e.isInterstitial(v);if((!e.isInterstitial(m)||m.event.appendInPlace)&&(R||v.event.appendInPlace)){const L=e.media||(T?E==null?void 0:E.media:null);L&&(L.currentTime=b)}else if(m){const L=e.findItemIndex(m);if(y>L){const C=e.schedule.findJumpRestrictedIndex(L+1,y);if(C>L){e.setSchedulePosition(C);return}}let I=0;if(R)e.timelinePos=b,e.checkBuffer();else{const C=v.event.assetList,D=d-(v[h]||v).start;for(let B=C.length;B--;){const F=C[B];if(F.duration&&D>=F.startOffset&&D<F.startOffset+F.duration){I=B;break}}}e.setSchedulePosition(y,I)}}},c=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},u={get bufferedEnd(){const d=t(),h=e.bufferingItem;if(h&&h===d){var f;return s(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((f=e.bufferingAsset)==null?void 0:f.startOffset)||0}return 0},get currentTime(){const d=c(),h=e.effectivePlayingItem;return h&&h===d?s(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=c(),f=e.effectivePlayingItem;f&&f===h&&l(d+f.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=c())==null?void 0:d.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var d;const h=(d=c())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(d);if(h.appendInPlace){const p=d.playout.start+d.event.duration;l(p+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!Y(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,s=e.media;if(n&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ie(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var n,s;if(e.media===t)return;let i=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let u;if(o.media)l&&(i=o.transferMedia(),this.detachedData=i),u="Primary";else if(c){const p=this.getBufferingPlayer();p?(i=p.transferMedia(),u=`${p}`):u="detached MediaSource"}else u="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${Ie(i)}`);else if(!this.detachedData||o.media===t){const p=this.playerQueue;p.length>1&&p.forEach(g=>{if(a&&g.interstitial.appendInPlace!==l){const m=g.interstitial;this.clearInterstitial(g.interstitial,null),m.appendInPlace=!1,m.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${m}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",h=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const f=this.schedule;if(h===i&&f){const p=a&&e.assetId===f.assetIdAtEnd;h.overrides={duration:f.duration,endOfStream:!a||p,cueRemoval:!a}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,s=this.effectivePlayingItem;if(n===-1){const i=this.hls.startPosition;if(this.log(ac("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const n=e.event,s=n.findAssetIndex(t),i=Bh(n,s);if(!n.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,n){const s=Bh(e,n);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,a=i.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(ac("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const s=t.parentIdentifier,i=n.getEvent(s);if(i){const o=n.findEventIndex(s),a=n.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,a-1)}}setSchedulePosition(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&Rr(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const u=o.event,d=this.playingAsset,h=d==null?void 0:d.identifier,f=h?this.getAssetPlayer(h):null;if(f&&h&&(!this.eventItemsMatch(o,i)||t!==void 0&&h!==u.assetList[t].identifier)){var l;const p=u.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${p+1}/${u.assetList.length} ${Mi(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(x.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:p,event:u,schedule:s.slice(0),scheduleIndex:e,player:f}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),p);return}this.retreiveMediaSource(h,i),f.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${Rr(o)}`),u.hasPlayed=!0,this.hls.trigger(x.INTERSTITIAL_ENDED,{event:u,schedule:s.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const p=(c=this.schedule)==null?void 0:c.items;if(i&&p){const g=this.findItemIndex(i);this.advanceSchedule(g,p,t,o,a)}return}}this.advanceSchedule(e,s,t,o,a)}advanceSchedule(e,t,n,s,i){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const d=u.interstitial,h=o.findEventIndex(d.identifier);(h<e||h>e+1)&&this.clearInterstitial(d,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(n===void 0){n=o.findAssetIndex(u,this.timelinePos);const p=Bh(u,n-1);if(u.isAssetPastPlayoutLimit(p)||u.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(u,e,n);return}n=p}const d=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let h=this.preloadAssets(u,n);if(this.eventItemsMatch(a,d||s)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Rr(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(x.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const f=u.assetList[n];if(!f){this.advanceAfterAssetEnded(u,e,n||0);return}if(h||(h=this.getAssetPlayer(f.identifier)),h===null||h.destroyed){const p=u.assetList.length;this.warn(`asset ${n+1}/${p} player destroyed ${u}`),h=this.createAssetPlayer(u,f,n),h.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(h,n,t,e,l),this.shouldPlay&&_E(h.media)}else a?(this.resumePrimary(a,e,s),this.shouldPlay&&_E(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Rr(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(ac("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!n)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Rr(e)}`),this.hls.trigger(x.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(n<s.fragmentStart||n>s.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:le.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(ac("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((n=s.mainForwardBufferInfo)==null?void 0:n.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(x.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(x.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const s=xe(xe({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=xe(xe({},this.altSelection),{},{audio:n});return}const i=xe(xe({},s),{},{audio:n});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=xe(xe({},this.altSelection),{},{subtitles:n});return}const i=xe(xe({},s),{},{subtitles:n});this.mediaSelection=i}onAudioTrackSwitching(e,t){const n=Ov(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Ov(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var n;const o=this.schedule.findEventIndex(i.identifier),a=(n=this.schedule.items)==null?void 0:n[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const n=e.end+.25,s=le.bufferInfo(this.primaryMedia,n,0);(s.end>n||(s.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${Rr(e)} (was ${Rr(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const s=le.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,n,e)}updateBufferedPos(e,t,n){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(i),d=Math.min(u+1,t.length-1),h=t[d];if((l===-1&&i&&e>=i.end||(c=h.event)!=null&&c.appendInPlace&&e+.01>=h.start)&&(l=d),this.isInterstitial(i)){const f=i.event;if(d-a>1&&f.appendInPlace===!1||f.assetList.length===0&&f.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>a)this.bufferedToItem(h);else{const f=this.primaryDetails;this.primaryLive&&f&&e>f.edge-f.targetduration&&h.start<f.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else n&&o&&!this.itemsMatch(o,i)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:s,events:i}=n;if(!s||!i)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Rr(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,d)=>{const h=this.getAssetPlayer(u.identifier);h&&(d===c&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(x.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,s=n.assetList.length===0&&!n.assetListLoader,i=n.cue.once;if(s||!i){const o=this.preloadAssets(n,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const n=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var a;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(a=h.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const h=u-l;h>0&&(c=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:s} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,l,e.duration,n);const d=this.assetListLoader.loadAssetList(e,c);d&&(e.assetListLoader=d)}else if(!o&&s){for(let c=t;c<s;c++){const u=e.assetList[c],d=this.getAssetPlayerQueueIndex(u.identifier);(d===-1||this.playerQueue[d].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,s,i,o){const a={parentIdentifier:e.identifier,identifier:B3(e,o,t),duration:i,startOffset:n,timelineStart:s,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const a=s.loadLevelObj||s.levels[s.currentLevel];(o||a)&&(o=_e({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=s.audioTracks[s.audioTrack],c=s.subtitleTracks[s.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const S=this.timelinePos-t.timelineStart;if(S>1){const T=t.duration;T&&S<T&&(u=S)}}const d=t.identifier,h=xe(xe({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=_e({},f,{contentId:Ea(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const p=new V3(this.HlsPlayerClass,h,e,t);this.playerQueue.push(p),e.assetList[n]=t;let g=!0;const m=S=>{if(S.live){var T;const R=new Error(`Interstitials MUST be VOD assets ${e}`),L={fatal:!0,type:ee.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:R},I=((T=this.schedule)==null?void 0:T.findEventIndex(e.identifier))||-1;this.handleAssetItemError(L,e,I,n,R.message);return}const A=S.edge-S.fragmentStart,b=t.duration;(g||b===null||A>b)&&(g=!1,this.log(`Interstitial asset "${d}" duration change ${b} > ${A}`),t.duration=A,this.updateSchedule())};p.on(x.LEVEL_UPDATED,(S,{details:T})=>m(T)),p.on(x.LEVEL_PTS_UPDATED,(S,{details:T})=>m(T)),p.on(x.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(S,T)=>{const A=this.getAssetPlayer(d);if(A&&T.tracks){A.off(x.BUFFER_CODECS,y),A.tracks=T.tracks;const b=this.primaryMedia;this.bufferingAsset===A.assetItem&&b&&!A.media&&this.bufferAssetPlayer(A,b)}};p.on(x.BUFFER_CODECS,y);const v=()=>{var S;const T=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${T}`),!T||!this.schedule)return;const A=this.schedule.findEventIndex(e.identifier),b=(S=this.schedule.items)==null?void 0:S[A];this.isInterstitial(b)&&this.advanceAssetBuffering(b,t)};p.on(x.BUFFERED_TO_END,v);const E=S=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const A=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,A,S)};return p.once(x.MEDIA_ENDED,E(n)),p.once(x.PLAYOUT_LIMIT_REACHED,E(1/0)),p.on(x.ERROR,(S,T)=>{if(!this.schedule)return;const A=this.getAssetPlayer(d);if(T.details===N.BUFFER_STALLED_ERROR){if(A!=null&&A.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${T.error} ${e}`)}),p.on(x.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const T=new Error(`Asset player destroyed unexpectedly ${d}`),A={fatal:!0,type:ee.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),n,T.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Mi(t)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:p}),p}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const s=this.playerQueue[n];this.log(`clear ${s} toSegment: ${t&&Rr(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(n,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,s,i){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,n[s]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Mi(a)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:n.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var n,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,a=this.schedule.findEventIndex(i.identifier),l=(n=this.schedule.items)==null?void 0:n[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const u=i.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const d=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!D_(d,e.tracks)){const h=new Error(`Asset ${Mi(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),f={fatal:!0,type:ee.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},p=i.findAssetIndex(o);this.handleAssetItemError(f,i,a,p,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const s=n.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||s-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${e} (media.currentTime: ${s})`),l&&(c/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,s,i){if(e.details===N.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Mi(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,d=_e({},e,{fatal:!1,errorAction:lo(!0),asset:o,assetListIndex:s,event:t,schedule:u,scheduleIndex:n,player:c});if(this.hls.trigger(x.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,f=this.bufferingAsset,p=new Error(i);if(o&&(this.clearAssetPlayer(a,null),o.error=p),!t.assetList.some(g=>!g.error))t.error=p;else for(let g=s;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===a?this.advanceAfterAssetEnded(t,n,s):f&&f.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,f)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let s=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${Rr(n)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const o=this.updateItem(n,s);this.itemsMatch(n,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var n,s;const i=t.event,o=i.identifier,a=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(o)))return;const l=i.timelineStart,c=i.duration;let u=0;a.forEach((g,m)=>{const y=parseFloat(g.DURATION);this.createAsset(i,m,u,l+u,y,g.URI),u+=y}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${i}`);const d=this.waitingItem,h=(d==null?void 0:d.event.identifier)===o;this.updateSchedule();const f=(s=this.bufferingItem)==null?void 0:s.event;if(h){var p;const g=this.schedule.findEventIndex(o),m=(p=this.schedule.items)==null?void 0:p[g];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){i.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(m)}this.setSchedulePosition(g)}else if((f==null?void 0:f.identifier)===o){const g=i.assetList[0];if(g){const m=this.getAssetPlayer(g.identifier);if(f.appendInPlace){const y=this.primaryMedia;m&&y&&this.bufferAssetPlayer(m,y)}else m&&m.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case N.ASSET_LIST_PARSING_ERROR:case N.ASSET_LIST_LOAD_ERROR:case N.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case N.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const AE=500;class z3 extends Lm{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",X.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=G.IDLE,this.setInterval(AE),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:s}=t;if(this.fragContextChanged(n)||(Qe(n)&&(this.fragPrevious=n),this.state=G.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=n.start;for(let c=0;c<i.length;c++)if(a>=i[c].start&&a<=i[c].end){o=i[c];break}const l=n.start+n.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:s}=t;if(n===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(n,i,X.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===X.SUBTITLE&&(t.details===N.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==G.STOPPED&&(this.state=G.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&MA(this.levels,t)){this.levels=t.map(n=>new Ja(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const s=new Ja(n);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,X.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==G.STOPPED&&this.setInterval(AE)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:s,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(n=l.details)!=null&&n.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const h=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(ku(o,d),c=o.fragmentStart):h&&(c=h.start,Lp(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&h&&(c=h.start,Lp(o,c))}d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=o,this.levelLastLoaded=l,a===s&&(this.hls.trigger(x.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===G.IDLE&&(ui(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&s!=null&&s.key&&s.iv&&co(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer,Rm(s.method)).catch(a=>{throw i.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(x.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=G.IDLE})}}doTick(){if(!this.media){this.state=G.IDLE;return}if(this.state===G.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:s}=this,i=this.getLoadPosition(),o=le.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:a,len:l}=o,c=n.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const d=c.fragments,h=d.length,f=c.edge;let p=null;const g=this.fragPrevious;if(a<f){const v=s.maxFragLookUpTolerance,E=a>f-v?0:v;p=ui(g,d,Math.max(d[0].start,a),E),!p&&g&&g.start<d[0].start&&(p=d[0])}else p=d[h-1];if(p=this.filterReplacedPrimary(p,n.details),!p)return;const m=p.sn-c.startSN,y=d[m-1];if(y&&y.cc===p.cc&&this.fragmentTracker.getState(y)===nt.NOT_LOADED&&(p=y),this.fragmentTracker.getState(p)===nt.NOT_LOADED){const v=this.mapToInitFragWhenRequired(p);v&&this.loadFragment(v,n,a)}}}loadFragment(e,t,n){Qe(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new q3(this.tracksBuffered[this.currentTrackId]||[])}}class q3{constructor(e){this.buffered=void 0;const t=(n,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const Y3={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},JA=r=>String.fromCharCode(Y3[r]||r),Lr=15,yn=100,Q3={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},X3={17:2,18:4,21:6,22:8,23:10,19:13,20:15},J3={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Z3={25:2,26:4,29:6,30:8,31:10,27:13,28:15},e4=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class t4{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;we.log(`${this.time} [${e}] ${n}`)}}}const $s=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class ZA{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const s=t[n];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class r4{constructor(){this.uchar=" ",this.penState=new ZA}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class n4{constructor(e){this.chars=[],this.pos=0,this.currPenState=new ZA,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<yn;t++)this.chars.push(new r4);this.logger=e}equals(e){for(let t=0;t<yn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<yn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<yn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>yn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=yn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=JA(e);if(this.pos>=yn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<yn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<yn;n++){const s=this.chars[n].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class jh{constructor(e){this.rows=[],this.currRow=Lr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Lr;t++)this.rows.push(new n4(e));this.logger=e}reset(){for(let e=0;e<Lr;e++)this.rows[e].clear();this.currRow=Lr-1}equals(e){let t=!0;for(let n=0;n<Lr;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Lr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Lr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ie(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Lr;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[i+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);n.setCursor(e.indent),e.color=n.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ie(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",s=-1;for(let i=0;i<Lr;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class RE{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new jh(n),this.nonDisplayedMemory=new jh(n),this.lastOutputScreen=new jh(n),this.currRollUpRow=this.displayedMemory.rows[Lr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Lr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[n]}this.logger.log(2,"MIDROW: "+Ie(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class IE{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=i4(),this.logger=void 0;const s=this.logger=new t4;this.channels=[null,new RE(e,t,s),new RE(e+1,n,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const s=t[n]&127,i=t[n+1]&127;let o=!1,a=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+$s([t[n],t[n+1]])+"] -> ("+$s([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(s4(s,i,l)){lc(null,null,l),this.logger.log(3,()=>"Repeated command ("+$s([s,i])+") is dropped");continue}lc(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else lc(null,null,l);if(!o&&(a=this.parseChars(s,i),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+$s([s,i])+" orig: "+$s([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(n||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[n];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+$s([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?n=o===1?Q3[e]:J3[e]:n=o===1?X3[e]:Z3[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(n,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let n;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,s.underline=(n&1)===1,n<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((n-16)/2)*4,s}parseChars(e,t){let n,s=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+JA(o)+"' in channel "+n),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+$s(s).join(",")),s}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(n||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=e4[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}lc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function lc(r,e,t){t.a=r,t.b=e}function s4(r,e,t){return t.a===r&&t.b===e}function i4(){return{a:null,b:null}}var jm=function(){if(Cu!=null&&Cu.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function n(a){return t(r,a)}function s(a){return t(e,a)}function i(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)a[d]=u[d]}return a}function o(a,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let h="",f=!1,p=a,g=l,m=c,y=null,v="",E=!0,S="auto",T="start",A=50,b="middle",R=50,L="middle";Object.defineProperty(u,"id",i({},d,{get:function(){return h},set:function(I){h=""+I}})),Object.defineProperty(u,"pauseOnExit",i({},d,{get:function(){return f},set:function(I){f=!!I}})),Object.defineProperty(u,"startTime",i({},d,{get:function(){return p},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",i({},d,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",i({},d,{get:function(){return m},set:function(I){m=""+I,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",i({},d,{get:function(){return y},set:function(I){y=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",i({},d,{get:function(){return v},set:function(I){const C=n(I);if(C===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",i({},d,{get:function(){return E},set:function(I){E=!!I,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",i({},d,{get:function(){return S},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");S=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",i({},d,{get:function(){return T},set:function(I){const C=s(I);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");T=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",i({},d,{get:function(){return A},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",i({},d,{get:function(){return b},set:function(I){const C=s(I);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");b=C,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",i({},d,{get:function(){return R},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");R=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",i({},d,{get:function(){return L},set:function(I){const C=s(I);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");L=C,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class o4{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function eR(r){function e(n,s,i,o){return(n|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class a4{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let s=0;s<n.length;++s)if(t===n[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function tR(r,e,t,n){const s=n?r.split(n):[r];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const Fp=new jm(0,0,""),cc=Fp.align==="middle"?"middle":"center";function l4(r,e,t){const n=r;function s(){const a=eR(r);if(a===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const c=new a4;tR(a,function(h,f){let p;switch(h){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===f){c.set(h,t[g].region);break}break;case"vertical":c.alt(h,f,["rl","lr"]);break;case"line":p=f.split(","),c.integer(h,p[0]),c.percent(h,p[0])&&c.set("snapToLines",!1),c.alt(h,p[0],["auto"]),p.length===2&&c.alt("lineAlign",p[1],["start",cc,"end"]);break;case"position":p=f.split(","),c.percent(h,p[0]),p.length===2&&c.alt("positionAlign",p[1],["start",cc,"end","line-left","line-right","auto"]);break;case"size":c.percent(h,f);break;case"align":c.alt(h,f,["start",cc,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&Fp.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",cc);let d=c.get("position","auto");d==="auto"&&Fp.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){r=r.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),o(),e.endTime=s(),o(),i(r,e)}function rR(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class c4{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new o4,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let i=t.buffer,o=0;for(i=rR(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function s(i){tR(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=n();const a=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=n(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new jm(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{l4(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const u4=/\r\n|\n\r|\n|\r/g,Gh=function(e,t,n=0){return e.slice(n,n+t.length)===t},d4=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Y(t)||!Y(n)||!Y(s)||!Y(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*s,t+=60*60*1e3*i,t};function Gm(r,e,t){return Ea(r.toString())+Ea(e.toString())+Ea(t)}const h4=function(e,t,n){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=n};function f4(r,e,t,n,s,i,o){const a=new c4,l=sr(new Uint8Array(r)).trim().replace(u4,`
`).split(`
`),c=[],u=e?Ej(e.baseTime,e.timescale):0;let d="00:00.000",h=0,f=0,p,g=!0;a.oncue=function(m){const y=t[n];let v=t.ccOffset;const E=(h-u)/9e4;if(y!=null&&y.new&&(f!==void 0?v=t.ccOffset=y.start:h4(t,n,E)),E){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}v=E-t.presentationOffset}const S=m.endTime-m.startTime,T=qt((m.startTime+v-f)*9e4,s*9e4)/9e4;m.startTime=Math.max(T,0),m.endTime=Math.max(T+S,0);const A=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(A)),m.id||(m.id=Gm(m.startTime,m.endTime,A)),m.endTime>0&&c.push(m)},a.onparsingerror=function(m){p=m},a.onflush=function(){if(p){o(p);return}i(c)},l.forEach(m=>{if(g)if(Gh(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(y=>{Gh(y,"LOCAL:")?d=y.slice(6):Gh(y,"MPEGTS:")&&(h=parseInt(y.slice(7)))});try{f=d4(d)/1e3}catch(y){p=y}return}else m===""&&(g=!1);a.parse(m+`
`)}),a.flush()}const Vh="stpp.ttml.im1t",nR=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,sR=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p4={left:"start",center:"center",right:"end",start:"start",end:"end"};function LE(r,e,t,n){const s=he(new Uint8Array(r),["mdat"]);if(s.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(a=>sr(a)),o=vj(e.baseTime,1,e.timescale);try{i.forEach(a=>t(g4(a,o)))}catch(a){n(a)}}function g4(r,e){const s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((d,h)=>(d[h]=s.getAttribute(`ttp:${h}`)||i[h],d),{}),a=s.getAttribute("xml:space")!=="preserve",l=CE(Kh(s,"styling","style")),c=CE(Kh(s,"layout","region")),u=Kh(s,"body","[begin]");return[].map.call(u,d=>{const h=iR(d,a);if(!h||!d.hasAttribute("begin"))return null;const f=Wh(d.getAttribute("begin"),o),p=Wh(d.getAttribute("dur"),o);let g=Wh(d.getAttribute("end"),o);if(f===null)throw kE(d);if(g===null){if(p===null)throw kE(d);g=f+p}const m=new jm(f-e,g-e,h);m.id=Gm(m.startTime,m.endTime,m.text);const y=c[d.getAttribute("region")],v=l[d.getAttribute("style")],E=m4(y,v,l),{textAlign:S}=E;if(S){const T=p4[S];T&&(m.lineAlign=T),m.align=S}return _e(m,E),m}).filter(d=>d!==null)}function Kh(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function CE(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function iR(r,e){return[].slice.call(r.childNodes).reduce((t,n,s)=>{var i;return n.nodeName==="br"&&s?t+`
`:(i=n.childNodes)!=null&&i.length?iR(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function m4(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((a,l)=>{const c=Hh(e,n,l)||Hh(r,n,l)||Hh(s,n,l);return c&&(a[l]=c),a},{})}function Hh(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function kE(r){return new Error(`Could not parse ttml timestamp ${r}`)}function Wh(r,e){if(!r)return null;let t=eR(r);return t===null&&(nR.test(r)?t=y4(r,e):sR.test(r)&&(t=v4(r,e))),t}function y4(r,e){const t=nR.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function v4(r,e){const t=sR.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class uc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class E4{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=DE(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new uc(this,"textTrack1"),t=new uc(this,"textTrack2"),n=new uc(this,"textTrack3"),s=new uc(this,"textTrack4");this.cea608Parser1=new IE(1,e,t),this.cea608Parser2=new IE(3,n,s)}addCues(e,t,n,s,i){let o=!1;for(let a=i.length;a--;){const l=i[a],c=S4(l[0],l[1],t,n);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),o=!0,c/(n-t)>.5))return}if(o||i.push([t,n]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,n,s)}else{const a=this.Cues.newCue(null,t,n,s);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:a}=this;n===X.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(x.FRAG_LOADED,l):this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let s=0;s<n.textTracks.length;s++){const i=n.textTracks[s];if(PE(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:s}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)n[e]=a,Qi(n[e]),YA(n[e],s);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,s={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,n){const s=this.media;if(s)return s.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Qi(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=DE(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Qi(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],s=n.some(i=>i.textCodec===Vh);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(MA(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const o=this.media,a=o?Mc(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let d=null;for(let h=0;h<a.length;h++)if(a[h]&&PE(a[h],l)){d=a[h],a[h]=null;break}d&&(u=d)}if(u)Qi(u);else{const d=oR(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===X.MAIN){var n,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(n=(s=t.part)==null?void 0:s.index)!=null?n:-1;i&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:n,payload:s}=t;if(n.type===X.SUBTITLE)if(s.byteLength){const i=n.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),a&&a.textCodec===Vh?this._parseIMSC1(n,s):this._parseVTTs(t)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;LE(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),n.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{n.logger.log(`Failed to parse IMSC1: ${s}`),n.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:n,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[n.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=n.initSegment)!=null&&t.data?Sr(n.initSegment.data,new Uint8Array(s)).buffer:s;f4(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,u=>{this._appendCues(u,n.level),l.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},u=>{const d=u.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(n,s),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&a>n.cc)&&l.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:u})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||LE(t,this.initPTS[e.cc],()=>{n.textCodec=Vh,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>QA(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;n.trigger(x.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===X.SUBTITLE&&this.onFragLoaded(x.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:s}=t;if(!(n.type===X.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,a[0]),this.cea608Parser2.addData(s[i].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<n)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Mp(a[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Mp(a[l],t,s))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let s=2;for(let i=0;i<n;i++){const o=e[s++],a=127&e[s++],l=127&e[s++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function oR(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function PE(r,e){return!!r&&r.kind===oR(e)&&Pp(e,r)}function S4(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function DE(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const x4=/\s/,w4={newCue(r,e,t,n){const s=[];let i,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<n.rows.length;h++)if(i=n.rows[h],a=!0,l=0,c="",!i.isEmpty()){var d;for(let g=0;g<i.chars.length;g++)x4.test(i.chars[g].uchar)&&a?l++:(c+=i.chars[g].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=rR(c.trim()),p=Gm(e,t,f);r!=null&&(d=r.cues)!=null&&d.getCueById(p)||(o=new u(e,t,f),o.id=p,o.line=h+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(o))}return r&&s.length&&(s.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),s.forEach(h=>QA(r,h))),s}};function T4(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const b4=/(\d+)-(\d+)\/(\d+)/;class OE{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||I4,this.controller=new self.AbortController,this.stats=new Sm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=_4(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&Y(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(tl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const f=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},c-(f-s.loading.start)),!d.ok){const{status:g,statusText:m}=d;throw new L4(m||"fetch, bad network response",g,d)}s.loading.first=f,s.total=R4(d.headers)||s.total;const p=(h=this.callbacks)==null?void 0:h.onProgress;return p&&Y(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,p):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,f;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const g=d[a];g&&(s.loaded=s.total=g);const m={url:p.url,data:d,code:p.status},y=(h=this.callbacks)==null?void 0:h.onProgress;y&&!Y(t.highWaterMark)&&y(s,e,d,p),(f=this.callbacks)==null||f.onSuccess(m,s,e,p)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const f=d&&d.code||0,p=d?d.message:null;(h=this.callbacks)==null||h.onError({code:f,text:p},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,s=0,i){const o=new mA,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&i(t,n,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<s||o.dataLength?(o.push(u),o.dataLength>=s&&i(t,n,o.flush().buffer,e)):i(t,n,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function _4(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(_e({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function A4(r){const e=b4.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function R4(r){const e=r.get("Content-Range");if(e){const n=A4(e);if(Y(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function I4(r,e){return new self.Request(r.url,e)}class L4 extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const C4=/^age:\s*[\d.]+\s*$/im;class aR{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Sm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return i(n,t.url)}).catch(o=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),i(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:n.status,text:o.message},t,n,s)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=n.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=i&&Y(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!n.aborted&&s>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const p=u??t.response;if(p!=null){var o,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const g=t.responseType==="arraybuffer"?p.byteLength:p.length;n.loaded=n.total=g,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const m=(o=this.callbacks)==null?void 0:o.onProgress;m&&m(n,e,p,t);const y={url:t.responseURL,data:p,code:c};(a=this.callbacks)==null||a.onSuccess(y,n,e,t);return}}const d=i.loadPolicy.errorRetry,h=n.retry,f={url:e.url,data:void 0,code:c};if(Iu(d,h,!1,f))this.retry(d);else{var l;we.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Iu(e,t,!0))this.retry(e);else{var n;we.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=bm(e,n.retry),n.retry++,we.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&C4.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const k4={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},P4=xe(xe({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:aR,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:KU,bufferController:Oj,capLevelController:$m,errorController:YU,fpsController:N3,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:iA,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:k4},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},D4()),{},{subtitleStreamController:z3,subtitleTrackController:$3,timelineController:E4,audioStreamController:Cj,audioTrackController:kj,emeController:uo,cmcdController:k3,contentSteeringController:D3,interstitialsController:W3});function D4(){return{cueHandler:w4,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function O4(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=$p(r),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];i.forEach(u=>{const d=`${o}Loading${u}`,h=e[d];if(h!==void 0&&l){c.push(d);const f=n[a].default;switch(e[a]={default:f},u){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${Ie(e[a])}`)}),xe(xe({},n),e)}function $p(r){return r&&typeof r=="object"?Array.isArray(r)?r.map($p):Object.keys(r).reduce((e,t)=>(e[t]=$p(r[t]),e),{}):r}function N4(r,e){const t=r.loader;t!==OE&&t!==aR?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):T4()&&(r.loader=OE,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Fc=2,M4=.1,F4=.05,$4=100;class U4 extends eA{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval($4),this.mediaSource=t.mediaSource;const n=this.media=t.media;Lt(n,"playing",this.onMediaPlaying),Lt(n,"waiting",this.onMediaWaiting),Lt(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Bt(n,"playing",this.onMediaPlaying),Bt(n,"waiting",this.onMediaWaiting),Bt(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,s;const i=(n=this.hls)==null?void 0:n.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1}));return}if(!le.getBuffered(o).length){this.nudgeRetry=0;return}const d=le.bufferInfo(o,e,0),h=d.nextStart||0,f=this.fragmentTracker;if(a&&f&&this.hls){const A=NE(this.hls.inFlightFragments,e),b=d.len>Fc,R=!h||A||h-e>Fc&&!f.getPartialFragment(e);if(b||R)return;this.moved=!1}const p=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(d.len>0)&&!h)return;const b=Math.max(h,d.start||0)-e,L=!!(p!=null&&p.live)?p.targetduration*2:Fc,I=dc(e,f);if(b>0&&(b<=L||I)){o.paused||this._trySkipBufferHole(I);return}}const g=i.detectStallWithCurrentTimeMs,m=self.performance.now(),y=this.waiting;let v=this.stalled;if(v===null)if(y>0&&m-y<g)v=this.stalled=y;else{this.stalled=m;return}const E=m-v;if(!a&&(E>=g||y)&&this.hls){var S;if(((S=this.mediaSource)==null?void 0:S.readyState)==="ended"&&!(p!=null&&p.live)&&Math.abs(e-((p==null?void 0:p.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const T=le.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(T,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(x.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&s&&s.length>1&&e>s.end(0)){const i=le.bufferedInfo(le.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=le.timeRangesToArray(s),a=le.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=le.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((l===-1||l>a)&&u-c<1&&e-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let h=dc(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const f=le.bufferInfo(this.media,e,0);this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,n){var s,i;const{fragmentTracker:o,media:a}=this,l=(s=this.hls)==null?void 0:s.config;if(!a||!o||!l)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,u=dc(n,o);if((u||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,n);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-n<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,s=e.nextStart;if(n&&s){const i=n.getFragAtPos(t,X.MAIN),o=n.getFragAtPos(s,X.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:s,stalled:i}=this;if(!s&&i!==null&&n&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${Ie(e)})`);this.warn(o.message),t.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!n||!i)return 0;const o=s.currentTime,a=le.bufferInfo(s,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const u=a.len<=i.maxBufferHole,d=a.len>0&&a.len<1&&s.readyState<3,h=l-o;if(h>0&&(u||d)){if(h>i.maxBufferHole){let p=!1;if(o===0){const g=n.getAppendedFrag(0,X.MAIN);g&&l<g.end&&(p=!0)}if(!p&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||NE(this.hls.inFlightFragments,l))return 0;let m=!1,y=e.end;for(;y<l;){const v=dc(y,n);if(v)y+=v.duration;else{m=!0;break}}if(m)return 0}}const f=Math.max(l+F4,o+M4);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${f}`),this.moved=!0,s.currentTime=f,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${f}`),g={type:ee.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?g.part=e:g.frag=e),this.hls.trigger(x.ERROR,g)}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!n||!i)return 0;const o=n.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const a=o+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),n.currentTime=a,t.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function NE(r,e){const t=ME(r.main);if(t&&t.start<=e)return t;const n=ME(r.audio);return n&&n.start<=e?n:null}function ME(r){if(!r)return null;switch(r.state){case G.IDLE:case G.STOPPED:case G.ENDED:case G.ERROR:return null}return r.frag}function dc(r,e){return e.getAppendedFrag(r,X.MAIN)||e.getPartialFragment(r)}const B4=.25;function Up(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function zh(r,e,t,n,s){let i=new r(e,t,"");try{i.value=n,s&&(i.type=s)}catch{i=new r(e,t,Ie(s?xe({type:s},n):n))}return i}const hc=(()=>{const r=Up();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class j4{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(x.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Qi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return YA(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:s}=this.hls.config;if(!n&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Up();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Xt.emsg&&!n||!s)continue;const c=TA(i[a].data),u=i[a].pts;let d=u+i[a].duration;d>hc&&(d=hc),d-u<=0&&(d=u+B4);for(let f=0;f<c.length;f++){const p=c[f];if(!bA(p)){this.updateId3CueEnds(u,l);const g=zh(o,u,d,p,l);g&&this.id3Track.addCue(g)}}}}updateId3CueEnds(e,t){var n;const s=(n=this.id3Track)==null?void 0:n.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===hc&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let c;s==="audio"?c=u=>u.type===Xt.audioId3&&l:s==="video"?c=u=>u.type===Xt.emsg&&a:c=u=>u.type===Xt.audioId3&&l||u.type===Xt.emsg&&a,Mp(i,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const a=Up();if(n&&s&&!o){const{fragmentStart:g,fragmentEnd:m}=e;let y=this.assetCue;y?(y.startTime=g,y.endTime=m):a&&(y=this.assetCue=zh(a,g,m,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let d=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const g=Object.keys(d).filter(m=>!u.includes(m));for(let m=g.length;m--;){var f;const y=g[m],v=(f=d[y])==null?void 0:f.cues;delete d[y],v&&Object.keys(v).forEach(E=>{const S=v[E];if(S){S.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(S)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const p=e.fragments[e.fragments.length-1];if(!(u.length===0||!Y(p==null?void 0:p.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let g=0;g<u.length;g++){const m=u[g],y=c[m],v=y.startTime,E=d[m],S=(E==null?void 0:E.cues)||{};let T=(E==null?void 0:E.durationKnown)||!1,A=hc;const{duration:b,endDate:R}=y;if(R&&b!==null)A=v+b,T=!0;else if(y.endOnNext&&!T){const I=u.reduce((C,D)=>{if(D!==y.id){const B=c[D];if(B.class===y.class&&B.startDate>y.startDate&&(!C||y.startDate<C.startDate))return B}return C},null);I&&(A=I.startTime,T=!0)}const L=Object.keys(y.attr);for(let I=0;I<L.length;I++){const C=L[I];if(!lB(C))continue;const D=S[C];if(D)T&&!(E!=null&&E.durationKnown)?D.endTime=A:Math.abs(D.startTime-v)>.01&&(D.startTime=v,D.endTime=A);else if(a){let B=y.attr[C];cB(C)&&(B=O_(B));const V=zh(a,v,A,{key:C,data:B},Xt.dateRange);V&&(V.id=m,this.id3Track.addCue(V),S[C]=V,o&&(C==="X-ASSET-LIST"||C==="X-ASSET-URL")&&V.addEventListener("enter",this.onEventCueEnter))}}d[m]={cues:S,dateRange:y,durationKnown:T}}}}}class G4{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!n.live)return;const a=this.targetLatency;if(a===null)return;const l=s-a,c=Math.min(this.maxLatency,a+n.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,f=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&n||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:o*s);const u=s;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const s=n.edge,i=e-t-this.edgeStalled,o=s-n.totalduration,a=s-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===N.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,s;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class V4 extends Fm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{const d=u.attrs;let{audioCodec:h,videoCodec:f}=u;h&&(u.audioCodec=h=bu(h,n)||void 0),f&&(f=u.videoCodec=_U(f));const{width:p,height:g,unknownCodecs:m}=u,y=(m==null?void 0:m.length)||0;if(a||(a=!!(p&&g)),l||(l=!!f),c||(c=!!h),y||h&&!this.isAudioSupported(h)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:v,"FRAME-RATE":E,"HDCP-LEVEL":S,"PATHWAY-ID":T,RESOLUTION:A,"VIDEO-RANGE":b}=d,L=`${`${T||"."}-`}${u.bitrate}-${A}-${E}-${v}-${b}-${S}`;if(i[L])if(i[L].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const I=o[L]+=1;u.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const C=this.createLevel(u);i[L]=C,s.push(C)}else i[L].addGroupId("audio",d.AUDIO),i[L].addGroupId("text",d.SUBTITLES);else{const I=this.createLevel(u);i[L]=I,o[L]=1,s.push(I)}}),this.filterAndSortMediaOptions(s,t,a,l,c)}createLevel(e){const t=new Ja(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(s.message),t.supportedResult=W_(s,[])}return t}isAudioSupported(e){return Qa(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Qa(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,s,i){var o;let a=[],l=[],c=e;const u=((o=t.stats)==null?void 0:o.parsing)||{};if((n||s)&&i&&(c=c.filter(({videoCodec:v,videoRange:E,width:S,height:T})=>(!!v||!!(S&&T))&&NU(E))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let v="no level with compatible codecs found in manifest",E=v;t.levels.length&&(E=`one or more CODECS in variant not supported: ${Ie(t.levels.map(T=>T.attrs.CODECS).filter((T,A,b)=>b.indexOf(T)===A))}`,this.warn(E),v+=` (${E})`);const S=new Error(v);this.hls.trigger(x.ERROR,{type:ee.MEDIA_ERROR,details:N.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:S,reason:E})}}),u.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(v=>!v.audioCodec||this.isAudioSupported(v.audioCodec)),FE(a)),t.subtitles&&(l=t.subtitles,FE(l));const d=c.slice(0);c.sort((v,E)=>{if(v.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"])return(v.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&v.height!==E.height)return v.height-E.height;if(v.frameRate!==E.frameRate)return v.frameRate-E.frameRate;if(v.videoRange!==E.videoRange)return _u.indexOf(v.videoRange)-_u.indexOf(E.videoRange);if(v.videoCodec!==E.videoCodec){const S=Iv(v.videoCodec),T=Iv(E.videoCodec);if(S!==T)return T-S}if(v.uri===E.uri&&v.codecSet!==E.codecSet){const S=Tu(v.codecSet),T=Tu(E.codecSet);if(S!==T)return T-S}return v.averageBitrate!==E.averageBitrate?v.averageBitrate-E.averageBitrate:0});let h=d[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==d.length)){for(let v=0;v<d.length;v++)if(d[v].pathwayId===c[0].pathwayId){h=d[v];break}}this._levels=c;for(let v=0;v<c.length;v++)if(c[v]===h){var f;this._firstLevel=v;const E=h.bitrate,S=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${E}`),((f=this.hls.userConfig)==null?void 0:f.abrEwmaDefaultEstimate)===void 0){const T=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);T>S&&S===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const p=i&&!s,g=this.hls.config,m=!!(g.audioStreamController&&g.audioTrackController),y={levels:c,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:m&&!p&&a.some(v=>!!v.url)};u.end=performance.now(),this.hls.trigger(x.MANIFEST_PARSED,y)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,n===e&&s&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${n}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,s==null?void 0:s.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===fe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===X.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(i=>!!n[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var n;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${s}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(n=t.deliveryDirectives)!=null&&n.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${n}`),this.hls.trigger(x.LEVEL_LOADING,{url:n,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));fA(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=n.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(x.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function FE(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function lR(){return self.SourceBuffer||self.WebKitSourceBuffer}function cR(){if(!As())return!1;const e=lR();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function K4(){if(!cR())return!1;const r=As();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(Xa(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(Xa(e,"audio"))))}function H4(){var r;const e=lR();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const W4=100;class z4 extends Lm{constructor(e,t,n){super(e,t,n,"stream-controller",X.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!Y(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,X.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:s}=this;if(this.stopLoad(),this.setInterval(W4),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=G.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=G.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case G.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&(!s.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(s))break;this.state=G.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=G.IDLE;break}break}case G.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===G.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[i]))return;const o=n[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const g={};this.altAudio===2&&(g.type="video"),this.hls.trigger(x.BUFFER_EOS,g),this.state=G.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=o.details;if(!c||this.state===G.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=G.WAITING_LEVEL,this.startFragRequested=!1;return}const u=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let f=this.getNextFragment(h,c);if(this.couldBacktrack&&!this.fragPrevious&&f&&Qe(f)&&this.fragmentTracker.getState(f)!==nt.OK){var p;const m=((p=this.backtrackFragment)!=null?p:f).sn-c.startSN,y=c.fragments[m-1];y&&f.cc===y.cc&&(f=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const m=this.audioOnly&&!this.altAudio?Re.AUDIO:Re.VIDEO,y=(m===Re.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,m,X.MAIN)}f=this.getNextFragmentLoopLoading(f,c,a,X.MAIN,d)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,o,h))}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);s===nt.NOT_LOADED||s===nt.PARTIAL?Qe(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,X.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:n=0}else n=0;const o=this.getBufferedFrag(t.currentTime+n);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case G.KEY_LOADING:case G.FRAG_LOADING:case G.FRAG_LOADING_WAITING_RETRY:case G.PARSING:case G.PARSED:this.state=G.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Lt(n,"playing",this.onMediaPlaying),Lt(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Bt(n,"playing",this.onMediaPlaying),Bt(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(n=n||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&s&&!H4(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==G.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=G.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:s,startFragRequested:i}=this,o=t.level,a=t.details,l=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===G.FRAG_LOADING||this.state===G.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let d=0;if(a.live||(n=c.details)!=null&&n.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(c.details=a,this.levelLastLoaded=c,i||this.setStartPosition(a,d),this.hls.trigger(x.LEVEL_UPDATED,{details:a,level:o}),this.state===G.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=G.IDLE}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(s!==null&&n.duration>s&&(i<s||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&n.readyState<4||i<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),n.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const d=le.bufferInfo(n,s,0);if(!((c=d.buffered)!=null&&c.length)){n.currentTime=s;return}if(d.start<=i){n.currentTime=s;return}const{nextStart:f}=le.bufferedInfo(d.buffered,i,0);f&&(n.currentTime=f)}else n.currentTime=s}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const a=o[n.level];if(!a){this.warn(`Level ${n.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,d=(t=n.initSegment)==null?void 0:t.data,h=this._getAudioCodec(a),f=this.transmuxer=this.transmuxer||new NA(this.hls,X.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=s?s.index:-1,g=p!==-1,m=new Am(n.level,n.sn,n.stats.chunkCount,i.byteLength,p,g),y=this.initPTS[n.cc];f.push(i,d,h,c,n,s,l.totalduration,u,m,y)}onAudioTrackSwitching(e,t){const n=this.hls,s=this.altAudio!==0;if(Au(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(x.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(x.AUDIO_TRACK_SWITCHED,t)}),n.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(x.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Au(t.url,this.hls);if(n){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let s,i,o=!1;for(const a in n){const l=n[a];if(l.id==="main"){if(i=a,s=l,a==="video"){const c=n[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:s}=t,i=n.type===X.MAIN;if(i){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===G.PARSED&&(this.state=G.IDLE);return}const a=s?s.stats:n.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),Qe(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,s)}const o=this.media;o&&(!this._hasEnoughToStart&&le.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=G.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(X.MAIN,t);break;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===G.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===fe.LEVEL&&(this.state=G.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=G.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Re.AUDIO||!this.altAudio){const n=(t===Re.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,X.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&n&&(n+=s);const i=this.getLevelDetails(),o=le.getBuffered(e),a=o.length?o.start(0):0,l=a-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${a}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:s}=this,i=n==null?void 0:n.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=G.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(x.FRAG_LOADED,n),i.bitrateTest=!1}).catch(n=>{this.state===G.STOPPED||this.state===G.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:a,part:l,level:c}=o,{video:u,text:d,id3:h,initSegment:f}=s,{details:p}=c,g=this.altAudio?void 0:s.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=G.PARSING,f){const m=f.tracks;if(m){const S=a.initSegment||a;if(this.unhandledEncryptionError(f,a))return;this._bufferInitSegment(c,m,S,i),n.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:t,tracks:m})}const y=f.initPTS,v=f.timescale,E=this.initPTS[a.cc];if(Y(y)&&(!E||E.baseTime!==y||E.timescale!==v)){const S=f.trackId;this.initPTS[a.cc]={baseTime:y,timescale:v,trackId:S},n.trigger(x.INIT_PTS_FOUND,{frag:a,id:t,initPTS:y,timescale:v,trackId:S})}}if(u&&p){g&&u.type==="audiovideo"&&this.logMuxedErr(a);const m=p.fragments[a.sn-1-p.startSN],y=a.sn===p.startSN,v=!m||a.cc>m.cc;if(s.independent!==!1){const{startPTS:E,endPTS:S,startDTS:T,endDTS:A}=u;if(l)l.elementaryStreams[u.type]={startPTS:E,endPTS:S,startDTS:T,endDTS:A};else if(u.firstKeyFrame&&u.independent&&i.id===1&&!v&&(this.couldBacktrack=!0),u.dropped&&u.independent){const b=this.getMainFwdBufferInfo(),R=(b?b.end:this.getLoadPosition())+this.config.maxBufferHole,L=u.firstKeyFramePTS?u.firstKeyFramePTS:E;if(!y&&R<L-this.config.maxBufferHole&&!v){this.backtrack(a);return}else v&&(a.gap=!0);a.setElementaryStreamInfo(u.type,a.start,S,a.start,A,!0)}else y&&E-(p.appliedTimelineOffset||0)>Fc&&(a.gap=!0);a.setElementaryStreamInfo(u.type,E,S,T,A),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,i,y||v)}else if(y||v)a.gap=!0;else{this.backtrack(a);return}}if(g){const{startPTS:m,endPTS:y,startDTS:v,endDTS:E}=g;l&&(l.elementaryStreams[Re.AUDIO]={startPTS:m,endPTS:y,startDTS:v,endDTS:E}),a.setElementaryStreamInfo(Re.AUDIO,m,y,v,E),this.bufferFragmentData(g,a,l,i)}if(p&&h!=null&&h.samples.length){const m={id:t,frag:a,details:p,samples:h.samples};n.trigger(x.FRAG_PARSING_METADATA,m)}if(p&&d){const m={id:t,frag:a,details:p,samples:d.samples};n.trigger(x.FRAG_PARSING_USERDATA,m)}}logMuxedErr(e){this.warn(`${Qe(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,s){if(this.state!==G.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:i,video:o,audiovideo:a}=t;if(i){const c=e.audioCodec;let u=Cc(i.codec,c);u==="mp4a"&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const h=i.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),i.levelCodec=u,i.id=X.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=X.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(x.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const d=t[c].initSegment;d!=null&&d.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:c,data:d,frag:n,part:null,chunkMeta:s,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,X.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=G.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(le.isBuffered(e,n)?t=this.getAppendedFrag(n):le.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(x.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(x.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Y(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Y(t)){const n=this.getLevelDetails(),s=this.currentFrag||(n?ui(null,n.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class q4 extends xr{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[n].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=N.KEY_LOAD_ERROR,n,s,i){return new xn({type:ee.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:n,networkDetails:s})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!Qe(e)||!Qe(o)||e.sn<o.sn)||!n&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=Pc(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=na(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,c))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=qh(i);let l=this.keyIdToKeyInfo[a];if((n=l)!=null&&n.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(s=l)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:d}=u;return i.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${i.keyId?" keyId: "+gt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=fU(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${gt(a)}`),xs.setKeyIdForUri(e.decryptdata.uri,a)):(a=xs.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${gt(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!Qe(t))return Promise.resolve(n);const i=this.emeController.loadKey(n);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,n))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,s=n.loader,i=new s(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,p,g)=>{const{frag:m,keyInfo:y}=p,v=qh(y.decryptdata);if(!m.decryptdata||y!==this.keyIdToKeyInfo[v])return a(this.createKeyLoadError(m,N.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));y.decryptdata.key=m.decryptdata.key=new Uint8Array(h.data),m.keyLoader=null,y.loader=null,o({frag:m,keyInfo:y})},onError:(h,f,p,g)=>{this.resetLoader(f),a(this.createKeyLoadError(t,N.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),p,xe({url:l.url,data:void 0},h)))},onTimeout:(h,f,p)=>{this.resetLoader(f),a(this.createKeyLoadError(t,N.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(h,f,p)=>{this.resetLoader(f),a(this.createKeyLoadError(t,N.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};i.load(l,u,d)})}resetLoader(e){const{frag:t,keyInfo:n,url:s}=e,i=n.loader;t.keyLoader===i&&(t.keyLoader=null,n.loader=null);const o=qh(n.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function qh(r){if(r.keyFormat!==mt.FAIRPLAY){const e=r.keyId;if(e)return gt(e)}return r.uri}function $E(r){const{type:e}=r;switch(e){case fe.AUDIO_TRACK:return X.AUDIO;case fe.SUBTITLE_TRACK:return X.SUBTITLE;default:return X.MAIN}}function Yh(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Y4{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,s=t.loader,i=n||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:fe.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:s,pathwayId:i,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:n,level:s,pathwayId:i,responseType:"text",type:fe.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:fe.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:fe.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[fe.LEVEL];if(n){const s=n.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(n.abort(),delete this.loaders[fe.LEVEL])}}load(e){var t;const n=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=this.hls.logger,u=s.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===fe.MANIFEST?i=n.manifestLoadPolicy.default:i=_e({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),Y((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===fe.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===fe.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===fe.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const h=Math.max(u*3,d*.8)*1e3;i=_e({},i,{maxTimeToFirstByteMs:Math.min(h,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=c.data;u.parsing.start=performance.now(),sn.isMediaPlaylist(p)||d.type!==fe.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,d,h||null,f):this.handleMasterPlaylist(c,u,d,h)},onError:(c,u,d,h)=>{this.handleNetworkError(u,d,!1,c,h)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};s.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,s){const i=this.hls,o=e.data,a=Yh(e,n),l=sn.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,l.playlistParsingError,s,t);return}const{contentSteering:c,levels:u,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:p}=l;this.variableList=p,u.forEach(v=>{const{unknownCodecs:E}=v;if(E){const{preferManagedMediaSource:S}=this.hls.config;let{audioCodec:T,videoCodec:A}=v;for(let b=E.length;b--;){const R=E[b];Qa(R,"audio",S)?(v.audioCodec=T=T?`${T},${R}`:R,Co.audio[T.substring(0,4)]=2,E.splice(b,1)):Qa(R,"video",S)&&(v.videoCodec=A=A?`${A},${R}`:R,Co.video[A.substring(0,4)]=2,E.splice(b,1))}}});const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":y}=sn.parseMasterPlaylistMedia(o,a,l);g.length&&!g.some(E=>!E.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new $e({}),bitrate:0,url:""})),i.trigger(x.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:m,captions:y,contentSteering:c,url:a,stats:t,networkDetails:s,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:p})}handleTrackOrLevelPlaylist(e,t,n,s,i){const o=this.hls,{id:a,level:l,type:c}=n,u=Yh(e,n),d=Y(l)?l:Y(a)?a:0,h=$E(n),f=sn.parseLevelPlaylist(e.data,u,d,h,0,this.variableList);if(c===fe.MANIFEST){const p={attrs:new $e({}),bitrate:0,details:f,name:"",url:u};f.requestScheduled=t.loading.start+uA(f,0),o.trigger(x.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:u,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=f,this.handlePlaylistLoaded(f,e,t,n,s,i)}handleManifestParsingError(e,t,n,s,i){this.hls.trigger(x.ERROR,{type:ee.NETWORK_ERROR,details:N.MANIFEST_PARSING_ERROR,fatal:t.type===fe.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,n=!1,s,i){let o=`A network ${n?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===fe.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===fe.AUDIO_TRACK||e.type===fe.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=N.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case fe.MANIFEST:l=n?N.MANIFEST_LOAD_TIMEOUT:N.MANIFEST_LOAD_ERROR,c=!0;break;case fe.LEVEL:l=n?N.LEVEL_LOAD_TIMEOUT:N.LEVEL_LOAD_ERROR,c=!1;break;case fe.AUDIO_TRACK:l=n?N.AUDIO_TRACK_LOAD_TIMEOUT:N.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case fe.SUBTITLE_TRACK:l=n?N.SUBTITLE_TRACK_LOAD_TIMEOUT:N.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const d={type:ee.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:i};if(s){const h=(t==null?void 0:t.url)||e.url;d.response=xe({url:h,data:void 0},s)}this.hls.trigger(x.ERROR,d)}handlePlaylistLoaded(e,t,n,s,i,o){const a=this.hls,{type:l,level:c,levelOrTrack:u,id:d,groupId:h,deliveryDirectives:f}=s,p=Yh(t,s),g=$E(s);let m=typeof s.level=="number"&&g===X.MAIN?c:void 0;const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(`${y} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(x.ERROR,{type:ee.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:y,reason:y.message,response:t,context:s,level:m,parent:g,networkDetails:i,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const v=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(x.ERROR,{type:ee.NETWORK_ERROR,details:N.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:v,reason:v.message,response:t,context:s,level:m,parent:g,networkDetails:i,stats:n});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case fe.MANIFEST:case fe.LEVEL:if(m){if(!u)m=0;else if(u!==a.levels[m]){const v=a.levels.indexOf(u);v>-1&&(m=v)}}a.trigger(x.LEVEL_LOADED,{details:e,levelInfo:u||a.levels[0],level:m||0,id:d||0,stats:n,networkDetails:i,deliveryDirectives:f,withoutMultiVariant:l===fe.MANIFEST});break;case fe.AUDIO_TRACK:a.trigger(x.AUDIO_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:h||"",stats:n,networkDetails:i,deliveryDirectives:f});break;case fe.SUBTITLE_TRACK:a.trigger(x.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:h||"",stats:n,networkDetails:i,deliveryDirectives:f});break}}}class Jt{static get version(){return Za}static isMSESupported(){return cR()}static isSupported(){return K4()}static getMediaSource(){return As()}static get Events(){return x}static get MetadataSchema(){return Xt}static get ErrorTypes(){return ee}static get ErrorDetails(){return N}static get DefaultConfig(){return Jt.defaultConfig?Jt.defaultConfig:P4}static set DefaultConfig(e){Jt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Cm,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=tU(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=O4(Jt.DefaultConfig,e,t);this.userConfig=e,n.progressive&&N4(n,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=n,c=new a(this),u=this.abrController=new s(this),d=new QU(this),h=n.interstitialsController,f=h?this.interstitialsController=new h(this,Jt):null,p=this.bufferController=new i(this,d),g=this.capLevelController=new o(this),m=new l(this),y=new Y4(this),v=n.contentSteeringController,E=v?new v(this):null,S=this.levelController=new V4(this,E),T=new j4(this),A=new q4(this.config,this.logger),b=this.streamController=new z4(this,d,A),R=this.gapController=new U4(this,d);g.setStreamController(b),m.setStreamController(b);const L=[y,S,b];f&&L.splice(1,0,f),E&&L.splice(1,0,E),this.networkControllers=L;const I=[u,p,R,g,m,T,d];this.audioTrackController=this.createController(n.audioTrackController,L);const C=n.audioStreamController;C&&L.push(this.audioStreamController=new C(this,d,A)),this.subtitleTrackController=this.createController(n.subtitleTrackController,L);const D=n.subtitleStreamController;D&&L.push(this.subtititleStreamController=new D(this,d,A)),this.createController(n.timelineController,I),A.emeController=this.emeController=this.createController(n.emeController,I),this.cmcdController=this.createController(n.cmcdController,I),this.latencyController=this.createController(G4,I),this.coreComponents=I,L.push(c);const B=c.onErrorOut;typeof B=="function"&&this.on(x.ERROR,B,c),this.on(x.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,s){this._emitter.off(e,t,n,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const s=e===x.ERROR;this.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:s,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(x.ERROR,{type:ee.OTHER_ERROR,details:N.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,s=t?e:{media:n};this._media=n,this.trigger(x.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(x.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,s=this._url=Em.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&n&&(n!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(x.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[X.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[X.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[X.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=U3()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){OU(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let s=0;s<n;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,n)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=n)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=Y_(t);return z_(e,n,navigator.mediaCapabilities)}}Jt.defaultConfig=void 0;function uR(r,[e,t]){return Math.min(t,Math.max(e,r))}function Q4(r){const e=w.useRef({value:r,previous:r});return w.useMemo(()=>(e.current.value!==r&&(e.current.previous=e.current.value,e.current.value=r),e.current.previous),[r])}var dR=["PageUp","PageDown"],hR=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],fR={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Uo="Slider",[Bp,X4,J4]=Xu(Uo),[pR,$8]=Mn(Uo,[J4]),[Z4,bd]=pR(Uo),gR=w.forwardRef((r,e)=>{const{name:t,min:n=0,max:s=100,step:i=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[n],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:f=!1,form:p,...g}=r,m=w.useRef(new Set),y=w.useRef(0),E=o==="horizontal"?e8:t8,[S=[],T]=dl({prop:u,defaultProp:c,onChange:C=>{var B;(B=[...m.current][y.current])==null||B.focus(),d(C)}}),A=w.useRef(S);function b(C){const D=o8(S,C);I(C,D)}function R(C){I(C,y.current)}function L(){const C=A.current[y.current];S[y.current]!==C&&h(S)}function I(C,D,{commit:B}={commit:!1}){const F=u8(i),V=d8(Math.round((C-n)/i)*i+n,F),M=uR(V,[n,s]);T((K=[])=>{const P=s8(K,M,D);if(c8(P,l*i)){y.current=P.indexOf(M);const k=String(P)!==String(K);return k&&B&&h(P),k?P:K}else return K})}return _.jsx(Z4,{scope:r.__scopeSlider,name:t,disabled:a,min:n,max:s,valueIndexToChangeRef:y,thumbs:m.current,values:S,orientation:o,form:p,children:_.jsx(Bp.Provider,{scope:r.__scopeSlider,children:_.jsx(Bp.Slot,{scope:r.__scopeSlider,children:_.jsx(E,{"aria-disabled":a,"data-disabled":a?"":void 0,...g,ref:e,onPointerDown:te(g.onPointerDown,()=>{a||(A.current=S)}),min:n,max:s,inverted:f,onSlideStart:a?void 0:b,onSlideMove:a?void 0:R,onSlideEnd:a?void 0:L,onHomeKeyDown:()=>!a&&I(n,0,{commit:!0}),onEndKeyDown:()=>!a&&I(s,S.length-1,{commit:!0}),onStepKeyDown:({event:C,direction:D})=>{if(!a){const V=dR.includes(C.key)||C.shiftKey&&hR.includes(C.key)?10:1,M=y.current,K=S[M],P=i*V*D;I(K+P,M,{commit:!0})}}})})})})});gR.displayName=Uo;var[mR,yR]=pR(Uo,{startEdge:"left",endEdge:"right",size:"width",direction:1}),e8=w.forwardRef((r,e)=>{const{min:t,max:n,dir:s,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=r,[d,h]=w.useState(null),f=Fe(e,E=>h(E)),p=w.useRef(void 0),g=hd(s),m=g==="ltr",y=m&&!i||!m&&i;function v(E){const S=p.current||d.getBoundingClientRect(),T=[0,S.width],b=Vm(T,y?[t,n]:[n,t]);return p.current=S,b(E-S.left)}return _.jsx(mR,{scope:r.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:_.jsx(vR,{dir:g,"data-orientation":"horizontal",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:E=>{const S=v(E.clientX);o==null||o(S)},onSlideMove:E=>{const S=v(E.clientX);a==null||a(S)},onSlideEnd:()=>{p.current=void 0,l==null||l()},onStepKeyDown:E=>{const T=fR[y?"from-left":"from-right"].includes(E.key);c==null||c({event:E,direction:T?-1:1})}})})}),t8=w.forwardRef((r,e)=>{const{min:t,max:n,inverted:s,onSlideStart:i,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=r,u=w.useRef(null),d=Fe(e,u),h=w.useRef(void 0),f=!s;function p(g){const m=h.current||u.current.getBoundingClientRect(),y=[0,m.height],E=Vm(y,f?[n,t]:[t,n]);return h.current=m,E(g-m.top)}return _.jsx(mR,{scope:r.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:_.jsx(vR,{"data-orientation":"vertical",...c,ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:g=>{const m=p(g.clientY);i==null||i(m)},onSlideMove:g=>{const m=p(g.clientY);o==null||o(m)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:g=>{const y=fR[f?"from-bottom":"from-top"].includes(g.key);l==null||l({event:g,direction:y?-1:1})}})})}),vR=w.forwardRef((r,e)=>{const{__scopeSlider:t,onSlideStart:n,onSlideMove:s,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=r,u=bd(Uo,t);return _.jsx(Ee.span,{...c,ref:e,onKeyDown:te(r.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):dR.concat(hR).includes(d.key)&&(l(d),d.preventDefault())}),onPointerDown:te(r.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():n(d)}),onPointerMove:te(r.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&s(d)}),onPointerUp:te(r.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),i(d))})})}),ER="SliderTrack",SR=w.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,s=bd(ER,t);return _.jsx(Ee.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...n,ref:e})});SR.displayName=ER;var jp="SliderRange",xR=w.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,s=bd(jp,t),i=yR(jp,t),o=w.useRef(null),a=Fe(e,o),l=s.values.length,c=s.values.map(h=>bR(h,s.min,s.max)),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return _.jsx(Ee.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...n,ref:a,style:{...r.style,[i.startEdge]:u+"%",[i.endEdge]:d+"%"}})});xR.displayName=jp;var Gp="SliderThumb",wR=w.forwardRef((r,e)=>{const t=X4(r.__scopeSlider),[n,s]=w.useState(null),i=Fe(e,a=>s(a)),o=w.useMemo(()=>n?t().findIndex(a=>a.ref.current===n):-1,[t,n]);return _.jsx(r8,{...r,ref:i,index:o})}),r8=w.forwardRef((r,e)=>{const{__scopeSlider:t,index:n,name:s,...i}=r,o=bd(Gp,t),a=yR(Gp,t),[l,c]=w.useState(null),u=Fe(e,v=>c(v)),d=l?o.form||!!l.closest("form"):!0,h=sT(l),f=o.values[n],p=f===void 0?0:bR(f,o.min,o.max),g=i8(n,o.values.length),m=h==null?void 0:h[a.size],y=m?a8(m,p,a.direction):0;return w.useEffect(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),_.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${p}% + ${y}px)`},children:[_.jsx(Bp.ItemSlot,{scope:r.__scopeSlider,children:_.jsx(Ee.span,{role:"slider","aria-label":r["aria-label"]||g,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:u,style:f===void 0?{display:"none"}:r.style,onFocus:te(r.onFocus,()=>{o.valueIndexToChangeRef.current=n})})}),d&&_.jsx(TR,{name:s??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},n)]})});wR.displayName=Gp;var n8="RadioBubbleInput",TR=w.forwardRef(({__scopeSlider:r,value:e,...t},n)=>{const s=w.useRef(null),i=Fe(s,n),o=Q4(e);return w.useEffect(()=>{const a=s.current;if(!a)return;const l=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==e&&u){const d=new Event("input",{bubbles:!0});u.call(a,e),a.dispatchEvent(d)}},[o,e]),_.jsx(Ee.input,{style:{display:"none"},...t,ref:i,defaultValue:e})});TR.displayName=n8;function s8(r=[],e,t){const n=[...r];return n[t]=e,n.sort((s,i)=>s-i)}function bR(r,e,t){const i=100/(t-e)*(r-e);return uR(i,[0,100])}function i8(r,e){return e>2?`Value ${r+1} of ${e}`:e===2?["Minimum","Maximum"][r]:void 0}function o8(r,e){if(r.length===1)return 0;const t=r.map(s=>Math.abs(s-e)),n=Math.min(...t);return t.indexOf(n)}function a8(r,e,t){const n=r/2,i=Vm([0,50],[0,n]);return(n-i(e)*t)*t}function l8(r){return r.slice(0,-1).map((e,t)=>r[t+1]-e)}function c8(r,e){if(e>0){const t=l8(r);return Math.min(...t)>=e}return!0}function Vm(r,e){return t=>{if(r[0]===r[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(r[1]-r[0]);return e[0]+n*(t-r[0])}}function u8(r){return(String(r).split(".")[1]||"").length}function d8(r,e){const t=Math.pow(10,e);return Math.round(r*t)/t}var _R=gR,h8=SR,f8=xR,p8=wR;const AR=w.forwardRef(({className:r,...e},t)=>_.jsxs(_R,{ref:t,className:ye("relative flex w-full touch-none select-none items-center",r),...e,children:[_.jsx(h8,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:_.jsx(f8,{className:"absolute h-full bg-primary"})}),_.jsx(p8,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));AR.displayName=_R.displayName;function g8({src:r,title:e,onClose:t,className:n,initialProgress:s=0,onProgressUpdate:i}){const o=w.useRef(null),a=w.useRef(null),[l,c]=w.useState(!1),[u,d]=w.useState(!1),[h,f]=w.useState(!1),[p,g]=w.useState(0),[m,y]=w.useState(0),[v,E]=w.useState(!0),S=w.useRef();w.useEffect(()=>{const C=o.current;if(!C||!r)return;const D=r.includes(".m3u8")||r.includes("m3u8");if(D&&Jt.isSupported()){const B=new Jt({enableWorker:!0,lowLatencyMode:!0});a.current=B,B.on(Jt.Events.ERROR,(F,V)=>{if(console.error("HLS error:",V),V.fatal)switch(V.type){case Jt.ErrorTypes.NETWORK_ERROR:B.startLoad();break;case Jt.ErrorTypes.MEDIA_ERROR:B.recoverMediaError();break;default:B.destroy();break}}),B.loadSource(r),B.attachMedia(C),B.on(Jt.Events.MANIFEST_PARSED,()=>{s>0&&C.duration&&(C.currentTime=C.duration*s)})}else D&&C.canPlayType("application/vnd.apple.mpegurl")?(C.src=r,C.addEventListener("loadedmetadata",()=>{s>0&&C.duration&&(C.currentTime=C.duration*s)})):(C.src=r,C.addEventListener("loadedmetadata",()=>{s>0&&C.duration&&(C.currentTime=C.duration*s)}));return()=>{a.current&&(a.current.destroy(),a.current=null)}},[r,s]),w.useEffect(()=>{const C=o.current;if(!C)return;const D=()=>{g(C.currentTime),C.duration&&i&&i(C.currentTime/C.duration)},B=()=>{y(C.duration)},F=()=>c(!0),V=()=>c(!1);return C.addEventListener("timeupdate",D),C.addEventListener("loadedmetadata",B),C.addEventListener("play",F),C.addEventListener("pause",V),()=>{C.removeEventListener("timeupdate",D),C.removeEventListener("loadedmetadata",B),C.removeEventListener("play",F),C.removeEventListener("pause",V)}},[i]);const T=()=>{const C=o.current;C&&(l?C.pause():C.play())},A=()=>{const C=o.current;C&&(C.muted=!C.muted,d(C.muted))},b=()=>{const C=o.current;C&&(document.fullscreenElement?(document.exitFullscreen(),f(!1)):(C.requestFullscreen(),f(!0)))},R=C=>{const D=o.current;D&&(D.currentTime=C[0],g(C[0]))},L=C=>{const D=Math.floor(C/60),B=Math.floor(C%60);return`${D}:${B.toString().padStart(2,"0")}`},I=()=>{E(!0),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{l&&E(!1)},3e3)};return _.jsxs("div",{className:ye("relative bg-background rounded-lg overflow-hidden",n),onMouseMove:I,onMouseLeave:()=>l&&E(!1),children:[_.jsx("video",{ref:o,className:"w-full aspect-video bg-muted",onClick:T,playsInline:!0,crossOrigin:"anonymous",preload:"metadata"}),_.jsxs("div",{className:ye("absolute inset-0 flex flex-col justify-between transition-opacity duration-300",v?"opacity-100":"opacity-0 pointer-events-none"),children:[_.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-b from-background/80 to-transparent",children:[e&&_.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:e}),t&&_.jsx(ct,{variant:"ghost",size:"icon",onClick:t,children:_.jsx(Nw,{className:"h-4 w-4"})})]}),_.jsxs("div",{className:"p-3 bg-gradient-to-t from-background/80 to-transparent",children:[_.jsx(AR,{value:[p],max:m||100,step:1,onValueChange:R,className:"mb-3"}),_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx(ct,{variant:"ghost",size:"icon",onClick:T,children:l?_.jsx(gC,{className:"h-4 w-4"}):_.jsx(pa,{className:"h-4 w-4"})}),_.jsx(ct,{variant:"ghost",size:"icon",onClick:A,children:u?_.jsx(wC,{className:"h-4 w-4"}):_.jsx(xC,{className:"h-4 w-4"})}),_.jsxs("span",{className:"text-xs text-muted-foreground",children:[L(p)," / ",L(m)]})]}),_.jsx(ct,{variant:"ghost",size:"icon",onClick:b,children:h?_.jsx(fC,{className:"h-4 w-4"}):_.jsx(hC,{className:"h-4 w-4"})})]})]})]})]})}function m8({videos:r,onDeleteVideo:e,onUpdateVideo:t}){const[n,s]=w.useState(""),[i,o]=w.useState("grid"),[a,l]=w.useState(null),c=r.filter(f=>{var p;return f.title.toLowerCase().includes(n.toLowerCase())||((p=f.tags)==null?void 0:p.some(g=>g.toLowerCase().includes(n.toLowerCase())))}),u=f=>{l(a===f?null:f)},d=(f,p)=>{t&&t(f,{watchProgress:p})},h=f=>{try{return new URL(f).hostname.replace("www.","")}catch{return""}};return _.jsxs("div",{className:"space-y-4",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsxs("div",{className:"relative flex-1",children:[_.jsx(mC,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),_.jsx(fm,{placeholder:"Search videos or tags...",value:n,onChange:f=>s(f.target.value),className:"pl-10"})]}),_.jsxs("div",{className:"flex items-center border rounded-md",children:[_.jsx(ct,{variant:i==="grid"?"secondary":"ghost",size:"icon",onClick:()=>o("grid"),children:_.jsx(cC,{className:"h-4 w-4"})}),_.jsx(ct,{variant:i==="list"?"secondary":"ghost",size:"icon",onClick:()=>o("list"),children:_.jsx(dC,{className:"h-4 w-4"})})]}),_.jsx(ct,{variant:"outline",size:"icon",children:_.jsx(lC,{className:"h-4 w-4"})})]}),r.some(f=>f.watchProgress&&f.watchProgress>0&&f.watchProgress<.95)&&_.jsxs("div",{className:"space-y-2",children:[_.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Continue Watching"}),_.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2",children:r.filter(f=>f.watchProgress&&f.watchProgress>0&&f.watchProgress<.95).map(f=>_.jsxs("div",{className:"flex-shrink-0 w-48 cursor-pointer",onClick:()=>u(f.id),children:[_.jsxs("div",{className:"relative aspect-video bg-muted rounded-md overflow-hidden",children:[f.thumbnail?_.jsx("img",{src:f.thumbnail,alt:f.title,className:"w-full h-full object-cover"}):_.jsx("div",{className:"w-full h-full flex items-center justify-center",children:_.jsx(pa,{className:"h-8 w-8 text-muted-foreground"})}),_.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-muted",children:_.jsx("div",{className:"h-full bg-primary",style:{width:`${(f.watchProgress||0)*100}%`}})})]}),_.jsx("p",{className:"text-xs mt-1 truncate",children:f.title})]},f.id))})]}),c.length===0?_.jsx("div",{className:"text-center py-12",children:_.jsx("p",{className:"text-muted-foreground",children:r.length===0?"No videos in your library yet":"No videos match your search"})}):_.jsx("div",{className:ye(i==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3"),children:c.map(f=>_.jsx(vu,{className:"overflow-hidden",children:a===f.id?_.jsx(g8,{src:f.url,title:f.title,initialProgress:f.watchProgress,onClose:()=>l(null),onProgressUpdate:p=>d(f.id,p)}):_.jsxs(Eu,{className:ye("p-0",i==="list"&&"flex items-center gap-4"),children:[_.jsxs("div",{className:ye("relative cursor-pointer",i==="grid"?"aspect-video":"w-32 h-20 flex-shrink-0"),onClick:()=>u(f.id),children:[f.thumbnail?_.jsx("img",{src:f.thumbnail,alt:f.title,className:"w-full h-full object-cover"}):_.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:_.jsx(pa,{className:"h-8 w-8 text-muted-foreground"})}),_.jsx("div",{className:"absolute inset-0 bg-background/50 opacity-0 hover:opacity-100 transition-opacity flex items-center justify-center",children:_.jsx(pa,{className:"h-10 w-10"})}),f.watchProgress&&f.watchProgress>0&&_.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-muted",children:_.jsx("div",{className:"h-full bg-primary",style:{width:`${f.watchProgress*100}%`}})})]}),_.jsxs("div",{className:ye("flex items-start justify-between gap-2",i==="grid"?"p-3":"flex-1 py-2 pr-3"),children:[_.jsxs("div",{className:"min-w-0 flex-1",children:[_.jsx("p",{className:"font-medium truncate",children:f.title}),_.jsx("p",{className:"text-xs text-muted-foreground",children:h(f.url)}),f.tags&&f.tags.length>0&&_.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:f.tags.slice(0,3).map(p=>_.jsx("span",{className:"text-xs bg-secondary px-1.5 py-0.5 rounded",children:p},p))})]}),_.jsxs(h_,{children:[_.jsx(f_,{asChild:!0,children:_.jsx(ct,{variant:"ghost",size:"icon",className:"h-8 w-8",children:_.jsx(oC,{className:"h-4 w-4"})})}),_.jsxs(hm,{align:"end",children:[_.jsxs(hs,{onClick:()=>{window.open(f.url,"_blank")},children:[_.jsx(aC,{className:"h-4 w-4 mr-2"}),"Open Stream URL"]}),_.jsxs(hs,{onClick:()=>{const p=document.createElement("a");p.href=f.url,p.download=`${f.title||"video"}.mp4`,p.target="_blank",document.body.appendChild(p),p.click(),document.body.removeChild(p),dr({title:"Download started",description:"If download doesn't start, the video may be a stream that can't be downloaded directly."})},children:[_.jsx(Vg,{className:"h-4 w-4 mr-2"}),"Download Video"]}),_.jsxs(hs,{children:[_.jsx(vC,{className:"h-4 w-4 mr-2"}),"Edit"]}),_.jsxs(hs,{className:"text-destructive",onClick:()=>e==null?void 0:e(f.id),children:[_.jsx(SC,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]})},f.id))})]})}const y8="stream-manager-db",v8=1,hn="videos";function _d(){return new Promise((r,e)=>{const t=indexedDB.open(y8,v8);t.onerror=()=>e(t.error),t.onsuccess=()=>r(t.result),t.onupgradeneeded=n=>{const s=n.target.result;s.objectStoreNames.contains(hn)||s.createObjectStore(hn,{keyPath:"id"}).createIndex("dateAdded","dateAdded",{unique:!1})}})}async function E8(){const r=await _d();return new Promise((e,t)=>{const i=r.transaction(hn,"readonly").objectStore(hn).getAll();i.onerror=()=>t(i.error),i.onsuccess=()=>{const o=i.result.map(a=>({...a,dateAdded:new Date(a.dateAdded)}));o.sort((a,l)=>l.dateAdded.getTime()-a.dateAdded.getTime()),e(o)}})}async function S8(r){const e=await _d();return new Promise((t,n)=>{const o=e.transaction(hn,"readwrite").objectStore(hn).add({...r,dateAdded:r.dateAdded.toISOString()});o.onerror=()=>n(o.error),o.onsuccess=()=>t()})}async function x8(r,e){const t=await _d();return new Promise((n,s)=>{const o=t.transaction(hn,"readwrite").objectStore(hn),a=o.get(r);a.onerror=()=>s(a.error),a.onsuccess=()=>{const l=a.result;if(!l){s(new Error("Video not found"));return}const c={...l,...e};e.dateAdded&&(c.dateAdded=e.dateAdded instanceof Date?e.dateAdded.toISOString():e.dateAdded);const u=o.put(c);u.onerror=()=>s(u.error),u.onsuccess=()=>n()}})}async function w8(r){const e=await _d();return new Promise((t,n)=>{const o=e.transaction(hn,"readwrite").objectStore(hn).delete(r);o.onerror=()=>n(o.error),o.onsuccess=()=>t()})}function T8(){const[r,e]=w.useState([]),[t,n]=w.useState(!0);w.useEffect(()=>{E8().then(e).catch(console.error).finally(()=>n(!1))},[]);const s=w.useCallback(async a=>{const l={...a,id:crypto.randomUUID(),dateAdded:new Date,watchProgress:0,tags:a.tags||[]};try{return await S8(l),e(c=>[l,...c]),l}catch(c){throw console.error("Failed to add video:",c),c}},[]),i=w.useCallback(async(a,l)=>{try{await x8(a,l),e(c=>c.map(u=>u.id===a?{...u,...l}:u))}catch(c){throw console.error("Failed to update video:",c),c}},[]),o=w.useCallback(async a=>{try{await w8(a),e(l=>l.filter(c=>c.id!==a))}catch(l){throw console.error("Failed to delete video:",l),l}},[]);return{videos:r,isLoading:t,addVideo:s,updateVideo:i,deleteVideo:o}}const b8=()=>{const{videos:r,isLoading:e,addVideo:t,updateVideo:n,deleteVideo:s}=T8(),i=async o=>{try{await t({title:o.title,url:o.url,thumbnail:o.thumbnail,tags:[]})}catch(a){console.error("Failed to save video:",a)}};return _.jsxs("div",{className:"min-h-screen bg-background",children:[_.jsx("header",{className:"border-b",children:_.jsxs("div",{className:"container mx-auto px-4 h-14 flex items-center justify-between",children:[_.jsx("h1",{className:"text-lg font-semibold",children:"Stream Manager"}),_.jsx(lF,{})]})}),_.jsx("main",{className:"container mx-auto px-4 py-6",children:_.jsxs(QO,{defaultValue:"downloads",className:"w-full",children:[_.jsxs(lb,{className:"grid w-full max-w-md mx-auto grid-cols-2 mb-6",children:[_.jsxs(op,{value:"downloads",className:"flex items-center gap-2",children:[_.jsx(Vg,{className:"h-4 w-4"}),"Downloads"]}),_.jsxs(op,{value:"library",className:"flex items-center gap-2",children:[_.jsx(uC,{className:"h-4 w-4"}),"Library ",!e&&r.length>0&&`(${r.length})`]})]}),_.jsx(ap,{value:"downloads",children:_.jsx(W2,{onVideoReady:i})}),_.jsx(ap,{value:"library",children:_.jsx(m8,{videos:r,onDeleteVideo:s,onUpdateVideo:n})})]})})]})},_8=()=>{const r=BT();return w.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),_.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:_.jsxs("div",{className:"text-center",children:[_.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),_.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),_.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},A8=new HD,R8=()=>_.jsx(zD,{client:A8,children:_.jsx(OO,{defaultTheme:"system",storageKey:"stream-manager-theme",children:_.jsxs(xD,{children:[_.jsx(sk,{}),_.jsx(Mk,{}),_.jsx(PO,{children:_.jsxs(LO,{children:[_.jsx(np,{path:"/",element:_.jsx(b8,{})}),_.jsx(np,{path:"*",element:_.jsx(_8,{})})]})})]})})});aw(document.getElementById("root")).render(_.jsx(R8,{}));
